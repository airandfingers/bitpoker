$("#chat_table").css("display","none");$("#chat_table").css("top","1000px");function onKeyDown(event){event.preventDefault()}window.onKeydown=onKeyDown;function Table(){self=this;this.events={};this.imageData={maxChipsPerColumn:5,distanceBetweenChipColumns:4,chatBoxAlpha:.75,maxChipColumns:3,numberOfPlayersSet:false};this.sessionPreferences={displaySize:{value:"desktop",updateValue:function(newValue){this.value=newValue;if(self.sessionPreferences.displaySize=="mobile"){if(!_.isObject(self.permanentPreferences.sourceObjects.value.mobileCards)){self.permanentPreferences.sourceObjects.value.mobileCards={}}self.images.sources.cardImageFolder=self.images.sources.mobileCardFolder;self.permanentPreferences.sourceObjects.value.cardObjectParent=self.permanentPreferences.sourceObjects.value.mobileCards}else{if(!_.isObject(self.permanentPreferences.sourceObjects.value.desktopCards)){self.permanentPreferences.sourceObjects.value.desktopCards={}}self.images.sources.cardImageFolder=self.images.sources.desktopCardFolder;self.permanentPreferences.sourceObjects.value.cardObjectParent=self.permanentPreferences.sourceObjects.value.desktopCards}}},changeUserSeatViewTo:{value:false,updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){self.changeUserSeatView(this.value)}}},tableChatFull:{tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels:{value:true,updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){var movementObject={};movementObject.magnitude=newValue;self.moveTableChatFullMessageText(movementObject)}}},defaultItemsToHideFalseHidesItem:{hideDealerMessages:{value:true,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hideDealerMessagesOn:{value:false,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hidePlayerMessages:{value:true,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hidePlayerMessagesOn:{value:false,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hideObserverMessages:{value:true,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hideObserverMessagesOn:{value:false,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},disableTouchScroll:{value:true,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},disableTouchScrollOn:{value:false,updateValue:function(newValue,options){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}}}}};this.permanentPreferences={defaultFontType:{value:"Lucida Sans"},sourceObjects:{value:parent.sourceObjects,updateValue:function(newValue){var newerValue=newValue;if(!_.isObject(newValue)){console.log("permanent preferences creating new parent.sourceObjects = {}");if(!_.isObject(parent.sourceObjects)){parent.sourceObjects={}}var newerValue=parent.sourceObjects}this.value=newerValue}},bigBlindsPerHorizontalSliderTick:{value:.5},bigBlindsPerMouseScroll:{value:.5},timePerHorizontalSliderTick:{value:500},animate:{value:true},playerChatMaxLines:{value:3},chatTextColor:{value:"#FFFFFF",updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){var stagesToUpdate=[];for(var i=0;i<self.images.seats.length;i++){stagesToUpdate.push(self.itemChanged(self.images.seats[i].chat.text.color=this.value))}self.updateStages(stagesToUpdate)}}},tableChatFull:{chatMessageFontSize:{value:11,updateValue:function(newValue){this.value=newValue;self.jQueryObjects.tableChatFullParagraph.css("font-size",this.value)}},chatMessageFontColor:{value:"white",updateValue:function(newValue){this.value=newValue;self.jQueryObjects.tableChatFullParagraph.css("color",this.value)}},windowColor:{value:"black"},windowAlpha:{value:.4,updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateStages(self.itemChanged(self.images.tableChatFull.window.alpha=this.value))}}}}};this.performance={};this.performance.numCanvasClears=0;this.gameState={};this.gameState.itemsCreated=false;this.gameState.defaulttimeToActInMS=15e3;this.gameState.numSeats=10;this.gameState.tableChatFull={log:[],lastDisplayedLogIDNumber:null,currentlyDisplayingDealerMessages:null,currentlyDisplayingPlayerMessages:null,currentlyDisplayingObserverMessages:null,scrollToBasedOnHiddenPixelsAtTopOfChatMessageText:99999999,mouseDown:false};this.gameState.betSize=new Number;this.gameState.displaySize="normal";this.gameState.secondsToAct;this.gameState.userSeatNumber=false;this.gameState.act={};this.gameState.street={};this.gameState.once={};this.gameState.hand={};this.gameState.seats=[];for(var i=0;i<this.gameState.numSeats;i++){this.gameState.seats[i]={};this.gameState.seats[i].displayMessageType="openSeat";this.gameState.seats[i].toAct=false;this.gameState.seats[i].inHand=false;this.gameState.seats[i].act={};this.gameState.seats[i].once={};this.gameState.seats[i].street={};this.gameState.seats[i].hand={};this.gameState.seats[i].flags={}}this.gameState.cashier={};this.gameState.tableChatBox={};this.gameState.messageBox={};this.gameState.messageBox.activeStages=[];var staticItems=0;var holeCardsAndButtons=staticItems+1;var middleTableItemsAndAnimations=holeCardsAndButtons+1;var playerBubbleChat=middleTableItemsAndAnimations+1;var chatBox=playerBubbleChat+1;var tableChatFull=chatBox+1;var cashier=tableChatFull+1;var messageBox=cashier+1;var loadingContainers=messageBox+1;this.gameState.zPositionData={containersPerCashier:3,tableChatFullTotalContainers:5,containersPerMessageBox:3,numContainers:55};this.gameState.zPositionData.background={stage:staticItems,container:0,numContainers:2,stageOptions:{mouseEnabled:false,enableDOMEvents:false,mouseOverFrequency:0,touchEnabled:false}};this.gameState.zPositionData.table={stage:staticItems,container:1};this.gameState.zPositionData.holeCards={stage:holeCardsAndButtons,container:0,newCanvas:true,numContainers:5,stageOptions:{mouseEnabled:true,enableDOMEvents:true,touchEnabled:true,mouseOverFrequency:30}};this.gameState.zPositionData.button={stage:holeCardsAndButtons,container:2};this.gameState.zPositionData.playerBubbleChat={stage:playerBubbleChat,container:0,numContainers:2,stageOptions:this.gameState.zPositionData.background.stageOptions};this.gameState.zPositionData.communityCards={stage:middleTableItemsAndAnimations,container:0,numContainers:5,stageOptions:this.gameState.zPositionData.background.stageOptions};this.gameState.zPositionData.chips={stage:middleTableItemsAndAnimations,container:1};this.gameState.zPositionData.cardAnimation={stage:middleTableItemsAndAnimations,container:2};this.gameState.zPositionData.chat={stage:chatBox,container:0,numContainers:1,stageOptions:this.gameState.zPositionData.background.stageOptions};this.gameState.zPositionData.cashier={stage:cashier,container:0,canvasHidden:true,numContainers:2,newCanvas:true,stageOptions:this.gameState.zPositionData.button.stageOptions};this.gameState.zPositionData.initialMessageBox={stage:messageBox,container:0,canvasHidden:true,numContainers:32,newCanvas:true,stageOptions:this.gameState.zPositionData.button.stageOptions};this.gameState.zPositionData.finalMessageBox={stage:messageBox,container:29};this.gameState.zPositionData.loadingBackground={stage:loadingContainers,container:0,numContainers:3,newCanvas:true,stageOptions:this.gameState.zPositionData.background.stageOptions};this.gameState.zPositionData.loadingAnimation={stage:loadingContainers,container:1};this.gameState.zPositionData.tableChatFull={stage:tableChatFull,container:0,canvasHidden:true,newCanvas:true,numContainers:4,stageOptions:this.gameState.zPositionData.button.stageOptions};this.gameState.zPositionData.tableChatFullButton={stage:tableChatFull,container:3};this.gameState.zPositionData.tableChatFullText={stage:tableChatFull,container:1};this.jQueryObjects={};this.jQueryObjects.canvasDiv=$("#pokerCanvasDiv");this.jQueryObjects.tableChatFullDiv=$("#tableChatFullTextDiv");this.jQueryObjects.tableChatFullParagraph=$("#tableChatFullText");this.jQueryObjects.chatBoxInput=$("#chat");this.jQueryObjects.cashierForm=$("#cashier");this.gameState.stageData=[];this.arrayOfParentsOfStageAndOfContainerArray=[];this.images={};this.images.sourceObjects={};this.images.sourceObjects.mobileCards={};this.images.sourceObjects.desktopCards={};this.images.sourceObjects.cardObjectParent={};this.images.sources={cardBackFileNameWithoutExtension:"back",background:"img/gray_bg.jpg",table:"img/table.png",dealerButton:"img/dealer_button_red.png",verticalSlider:"img/raise_slider.png",horizontalSlider:"img/small_slider_bg.png",cashierBackground:"img/cashier_background.png",cashierCloseX:"img/cashier_close_window_x.jpg",cashierButton:"img/cashier.png",cashierButtonOver:"img/cashier_over.png",cashierButtonPress:"img/cashier_press.png",cashierButtonSprite:"img/cashier_button_sprite.png",getChips:"img/get_chips.png",showTableChatFull:"img/show_chat.png",hideTableChatFull:"img/hide_chat.png",standUp:"img/stand_up.png",exitTable:"img/exit_table.png",messageBoxBackground:"img/message_box.png",messageBoxCloseX:"img/message_box_close_window_x.jpg",checkBox:"img/check_box.png",checkBoxChecked:"img/check_box_clicked.png",dealHoleCardSound:"sound/deal_hole_card.wav",checkSound:"sound/check.wav",betSound:"sound/bet.wav",shuffleSound:"sound/shuffle.wav",dealCommunity:"sound/deal_community.wav",foldSound:"sound/fold.wav",moveChipsSound:"sound/move_chips.wav",chips:{red:"img/chips/red_chip.png",black:"img/chips/black_chip.png",10:"img/chips/10.png"},mobileCardFolder:"img/fourcolordeck/resize/",desktopCardFolder:"img/fourcolordeck/"};this.images.background={};this.images.pots=[];for(var i=0;i<9;i++){this.images.pots[i]={};this.images.pots[i].potSize={text:{}};this.images.pots[i].chips=[];this.images.pots[i].firstChip={};this.images.pots[i].secondChip={};this.images.pots[i].secondColumnChip={}}this.images.totalPotSize={};this.images.fold={text:{},messages:[]};this.images.call={text:{},messages:[]};this.images.bet={text:{},messages:[]};this.images.raise={text:{},messages:[]};this.images.bet={text:{},messages:[]};this.images.check={text:{},messages:[]};this.images.betSlider={};this.images.cashier={};this.images.messageBox=[];for(var i=0;i<=this.gameState.zPositionData.finalMessageBox;i++){this.images.messageBox.push({})}this.images.community=[{},{},{},{},{}];this.images.leftSideButtons=[];this.images.rightSideButtons=[];for(var i=0;i<3;i=i+1){this.images.leftSideButtons[i]={};this.images.rightSideButtons[i]={}}this.images.seats=[];for(var i=0;i<this.gameState.numSeats;i=i+1){this.images.seats[i]={};this.images.seats[i].nonRotatedSeatNumber=i;this.images.seats[i].originalSeatNumber=i;this.images.seats[i].rotatedSeatNumber=i;this.images.seats[i].seat={};this.images.seats[i].text={};this.images.seats[i].bet={};this.images.seats[i].chips=[];this.images.seats[i].firstChip={};this.images.seats[i].secondChip={};this.images.seats[i].secondColumnChip={};this.images.seats[i].messages=[];this.images.seats[i].hiddenCards=[];this.images.seats[i].shownCards=[];this.images.seats[i].dealerButton={}}this.images.Item=function(x,y,width,height,zIndexOrStageAndContainerObject,options){this.position={};this.position.x=Math.floor(x);this.position.y=Math.floor(y);this.position.z={};if(!_.isObject(zIndexOrStageAndContainerObject)){throw"z data not given for Item constructor"}if(_.isObject(zIndexOrStageAndContainerObject)){this.position.z=zIndexOrStageAndContainerObject}else if(_.isNumber(zIndexOrStageAndContainerObject)&&zIndexOrStageAndContainerObject>=0){for(var i=0;i<=zIndexOrStageAndContainerObject;i++){for(var stageNumber=0;stageNumber<self.arrayOfParentsOfStageAndOfContainerArray.length;stageNumber++){if(i+self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers.length<zIndexOrStageAndContainerObject){i=i+self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers.length}else{this.position.z.stage=stageNumber;this.position.z.container=zIndexOrStageAndContainerObject-i}}}}this.size={};this.size.x=width;this.size.y=height;if(options){if(options.messages){this.messages=options.messages}if(options.otherMessages){this.otherMessages=options.otherMessages}}this.drawRoundedRectangle=function(fillColor){this.image.graphics.beginFill(fillColor).drawRoundRect(0,0,this.size.x,this.size.y,this.size.y*.1)}};this.images.itemAsBitmap=function(item,source,options){if(!options){var options={}}var stagesToUpdate=[];if(_.isString(source)){var tempImage=new Image;tempImage.src=source;item.image=new createjs.Bitmap(tempImage)}else if(_.isObject(source)){item.image=new createjs.Bitmap(source)}else{console.log("itemAsBitmap passed non source paramater");console.log(source instanceof parent.window.Image);console.log(source);throw""}self.positionItemImage(item,{update:false});item.image.parentOfImageObject=item;item.bitmapSource=source;if(item.messages){item.image.onClick=self.events.onButtonClick}stagesToUpdate.push(self.itemChanged(item));if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.images.cardAsBitmap=function(item,card,options){if(!options){var options={}}var stagesToUpdate=[];if(self.sessionPreferences.displaySize.value!=="mobile"){var sourceParent=self.permanentPreferences.sourceObjects.value.cardObjectParent}else{var sourceParent=self.permanentPreferences.sourceObjects.value.cardObjectParent}if(card instanceof Image){var source=card}else if(_.isString(card)){var source=sourceParent[card]}else{var source=sourceParent.cardBack}stagesToUpdate.push(this.itemAsBitmap(item,source,options));if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.images.itemAsRectangle=function(item,fillColor){item.image=new createjs.Shape;self.positionItemImage(item,{update:false});item.drawRoundedRectangle(fillColor);item.image.parentOfImageObject=item;item.fillColor=fillColor;if(item.messages){item.image.onClick=self.events.onButtonClick}};this.images.drawSeat=function(parent,borderColor,fillColor,middleDividerColor,options){if(parent.image instanceof createjs.Shape){}else{parent.image=new createjs.Shape;parent.image.parentOfImageObject=parent}if(options&&options.outerStrokeWidth){var outerStrokeWidth=options.outerStrokeWidth}else{var outerStrokeWidth=2}if(options&&options.middleDividerStrokeWidth){var middleDividerStrokeWidth=options.middleDividerStrokeWidth}else{var middleDividerStrokeWidth=1}var x=outerStrokeWidth/2;var y=outerStrokeWidth/2;var width=parent.size.x-outerStrokeWidth;var height=parent.size.y-outerStrokeWidth;parent.image.graphics.clear();parent.image.alpha=1;parent.image.snapToPixel=true;parent.image.graphics.setStrokeStyle(outerStrokeWidth,"round").beginStroke(borderColor).beginFill(fillColor).drawRect(x,y,width,height);if(options&&options.borderFillRatio&&_.isNumber(options.borderFillRatio)&&options.borderFillRatio>0){if(options&&options.newFillColor){var newFillColor=options.newFillColor}else{newFillColor="#FFFF00"}parent.image.graphics.setStrokeStyle(outerStrokeWidth,"square").beginStroke(newFillColor);var totalDistance=width*2+height*2;var distanceToFill=options.borderFillRatio*totalDistance;parent.image.graphics.moveTo(x,y);if(distanceToFill>=height){parent.image.graphics.lineTo(x,y+height);distanceToFill=distanceToFill-height}else if(distanceToFill>0){parent.image.graphics.lineTo(x,y+distanceToFill);distanceToFill=0}if(distanceToFill>=width){parent.image.graphics.lineTo(x+width,y+height);distanceToFill=distanceToFill-width}else if(distanceToFill>0){parent.image.graphics.lineTo(x+distanceToFill,y+height);distanceToFill=0}if(distanceToFill>=height){parent.image.graphics.lineTo(x+width,y);distanceToFill=distanceToFill-height}else if(distanceToFill>0){parent.image.graphics.lineTo(x+width,y+height-distanceToFill);distanceToFill=0}if(distanceToFill>=width){parent.image.graphics.lineTo(x,y);distanceToFill=distanceToFill-width}else if(distanceToFill>0){parent.image.graphics.lineTo(x+width-distanceToFill,y);distanceToFill=0}}parent.image.graphics.setStrokeStyle(middleDividerStrokeWidth).beginStroke(middleDividerColor);parent.image.borderColor=borderColor;parent.image.fillColor=fillColor;parent.image.middleDividerColor=middleDividerColor;parent.image.outerStrokeWidth=outerStrokeWidth;parent.image.middleDividerStrokeWidth=middleDividerStrokeWidth;self.positionItemImage(parent,{update:false});var stage=parent.position.z.stage;var container=parent.position.z.container;if(self.arrayOfParentsOfStageAndOfContainerArray[stage].containers[container].contains(parent.image)){self.arrayOfParentsOfStageAndOfContainerArray[stage].upToDate=false}return stage};this.images.addItemText=function(parentOfImageObject,text,sizeAndFont,color,options){if(!options){var options={}}parentOfImageObject.text=new createjs.Text(text,sizeAndFont,color);if(options.textAlign==="left"){parentOfImageObject.text.x=parentOfImageObject.position.x;parentOfImageObject.text.textAlign=options.textAlign}else{parentOfImageObject.text.x=parentOfImageObject.position.x+parentOfImageObject.size.x/2;parentOfImageObject.text.textAlign="center"}parentOfImageObject.text.y=parentOfImageObject.position.y+2;parentOfImageObject.text.baseline="top";parentOfImageObject.text.maxWidth=parentOfImageObject.size.x*.9;parentOfImageObject.textColor=color;_.each(options,function(value,index,list){if(!_.isObject(value)&&!_.isUndefined(value)&&!_.isFunction(parentOfImageObject.text[index])){parentOfImageObject.text[index]=value}})};this.events.buttonMouseDown=function(event){if(event.target instanceof createjs.Shape){event.target.graphics.clear();event.target.graphics.beginFill("red").drawRoundRect(0,0,event.target.parentOfImageObject.size.x,event.target.parentOfImageObject.size.y,event.target.parentOfImageObject.size.y*.15);event.target.parentOfImageObject.text.y=event.target.parentOfImageObject.text.y+2;self.updateStages(event.target.parentOfImageObject.position.z.stage);event.onMouseUp=function(event){event.target.graphics.clear();event.target.graphics.beginFill(event.target.parentOfImageObject.fillColor).drawRoundRect(0,0,event.target.parentOfImageObject.size.x,event.target.parentOfImageObject.size.y,event.target.parentOfImageObject.size.y*.15);event.target.parentOfImageObject.text.y=event.target.parentOfImageObject.text.y-2;self.updateStages(event.target.parentOfImageObject.position.z.stage)}}};this.events.onButtonClick=function(event){if(event.target.parentOfImageObject.messages)socket.emit.apply(socket,event.target.parentOfImageObject.messages);if(event.target.parentOfImageObject.otherMessages){socket.emit.apply(socket,event.target.parentOfImageObject.otherMessages)}};this.events.foldToAnyBetClick=function(event){self.setPreactionData("hand","check",true);self.setPreactionData("hand","fold",true);self.updateUserOptionsBasedOnFlagsAndPreactions()};this.events.foldToAnyBetOnClick=function(event){console.log("this.events.foldToAnyBetOnClick called");self.setPreactionData("hand","check",false);self.setPreactionData("hand","fold",false);self.updateUserOptionsBasedOnFlagsAndPreactions()};this.events.cashierTextFieldFocused=function(event){$(event.target).one("mouseup",function(e){e.preventDefault()}).select()};this.events.cashierInputSelected=function(event){var min;var allRadios=$(event.target.parentElement.parentElement).find("input[type='radio']");var parentID=false;if(event.target.parentElement.id=="otherAmountDiv"){min=self.gameState.cashier.min;parentID=event.target.parentElement.id}else if(event.target.parentElement.id=="autoRebuyDiv"){min=self.gameState.cashier.table_min;parentID=event.target.parentElement.id}else if(event.target.parentElement.id=="maxDiv"){min=self.gameState.cashier.max;parentID=event.target.parentElement.id}if(parentID){var radioInClickedDiv=$("#"+parentID).find("input[type='radio']");if(radioInClickedDiv&&radioInClickedDiv.prop("checked")==false){allRadios.prop("checked",false);radioInClickedDiv.prop("checked",true)}var textField=$(event.target.parentElement).find("input[type='text']");var alreadySelected=false;if(typeof parseFloat(textField.val())=="number"&&parseFloat(textField.val())>=min){}else{textField.val(min);textField.select();alreadySelected=true}if($(event.target).is("input[type='text']")){}else if(alreadySelected!=true){textField.select()}}};this.events.onCashierTextFieldFocus=function(event){$(event.target).one("mouseup",function(event){event.preventDefault()}).select()};this.events.onAddChipsClick=function(event){if($("#maxRadio").is(":checked")){socket.emit("add_chips",self.gameState.cashier.max,self.gameState.cashier.currency)}else if($("#otherAmountRadio").is(":checked")){var amount=$("#otherAmount").val();if(isNaN(amount)){var info={};info.okay=true;var message="amount must be a number";self.displayMessageBox(message,info)}else{socket.emit("add_chips",Number(amount),self.gameState.cashier.currency)}}else if($("#autoRebuyRadio").is(":checked")){var amount=$("#autoRebuy").val();if(isNaN(otherAmount)){var info={};info.okay=true;var message="Amount must be a number";self.displayMessageBox(message,info)}else{socket.emit("auto_rebuy",Number(amount),self.gameState.cashier.currency)}}else if(!$("input[name='addChipsRadio']:checked").val()){var info={};info.okay=true;var message="Please select either: max, other amount, or auto-rebuy";self.displayMessageBox(message,info)}};this.events.onStagePress=function(event){$(":text").blur()};this.events.mouseDownClickAndDrag=function(event,options){console.log("mousedownclick and drag called");console.log(event);if(!options){var options={}}var defaultOptions={};defaultOptions.permanent=false;if(event.target.parentOfImageObject instanceof self.images.Item){defaultOptions.animationTarget=event.target.parentOfImageObject}_.defaults(options,defaultOptions);var initialX=event.stageX;var initialY=event.stageY;event.onMouseMove=function(e){console.log(e);var moveX=e.stageX-initialX;var moveY=e.stageY-initialY;initialX=initialX+moveX;initialY=initialY+moveY;self.setImageItemPositionAndTextBasedOnImageChange(options.animationTarget,moveX,moveY,options)}};this.events.seatMouseEvent=function(event,options){if(!options){var options={}}var defaults={};if(_.isObject(event.target.parentOfImageObject)&&_.isObject(event.target.parentOfImageObject.seatObjectAncestor)){defaults.seatObject=event.target.parentOfImageObject.seatObjectAncestor;defaults.seatNum=defaults.seatObject.nonRotatedSeatNumber;defaults.animationTime=600}options=_.defaults(options,defaults);var animationTime=options.animationTime;var seatObject=options.seatObject;var seatNum=options.seatNum;var getHoleCardAnimationArray=function(){return self.gameState.seats[seatNum].hand.holeCardsPopupAnimation};var animationBottomY=seatObject.seat.position.y;var animationTopY=seatObject.hiddenCards[0].position.y;var animationDistanceY=animationTopY-animationBottomY;if(animationDistanceY<0){animationDistanceY=animationDistanceY*-1}var animationSpeed=animationDistanceY/animationTime;var seatBottomY=seatObject.seat.position.y+seatObject.seat.size.y;var displayedAnimationArray=false;var getAnimationDirection=function(){return self.gameState.seats[seatNum].hand.holeCardAnimationDirection};var setAnimationDirection=function(direction){self.gameState.seats[seatNum].hand.holeCardAnimationDirection=direction};var killCheckingFunction=function(){if(self.gameState.seats[seatNum].checkingForFoldedHoleCardAnimation){clearInterval(self.gameState.seats[seatNum].checkingForFoldedHoleCardAnimation)}};var getPreviousCheckingFunctionEvent=function(){return self.gameState.seats[seatNum].hand.checkingForFoldedHoleCardAnimationEvent};var storeEvent=function(){event.options=options;self.gameState.seats[seatNum].hand.checkingForFoldedHoleCardAnimationEvent=event};var setCorrectEventAndOptions=function(){var useCurrentEvent=false;var previousEvent=getPreviousCheckingFunctionEvent();if(!_.isObject(previousEvent)){return false}var isSeatMouseEvent=event.target.id===seatObject.seat.image.id;var isPreviousEventSeatMouseEvent=previousEvent.target.id===previousEvent.options.seatObject.seat.image.id;var areBothEventsSameTarget=event.target.id===previousEvent.target.id;var areBothEventsRelatedToTheSameSeat=seatNum===previousEvent.options.seatNum;if(areBothEventsSameTarget===true||event.type===previousEvent.type||areBothEventsRelatedToTheSameSeat===false||event.type!=="mouseover"&&event.type!=="mouseout"||previousEvent.type!=="mouseover"&&previousEvent.type!=="mouseout"||isPreviousEventSeatMouseEvent===true&&isSeatMouseEvent===true){useCurrentEvent=true}else if(event.type==="mouseover"){useCurrentEvent=true}else{useCurrentEvent=false}if(useCurrentEvent===false){event=previousEvent;options=previousEvent.options}};setCorrectEventAndOptions();storeEvent();killCheckingFunction();if(event.type==="mouseover"){animateUp();keepChecking()}else if(event.type==="mouseout"){animateDown()}event.onMouseMove=function(event){console.log("onmousemove called");animateUp()};event.onMouseDown=function(event){};event.onMouseUp=function(event){};event.onMouseOut=function(event){console.log("mouseout")};function keepChecking(){killCheckingFunction();var interval=80;var isSeatMouseEvent=event.target.id===seatObject.seat.image.id;self.gameState.seats[seatNum].checkingForFoldedHoleCardAnimation=setInterval(function(){console.log("animation direction is: "+getAnimationDirection());if(getAnimationDirection()===("bottom"||"up"||"down")){killCheckingFunction()}else{console.log("checking to see if we should animate");if(shouldAnimate()===true){if(isSeatMouseEvent===true){console.log("shouldanimate = true, eventtype is: "+event.type+" isseatmouseevent = "+isSeatMouseEvent);killCheckingFunction();self.events.seatMouseEvent(event,options)}}else{console.log("shouldAnimate = false, ending hole card popup animations");console.log("eventtype is: "+event.type+" isseatmouseevent = "+isSeatMouseEvent);endAnimations();if(event.type!=="mouseover"||isSeatMouseEvent!==true){killCheckingFunction()}}}},interval)}function animateUp(){var animationInfoArray=[];if(getAnimationDirection()==="top"){return false}if(getAnimationDirection()==="up"){return false}if(!_.isArray(getHoleCardAnimationArray())){console.log("animateup stopped cuz no cards");return false}console.log("animating up "+getAnimationDirection());setAnimationDirection("up");var holeCardAnimationArray=getHoleCardAnimationArray();_.each(_.range(holeCardAnimationArray.length),function(cardNumber){animationInfoArray[cardNumber]={item:holeCardAnimationArray[cardNumber],finalY:animationTopY,onTick:onAnimationTick,animationTime:(holeCardAnimationArray[cardNumber].image.y-animationBottomY)/animationSpeed,onEnd:function(){keepChecking();setAnimationDirection("top")},onStart:function(animationInfo){displayedAnimationArray=holeCardAnimationArray;cropCardImages();self.displayChildren(animationInfo.item)}}});_.each(_.range(holeCardAnimationArray.length),function(cardNumber){self.animateImage(animationInfoArray[cardNumber])})}function animateDown(){var animationInfoArray=[];if(getAnimationDirection()!=="top"&&getAnimationDirection()!=="up"){return false}if(!_.isArray(getHoleCardAnimationArray())){return false}setAnimationDirection("down");console.log("animating down");var holeCardAnimationArray=getHoleCardAnimationArray();_.each(_.range(holeCardAnimationArray.length),function(cardNumber){animationInfoArray[cardNumber]={item:holeCardAnimationArray[cardNumber],finalY:animationBottomY,onTick:onAnimationTick,animationTime:(animationTopY-holeCardAnimationArray[cardNumber].image.y)/animationSpeed,onEnd:function(animationInfo,imageTween,textTween){setAnimationDirection("bottom");self.hideChildren(animationInfo.item)},onStart:function(){displayedAnimationArray=holeCardAnimationArray;cropCardImages()}}});_.each(_.range(holeCardAnimationArray.length),function(cardNumber){self.animateImage(animationInfoArray[cardNumber])})}function endAnimations(){self.hideChildren(displayedAnimationArray);setAnimationDirection(false)}function shouldAnimate(){if(self.gameState.seats[seatNum].inHand!==false){return false}if(seatObject.rotatedSeatNumber===self.gameState.userSeatNumber){if(!(_.isArray(self.gameState.holeCards)&&self.gameState.holeCards.length>0)){return false}}else if(!_.isObject(seatObject.shownCards[0].image)||self.isItemAddedToStage(seatObject.shownCards[0])||!_.isObject(seatObject.shownCards[1].image)||self.isItemAddedToStage(seatObject.shownCards[1])||!_.isObject(seatObject.hiddenCards[0].image)||self.isItemAddedToStage(seatObject.hiddenCards[0])||!_.isObject(seatObject.hiddenCards[1].image)||self.isItemAddedToStage(seatObject.hiddenCards[1])){return false}if(!_.isArray(getHoleCardAnimationArray()||getHoleCardAnimationArray().length===0)){return false}return true}function onAnimationTick(animationInfo,imageTween,textTween){if(shouldAnimate()===false){imageTween.removeTweens(imageTween.target);textTween.removeTweens(textTween.target);endAnimations()}else{cropCardImages()}}function cropCardImages(){self.adjustHoleCardImageSourceRectangle(getHoleCardAnimationArray(),{seatNumber:seatNum})}};this.events.showTableChatFullOnClick=function(){self.displayTableChatFull();$("#chatForm").blur();self.jQueryObjects.tableChatFullParagraph.blur()};this.events.hideTableChatFullOnClick=function(){self.hideTableChatFull()};this.moveTableChatFullMessageText=function(movementObject,options){var velocityTo0InMiliseconds=1e3;if(!movementObject){var movementObject={}}var defaults={};defaults.relativeUnit="pixels";defaults.relativity="top";if(!_.isNumber(movementObject.magnitude)){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("using mcustomsrollbar function to scroll to bottom, then update");self.jQueryObjects.tableChatFullDiv.mCustomScrollbar("scrollTo","bottom");movementObject.resize=true}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();if(!_.isObject(scroll[0])){console.log(scroll)}if(scroll[0].getContentSize().h!=self.jQueryObjects.tableChatFullDiv.height()){self.jQueryObjects.tableChatFullDiv.scrollTop(scroll[0].getContentSize().h*1.5);movementObject.resize=true}}}else{if(movementObject.positionUnit=="pixels"){}if(_.isNumber(movementObject.magnitude)){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();scroll[0].scrollTop(self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value);movementObject.resize=true}}}if(movementObject.resize===true){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("calling update function of mcustomscrollbar");self.jQueryObjects.tableChatFullDiv.mCustomScrollbar("update")}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();scroll[0].resize()}}};this.events.tableChatFullChatMessageTextMouseDown=function(e){self.gameState.tableChatFull.mouseDown=true;console.log("tablechatfull text clicked");var initialRawX=e.rawX;var initialRawY=e.rawY};this.events.disableTouchScrollClicked=function(){console.log("disableTouchScrollClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.disableTouchScroll.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.disableTouchScrollOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()
};this.events.disableTouchScrollOnClicked=function(){console.log("disableTouchScrollClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.disableTouchScroll.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.disableTouchScrollOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideDealerMessagesClicked=function(){self.getPermanentPreferences();console.log("hideDealerMessagesClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessages.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessagesOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideDealerMessagesOnClicked=function(){console.log("hideDealerMessagesOnClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessages.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessagesOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hidePlayerMessagesClicked=function(){console.log("hidePlayerMessagesClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessages.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessagesOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hidePlayerMessagesOnClicked=function(){console.log("hidePlayerMessagesOnClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessages.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessagesOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideObserverMessagesClicked=function(){console.log("hideObserverMessagesClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessages.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessagesOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideObserverMessagesOnClicked=function(){self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessages.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessagesOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.rotateSeatsIfNeededAndConfirm=function(){if(self.permanentPreferences.alwaysRotate===true){}var preferenceSeat=self.sessionPreferences.changeUserSeatViewTo.value;if(_.isNumber(preferenceSeat)&&(preferenceSeat===0||preferenceSeat===self.gameState.userSeatNumber)){self.changeUserSeatView(preferenceSeat)}else{self.changeUserSeatView();var messageInfo={};messageInfo.title="Seat Viewpoint Changed";messageInfo.okayText="OK, this is fine";messageInfo.cancelText="Change view";messageInfo.cancel=true;messageInfo.okayEvent=function(){self.hideMessageBox();self.sessionPreferences.changeUserSeatViewTo.value=self.images.seats[self.gameState.userSeatNumber].rotatedSeatNumber;console.log("setting seat view preference to "+self.sessionPreferences.changeUserSeatViewTo.value);self.saveSessionPreferences()};messageInfo.cancelEvent=function(){if(self.images.seats[self.gameState.userSeatNumber].rotatedSeatNumber!==self.gameState.userSeatNumber){self.changeUserSeatView(self.gameState.userSeatNumber)}else{self.changeUserSeatView()}};var messageString="Your table viewpoint has been changed so that you appear at the bottom middle.  Your position relative to other players remains the same. Click "+messageInfo.cancelText+" to change your view back.";self.displayMessageBox(messageString,messageInfo)}};this.events.userStands=function(){self.setPreactionData("hand","check",true);self.setPreactionData("hand","fold",true);socket.emit("stand")};this.events.exitTableClick=function(event){console.log("exittable clicked");var messageInfo={};messageInfo.title="Leave Table?";messageInfo.cancel=true;messageInfo.okayEvent=function(){self.events.userStands();self.events.exit()};self.displayMessageBox("Are you sure you want to leave?",messageInfo)};this.events.viewLobbyClick=function(event){var lobbyName="Lobby";window.open("/lobby",lobbyName,"width=800,height=770 ,left=200,top=200,location=0,toolbar=no,menubar=no,titlebar=no,directories=no,scrollbars=yes")};this.events.exit=function(event){self.hideMessageBox();if(_.isObject(parent.iframes)){console.log("Close iframe");parent.iframes.closeIframe($("#server_values").data("table_name"))}else{console.log("Close window instead");var win=window.open("","_self");win.close()}};this.events.wheelScroll=function(numScrolls){if(_.isNumber(numScrolls)==false){return"scroll failed"}var change=numScrolls*self.permanentPreferences.bigBlindsPerMouseScroll.value*self.gameState.bigBlind;var betValue=parseFloat($("#betSize").val());var isBetValueValid=!isNaN(betValue)&&_.isNumber(betValue);if(isBetValueValid==true){var newBet=change+betValue}else{var newBet=change+self.gameState.betSize}newBet=self.returnRoundedDownBetSize(newBet);self.adjustBetDisplay(newBet)};this.events.betSliderHorizontalMouseDown=function(event){var minX=self.images.betSlider.horizontal.position.x;var maxX=self.images.betSlider.horizontal.position.x+self.images.betSlider.horizontal.size.x-self.images.betSlider.vertical.size.x;var pixelsPerTick=self.gameState.bigBlind*self.permanentPreferences.bigBlindsPerHorizontalSliderTick.value/(self.gameState.maxBet-self.gameState.minBet)*(maxX-minX);var adjustBetSize=function(){betSizePercent=(self.images.betSlider.vertical.image.x-minX)/(maxX-minX);unroundedBetAmount=betSizePercent*(self.gameState.maxBet-self.gameState.minBet)+self.gameState.minBet;roundedBet=Math.round(unroundedBetAmount/self.gameState.minIncrement)*self.gameState.minIncrement;self.adjustBetDisplay(roundedBet)};var moveSlider=function(event){createjs.Tween.removeTweens(self.images.betSlider.vertical.image);var pixelDirection;if(event.stageX>self.images.betSlider.vertical.image.x+self.images.betSlider.vertical.size.x){pixelDirection=1;self.images.betSlider.vertical.image.x=self.images.betSlider.vertical.image.x+pixelsPerTick;if(self.images.betSlider.vertical.image.x>maxX){self.images.betSlider.vertical.image.x=maxX}adjustBetSize()}else if(event.stageX<self.images.betSlider.vertical.image.x){pixelDirection=-1;self.images.betSlider.vertical.image.x-pixelsPerTick;if(self.images.betSlider.vertical.image.x<minX){self.images.betSlider.vertical.image.x=minX}adjustBetSize()}else{pixelDirection=0}if(pixelDirection>0||pixelDirection<0){createjs.Tween.get(self.images.betSlider.vertical.image,{override:true,loop:true}).wait(self.permanentPreferences.timePerHorizontalSliderTick.value).call(moveSlider,[event])}};moveSlider(event);event.onMouseMove=function(event){moveSlider(event)};event.onMouseUp=function(event){createjs.Tween.removeTweens(self.images.betSlider.vertical.image)}};this.events.betSliderVerticalMouseDown=function(event){var roundedBet;var betSizePercent;var unRoundedBetAmount;var minX=self.images.betSlider.horizontal.position.x;var maxX=self.images.betSlider.horizontal.position.x+self.images.betSlider.horizontal.size.x-self.images.betSlider.vertical.size.x;event.onMouseMove=function(event){if(event.stageX>maxX){event.target.x=maxX;roundedBet=self.gameState.maxBet}else if(event.stageX<minX){event.target.x=minX;roundedBet=self.gameState.minBet}else if(event.stageX>=minX&&event.stageX<=maxX){event.target.x=event.stageX;betSizePercent=(event.stageX-minX)/(maxX-minX);unroundedBetAmount=betSizePercent*(self.gameState.maxBet-self.gameState.minBet)+self.gameState.minBet;roundedBet=Math.round(unroundedBetAmount/self.gameState.minIncrement)*self.gameState.minIncrement}self.adjustBetDisplay(roundedBet)};event.onMouseUp=function(event){if(event.stageX>maxX){event.target.x=maxX;roundedBet=self.gameState.maxBet}else if(event.stageX<minX){event.target.x=minX;roundedBet=self.gameState.minBet}else if(event.stageX>=minX&&event.stageX<=maxX){event.target.x=event.stageX;betSizePercent=(event.stageX-minX)/(maxX-minX);unroundedBetAmount=betSizePercent*(self.gameState.maxBet-self.gameState.minBet)+self.gameState.minBet;roundedBet=Math.round(unroundedBetAmount/self.gameState.minIncrement)*self.gameState.minIncrement}self.adjustBetDisplay(roundedBet)}};this.events.betSizeUnfocused=function(event){console.log("betsizeunfocused called");var newBetSize=parseFloat($("#betSize").val());var isNumber=!isNaN(newBetSize)&&_.isNumber(newBetSize);var roundedBetSize;if(isNumber==false){roundedBetSize=self.returnRoundedDownBetSize(self.gameState.betSize)}else{roundedBetSize=self.returnRoundedDownBetSize(newBetSize)}if(roundedBetSize>self.gameState.maxBet){roundedBetSize=self.gameState.maxBet}else if(roundedBetSize<self.gameState.minBet){roundedBetSize=self.gameState.minBet}if(roundedBetSize!=newBetSize){self.adjustBetDisplay(roundedBetSize)}self.images.bet.image.onClick=self.events.onButtonClick;self.images.raise.image.onClick=self.events.onButtonClick};this.events.betSizeChanged=function(){console.log("betsize changed");var newBetSize=parseFloat($("#betSize").val());var hasValue=/\S/.test($("#betSize").val());var isNumber=!isNaN(newBetSize)&&_.isNumber(newBetSize);var isChanged=newBetSize!=self.gameState.betSize;if(hasValue&&isNumber&&isChanged){self.adjustBetDisplay(newBetSize)}if(self.returnRoundedDownBetSize(newBetSize)==false||self.returnRoundedDownBetSize(newBetSize)!=newBetSize){console.log("disabling 1 click on raise/bet");self.images.bet.image.onPress=disableOneClick;self.images.raise.image.onPress=disableOneClick;self.images.bet.image.onClick=null;self.images.raise.image.onClick=null;var disableOneClick=function(event){event.onMouseUp=function(event){event.target.onClick=self.events.onButtonClick;event.target.onPress=self.events.buttonMouseDown}}}if(self.returnRoundedDownBetSize(newBetSize)!=false&&self.returnRoundedDownBetSize(newBetSize)==newBetSize){self.images.bet.image.onClick=self.events.onButtonClick;self.images.raise.image.onClick=self.events.onButtonClick;self.images.bet.image.onPress=self.events.buttonMouseDown;self.images.raise.image.onPress=self.events.buttonMouseDown}};this.initialize=function(){this.initializeStagesAndCanvasCallThisFirst();if(parent.imagesLoaded===true||parent.imagesLoading===true){return}var imageSourceArray=[];var soundSourceArray=[];var flashSoundSourceArray=[];var resourceID=0;var loadedFiles=0;var errorFiles=0;var errorSrcArray=[];var isImageSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".PNG"){return true}else if(sourceEnding==".JPG"){return true}else{return false}};var isSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".MP3"){return true}else if(sourceEnding==".WAV"){return true}else{return false}};var isFlashSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".SWF"){return true}else{return false}};for(var i in this.images.sources){if(_.isString(this.images.sources[i])){if(isImageSource(this.images.sources[i])){imageSourceArray.push({src:this.images.sources[i],id:resourceID,name:i,sourceObjectParent:this.images.sourceObjects});resourceID++}else if(isFlashSoundSource(this.images.sources[i])){flashSoundSourceArray.push({src:this.images.sources[i],id:resourceID,name:i});resourceID++}else if(isSoundSource(this.images.sources[i])){soundSourceArray.push({src:this.images.sources[i],id:resourceID,name:i});resourceID++}}else if(_.isObject(this.images.sources[i])){this.images.sourceObjects[i]={};for(var n in this.images.sources[i]){if(_.isString(this.images.sources[i][n])){imageSourceArray.push({src:this.images.sources[i][n],id:resourceID,name:n,sourceObjectParent:this.images.sourceObjects[i]});resourceID++}}}}this.images.sourceObjects.desktopCards={};this.images.sourceObjects.mobileCards={};var desktopCards=this.images.sourceObjects.desktopCards;var mobileCards=this.images.sourceObjects.mobileCards;imageSourceArray.push({src:this.images.sources.desktopCardFolder+this.images.sources.cardBackFileNameWithoutExtension+".png",id:resourceID,name:"cardBack",sourceObjectParent:desktopCards});imageSourceArray.push({src:this.images.sources.mobileCardFolder+this.images.sources.cardBackFileNameWithoutExtension+".png",id:resourceID,name:"cardBack",sourceObjectParent:mobileCards});for(var i=2;i<=14;i++){var cardRank;if(i==10){cardRank="t"}else if(i==11){cardRank="j"}else if(i==12){cardRank="q"}else if(i==13){cardRank="k"}else if(i==14){cardRank="a"}else{cardRank=i}imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"c.png",id:resourceID,name:cardRank+"c",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"d.png",id:resourceID,name:cardRank+"d",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"h.png",id:resourceID,name:cardRank+"h",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"s.png",id:resourceID,name:cardRank+"s",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"c.png",id:resourceID,name:cardRank+"c",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"d.png",id:resourceID,name:cardRank+"d",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"h.png",id:resourceID,name:cardRank+"h",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"s.png",id:resourceID,name:cardRank+"s",sourceObjectParent:mobileCards});resourceID++}console.log(imageSourceArray);var introScreen={};var canvasWidth=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.width;var canvasHeight=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.height;var titleSizeAndFont="20px "+self.permanentPreferences.defaultFontType.value;var titleHeight=35;var titleAndPreloadBarDistanceY=50;var titleText="Loading resources...";var titleColor="#000000";var statusSizeAndFont="15px "+self.permanentPreferences.defaultFontType.value;var statusHeight=20;var statusColor="#000000";var preloadBarY=canvasHeight/2;var preloadBarWidth=canvasWidth*.65;var preloadBarHeight=30;var preloadBarBorderColor="rgb(0,0,255)";var preloadBarProgressColor="#000000";var preloadBarUnfinishedColor="rgb(150,150,150)";var introScreenBackgroundColor="blue";introScreen.background=new this.images.Item(0,0,canvasWidth,canvasHeight,this.gameState.zPositionData.loadingBackground);introScreen.background.image=new createjs.Shape;introScreen.background.image.graphics.beginFill(introScreenBackgroundColor).drawRect(introScreen.background.position.x,introScreen.background.position.y,introScreen.background.size.x,introScreen.background.size.y);introScreen.preloadBar=new this.images.Item(canvasWidth/2-preloadBarWidth/2,preloadBarY,preloadBarWidth,preloadBarHeight,this.gameState.zPositionData.loadingAnimation);introScreen.title=new this.images.Item(0,preloadBarY-titleAndPreloadBarDistanceY-titleHeight,canvasWidth,titleHeight,this.gameState.zPositionData.loadingAnimation);introScreen.status=new this.images.Item(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y-statusHeight,canvasWidth-introScreen.preloadBar.x,statusHeight,this.gameState.zPositionData.loadingAnimation);introScreen.preloadBar.image=new createjs.Shape;introScreen.preloadBar.drawBar=function(progressRatio){var progressX=introScreen.preloadBar.size.x*progressRatio+introScreen.preloadBar.position.x;var unfinishedX;if(progressX>=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x){progressX=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x;unfinishedX=false}else if(progressX<=introScreen.preloadBar.position.x){progressX=false;unfinishedX=introScreen.preloadBar.position.x}else{unfinishedX=progressX}introScreen.preloadBar.image.graphics.clear().beginStroke(preloadBarBorderColor).beginFill(null).setStrokeStyle(1).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,introScreen.preloadBar.size.x,introScreen.preloadBar.size.y);if(progressX!=false){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarProgressColor).beginStroke(null).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,progressX-introScreen.preloadBar.position.x,introScreen.preloadBar.size.y)}if(unfinishedX!=false&&unfinishedX<introScreen.preloadBar.position.x+introScreen.preloadBar.size.x){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarUnfinishedColor).beginStroke(null).drawRect(unfinishedX,introScreen.preloadBar.position.y,introScreen.preloadBar.position.x+introScreen.preloadBar.size.x-unfinishedX,introScreen.preloadBar.size.y)}var stage=introScreen.preloadBar.position.z.stage;var container=introScreen.preloadBar.position.z.container;if(self.arrayOfParentsOfStageAndOfContainerArray[stage].containers[container].contains(introScreen.preloadBar.image)){self.arrayOfParentsOfStageAndOfContainerArray[stage].upToDate=false}return stage};this.images.addItemText(introScreen.title,titleText,titleSizeAndFont,titleColor);introScreen.status.text=new createjs.Text("",statusSizeAndFont,statusColor);introScreen.status.text.x=introScreen.status.position.x;introScreen.status.text.y=introScreen.status.position.y+1;introScreen.status.text.baseline="top";introScreen.status.text.textAlign="left";introScreen.status.textColor=titleColor;this.images.imageLoading={};var titleHeight=30;var titleSizeAndFont="30px "+self.permanentPreferences.defaultFontType.value;var titleColor="blue";var titleText="Displaying Images ...";var titleX=canvasWidth*.25;var titleY=canvasHeight*.75;this.images.imageLoading.title=new this.images.Item(titleX,titleY,canvasWidth-titleX,titleHeight,this.gameState.zPositionData.loadingAnimation);this.images.imageLoading.title.text=new createjs.Text(titleText,titleSizeAndFont,titleColor);this.images.imageLoading.title.text.x=this.images.imageLoading.title.position.x;this.images.imageLoading.title.text.y=this.images.imageLoading.title.position.y+1;this.images.imageLoading.title.text.baseline="top";this.images.imageLoading.title.text.textAlign="left";this.images.imageLoading.title.text.textColor=titleColor;var displayPreloadScreen=function(){self.displayChildren(introScreen,{update:false})};var totalSources=imageSourceArray.length+soundSourceArray.length+flashSoundSourceArray.length;function handleLoad(src,id,onComplete){loadedFiles++;introScreen.status.text.text=src+" loaded";introScreen.preloadBar.drawBar(loadedFiles/totalSources);console.log(src+" loaded file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}self.updateStages(introScreen.status.position.z.stage);if(onComplete){onComplete()}}function handleLoadError(src,id,onComplete){loadedFiles++;errorFiles++;errorSrcArray.push(src);introScreen.status.text.text=src+" loaded";console.log(src+" error loading file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);introScreen.preloadBar.drawBar(loadedFiles/totalSources);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}if(loadedFiles>=totalSources){console.log("load completed with total of "+errorFiles+" image and sound errors whose sources are in the following array:");console.log(errorSrcArray)}self.updateStages(introScreen.status.position.z.stage);if(onComplete){onComplete()}}var preloadImages=function(imageArray,onComplete){var loadedImages=0;var increaseCounter=function(){loadedImages++;console.log("loaded "+loadedImages+" images out of a total of "+imageArray.length+" images")};_.each(_.range(imageArray.length),function(i){imageArray[i].sourceObjectParent[imageArray[i].name]=new Image;var newImageObject=imageArray[i].sourceObjectParent[imageArray[i].name];if(typeof imageArray[i]=="string"){newImageObject.src=imageArray[i]}else if(typeof imageArray[i]=="object"){newImageObject.src=imageArray[i].src}newImageObject.onload=function(){handleLoad(newImageObject.src,imageArray[i].id,increaseCounter)};newImageObject.onerror=function(){handleLoadError(newImageObject.src,imageArray[i].id,increaseCounter)}});var checkIfCompleted=setInterval(function(){if(loadedImages>=imageArray.length){onComplete();clearInterval(checkIfCompleted)}},25)};var preloadSounds=function(flashArray,soundArray){createjs.FlashPlugin.BASE_PATH="js/vendor/";createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]);createjs.Sound.addEventListener("fileload",function(event){handleLoad(event.src,event.id)});createjs.Sound.addEventListener("error",function(event){handleLoadError(event.src,event.id)});createjs.Sound.registerManifest(soundArray);for(var i=0;i<flashArray.length;i++){console.log(flashArray[i].src);var temp=createjs.Sound.createInstance(flashArray[i].src);console.log(temp);temp.play();handleLoad(flashArray[i].src,flashArray[i].id)}};displayPreloadScreen();preloadImages(imageSourceArray,function(){self.displayChildren(self.images.imageLoading.title,{update:false});self.createAllItems()});preloadSounds(flashSoundSourceArray,soundSourceArray)};this.initializeParent=function(){this.initializeStagesAndCanvasCallThisFirst();var totalSources=0;var imageSourceArray=[];var soundSourceArray=[];var flashSoundSourceArray=[];var resourceID=0;var loadedFiles=0;var errorFiles=0;var errorSrcArray=[];var stage=this.gameState.zPositionData.loadingBackground.stage;var isImageSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".PNG"){return true}else if(sourceEnding==".JPG"){return true}else{return false}};var isSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".MP3"){return true}else if(sourceEnding==".WAV"){return true}else{return false}};var isFlashSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".SWF"){return true}else{return false}};var desktopCards;var mobileCards;var createPreloadArray=function(){for(var i in self.images.sources){if(_.isString(self.images.sources[i])){if(isImageSource(self.images.sources[i])){imageSourceArray.push({src:self.images.sources[i],id:resourceID,name:i,sourceObjectParent:self.permanentPreferences.sourceObjects.value});resourceID++}else if(isFlashSoundSource(self.images.sources[i])){flashSoundSourceArray.push({src:self.images.sources[i],id:resourceID,name:i});resourceID++}else if(isSoundSource(self.images.sources[i])){soundSourceArray.push({src:self.images.sources[i],id:resourceID,name:i});resourceID++}}else if(_.isObject(self.images.sources[i])){self.permanentPreferences.sourceObjects.value[i]={};for(var n in self.images.sources[i]){if(_.isString(self.images.sources[i][n])){imageSourceArray.push({src:self.images.sources[i][n],id:resourceID,name:n,sourceObjectParent:self.permanentPreferences.sourceObjects.value[i]});resourceID++}}}}self.permanentPreferences.sourceObjects.value.desktopCards={};self.permanentPreferences.sourceObjects.value.mobileCards={};var desktopCards=self.permanentPreferences.sourceObjects.value.desktopCards;var mobileCards=self.permanentPreferences.sourceObjects.value.mobileCards;imageSourceArray.push({src:self.images.sources.desktopCardFolder+self.images.sources.cardBackFileNameWithoutExtension+".png",id:resourceID,name:"cardBack",sourceObjectParent:desktopCards});imageSourceArray.push({src:self.images.sources.mobileCardFolder+self.images.sources.cardBackFileNameWithoutExtension+".png",id:resourceID,name:"cardBack",sourceObjectParent:mobileCards});for(var i=2;i<=14;i++){var cardRank;if(i==10){cardRank="t"}else if(i==11){cardRank="j"}else if(i==12){cardRank="q"}else if(i==13){cardRank="k"}else if(i==14){cardRank="a"}else{cardRank=i}imageSourceArray.push({src:self.images.sources.desktopCardFolder+cardRank+"c.png",id:resourceID,name:cardRank+"c",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:self.images.sources.desktopCardFolder+cardRank+"d.png",id:resourceID,name:cardRank+"d",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:self.images.sources.desktopCardFolder+cardRank+"h.png",id:resourceID,name:cardRank+"h",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:self.images.sources.desktopCardFolder+cardRank+"s.png",id:resourceID,name:cardRank+"s",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:self.images.sources.mobileCardFolder+cardRank+"c.png",id:resourceID,name:cardRank+"c",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:self.images.sources.mobileCardFolder+cardRank+"d.png",id:resourceID,name:cardRank+"d",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:self.images.sources.mobileCardFolder+cardRank+"h.png",id:resourceID,name:cardRank+"h",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:self.images.sources.mobileCardFolder+cardRank+"s.png",id:resourceID,name:cardRank+"s",sourceObjectParent:mobileCards});resourceID++}totalSources=imageSourceArray.length+soundSourceArray.length+flashSoundSourceArray.length};console.log(imageSourceArray);var introScreen={};var canvasWidth=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.width;var canvasHeight=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.height;var titleSizeAndFont="20px "+self.permanentPreferences.defaultFontType.value;var titleHeight=35;var titleAndPreloadBarDistanceY=50;var titleText="Loading resources...";var titleColor="#000000";var statusSizeAndFont="15px "+self.permanentPreferences.defaultFontType.value;var statusHeight=20;var statusColor="#000000";var preloadBarY=canvasHeight/2;var preloadBarWidth=canvasWidth*.65;var preloadBarHeight=30;var preloadBarBorderColor="rgb(0,0,255)";var preloadBarProgressColor="#000000";var preloadBarUnfinishedColor="rgb(150,150,150)";var introScreenBackgroundColor="blue";introScreen.background=new this.images.Item(0,0,canvasWidth,canvasHeight,this.gameState.zPositionData.loadingBackground);introScreen.background.image=new createjs.Shape;introScreen.background.image.graphics.beginFill(introScreenBackgroundColor).drawRect(introScreen.background.position.x,introScreen.background.position.y,introScreen.background.size.x,introScreen.background.size.y);introScreen.preloadBar=new this.images.Item(canvasWidth/2-preloadBarWidth/2,preloadBarY,preloadBarWidth,preloadBarHeight,this.gameState.zPositionData.loadingAnimation);introScreen.title=new this.images.Item(0,preloadBarY-titleAndPreloadBarDistanceY-titleHeight,canvasWidth,titleHeight,this.gameState.zPositionData.loadingAnimation);introScreen.status=new this.images.Item(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y-statusHeight,canvasWidth-introScreen.preloadBar.x,statusHeight,this.gameState.zPositionData.loadingAnimation);introScreen.preloadBar.image=new createjs.Shape;introScreen.preloadBar.drawBar=function(progressRatio){if(!_.isNumber(progressRatio)||_.isNaN(progressRatio)){var progressRatio=0}var progressX=introScreen.preloadBar.size.x*progressRatio+introScreen.preloadBar.position.x;var unfinishedX;if(progressX>=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x){progressX=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x;unfinishedX=false}else if(progressX<=introScreen.preloadBar.position.x){progressX=false;unfinishedX=introScreen.preloadBar.position.x}else{unfinishedX=progressX}introScreen.preloadBar.image.graphics.clear().beginStroke(preloadBarBorderColor).beginFill(null).setStrokeStyle(1).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,introScreen.preloadBar.size.x,introScreen.preloadBar.size.y);if(progressX!=false){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarProgressColor).beginStroke(null).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,progressX-introScreen.preloadBar.position.x,introScreen.preloadBar.size.y)}if(unfinishedX!=false&&unfinishedX<introScreen.preloadBar.position.x+introScreen.preloadBar.size.x){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarUnfinishedColor).beginStroke(null).drawRect(unfinishedX,introScreen.preloadBar.position.y,introScreen.preloadBar.position.x+introScreen.preloadBar.size.x-unfinishedX,introScreen.preloadBar.size.y)}return self.itemChanged(introScreen.preloadBar)};this.images.addItemText(introScreen.title,titleText,titleSizeAndFont,titleColor);introScreen.status.text=new createjs.Text("",statusSizeAndFont,statusColor);introScreen.status.text.x=introScreen.status.position.x;introScreen.status.text.y=introScreen.status.position.y+1;introScreen.status.text.baseline="top";introScreen.status.text.textAlign="left";introScreen.status.textColor=titleColor;this.images.imageLoading={};var titleHeight=30;var titleSizeAndFont="30px "+self.permanentPreferences.defaultFontType.value;var titleColor="blue";var titleText="Displaying Images ...";var titleX=canvasWidth*.25;var titleY=canvasHeight*.75;this.images.imageLoading.title=new this.images.Item(titleX,titleY,canvasWidth-titleX,titleHeight,this.gameState.zPositionData.loadingAnimation);this.images.imageLoading.title.text=new createjs.Text(titleText,titleSizeAndFont,titleColor);this.images.imageLoading.title.text.x=this.images.imageLoading.title.position.x;this.images.imageLoading.title.text.y=this.images.imageLoading.title.position.y+1;this.images.imageLoading.title.text.baseline="top";this.images.imageLoading.title.text.textAlign="left";this.images.imageLoading.title.text.textColor=titleColor;var displayPreloadScreen=function(){self.displayChildren(introScreen,{update:false})};function handleLoad(src,id,onEnd){loadedFiles++;parent.loadingScreen.status=src+" loaded";parent.loadingScreen.progressRatio=loadedFiles/totalSources;console.log(src+" loaded file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);console.log(parent.loadingScreen.progressRatio);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}if(onEnd){onEnd()}}function handleLoadError(src,id,onEnd){loadedFiles++;errorFiles++;errorSrcArray.push(src);parent.loadingScreen.status=src+" loaded";parent.loadingScreen.progressRatio=loadedFiles/totalSources;console.log(src+" error loading file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);console.log(parent.loadingScreen.progressRatio);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}if(loadedFiles>=totalSources){console.log("load completed with total of "+errorFiles+" image and sound errors whose sources are in the following array:");console.log(errorSrcArray)}if(onEnd){onEnd()}}var preloadImages=function(imageArray){var loadedImages=0;var increaseCounter=function(){loadedImages++;console.log("loaded "+loadedImages+" images out of a total of "+imageArray.length+" images")};_.each(_.range(imageArray.length),function(i){imageArray[i].sourceObjectParent[imageArray[i].name]=new Image;var newImageObject=imageArray[i].sourceObjectParent[imageArray[i].name];
if(typeof imageArray[i]=="string"){newImageObject.src=imageArray[i]}else if(typeof imageArray[i]=="object"){newImageObject.src=imageArray[i].src}newImageObject.onload=function(){handleLoad(newImageObject.src,imageArray[i].id,increaseCounter)};newImageObject.onerror=function(){handleLoadError(newImageObject.src,imageArray[i].id,increaseCounter)}})};function onComplete(){console.log("onComplete called in initialize");console.log(parent);parent.loaded=true;self.displayChildren(self.images.imageLoading.title,{update:false});self.createAllItems()}function checkIfCompleted(e){if(parent.loadingScreen.progressRatio>=1||parent.loaded===true){console.log("loading has been completed");console.log(parent);console.log(self.permanentPreferences.sourceObjects.value);console.log(parent.sourceObjects);onComplete();createjs.Ticker.removeEventListener(e.type,checkIfCompleted)}else{introScreen.preloadBar.drawBar(parent.loadingScreen.progressRatio);introScreen.status.text.text=parent.loadingScreen.status;self.itemChanged(introScreen.status);self.updateStages()}}var preloadSounds=function(flashArray,soundArray){createjs.FlashPlugin.BASE_PATH="js/vendor/";createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]);createjs.Sound.addEventListener("fileload",function(event){handleLoad(event.src,event.id)});createjs.Sound.addEventListener("error",function(event){handleLoadError(event.src,event.id)});createjs.Sound.registerManifest(soundArray);for(var i=0;i<flashArray.length;i++){console.log(flashArray[i].src);var temp=createjs.Sound.createInstance(flashArray[i].src);console.log(temp);temp.play();handleLoad(flashArray[i].src,flashArray[i].id)}};console.log("we are going to check whether to perform load from this page, or use other page load");console.log(parent);if(parent.loaded===true||parent.loading===true){console.log("other frame to load our images");console.log(self.permanentPreferences.sourceObjects.value);console.log(parent.sourceObjects)}else{console.log("loading from this page");parent.loading=true;parent.loadingScreen={};parent.loadingScreen.progressRatio=0;parent.loadingScreen.status="";createPreloadArray();preloadSounds(flashSoundSourceArray,soundSourceArray);preloadImages(imageSourceArray)}displayPreloadScreen();createjs.Ticker.addEventListener("tick",checkIfCompleted)};this.images.setDefaults=function(){$("#iframe, iframe").bind("mousewheel",function(e){console.log(e);e.preventDefault()});var canvasWidth=self.arrayOfParentsOfStageAndOfContainerArray[self.gameState.zPositionData.background.stage].stage.canvas.width;var canvasHeight=self.arrayOfParentsOfStageAndOfContainerArray[self.gameState.zPositionData.background.stage].stage.canvas.height;var cardWidth;var cardHeight;if(this.sources.cardImageFolder.indexOf("resize")>=0){cardWidth=36;cardHeight=44}else{cardWidth=40;cardHeight=64}var spaceBetweenHoleCards=-cardWidth/8;var shownCardY=.92;var checkBoxButtonWidth=100;var checkBoxButtonHeight=13;var checkBoxButtonDistanceFromChat=8;var checkBoxButtonOffSetLeft=2;var checkBoxButtonDistanceY=3;var checkBoxButtonCheckBoxWidth=checkBoxButtonHeight;var checkBoxButtonDistanceFromBoxToText=5;var checkBoxButtonDistanceFromEdgeToInteriorHitAreaY=1;var checkBoxButtonSizeAndFont="10px "+self.permanentPreferences.defaultFontType.value;var checkBoxButtonTextColor="#FFFFFF";var actionButtonWidth=80;var actionButtonHeight=25;var actionButtonLeftX=160;var actionButtonY=419;var distanceBetweenActionButtons=20;var seatWidth=90;var seatHeight=33;var distanceBetweenSeatsX=40;var distanceBetweenSeatsY=123;var firstRowY=77;var secondRowY=153;var thirdRowY=secondRowY+seatHeight+distanceBetweenSeatsY;var fourthRowY=371;var firstColumnX=27;var fifthColumnX=canvasWidth-firstColumnX-seatWidth;var secondColumnX=canvasWidth/2-seatWidth/2-seatWidth-distanceBetweenSeatsX;var thirdColumnX=canvasWidth/2-seatWidth/2;var fourthColumnX=thirdColumnX+seatWidth+distanceBetweenSeatsX;var currencyDisplayWidth=canvasWidth;var currencyDisplayHeight=15;var currencyDisplayTopOffset=1;var currencyDisplaySizeAndFont="16px "+self.permanentPreferences.defaultFontType.value;var currencyDisplayColor="white";var communityY=220;var distanceBetweenCommunityCards=2;var dealerButtonWidth=30;var dealerButtonHeight=22;var topRowSeatDealerButtonX=-dealerButtonWidth/3;var topRowSeatDealerButtonY=seatHeight+dealerButtonHeight*.1;var leftColumnSeatDealerButtonX=seatWidth+dealerButtonWidth*.1;var leftColumnSeatDealerButtonY=0;var bottomRowSeatDealerButtonX=seatWidth+dealerButtonWidth/3;var bottomRowSeatDealerButtonY=-dealerButtonHeight*1.1;var rightColumnSeatDealerButtonX=-dealerButtonWidth*1.1;var rightColumnSeatDealerButtonY=0;var potHeight=14;var potWidth=85;var potSizeAndFont="14px "+self.permanentPreferences.defaultFontType.value;var potTextColor="#FFFFFF";var potDistanceToCommunity=-25;var chipDiameter=20;var distanceBetweenChipsY=3;var betTextHeight=11;var betTextWidth=20;var absoluteDistanceBetweenBetTextAndChipImages=0;var htmlTableChatBoxLeftOffset=checkBoxButtonOffSetLeft;var htmlTableChatBoxBottomOffset=8;var htmlTableChatBoxWidth=140;var htmlTableChatBorderSize=self.jQueryObjects.chatBoxInput.css("border").substring(0,self.jQueryObjects.chatBoxInput.css("border").indexOf("p"));var htmlTableChatBoxHeight=20;var htmlTableChatBoxReminderTextColor="rgb(160,0,0) ";var verticalBetSliderWidth=6;var verticalBetSliderHeight=13;var horizontalBetSliderWidth=125;var horizontalBetSliderHeight=7;var horizontalBetSliderOffsetBottom=19;var distanceBetweenBetSizeAndHorizontalSlider=15;var betSizeWidth=80;var betSizeHeight=20;var chatBoxWidth=seatWidth*1.4;var initialChatBoxHeight=seatHeight/2.3;var absoluteChatDistanceFromSeatY=seatHeight/4;var chatBoxBorderColor="#FFFFFF";var chatBoxFontSize=10;var bottomChipOffsetX=chipDiameter;var bottomChipOffsetY=-cardHeight*shownCardY-chipDiameter*1.5;var leftChipOffsetX=seatWidth+chipDiameter*1.5;var leftChipOffsetY=chipDiameter/2;var topChipOffsetX=seatWidth-chipDiameter;var topChipOffsetY=seatHeight+chipDiameter*1.5;var rightChipOffsetX=-chipDiameter*1.5;var rightChipOffsetY=seatHeight-chipDiameter/2;var cashierButtonWidth=132;var cashierButtonHeight=52;var distanceBetweenUpperButtonHitAreasY=3;var standUpWidth=158;var standUpHeight=26;var standUpHitAreaUpperLeftOffsetX=6;var standUpHitAreaLowerLeftOffsetX=37;var standUpHitAreaTopOffset=1;var standUpHitAreaBottomOffset=3;var standUpHitAreaRightOffset=1;var exitTableWidth=135;var exitTableHeight=32;var exitTableHitAreaUpperLeftOffsetX=18;var exitTableHitAreaLowerLeftOffsetX=49;var exitTableHitAreaTopOffset=1;var exitTableHitAreaBottomOffset=9;var exitTableHitAreaRightOffset=1;var getChipsWidth=149;var getChipsHeight=41;var getChipsHitAreaLeftOffset=1;var getChipsHitAreaTopOffset=1;var getChipsHitAreaBottomOffset=10;var getChipsHitAreaUpperRightOffset=9;var getChipsHitAreaLowerRightOffset=38;var showTableChatFullWidth=112;var showTableChatFullHeight=31;var showTableChatFullHitAreaOffsetLeft=1;var showTableChatFullHitAreaOffsetTop=1;var showTableChatFullHitAreaOffsetBottom=7;var showTableChatFullHitAreaOffsetTopRight=5;var showTableChatFullHitAreaOffsetBottomRight=27;var openSeatOuterStrokeWidth=1.5;var tableX=0;var tableY=15;var disabledButtonOverlayAlpha=.43;this.community[0]=new this.Item(canvasWidth/2-cardWidth/2-cardWidth*2-distanceBetweenCommunityCards*2,communityY,cardWidth,cardHeight,self.gameState.zPositionData.communityCards);this.community[1]=new this.Item(canvasWidth/2-cardWidth/2-cardWidth-distanceBetweenCommunityCards,communityY,cardWidth,cardHeight,self.gameState.zPositionData.communityCards);this.community[2]=new this.Item(canvasWidth/2-cardWidth/2,communityY,cardWidth,cardHeight,self.gameState.zPositionData.communityCards);this.community[3]=new this.Item(canvasWidth/2+cardWidth/2+distanceBetweenCommunityCards,communityY,cardWidth,cardHeight,self.gameState.zPositionData.communityCards);this.community[4]=new this.Item(canvasWidth/2+cardWidth/2+cardWidth+2*distanceBetweenCommunityCards,communityY,cardWidth,cardHeight,self.gameState.zPositionData.communityCards);this.startingCard=new this.Item(canvasWidth,canvasHeight,cardWidth,cardHeight,self.gameState.zPositionData.cardAnimation);this.dealerButton=new this.Item(0,0,dealerButtonWidth,dealerButtonHeight,self.gameState.zPositionData.chips);this.itemAsBitmap(this.dealerButton,self.permanentPreferences.sourceObjects.value.dealerButton);var createPotItems=function(potNumber,firstChipX,firstChipY,options){if(!options){var options={}}var distanceY=distanceBetweenChipsY;var maxPotWidth=distanceX*(self.imageData.maxChipColumns-1)+chipDiameter;var distanceX=self.imageData.distanceBetweenChipColumns+chipDiameter;if(options.columnDirection==="left"){distanceX=distanceX*-1}self.images.pots[potNumber].firstChip=new self.images.Item(firstChipX,firstChipY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);self.images.pots[potNumber].secondChip=new self.images.Item(firstChipX,firstChipY-distanceY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);self.images.pots[potNumber].secondColumnChip=new self.images.Item(firstChipX+distanceX,firstChipY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);if(options.columnDirection!=="left"){self.images.pots[potNumber].potSize=new self.images.Item(firstChipX,firstChipY+chipDiameter,betSizeWidth,potHeight,self.gameState.zPositionData.chips)}else{self.images.pots[potNumber].potSize=new self.images.Item(firstChipX+chipDiameter-betSizeWidth,firstChipY+chipDiameter,betSizeWidth,potHeight,self.gameState.zPositionData.chips)}self.images.addItemText(self.images.pots[potNumber].potSize,"",potSizeAndFont,potTextColor,{textAlign:"left"});self.images.pots[potNumber].potSize.text.maxWidth=999999;console.log("created pot items for pot number: "+potNumber);console.log(self.images.pots[potNumber])};var pot0X=canvasWidth/2-cardWidth/2-cardWidth;var pot0Y=communityY-potHeight-chipDiameter;createPotItems(0,pot0X,pot0Y);var totalPotWidth=(this.pots[0].secondColumnChip.position.x-this.pots[0].firstChip.position.x)*(self.imageData.maxChipColumns-1)+chipDiameter;var distanceBetweenPots=self.imageData.maxChipColumns;var distanceBetweenChipsInColumn=this.pots[0].firstChip.position.y-this.pots[0].secondChip.position.y;var chipColumnHeight=chipDiameter+(self.imageData.maxChipsPerColumn-1)*distanceBetweenChipsInColumn;var maxChipColumnHeight=(self.imageData.maxChipsPerColumn-1)*(this.pots[0].secondChip.position.x-this.pots[0].firstChip.position.x)+chipDiameter;var maxTotalPotHeight=maxChipColumnHeight+potHeight;this.totalPotSize=new this.Item(this.pots[0].firstChip.position.x,this.pots[0].firstChip.position.y+chipDiameter-chipColumnHeight-potHeight*2,potWidth,potHeight,self.gameState.zPositionData.chips);this.addItemText(this.totalPotSize,"",potSizeAndFont,potTextColor);this.totalPotSize.text.maxWidth=null;var pot1X=pot0X+totalPotWidth+distanceBetweenPots;var pot1Y=pot0Y;createPotItems(1,pot1X,pot1Y);var pot2X=self.images.community[4].position.x+self.images.community[4].size.x+1;var pot2Y=pot1Y+potHeight;createPotItems(2,pot2X,pot2Y);var pot3X=pot2X;var pot3Y=pot2Y+maxTotalPotHeight*1.5;createPotItems(3,pot3X,pot3Y);var pot4X=pot1X;var pot4Y=self.images.community[4].position.y+self.images.community[4].size.y+maxChipColumnHeight;createPotItems(4,pot4X,pot4Y);var pot5X=pot0X;var pot5Y=pot4Y;createPotItems(5,pot5X,pot5Y);var pot6X=self.images.community[0].position.x-chipDiameter;var pot6Y=pot3Y;createPotItems(6,pot6X,pot6Y,{columnDirection:"left"});var pot7X=pot6X;var pot7Y=pot2Y;createPotItems(7,pot7X,pot7Y,{columnDirection:"left"});var pot8X=canvasWidth/2-totalPotWidth/2;var pot8Y=this.totalPotSize.position.y-maxTotalPotHeight;createPotItems(8,pot8X,pot8Y);this.htmlTableChatBox=new this.Item(htmlTableChatBoxLeftOffset,canvasHeight-htmlTableChatBoxBottomOffset-htmlTableChatBoxHeight-htmlTableChatBorderSize*2,htmlTableChatBoxWidth,htmlTableChatBoxHeight,self.gameState.zPositionData.button);var defaultMessage="Type here to chat";self.jQueryObjects.chatBoxInput.val(defaultMessage);self.jQueryObjects.chatBoxInput.css("color",htmlTableChatBoxReminderTextColor);self.jQueryObjects.chatBoxInput.focus(function(){if(self.jQueryObjects.chatBoxInput.val()==defaultMessage){self.jQueryObjects.chatBoxInput.val("");self.jQueryObjects.chatBoxInput.css("color",self.permanentPreferences.chatTextColor.value)}});self.jQueryObjects.chatBoxInput.focusout(function(){if(/\S/.test(self.jQueryObjects.chatBoxInput.val())){}else{self.jQueryObjects.chatBoxInput.val("Type here to chat");self.jQueryObjects.chatBoxInput.css("color",htmlTableChatBoxReminderTextColor)}});var chatBoxStageParent=self.arrayOfParentsOfStageAndOfContainerArray[self.images.htmlTableChatBox.position.z.stage];var chatBoxStageCanvasZIndex=$(chatBoxStageParent.stage.canvas).css("z-index");$("#chatDiv").css("z-index",parseInt(chatBoxStageCanvasZIndex)+1);self.jQueryObjects.chatBoxInput.css({position:"absolute",left:this.htmlTableChatBox.position.x+"px",top:this.htmlTableChatBox.position.y+"px",width:this.htmlTableChatBox.size.x+"px",height:this.htmlTableChatBox.size.y+"px",padding:"0px",margin:"0px"});self.jQueryObjects.chatBoxInput.keypress(function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){socket.emit("chat",$("#chat").val());$("#chat").val("");self.jQueryObjects.chatBoxInput.focus()}});this.foldToAnyBet=new this.Item(checkBoxButtonOffSetLeft,this.htmlTableChatBox.position.y-checkBoxButtonDistanceFromChat-3*checkBoxButtonHeight-2*checkBoxButtonDistanceY,checkBoxButtonWidth,checkBoxButtonHeight,self.gameState.zPositionData.button,{messages:["set_flag","check",true],otherMessages:["set_flag","fold",true]});this.sitOutNextHand=new this.Item(checkBoxButtonOffSetLeft,this.htmlTableChatBox.position.y-checkBoxButtonDistanceFromChat-2*checkBoxButtonHeight-checkBoxButtonDistanceY,checkBoxButtonWidth,checkBoxButtonHeight,self.gameState.zPositionData.button,{messages:["sit_out"]});this.sitOutNextBlind=new this.Item(checkBoxButtonOffSetLeft,this.htmlTableChatBox.position.y-checkBoxButtonDistanceFromChat-checkBoxButtonHeight,checkBoxButtonWidth,checkBoxButtonHeight,self.gameState.zPositionData.button,{messages:["set_flag","post_blind",false]});this.foldToAnyBetOn=new this.Item(this.foldToAnyBet.position.x,this.foldToAnyBet.position.y,this.foldToAnyBet.size.x,this.foldToAnyBet.size.y,self.gameState.zPositionData.button,{messages:["set_flag","fold",false],otherMessages:["set_flag","check",false]});this.sitOutNextHandOn=new this.Item(this.sitOutNextHand.position.x,this.sitOutNextHand.position.y,this.sitOutNextHand.size.x,this.sitOutNextHand.size.y,self.gameState.zPositionData.button,{messages:["sit_in"]});this.sitOutNextBlindOn=new this.Item(this.sitOutNextBlind.position.x,this.sitOutNextBlind.position.y,this.sitOutNextBlind.size.x,this.sitOutNextBlind.size.y,self.gameState.zPositionData.button,{messages:["set_flag","post_blind",true]});this.itemAsBitmap(this.foldToAnyBet,self.permanentPreferences.sourceObjects.value.checkBox);this.itemAsBitmap(this.sitOutNextHand,self.permanentPreferences.sourceObjects.value.checkBox);this.itemAsBitmap(this.sitOutNextBlind,self.permanentPreferences.sourceObjects.value.checkBox);this.itemAsBitmap(this.foldToAnyBetOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);this.itemAsBitmap(this.sitOutNextHandOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);this.itemAsBitmap(this.sitOutNextBlindOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.drawCheckBoxButtonHitSquareAndAdjustItemWidth=function(item){var textWidth=self.getTextWidthAndFontSize(item)[0];var totalWidth=checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText+textWidth;item.size.x=totalWidth;var hitSquare=new createjs.Shape;hitSquare.graphics.beginFill("#FFFFFF").beginStroke(0).drawRect(0,checkBoxButtonDistanceFromEdgeToInteriorHitAreaY,totalWidth,item.size.y-checkBoxButtonDistanceFromEdgeToInteriorHitAreaY);return hitSquare};self.images.addCheckBoxButtonText=function(item,text,options){if(!options){var options={}}update=options.update;options.update=false;var stagesToUpdate=[];if(item.text instanceof createjs.Text===false){item.text=new createjs.Text(text,checkBoxButtonSizeAndFont,checkBoxButtonTextColor)}else{if(item.text.text!==text||item.font!==checkBoxButtonSizeAndFont||item.color!==checkBoxButtonTextColor||item.text.x!==item.position.x+checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText||item.text.y!==item.position.y+1||item.text.baseline!=="top"||item.text.textAlign!=="left"){stagesToUpdate.push(self.itemChanged(item))}item.text.text=text;item.font=checkBoxButtonSizeAndFont;item.color=checkBoxButtonTextColor}item.text.x=item.position.x+checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText;item.text.y=item.position.y+1;item.text.baseline="top";item.text.textAlign="left";item.textColor=checkBoxButtonTextColor;var hit=self.images.drawCheckBoxButtonHitSquareAndAdjustItemWidth(item);item.text.hitArea=hit;item.image.hitArea=hit;options.update=update;if(update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};self.images.addCheckBoxButtonText(this.foldToAnyBet,"Auto check/fold");self.images.addCheckBoxButtonText(this.sitOutNextHand,"Sit out next hand");self.images.addCheckBoxButtonText(this.sitOutNextBlind,"Sit out next blind");self.images.addCheckBoxButtonText(this.foldToAnyBetOn,"Auto check/fold");self.images.addCheckBoxButtonText(this.sitOutNextHandOn,"Sit out next hand");self.images.addCheckBoxButtonText(this.sitOutNextBlindOn,"Sit out next blind");this.foldToAnyBet.image.onClick=self.events.foldToAnyBetClick;this.sitOutNextHand.image.onClick=self.events.onButtonClick;this.sitOutNextBlind.image.onClick=self.events.onButtonClick;this.foldToAnyBetOn.image.onClick=self.events.foldToAnyBetOnClick;this.sitOutNextHandOn.image.onClick=self.events.onButtonClick;this.sitOutNextBlindOn.image.onClick=self.events.onButtonClick;this.seats[0].seat=new this.Item(thirdColumnX,fourthRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[1].seat=new this.Item(secondColumnX,fourthRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[2].seat=new this.Item(firstColumnX,thirdRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[3].seat=new this.Item(firstColumnX,secondRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[4].seat=new this.Item(secondColumnX,firstRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[5].seat=new this.Item(thirdColumnX,firstRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[6].seat=new this.Item(fourthColumnX,firstRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[7].seat=new this.Item(fifthColumnX,secondRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[8].seat=new this.Item(fifthColumnX,thirdRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);this.seats[9].seat=new this.Item(fourthColumnX,fourthRowY,seatWidth,seatHeight,self.gameState.zPositionData.button);_.each(_.range(this.seats.length),function(i){var x=self.images.seats[i].seat.position.x;var y=self.images.seats[i].seat.position.y;var width=self.images.seats[i].seat.size.x;var height=self.images.seats[i].seat.size.y;self.images.seats[i].seat.image=new createjs.Shape;self.images.seats[i].seat.image.parentOfImageObject=self.images.seats[i].seat});for(var i=0;i<this.seats.length;i++){self.images.drawSeat(this.seats[i].seat,"#000000","#000000","#7d7d7d");this.seats[i].seat.image.onMouseOver=self.events.seatMouseEvent;this.seats[i].seat.image.onMouseOut=self.events.seatMouseEvent;this.seats[i].openSeat=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y,self.gameState.zPositionData.button);this.seats[i].disabledSeat=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y,self.gameState.zPositionData.button);this.seats[i].action=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y/2,self.gameState.zPositionData.button);this.seats[i].countdown=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y/2,self.gameState.zPositionData.button);this.seats[i].winner=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y/2,self.gameState.zPositionData.button);this.seats[i].playerName=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y/2,self.gameState.zPositionData.button);this.seats[i].status=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y+this.seats[i].seat.size.y/2,this.seats[i].seat.size.x,this.seats[i].seat.size.y/2,self.gameState.zPositionData.button);var middleOfSeat=this.seats[i].seat.position.x+this.seats[i].seat.size.x/2;var card0X=middleOfSeat-cardWidth-spaceBetweenHoleCards/2;var cardY=this.seats[i].seat.position.y-cardHeight*shownCardY;var card1X=middleOfSeat+spaceBetweenHoleCards/2;this.seats[i].hiddenCards=[];this.seats[i].hiddenCards[0]=new this.Item(card0X,cardY,cardWidth,cardHeight,self.gameState.zPositionData.holeCards);this.seats[i].hiddenCards[1]=new this.Item(card1X,cardY,cardWidth,cardHeight,self.gameState.zPositionData.holeCards);this.seats[i].shownCards=[];this.seats[i].shownCards[0]=new this.Item(card0X,cardY,cardWidth,cardHeight,self.gameState.zPositionData.holeCards);this.seats[i].shownCards[1]=new this.Item(card1X,cardY,cardWidth,cardHeight,self.gameState.zPositionData.holeCards);var openSeatFill="#000000";var openSeatMiddle=openSeatMiddle;var openSeatBorder="#FFFFFF";self.images.drawSeat(this.seats[i].openSeat,openSeatBorder,openSeatFill,openSeatMiddle,{outerStrokeWidth:openSeatOuterStrokeWidth});this.seats[i].openSeat.image.parentOfImageObject=this.seats[i].openSeat;this.seats[i].openSeat.text=new createjs.Text("Open Seat","15px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.seats[i].openSeat.text.x=this.seats[i].openSeat.position.x+this.seats[i].openSeat.size.x/2;this.seats[i].openSeat.text.y=this.seats[i].openSeat.position.y+4;this.seats[i].openSeat.text.baseline="top";this.seats[i].openSeat.text.textAlign="center";this.seats[i].openSeat.text.maxWidth=this.seats[i].openSeat.size.x*.9;this.seats[i].openSeat.textColor="#FFFFFF";var disabledBorder="#544E4F";var disabledFill="black";var disabledMiddle=disabledFill;self.images.drawSeat(this.seats[i].disabledSeat,disabledBorder,disabledFill,disabledMiddle,{outerStrokeWidth:openSeatOuterStrokeWidth});this.seats[i].disabledSeat.image.parentOfImageObject=this.seats[i].disabledSeat;if(self.sessionPreferences.displaySize.value!=="mobile"){}else{}this.cardAsBitmap(this.seats[i].hiddenCards[0],null);this.cardAsBitmap(this.seats[i].hiddenCards[1],null);this.addItemText(this.seats[i].shownCards[0],"","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.addItemText(this.seats[i].shownCards[1],"","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.addItemText(this.seats[i].playerName,"","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.addItemText(this.seats[i].status,"","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.addItemText(this.seats[i].action,"","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.addItemText(this.seats[i].countdown,"","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.addItemText(this.seats[i].winner,"","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");var seatLocationMarginOfError=1.1;if(this.seats[i].seat.position.y<firstRowY+seatLocationMarginOfError&&this.seats[i].seat.position.y>firstRowY-seatLocationMarginOfError){var dealerButtonX=this.seats[i].seat.position.x+topRowSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+topRowSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,self.gameState.zPositionData.chips);this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+topChipOffsetX,this.seats[i].seat.position.y+topChipOffsetY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x-chipDiameter-self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);var distanceBetweenChipsY=this.pots[0].secondChip.position.y-this.pots[0].firstChip.position.y;var upperRightChipX=this.seats[i].firstChip.position.x;var upperRightChipY=this.seats[i].firstChip.position.y+distanceBetweenChipsY*(self.imageData.maxChipsPerColumn-1);var betX=upperRightChipX+absoluteDistanceBetweenBetTextAndChipImages;var betY=upperRightChipY;this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,self.gameState.zPositionData.chips)}else if(this.seats[i].seat.position.x<firstColumnX+seatLocationMarginOfError&&this.seats[i].seat.position.x>firstColumnX-seatLocationMarginOfError){var dealerButtonX=this.seats[i].seat.position.x+leftColumnSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+leftColumnSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,self.gameState.zPositionData.chips);this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+leftChipOffsetX,this.seats[i].seat.position.y+leftChipOffsetY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x+chipDiameter+self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);var distanceBetweenChipsY=this.pots[0].secondChip.position.y-this.pots[0].firstChip.position.y;var upperLeftChipX=this.seats[i].firstChip.position.x;var upperLeftChipY=this.seats[i].firstChip.position.y-distanceBetweenChipsY*(self.imageData.maxChipsPerColumn-1);var betX=upperLeftChipX-betTextWidth-absoluteDistanceBetweenBetTextAndChipImages;var betY=upperLeftChipY-betTextHeight-absoluteDistanceBetweenBetTextAndChipImages;this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,self.gameState.zPositionData.chips)}else if(this.seats[i].seat.position.y<fourthRowY+seatLocationMarginOfError&&this.seats[i].seat.position.y>fourthRowY-seatLocationMarginOfError){this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+bottomChipOffsetX,this.seats[i].seat.position.y+bottomChipOffsetY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x+chipDiameter+self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);var bottomLeftChipX=this.seats[i].firstChip.position.x;var bottomLeftChipY=this.seats[i].firstChip.position.y;var betX=bottomLeftChipX-betTextWidth-absoluteDistanceBetweenBetTextAndChipImages;var betY=bottomLeftChipY;var dealerButtonX=this.seats[i].seat.position.x+bottomRowSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+bottomRowSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,self.gameState.zPositionData.chips);this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,self.gameState.zPositionData.chips)}else if(this.seats[i].seat.position.x<fifthColumnX+seatLocationMarginOfError&&this.seats[i].seat.position.x>fifthColumnX-seatLocationMarginOfError){var dealerButtonX=this.seats[i].seat.position.x+rightColumnSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+rightColumnSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,self.gameState.zPositionData.chips);this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+rightChipOffsetX,this.seats[i].seat.position.y+rightChipOffsetY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x-chipDiameter-self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);var bottomRightChipX=this.seats[i].firstChip.position.x;var bottomRightChipY=this.seats[i].firstChip.position.y;var betX=bottomRightChipX-betTextWidth;var betY=bottomRightChipY+chipDiameter+absoluteDistanceBetweenBetTextAndChipImages;this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,self.gameState.zPositionData.chips)}var distanceBetweenChipsY=this.pots[0].secondChip.position.y-this.pots[0].firstChip.position.y;this.seats[i].secondChip=new this.Item(this.seats[i].firstChip.position.x,this.seats[i].firstChip.position.y+distanceBetweenChipsY,chipDiameter,chipDiameter,self.gameState.zPositionData.chips);this.addItemText(this.seats[i].bet,"","12px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{textAlign:"left"});this.seats[i].bet.text.maxWidth=null;if(this.seats[i].dealerButton instanceof this.Item){this.itemAsBitmap(this.seats[i].dealerButton,self.permanentPreferences.sourceObjects.value.dealerButton)}else{console.log(i+" is not a seat")}}_.each(_.range(this.seats.length),function(i){var chatX=self.images.seats[i].seat.position.x+self.images.seats[i].seat.size.x/2-chatBoxWidth/2;var chatY=self.images.seats[i].seat.position.y-absoluteChatDistanceFromSeatY;self.images.seats[i].chat=new self.images.Item(chatX,chatY,chatBoxWidth,initialChatBoxHeight,self.gameState.zPositionData.playerBubbleChat);self.images.seats[i].chat.image=new createjs.Shape;self.images.seats[i].chat.image.drawChat=function(width,numLines){if(width==undefined){var width=self.images.seats[i].chat.size.x}else if(width>self.images.seats[i].chat.size.x){width=self.images.seats[i].chat.size.x}self.images.seats[i].chat.image.graphics.clear();self.images.seats[i].chat.image.parentOfImageObject=self.images.seats[i].chat;var x=(self.images.seats[i].chat.size.x-width)/2;var y=0;self.images.seats[i].chat.image.snapToPixel=true;self.images.seats[i].chat.image.graphics.setStrokeStyle(1,"round").beginStroke(chatBoxBorderColor).beginFill("#000000").drawRoundRect(x,y-(numLines-1)*(chatBoxFontSize+1),width,self.images.seats[i].chat.size.y+(numLines-1)*(chatBoxFontSize+1),self.images.seats[i].chat.size.y*.16);self.images.seats[i].chat.image.alpha=self.imageData.chatBoxAlpha;self.positionItemImage(self.images.seats[i].chat,{update:false})};self.images.seats[i].chat.text=new createjs.Text("",chatBoxFontSize+"px "+self.permanentPreferences.defaultFontType.value,self.permanentPreferences.chatTextColor.value);self.images.seats[i].chat.text.x=self.images.seats[i].chat.position.x+self.images.seats[i].chat.size.x/2;self.images.seats[i].chat.text.y=self.images.seats[i].chat.position.y;self.images.seats[i].chat.text.baseline="top";self.images.seats[i].chat.text.textAlign="center";self.images.seats[i].chat.text.lineWidth=self.images.seats[i].chat.size.x*.85});_.each(_.range(this.seats.length),function(seatNumber){_.each(self.images.seats[seatNumber],function(value,index,element){if(_.isArray(self.images.seats[seatNumber][index])){for(var i=0;i<self.images.seats[seatNumber][index].length;i++){self.images.seats[seatNumber][index][i].seatObjectAncestor=self.images.seats[seatNumber]}}else if(_.isObject(self.images.seats[seatNumber][index])){self.images.seats[seatNumber][index].seatObjectAncestor=self.images.seats[seatNumber]}})});var actionButtonOffsetBottom=8;var actionButtonY=canvasHeight-actionButtonOffsetBottom-actionButtonHeight;var actionButtonHeight=24;
this.fold=new this.Item(actionButtonLeftX,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["act","fold"]});this.call=new this.Item(actionButtonLeftX+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["act","call"]});this.check=new this.Item(actionButtonLeftX+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["act","check"]});this.raise=new this.Item(this.check.position.x+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["act","raise"]});this.bet=new this.Item(this.check.position.x+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["act","bet"]});this.itemAsRectangle(this.fold,"red");this.addItemText(this.fold,"fold","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.itemAsRectangle(this.call,"red");this.addItemText(this.call,"call","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.itemAsRectangle(this.check,"red");this.addItemText(this.check,"check","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.itemAsRectangle(this.raise,"red");this.addItemText(this.raise,"raise","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.itemAsRectangle(this.bet,"red");this.addItemText(this.bet,"bet","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.fold.image.onClick=self.events.onButtonClick;this.call.image.onClick=self.events.onButtonClick;this.check.image.onClick=self.events.onButtonClick;this.raise.image.onClick=self.events.onButtonClick;this.bet.image.onClick=self.events.onButtonClick;var betSliderX=this.bet.position.x+this.bet.size.x+distanceBetweenActionButtons;var betSliderMiddleY=actionButtonY+actionButtonHeight/2;this.betSlider.horizontal=new this.Item(betSliderX,betSliderMiddleY-horizontalBetSliderHeight/2,horizontalBetSliderWidth,horizontalBetSliderHeight,self.gameState.zPositionData.button);var verticalY=this.betSlider.horizontal.position.y+this.betSlider.horizontal.size.y/2-verticalBetSliderHeight/2;this.betSlider.vertical=new this.Item(this.betSlider.horizontal.position.x,verticalY,verticalBetSliderWidth,verticalBetSliderHeight,self.gameState.zPositionData.button);var betSizeX=this.betSlider.horizontal.position.x+this.betSlider.horizontal.size.x+distanceBetweenBetSizeAndHorizontalSlider;var betSizeY=this.betSlider.horizontal.position.y+this.betSlider.horizontal.size.y/2-betSizeHeight/2;this.betSlider.betSize=new this.Item(betSizeX,betSizeY,betSizeWidth,betSizeHeight,self.gameState.zPositionData.button);this.itemAsBitmap(this.betSlider.horizontal,self.permanentPreferences.sourceObjects.value.horizontalSlider);this.itemAsBitmap(this.betSlider.vertical,self.permanentPreferences.sourceObjects.value.verticalSlider);this.betSlider.betSize.image=document.getElementById("betSize");self.updateBetSize("");var betSizeStageParent=self.arrayOfParentsOfStageAndOfContainerArray[self.images.betSlider.vertical.position.z.stage];var betSizeStageCanvasZIndex=$(betSizeStageParent.stage.canvas).css("z-index");$("#betSizeDiv").css("z-index",parseInt(betSizeStageCanvasZIndex)+1);$("#betSize").focus(function(){$("#betSize").one("mouseup",function(event){event.preventDefault()}).select()});$("#betSize").focusout(function(event){self.events.betSizeUnfocused(event)});$("#betSize").change(function(){self.events.betSizeChanged()});$("#betSize").keyup(function(){self.events.betSizeChanged()});$("#betSize").bind("paste",function(e){self.events.betSizeChanged()});$("#betSize")[0].oninput=function(){self.events.betSizeChanged()};$("#betSizeDiv").bind("mousewheel",function(event,delta,deltaX,deltaY){self.events.wheelScroll(deltaY)});$("#betSize").css({position:"absolute",left:this.betSlider.betSize.position.x+"px",top:this.betSlider.betSize.position.y+"px",width:this.betSlider.betSize.size.x+"px",height:this.betSlider.betSize.size.y+"px",padding:"0px",margin:"0px"});this.cashierButton=new this.Item(canvasWidth-80,0,cashierButtonWidth,cashierButtonHeight,self.gameState.zPositionData.button);var cashierButtonSpriteData={images:[self.permanentPreferences.sourceObjects.value.cashierButtonSprite],frames:{width:80,height:31},animations:{mouseOut:0,mouseOver:1,mouseDown:2}};this.standUp=new this.Item(canvasWidth-standUpWidth,0,standUpWidth,standUpHeight,self.gameState.zPositionData.button,{messages:["stand"]});this.itemAsBitmap(this.standUp,self.permanentPreferences.sourceObjects.value.standUp);var standUpHit=new createjs.Shape;var topY=standUpHitAreaTopOffset;var bottomY=this.standUp.size.y-standUpHitAreaBottomOffset;standUpHit.graphics.beginFill("#000000").setStrokeStyle(0).moveTo(standUpHitAreaUpperLeftOffsetX,topY).lineTo(standUpHitAreaLowerLeftOffsetX,bottomY).lineTo(this.standUp.size.x-standUpHitAreaRightOffset,bottomY).lineTo(this.standUp.size.x-standUpHitAreaRightOffset,topY).lineTo(standUpHitAreaUpperLeftOffsetX,topY);this.standUp.image.hitArea=standUpHit;this.standUpDisabledShape=new this.Item(this.standUp.position.x+standUpHitAreaUpperLeftOffsetX,this.standUp.position.y+topY,this.standUp.size.x-standUpHitAreaUpperLeftOffsetX-standUpHitAreaRightOffset,this.standUp.size.y-topY-bottomY,{container:self.gameState.zPositionData.button.container,stage:self.gameState.zPositionData.button.stage+1});this.standUpDisabledShape.image=standUpHit.clone(true);this.standUpDisabledShape.image.x=this.standUp.position.x;this.standUpDisabledShape.image.y=this.standUp.position.y;this.standUpDisabledShape.image.alpha=disabledButtonOverlayAlpha;this.getChips=new this.Item(0,0,getChipsWidth,getChipsHeight,self.gameState.zPositionData.button,{messages:["get_add_chips_info"]});this.itemAsBitmap(this.getChips,self.permanentPreferences.sourceObjects.value.getChips);var getChipsHitTopLeft={x:getChipsHitAreaLeftOffset,y:getChipsHitAreaTopOffset};var getChipsHitBottomLeft={x:getChipsHitTopLeft.x,y:this.getChips.size.y-getChipsHitAreaBottomOffset};var getChipsHitTopRight={x:this.getChips.size.x-getChipsHitAreaUpperRightOffset,y:getChipsHitAreaTopOffset};var getChipsHitBottomRight={x:this.getChips.size.x-getChipsHitAreaLowerRightOffset,y:getChipsHitBottomLeft.y};var getChipsHit=new createjs.Shape;getChipsHit.graphics.beginFill("#000000").beginStroke(0).moveTo(getChipsHitTopLeft.x,getChipsHitTopLeft.y).lineTo(getChipsHitBottomLeft.x,getChipsHitBottomLeft.y).lineTo(getChipsHitBottomRight.x,getChipsHitBottomRight.y).lineTo(getChipsHitTopRight.x,getChipsHitTopRight.y).closePath;this.getChips.image.hitArea=getChipsHit;this.getChipsDisabledShape=new this.Item(getChipsHitTopLeft.x,getChipsHitTopLeft.y,getChipsHitTopRight.x-getChipsHitTopLeft.x,getChipsHitBottomRight.y-getChipsHitTopLeft.y,{container:self.gameState.zPositionData.button.container,stage:self.gameState.zPositionData.button.stage+1});this.getChipsDisabledShape.image=getChipsHit;this.getChipsDisabledShape.image.alpha=disabledButtonOverlayAlpha;var exitTableOffsetY=distanceBetweenUpperButtonHitAreasY-exitTableHitAreaTopOffset-standUpHitAreaBottomOffset;this.exitTable=new this.Item(canvasWidth-exitTableWidth,standUpHeight,exitTableWidth,exitTableHeight,self.gameState.zPositionData.button);this.itemAsBitmap(this.exitTable,self.permanentPreferences.sourceObjects.value.exitTable);var exitTableHit=new createjs.Shape;exitTableHit.graphics.beginStroke(0).beginFill("#000000").moveTo(this.exitTable.size.x-exitTableHitAreaRightOffset,exitTableHitAreaTopOffset).lineTo(this.exitTable.size.x-exitTableHitAreaRightOffset,this.exitTable.size.y-exitTableHitAreaBottomOffset).lineTo(exitTableHitAreaLowerLeftOffsetX,this.exitTable.size.y-exitTableHitAreaBottomOffset).lineTo(exitTableHitAreaUpperLeftOffsetX,exitTableHitAreaTopOffset).lineTo(this.exitTable.size.x-exitTableHitAreaRightOffset,exitTableHitAreaTopOffset);this.exitTable.image.hitArea=exitTableHit;this.exitTable.image.onClick=self.events.exitTableClick;this.sitIn=new this.Item(actionButtonLeftX,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["sit_in"]});this.rebuy=new this.Item(actionButtonLeftX,actionButtonY,actionButtonWidth,actionButtonHeight,self.gameState.zPositionData.button,{messages:["get_add_chips_info"]});this.itemAsRectangle(this.sitIn,"black");this.addItemText(this.sitIn,"Deal Me In","10px "+self.permanentPreferences.defaultFontType.value,"white");this.itemAsRectangle(this.rebuy,"black");this.addItemText(this.rebuy,"Get Chips","10px "+self.permanentPreferences.defaultFontType.value,"white");this.sitIn.image.onClick=self.events.onButtonClick;this.rebuy.image.onClick=self.events.onButtonClick;var currencyDisplayX=canvasWidth/2-currencyDisplayWidth/2;this.currencyDisplay=new this.Item(currencyDisplayX,currencyDisplayTopOffset,currencyDisplayWidth,currencyDisplayHeight,self.gameState.zPositionData.background);this.addItemText(this.currencyDisplay,"",currencyDisplaySizeAndFont,currencyDisplayColor);var fourColorDeckData={images:[self.permanentPreferences.sourceObjects.value.fourColorDeck],frames:{width:37,height:45}};var containersPerMessageBox=self.gameState.zPositionData.containersPerMessageBox;var messageBoxStageNumber=self.gameState.zPositionData.initialMessageBox.stage;for(var messageBoxImageContainerIndex=self.gameState.zPositionData.initialMessageBox.container;messageBoxImageContainerIndex<=self.gameState.zPositionData.finalMessageBox.container-containersPerMessageBox;messageBoxImageContainerIndex=messageBoxImageContainerIndex+containersPerMessageBox){for(var n=messageBoxImageContainerIndex;n<messageBoxImageContainerIndex+containersPerMessageBox;n++){self.images.messageBox[n]={}}self.images.messageBox[messageBoxImageContainerIndex].window=new self.images.Item(0,0,0,0,{stage:messageBoxStageNumber,container:messageBoxImageContainerIndex});self.images.itemAsBitmap(self.images.messageBox[messageBoxImageContainerIndex].window,self.permanentPreferences.sourceObjects.value.messageBoxBackground);self.images.messageBox[messageBoxImageContainerIndex].closeWindow=new self.images.Item(0,0,0,0,{stage:messageBoxStageNumber,container:messageBoxImageContainerIndex});self.images.itemAsBitmap(self.images.messageBox[messageBoxImageContainerIndex].closeWindow,self.permanentPreferences.sourceObjects.value.messageBoxCloseX)}$(self.arrayOfParentsOfStageAndOfContainerArray[this.messageBox[0].window.position.z.stage].stage.canvas).css("display","none");this.table=new this.Item(tableX,tableY,canvasWidth,canvasHeight,self.gameState.zPositionData.table);this.itemAsBitmap(this.table,self.permanentPreferences.sourceObjects.value.table);self.images.createCashier=function(){var cashierImageContainerIndex=self.gameState.zPositionData.cashier.container;var cashierStageNumber=self.gameState.zPositionData.cashier.stage;var cashierWindowContainer=0;var cashierWindowWidth=298;var cashierWindowHeight=360;var textLeftOffset=13;var textTopOffset=4;var textRightOffset=136;var textHeight=13;var distanceBetweenTextY=5;var sizeAndFont="12px "+self.permanentPreferences.defaultFontType.value;var textColor="#000000";var outerTopHeight=31;var outerBottomHeight=8;var outerSideWidth=8;var columns=2;var rows=10;var cashierWindowX=canvasWidth/2-cashierWindowWidth/2;var cashierWindowY=canvasHeight/2-cashierWindowHeight/2;var closeWindowWidth=31;var closeWindowHeight=20;var closeWindowY=cashierWindowY+1;var closeWindowX=cashierWindowX+cashierWindowWidth-closeWindowWidth-7;var innerCashierX=cashierWindowX+outerSideWidth;var innerCashierY=cashierWindowY+outerTopHeight;var innerCashierWidth=cashierWindowWidth-2*outerSideWidth-2;var innerCashierHeight=cashierWindowHeight-outerBottomHeight-outerTopHeight;var textX=innerCashierX+textLeftOffset;var textBoxOffsetLeft=135;var textBoxOffsetRight=23;var textBoxToTextHeightRatio=1.8;var distanceFromGrayBoxTopToFirstTextBox=15;var textBoxHeight=textHeight*textBoxToTextHeightRatio;var textBoxWidth=innerCashierWidth-textBoxOffsetRight-textBoxOffsetLeft;var distanceBetweenTextBoxY=textBoxToTextHeightRatio*distanceBetweenTextY;var radioOffsetLeft=19.5;var radioWidth=13;var radioHeight=radioWidth;var distanceFromRadioToText=6;var grayBoxOffsetTop=151;var htmlTextWidth=textBoxOffsetLeft-radioWidth-distanceFromRadioToText-radioOffsetLeft;var grayBoxOffsetSide=11;var grayBoxOffsetTop=150;var grayBoxOffsetBottom=49;this.cashier.window=new this.Item(cashierWindowX,cashierWindowY,cashierWindowWidth,cashierWindowHeight,{stage:cashierStageNumber,container:cashierWindowContainer});this.itemAsBitmap(this.cashier.window,self.permanentPreferences.sourceObjects.value.cashierBackground);var clickAndDragHitArea=new createjs.Rectangle(this.cashier.window.position.x,this.cashier.window.y,cashierWindowWidth,outerTopHeight);this.cashier.window.image.removeAllEventListeners();this.cashier.window.image.addEventListener("mousedown",function(e){var options={animationTarget:self.images.cashier};self.events.mouseDownClickAndDrag(e,options)});var textColumnX=[];var textColumnWidth=[];var textRowY=[];for(var i=0;i<rows;i++){textRowY.push(cashierWindowY+outerTopHeight+textTopOffset+i*(textHeight+distanceBetweenTextY))}for(var i=0;i<columns;i++){if(i%columns==0){textColumnX.push(cashierWindowX+outerSideWidth+textLeftOffset)}else if(i%columns==1){textColumnX.push(cashierWindowX+cashierWindowWidth-outerSideWidth-textRightOffset)}}for(var i=0;i<columns;i++){if(i%columns==0){textColumnWidth.push(textColumnX[(i+1)%columns]-textColumnX[i])}else if(i%columns==1){textColumnX.push(cashierWindowX+cashierWindowWidth-outerSideWidth-textColumnX[i])}}var cashierItems={};cashierItems.currency={name:"currency",location:[0,0]};cashierItems.blinds={name:"blinds",location:[1,0]};cashierItems.tableName={name:"tableName",location:[0,1],text:"Table Name:"};cashierItems.tableNameValue={name:"tableNameValue",location:[1,1]};cashierItems.tableMin={name:"tableMin",location:[0,2],text:"Table Minimum:"};cashierItems.tableMinValue={name:"tableMinValue",location:[1,2]};cashierItems.tableMax={name:"tableMax",location:[0,3],text:"Table Maximum:"};cashierItems.tableMaxValue={name:"tableMaxValue",location:[1,3]};cashierItems.playerMin={name:"playerMin",location:[0,4],text:"Minimum Add-On:"};cashierItems.playerMinValue={name:"playerMinValue",location:[1,4]};cashierItems.accountBalance={name:"accountBalance",location:[0,5],text:"Available Balance:"};cashierItems.accountBalanceValue={name:"accountBalanceValue",location:[1,5]};cashierItems.autoRebuy={name:"autoRebuy",location:[0,6],text:"Auto-Rebuy:"};cashierItems.autoRebuyValue={name:"autoRebuyValue",location:[1,6]};var rowsUsed=7;$(self.arrayOfParentsOfStageAndOfContainerArray[self.images.cashier.window.position.z.stage].stage.canvas).css("display","none");$("#cashier input[type='radio']").css({background:"rgb(233,233,233)","background-image":"img/radio_button_bg.jpg","background-repeat":"repeat","-webkit-backface-visibility":"hidden"});var radioX=innerCashierX+radioOffsetLeft;var maxTextBoxY=innerCashierY+grayBoxOffsetTop+distanceFromGrayBoxTopToFirstTextBox;var textBoxX=innerCashierX+textBoxOffsetLeft;var maxRadioY=maxTextBoxY+textBoxHeight/2-radioHeight/2;var textX=radioX+radioWidth+distanceFromRadioToText;var cashierParentOfStage=self.arrayOfParentsOfStageAndOfContainerArray[self.images.cashier.window.position.z.stage];var cashierStageCanvasZIndex=parseInt($(cashierParentOfStage.stage.canvas).css("z-index"));$("#cashierDiv").css({"z-index":parseInt(cashierStageCanvasZIndex)+1,width:cashierParentOfStage.stage.canvas.width,height:cashierParentOfStage.stage.canvas.height,left:0,top:0});$("#cashier input[type='text']").css("width",textBoxWidth+"px");$("#cashier input[type='text']").css("height",textBoxHeight+"px");$("#cashier").children().children().css({font:sizeAndFont});$("#cashier p").css({"max-width":htmlTextWidth+"px",height:textBoxHeight+"px","white-space":"nowrap"});this.cashier.maxRadio=new this.Item(radioX,maxRadioY,radioWidth,radioHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.maxRadio.image=$("#maxRadio")[0];$("#maxRadio").css("left",radioX+"px");$("#maxRadio").css("top",maxRadioY+"px");this.cashier.maxText=new this.Item(textX,maxRadioY,htmlTextWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.maxText.image=$("#maxText")[0];$("#maxText").css("left",textX+"px");$("#maxText").css("top",maxRadioY+"px");this.cashier.maxAmount=new this.Item(textBoxX,maxTextBoxY,textBoxWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.maxAmount.image=$("#maxAmount")[0];$("#maxAmount").css("left",textBoxX+"px");$("#maxAmount").css("top",maxTextBoxY+"px");var otherTextBoxY=maxTextBoxY+textBoxHeight+distanceBetweenTextBoxY;var otherRadioY=otherTextBoxY+textBoxHeight/2-radioHeight/2;this.cashier.otherAmountRadio=new this.Item(radioX,otherRadioY,radioWidth,radioHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.otherAmountRadio.image=$("#otherAmountRadio")[0];$("#otherAmountRadio").css("left",radioX+"px");$("#otherAmountRadio").css("top",otherRadioY+"px");this.cashier.otherAmountText=new this.Item(textX,otherRadioY,htmlTextWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.otherAmountText.image=$("#otherAmountText")[0];$("#otherAmountText").css("left",textX+"px");$("#otherAmountText").css("top",otherRadioY+"px");this.cashier.otherAmount=new this.Item(textBoxX,otherTextBoxY,textBoxWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.otherAmount.image=$("#otherAmount")[0];$("#otherAmount").css("left",textBoxX+"px");$("#otherAmount").css("top",otherTextBoxY+"px");var autoRebuyTextBoxY=otherTextBoxY+textBoxHeight+distanceBetweenTextBoxY;var autoRebuyRadioY=autoRebuyTextBoxY+textBoxHeight/2-radioHeight/2;this.cashier.autoRebuyRadio=new this.Item(radioX,autoRebuyRadioY,radioWidth,radioHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.autoRebuyRadio.image=$("#autoRebuyRadio")[0];$("#autoRebuyRadio").css("left",radioX+"px");$("#autoRebuyRadio").css("top",autoRebuyRadioY+"px");this.cashier.autoRebuyText=new this.Item(textX,autoRebuyRadioY,htmlTextWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.autoRebuyText.image=$("#autoRebuyText")[0];$("#autoRebuyText").css("left",textX+"px");$("#autoRebuyText").css("top",autoRebuyRadioY+"px");this.cashier.autoRebuyAmount=new this.Item(textBoxX,autoRebuyTextBoxY,textBoxWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.autoRebuyAmount.image=$("#autoRebuyAmount")[0];$("#autoRebuyAmount").css("left",textBoxX+"px");$("#autoRebuyAmount").css("top",autoRebuyTextBoxY+"px");$("#otherAmountDiv").children().unbind();$("#otherAmountDiv").children().mousedown(function(event){self.events.cashierInputSelected(event)});$("#autoRebuyDiv").children().unbind();$("#autoRebuyDiv").children().mousedown(function(event){self.events.cashierInputSelected(event)});$("#maxDiv").children().unbind();$("#maxDiv").children().mousedown(function(event){self.events.cashierInputSelected(event)});$("#cashierDiv").find("input[type = 'text']").unbind();$("#cashierDiv").find("input[type = 'text']").focus(function(event){self.events.onCashierTextFieldFocus(event)});for(var i in cashierItems){if(_.isArray(cashierItems[i].location)){this.cashier[cashierItems[i].name]=new this.Item(textColumnX[cashierItems[i].location[0]],textRowY[cashierItems[i].location[1]],textColumnWidth[0],textHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});if(cashierItems[i].text){var text=cashierItems[i].text}else{var text=""}this.cashier[cashierItems[i].name].text=new createjs.Text(text,sizeAndFont,textColor);this.cashier[cashierItems[i].name].text.x=this.cashier[cashierItems[i].name].position.x;this.cashier[cashierItems[i].name].text.y=this.cashier[cashierItems[i].name].position.y+1;this.cashier[cashierItems[i].name].text.baseline="top";this.cashier[cashierItems[i].name].text.textAlign="left";this.cashier[cashierItems[i].name].text.maxWidth=this.cashier[cashierItems[i].name].size.x*.9}}var grayBoxX=cashierWindowX+outerSideWidth+grayBoxOffsetSide;var grayBoxY=cashierWindowY+outerTopHeight+grayBoxOffsetTop;var grayBoxWidth=cashierWindowWidth-2*outerSideWidth-2*grayBoxOffsetSide;var grayBoxHeight=cashierWindowY+cashierWindowHeight-outerBottomHeight-grayBoxOffsetBottom-grayBoxY;this.cashier.grayBox=new this.Item(grayBoxX,grayBoxY,grayBoxWidth,grayBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});var addChipsText="add chips";var cancelText="cancel";var cashierButtonTextSizeAndFont="13px "+self.permanentPreferences.defaultFontType.value;var cashierButtonHeight=21;var cashierButtonTextColor="white";var cashierButtonColor="blue";var cashierRatioOfTextWidthToButtonWidth=.83;var distanceBetweenCashierButtons=innerCashierWidth/5.4;var addChipsWidth=self.getStringWidth(addChipsText,cashierButtonTextSizeAndFont)/cashierRatioOfTextWidthToButtonWidth;var cancelWidth=self.getStringWidth(cancelText,cashierButtonTextSizeAndFont)/cashierRatioOfTextWidthToButtonWidth;if(addChipsWidth>=cancelWidth){var cashierButtonWidth=addChipsWidth}else{var cashierButtonWidth=cancelWidth}var addChipsX=cashierWindowX+cashierWindowWidth/2-distanceBetweenCashierButtons/2-cashierButtonWidth;var cancelX=cashierWindowX+cashierWindowWidth/2+distanceBetweenCashierButtons/2;var innerCashierBottomY=innerCashierY+innerCashierHeight;var cashierButtonY=innerCashierBottomY-grayBoxOffsetBottom/2-cashierButtonHeight/2;this.cashier.addChipsTextBox=new this.Item(textX,this.cashier.accountBalance.position.y+25,innerCashierWidth,25,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.addChips=new this.Item(addChipsX,cashierButtonY,cashierButtonWidth,cashierButtonHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.itemAsRectangle(this.cashier.addChips,cashierButtonColor);this.addItemText(this.cashier.addChips,addChipsText,cashierButtonTextSizeAndFont,cashierButtonTextColor);this.cashier.addChips.image.onClick=self.events.onAddChipsClick;this.cashier.cancel=new this.Item(cancelX,cashierButtonY,cashierButtonWidth,cashierButtonHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.itemAsRectangle(this.cashier.cancel,cashierButtonColor);this.addItemText(this.cashier.cancel,cancelText,cashierButtonTextSizeAndFont,cashierButtonTextColor);this.cashier.cancel.image.onClick=self.hideCashier;this.cashier.closeWindow=new this.Item(closeWindowX,closeWindowY,closeWindowWidth,closeWindowHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.itemAsBitmap(this.cashier.closeWindow,self.permanentPreferences.sourceObjects.value.cashierCloseX);this.cashier.closeWindow.image.onClick=self.hideCashier};self.images.createCashier();var showTableChatFullOffsetY=distanceBetweenUpperButtonHitAreasY-showTableChatFullHitAreaOffsetTop-getChipsHitAreaBottomOffset;this.showTableChatFull=new this.Item(this.getChips.position.x,this.getChips.position.y+this.getChips.size.y+showTableChatFullOffsetY,showTableChatFullWidth,showTableChatFullHeight,self.gameState.zPositionData.button);this.itemAsBitmap(this.showTableChatFull,self.permanentPreferences.sourceObjects.value.showTableChatFull);this.showTableChatFull.image.onClick=self.events.showTableChatFullOnClick;this.hideTableChatFull=new this.Item(this.getChips.position.x,this.getChips.position.y+this.getChips.size.y+showTableChatFullOffsetY,showTableChatFullWidth,showTableChatFullHeight,self.gameState.zPositionData.button);this.itemAsBitmap(this.hideTableChatFull,self.permanentPreferences.sourceObjects.value.hideTableChatFull);this.hideTableChatFull.image.onClick=self.events.hideTableChatFullOnClick;var showTableChatFullHitArea=new createjs.Shape;showTableChatFullHitArea.graphics.beginStroke(0).beginFill("#000000").moveTo(showTableChatFullHitAreaOffsetLeft,showTableChatFullHitAreaOffsetTop).lineTo(showTableChatFullHitAreaOffsetLeft,showTableChatFullHeight-showTableChatFullHitAreaOffsetBottom).lineTo(showTableChatFullWidth-showTableChatFullHitAreaOffsetBottomRight,showTableChatFullHeight-showTableChatFullHitAreaOffsetBottom).lineTo(showTableChatFullWidth-showTableChatFullHitAreaOffsetTopRight,showTableChatFullHitAreaOffsetTop).lineTo(showTableChatFullHitAreaOffsetLeft,showTableChatFullHitAreaOffsetTop);this.showTableChatFull.image.hitArea=showTableChatFullHitArea;this.hideTableChatFull.image.hitArea=showTableChatFullHitArea;var tableChatFullLeftOffset=5;var tableChatFullTopOffsetFromHideChat=4;var tableChatFullBottomOffsetFromFoldToAnyBetButton=5;var tableChatFullRightOffsetFromMiddleSeat=10;this.tableChatFull={};var tableChatFullStageX=tableChatFullLeftOffset;var tableChatFullStageY=tableChatFullTopOffsetFromHideChat+this.hideTableChatFull.position.y+this.hideTableChatFull.size.y;var tableChatFullStageWidth=this.seats[0].seat.position.x-tableChatFullStageX-tableChatFullRightOffsetFromMiddleSeat;var tableChatFullStageHeight=this.foldToAnyBet.position.y-tableChatFullBottomOffsetFromFoldToAnyBetButton-tableChatFullStageY;this.tableChatFull.htmlStageElement=new this.Item(tableChatFullStageX,tableChatFullStageY,tableChatFullStageWidth,tableChatFullStageHeight,self.gameState.zPositionData.tableChatFull);var tableChatFullStageCanvas=self.arrayOfParentsOfStageAndOfContainerArray[this.tableChatFull.htmlStageElement.position.z.stage].stage.canvas;$(tableChatFullStageCanvas).attr({width:this.tableChatFull.htmlStageElement.size.x+"px",height:this.tableChatFull.htmlStageElement.size.y+"px"});$(tableChatFullStageCanvas).css({display:"none",left:this.tableChatFull.htmlStageElement.position.x+"px",top:this.tableChatFull.htmlStageElement.position.y+"px"});var tableChatFullWindowBackgroundColor=self.permanentPreferences.tableChatFull.windowColor.value;var tableChatFullWindowBorderColor="#000000";var tableChatFullWindowBorderWidth=1;var tableChatFullWindowAlpha=self.permanentPreferences.tableChatFull.windowAlpha.value;var tableChatFullRoundedRectCornerSizeRatioOfHeight=.05;this.tableChatFull.window=new this.Item(0,0,tableChatFullStageWidth,tableChatFullStageHeight,self.gameState.zPositionData.tableChatFull);this.tableChatFull.window.image=new createjs.Shape;this.tableChatFull.window.image.graphics.beginFill(tableChatFullWindowBackgroundColor).setStrokeStyle(tableChatFullWindowBorderWidth,"round").beginStroke(tableChatFullWindowBorderColor).drawRoundRect(this.tableChatFull.window.position.x,this.tableChatFull.window.position.y,this.tableChatFull.window.size.x,this.tableChatFull.window.size.y,tableChatFullRoundedRectCornerSizeRatioOfHeight*this.tableChatFull.window.size.y);this.tableChatFull.window.image.alpha=tableChatFullWindowAlpha;var hideDealerMessagesOffsetLeft=this.tableChatFull.htmlStageElement.size.x*.05;var hideDealerMessagesOffsetRight=hideDealerMessagesOffsetLeft;var hideDealerMessagesOffsetTop=checkBoxButtonDistanceY;this.tableChatFull.hideDealerMessages=new this.Item(hideDealerMessagesOffsetLeft,hideDealerMessagesOffsetTop,this.tableChatFull.window.size.x-checkBoxButtonOffSetLeft*2,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.hideDealerMessages,self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.hideDealerMessages,"Hide dealer messages");this.tableChatFull.hideDealerMessages.image.onClick=self.events.hideDealerMessagesClicked;this.tableChatFull.hideDealerMessagesOn=new this.Item(hideDealerMessagesOffsetLeft,this.tableChatFull.hideDealerMessages.position.y,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.hideDealerMessagesOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.hideDealerMessagesOn,"Hide dealer messages");this.tableChatFull.hideDealerMessagesOn.image.onClick=self.events.hideDealerMessagesOnClicked;this.tableChatFull.hidePlayerMessages=new this.Item(hideDealerMessagesOffsetLeft,hideDealerMessagesOffsetTop*2+checkBoxButtonHeight,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.hidePlayerMessages,self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.hidePlayerMessages,"Hide player messages");this.tableChatFull.hidePlayerMessages.image.onClick=self.events.hidePlayerMessagesClicked;this.tableChatFull.hidePlayerMessagesOn=new this.Item(hideDealerMessagesOffsetLeft,this.tableChatFull.hidePlayerMessages.position.y,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.hidePlayerMessagesOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.hidePlayerMessagesOn,"Hide player messages");this.tableChatFull.hidePlayerMessagesOn.image.onClick=self.events.hidePlayerMessagesOnClicked;this.tableChatFull.hideObserverMessages=new this.Item(hideDealerMessagesOffsetLeft,checkBoxButtonDistanceY*3+checkBoxButtonHeight*2,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.hideObserverMessages,self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.hideObserverMessages,"Hide observer messages");this.tableChatFull.hideObserverMessages.image.onClick=self.events.hideObserverMessagesClicked;this.tableChatFull.hideObserverMessagesOn=new this.Item(hideDealerMessagesOffsetLeft,this.tableChatFull.hideObserverMessages.position.y,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.hideObserverMessagesOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.hideObserverMessagesOn,"Hide observer messages");this.tableChatFull.hideObserverMessagesOn.image.onClick=self.events.hideObserverMessagesOnClicked;var longestLeftSideCheckBoxAndTextItemWidth=this.tableChatFull.hideObserverMessages.size.x;if(this.tableChatFull.hidePlayerMessages.size.x>longestLeftSideCheckBoxAndTextItemWidth){longestLeftSideCheckBoxAndTextItemWidth=this.tableChatFull.hidePlayerMessages.size.x}if(this.tableChatFull.hideDealerMessages.size.x>longestLeftSideCheckBoxAndTextItemWidth){longestLeftSideCheckBoxAndTextItemWidth=this.tableChatFull.hidePlayerMessages.size.x}var rightSideCheckBoxX=this.tableChatFull.hideDealerMessages.position.x+longestLeftSideCheckBoxAndTextItemWidth+hideDealerMessagesOffsetRight;var rightSideCheckBoxY=this.tableChatFull.hideDealerMessages.position.y;this.tableChatFull.disableTouchScroll=new this.Item(rightSideCheckBoxX,rightSideCheckBoxY,0,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.disableTouchScroll,self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.disableTouchScroll,"Disable touch scroll");this.tableChatFull.disableTouchScroll.image.onClick=self.events.disableTouchScrollClicked;this.tableChatFull.disableTouchScrollOn=new this.Item(this.tableChatFull.disableTouchScroll.position.x,this.tableChatFull.disableTouchScroll.position.y,this.tableChatFull.disableTouchScroll.size.x,checkBoxButtonHeight,self.gameState.zPositionData.tableChatFullText);this.itemAsBitmap(this.tableChatFull.disableTouchScrollOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);
self.images.addCheckBoxButtonText(this.tableChatFull.disableTouchScrollOn,"Disable touch scroll");this.tableChatFull.disableTouchScrollOn.image.onClick=self.events.disableTouchScrollOnClicked;var htmlChatStageElementTextOffsetLeft=checkBoxButtonOffSetLeft-1;var htmlChatStageElementTextOffsetRight=checkBoxButtonOffSetLeft-1;var htmlChatStageElementTextOffsetTopFromLastButton=3;var htmlChatStageElementTextOffsetBottom=this.tableChatFull.window.size.y*tableChatFullRoundedRectCornerSizeRatioOfHeight;var htmlChatStageElementX=this.tableChatFull.htmlStageElement.position.x+htmlChatStageElementTextOffsetLeft;var htmlChatStageElementY=this.tableChatFull.htmlStageElement.position.y+this.tableChatFull.hideObserverMessages.position.y+this.tableChatFull.hideObserverMessages.size.y+htmlChatStageElementTextOffsetTopFromLastButton;var htmlChatStageElementWidth=this.tableChatFull.htmlStageElement.size.x-htmlChatStageElementTextOffsetLeft-htmlChatStageElementTextOffsetRight;var htmlChatStageElementHeight=this.tableChatFull.htmlStageElement.size.y-htmlChatStageElementTextOffsetBottom-(htmlChatStageElementY-this.tableChatFull.htmlStageElement.position.y);this.tableChatFull.htmlChatStageElement=new this.Item(htmlChatStageElementX,htmlChatStageElementY,htmlChatStageElementWidth,htmlChatStageElementHeight,self.gameState.zPositionData.tableChatFull);var tableChatFullParentOfStage=self.arrayOfParentsOfStageAndOfContainerArray[this.tableChatFull.htmlChatStageElement.position.z.stage];var tableChatFullStageCanvasZIndex=$(tableChatFullParentOfStage.stage.canvas).css("z-index");self.jQueryObjects.tableChatFullDiv.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",display:"none",left:this.tableChatFull.htmlChatStageElement.position.x+"px",top:this.tableChatFull.htmlChatStageElement.position.y+"px",width:this.tableChatFull.htmlChatStageElement.size.x+"px",height:this.tableChatFull.htmlChatStageElement.size.y+"px","z-index":parseInt(tableChatFullStageCanvasZIndex)+1});var scrollBarInnerWidth=2;var scrollBarBorderWidth=1;var scrollBarTotalWidth=scrollBarInnerWidth+2*scrollBarBorderWidth;var chatMessageOffsetLeft=0;var chatMessageOffsetRight=0;var chatMessageOffsetTop=0;var chatMessageOffsetBottom=chatMessageOffsetTop;this.tableChatFull.chatMessageText=new this.Item(chatMessageOffsetLeft,chatMessageOffsetTop,htmlChatStageElementWidth-chatMessageOffsetLeft-chatMessageOffsetRight,htmlChatStageElementHeight-chatMessageOffsetTop-chatMessageOffsetBottom,self.gameState.zPositionData.tableChatFullText);var chatMessageFontSize=self.permanentPreferences.tableChatFull.chatMessageFontSize.value;var chatMessageFont="Lucida Sans";var chatMessageFontColor=self.permanentPreferences.tableChatFull.chatMessageFontColor.value;this.tableChatFull.chatMessageText.text=document.getElementById("tableChatFullTextDiv");var messageTextScrollBarNiceScrollOptions={cursorwidth:3,cursorborderwidth:scrollBarBorderWidth+"px solid #FFF",enablescrollonselection:false,horizrailenabled:false,hwacceleration:false,bouncescroll:false,cursoropacitymax:self.permanentPreferences.tableChatFull.windowAlpha.value,autohidemode:false,touchbehavior:true,zindex:parseInt(tableChatFullStageCanvasZIndex)+1,background:"transparent"};var mCustomScrollbarOptions={theme:"light",updateOnContentResize:true,scrollButtons:{enable:true},callbacks:{onScrollStart:function(){console.log("scrolling started")}},set_height:this.tableChatFull.htmlChatStageElement.size.y,horizontalScroll:false};if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("creating mCustomScrollbar");self.jQueryObjects.tableChatFullDiv.mCustomScrollbar(mCustomScrollbarOptions)}else{$("#tableChatFullTextDiv").niceScroll(messageTextScrollBarNiceScrollOptions)}var stopWheel=function(e){console.log(e);if(e.preventDefault){e.preventDefault()}e.returnValue=false};self.jQueryObjects.tableChatFullParagraph.css({width:this.tableChatFull.chatMessageText.size.x+"px",height:this.tableChatFull.chatMessageText.size.y+"px",font:chatMessageFont,"font-size":chatMessageFontSize+"px",color:chatMessageFontColor,"text-overflow":"auto",top:this.tableChatFull.chatMessageText.position.y+"px",left:this.tableChatFull.chatMessageText.position.x+"px"});console.log(this.tableChatFull.chatMessageText);for(var i=0;i<this.seats.length;i++){self.displayChipStack(99999999999999,this.seats[i],{hidden:true,chipArrayName:"referenceChips"})}self.createPreactionOptionItems();console.log("all createjs images have been created")};this.createStage=function(options){var initializeStageSettings=function(options){if(!options){var options={}}if(!options.stageOptions){options.stageOptions={}}if(!_.isNumber(options.stage)){var stageNumber=self.arrayOfParentsOfStageAndOfContainerArray.length-1}else{var stageNumber=options.stage}var stageOptions=options.stageOptions;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.autoClear=false;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.snapToPixel=false;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.snapToPixelEnabled=false;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.mouseMoveOutside=true;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.tickOnUpdate=false;if(stageOptions){if(stageOptions.touchEnabled===true){createjs.Touch.enable(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage)}if(!_.isNull(stageOptions.mouseEnabled)&&!_.isUndefined(stageOptions.mouseEnabled)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.mouseEnabled=stageOptions.mouseEnabled}if(!_.isNull(stageOptions.mouseMoveOutside)&&!_.isUndefined(stageOptions.mouseMoveOutside)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.mouseMoveOutside=stageOptions.mouseMoveOutside}if(_.isNumber(stageOptions.mouseOverFrequency)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.enableMouseOver(stageOptions.mouseOverFrequency)}if(!_.isNull(stageOptions.enableDOMEvents)&&!_.isUndefined(stageOptions.enableDOMEvents)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.enableDOMEvents(stageOptions.enableDOMEvents)}}if(options.canvasHidden===true){$(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.canvas).css("display","none")}if(_.isNumber(options.numContainers)){var numContainers=options.numContainers;if(!_.isArray(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers=[]}for(var i=0;i<numContainers;i++){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[i]=new createjs.Container;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.addChild(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[i])}}};if(!options){var options={}}if(!_.isNumber(options.stage)){options.stage=this.arrayOfParentsOfStageAndOfContainerArray.length}if(options.stage===0||this.arrayOfParentsOfStageAndOfContainerArray.length==0){var previousCanvasIDNumber=0;var newCanvasIDNumber=0}else{for(var i=options.stage-1;i>=0;i--){if(!_.isEmpty(this.arrayOfParentsOfStageAndOfContainerArray[i])){var previousStageNumber=i;i=-9999}}var previousCanvasID=this.arrayOfParentsOfStageAndOfContainerArray[previousStageNumber].stage.canvas.id;var previousCanvasIDNumber=parseFloat(previousCanvasID.replace("canvas",""));if(options.stage>this.arrayOfParentsOfStageAndOfContainerArray.length-1){var newCanvasIDNumber=previousCanvasIDNumber+1}else{var nextCanvasID=this.arrayOfParentsOfStageAndOfContainerArray[options.stage].stage.canvas.id;var nextCanvasIDNumber=parseFloat(nextCanvasID.replace("canvas",""));var newCanvasIDNumber=(previousCanvasIDNumber+nextCanvasIDNumber)/2}}if(options.newCanvas===true||options.stage===0){var newCanvasID="canvas"+newCanvasIDNumber;var canvasWidth=$("#iframeSize")[0].width;var canvasHeight=$("#iframeSize")[0].height;var canvasClass="pokerCanvasClass";var zIndexesPerCanvas=10;var initialZIndex=3;self.jQueryObjects.canvasDiv.append("<canvas id = "+"'"+newCanvasID+"'"+"class = "+"'"+canvasClass+"'"+" width="+"'"+canvasWidth+"'"+" height="+"'"+canvasHeight+"'"+"></canvas>");$("#"+newCanvasID).css("z-index",parseInt(newCanvasIDNumber*zIndexesPerCanvas)+initialZIndex)}else{var newCanvasID="canvas"+previousCanvasIDNumber}self.arrayOfParentsOfStageAndOfContainerArray.splice(options.stage,0,{});self.arrayOfParentsOfStageAndOfContainerArray[options.stage].upToDate=true;self.arrayOfParentsOfStageAndOfContainerArray[options.stage].nickName=options.nickName;var canvas=document.getElementById(newCanvasID);self.arrayOfParentsOfStageAndOfContainerArray[options.stage].stage=new createjs.Stage(canvas);initializeStageSettings(options)};this.initializeStagesAndCanvasCallThisFirst=function(){var zPositionData=this.gameState.zPositionData;var stageData=[];_.each(zPositionData,function(element,index,list){if(zPositionData[index].container===0){stageData[zPositionData[index].stage]=zPositionData[index];stageData[zPositionData[index].stage].nickName=index}},this);var canvasNumber=0;_.each(_.range(stageData.length),function(stageIteration){self.createStage(stageData[stageIteration])})};this.setBackground=function(){var canvasHeight=this.arrayOfParentsOfStageAndOfContainerArray[this.gameState.zPositionData.background.stage].stage.canvas.height;var canvasWidth=this.arrayOfParentsOfStageAndOfContainerArray[this.gameState.zPositionData.background.stage].stage.canvas.width;this.images.background=new this.images.Item(0,0,canvasWidth,canvasHeight,this.gameState.zPositionData.background);this.images.itemAsBitmap(this.images.background,self.permanentPreferences.sourceObjects.value.background);this.displayChildren(this.images.background)};this.images.setDefaultEvents=function(){this.betSlider.vertical.image.onPress=self.events.betSliderVerticalMouseDown;this.betSlider.horizontal.image.onPress=self.events.betSliderHorizontalMouseDown;for(var i=0;i<this.seats.length;i=i+1){this.seats[i].openSeat.image.onClick=function(event){if(_.isArray(event.target.parentOfImageObject.messages)){event.target.parentOfImageObject.messages.splice(0)}else{event.target.parentOfImageObject.messages=[]}event.target.parentOfImageObject.messages.push("sit",event.target.parentOfImageObject.seatObjectAncestor.rotatedSeatNumber);self.events.onButtonClick(event)}}};this.images.setDefaultMessages=function(){};this.createAllItems=function(){this.updatePreference(this.sessionPreferences,this.sessionPreferences,{updateEqualValues:true});this.setBackground();this.images.setDefaults();this.receiveTableState();this.images.setDefaultEvents();this.images.setDefaultMessages();this.gameState.itemsCreated=true;this.displayTableChatBox();console.log("this.create all items finished")};this.returnRoundedDownBetSize=function(betSize){if(betSize>self.gameState.maxBet){return self.gameState.maxBet}else if(betSize<self.gameState.minBet){return self.gameState.minBet}var isNumber=!isNaN(betSize)&&_.isNumber(betSize);var roundedBetSize;if(isNumber==false){return false}else{roundedBetSize=Math.floor(betSize/self.gameState.minIncrement)*self.gameState.minIncrement}return roundedBetSize};this.playerPutsChipsInPot=function(seatNumber,betSize,stackSize,options){if(!options){var options={}}var update=options.update;options.update=false;options.displayChipStackSize=true;var stagesToUpdate=[];self.gameState.seats[seatNumber].inHand=true;stagesToUpdate.push(this.displayChipStack(betSize,this.images.seats[seatNumber],options));if(!_.isNull(stackSize)&&!_.isUndefined(stackSize)&&stackSize<=0){stackSize="All In"}if(this.images.seats[seatNumber].status.text.text!==stackSize){this.images.seats[seatNumber].status.text.text=stackSize;stagesToUpdate.push(this.itemChanged(this.images.seats[seatNumber].bet))}options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideAllBets=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];for(var i=0;i<this.images.seats.length;i=i+1){stagesToUpdate.push(this.hideBet(i,options))}options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.createHoleCardCopyIfNeeded=function(playerNumber){console.log("createholecardcopyif needed called for player: "+playerNumber+" user is number "+self.gameState.userSeatNumber);console.log(self.gameState.holeCards);var popupAlpha=.6;if(_.isArray(self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation)){self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation.length=0}else{self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation=[]}var animationArray=self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation;var holeCardArray=this.images.seats[playerNumber].shownCards;var shouldCopyHoleCards=false;var holeCardSources=[];if(self.gameState.userSeatNumber===playerNumber&&_.isArray(self.gameState.holeCards)&&self.gameState.holeCards.length>0){console.log("creating user hole card copy");shouldCopyHoleCards=true;holeCardSources=self.gameState.holeCards}else if(shouldCopyHoleCards===false){console.log("checking to see if we should create hole card copy for non-user, or user that loaded late");for(var i=0;i<holeCardArray.length;i++){if(self.isItemAddedToStage(holeCardArray[i])!==true){console.log("card "+i+"is not added to stage");shouldCopyHoleCards=false}else{holeCardSources[i]=holeCardArray[i].image.imageSource}}}console.log("copy hole cards is "+shouldCopyHoleCards);if(shouldCopyHoleCards!==true){return false}for(var i=0;i<holeCardArray.length;i++){animationArray[i]=new this.images.Item(0,0,0,0,{stage:0,container:0});self.images.cardAsBitmap(animationArray[i],holeCardSources[i]);self.setItemLocationsInItemAEqualToOnesInItemB(animationArray[i],holeCardArray[i]);animationArray[i].image.y=this.images.seats[playerNumber].seat.position.y;animationArray[i].image.alpha=popupAlpha;var options={seatNum:playerNumber,seatObject:self.images.seats[playerNumber]};animationArray[i].image.onMouseOver=function(event){console.log("animatedCard moused OVER");self.images.seats[playerNumber].seat.image.onMouseOver(event,options)};animationArray[i].image.onMouseOut=function(event){console.log("animatedCard moused OUT");self.images.seats[playerNumber].seat.image.onMouseOut(event,options)};if(animationArray[i].text){animationArray[i].text.y=this.images.seats[playerNumber].seat.text.y-this.images.seats[playerNumber].seat.image.y+this.images.seats[playerNumber].seat.position.y;animationArray[i].text.alpha=popupAlpha}}self.hideChildren(animationArray)};this.displayTableChatBox=function(){self.jQueryObjects.chatBoxInput.css({display:"inline"})};this.activateTicker=function(FPS,onTick){if(!_.isNumber(FPS)){var FPS=15}createjs.Ticker.setFPS(FPS);createjs.Ticker.addEventListener("tick",handleTick);function handleTick(event){if(_.isFunction(onTick)){onTick()}if(!event.paused){self.updateStages()}}};this.disableTicker=function(){createjs.Ticker.setFPS(12);createjs.Ticker.removeEventListener("tick");function handleTick(event){if(onTick){onTick()}console.log(event);if(!event.paused){self.updateStages()}}};this.positionItemImage=function(item,options){if(!options){var options={}}var stagesToUpdate=[];if(_.isObject(item.image)){item.image.x=item.position.x;item.image.y=item.position.y}stagesToUpdate.push(this.itemChanged(item));if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.getStringWidth=function(string,font){var context=self.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.getContext("2d");context.font=font;var textData=context.measureText(string);return textData.width};this.disableTableChatBox=function(){self.jQueryObjects.chatBoxInput.attr("readonly",true)};this.enableTableChatBox=function(){self.jQueryObjects.chatBoxInput.attr("readonly",false)};this.hideTableChatBox=function(){self.jQueryObjects.chatBoxInput.attr("display",none)};this.getSeatImageIndex=function(seatNum,seatNumberVariableName){if(!_.isString(seatNumberVariableName)){var seatNumberVariableName="originalSeatNumber"}for(var i=0;i<self.images.seats.length;i++){if(self.images.seats[i][seatNumberVariableName]==seatNum){return i}}};this.copyItemLocationData=function(item){var itemCopyWithOnlyLocationData={};if(item.image){itemCopyWithOnlyLocationData.image={};itemCopyWithOnlyLocationData.image.x=item.image.x;itemCopyWithOnlyLocationData.image.y=item.image.y}if(item.text){itemCopyWithOnlyLocationData.text={};itemCopyWithOnlyLocationData.text.x=item.text.x;itemCopyWithOnlyLocationData.text.y=item.text.y}if(item.size){itemCopyWithOnlyLocationData.size={};itemCopyWithOnlyLocationData.size.x=item.size.x;itemCopyWithOnlyLocationData.size.y=item.size.y}if(item.position){itemCopyWithOnlyLocationData.position={};itemCopyWithOnlyLocationData.position.x=item.position.x;itemCopyWithOnlyLocationData.position.y=item.position.y;if(item.position.z){itemCopyWithOnlyLocationData.position.z={};itemCopyWithOnlyLocationData.position.z.stage=item.position.z.stage;itemCopyWithOnlyLocationData.position.z.container=item.position.z.container}}return itemCopyWithOnlyLocationData};this.setItemLocationsInItemAEqualToOnesInItemB=function(itemA,itemB){if(!_.isObject(itemA)||!_.isObject(itemB)){return}if(itemA.image&&itemB.image){itemA.image.x=itemB.image.x;itemA.image.y=itemB.image.y}if(itemA.text&&itemB.text){itemA.text.x=itemB.text.x;itemA.text.y=itemB.text.y}if(_.isObject(itemB.position)){if(!_.isObject(itemA.position)){itemA.position={}}itemA.position.x=itemB.position.x;itemA.position.y=itemB.position.y;if(_.isObject(itemB.position.z)){if(!_.isObject(itemA.position.z)){itemA.position.z={}}itemA.position.z.stage=itemB.position.z.stage;itemA.position.z.container=itemB.position.z.container}}if(_.isObject(itemB.size)){if(!_.isObject(itemA.size)){itemA.size={}}itemA.size.x=itemB.size.x;itemA.size.y=itemB.size.y}};this.copySeatObjectItemLocationData=function(seatObject){var seatObjectCopy={};this.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(seatObject,function(value,indexes){if(_.isArray(value)){seatObjectCopy[indexes[0]]=[];return}else{if(indexes.length===1){seatObjectCopy[indexes[0]]=self.copyItemLocationData(value)}else if(indexes.length===2){seatObjectCopy[indexes[0]][indexes[1]]=self.copyItemLocationData(value)}}});return seatObjectCopy};this.setSeatObjectLocationsInSeatObjectAEqualToOnesInSeatObjectB=function(seatObjectA,seatObjectB){this.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(seatObjectB,function(value,indexes){if(_.isArray(value)){if(!_.isArray(seatObjectA[indexes[0]])){console.log("seatObjectA with following indexes is not an array");console.log(indexes);console.log("seatObjectA.index0 value = ");console.log(seatObjectA[indexes[0]]);seatObjectA[indexes[0]]=[];console.log("created an array in seatObjectA named "+indexes[0])}}else if(indexes.length===1){self.setItemLocationsInItemAEqualToOnesInItemB(seatObjectA[indexes[0]],value)}else if(indexes.length===2){if(_.isUndefined(seatObjectA[indexes[0]][indexes[1]])){console.log(seatObjectA);console.log(indexes);console.log(value)}if(indexes[0]==="chipReference"){self.setItemLocationsInItemAEqualToOnesInItemB(seatObjectA["chips"][indexes[1]],value)}else if(indexes[0]==="chips"){return}self.setItemLocationsInItemAEqualToOnesInItemB(seatObjectA[indexes[0]][indexes[1]],value)}})};this.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray=function(seatObject,performIfObject){_.each(seatObject,function(value,index,list){if(_.isArray(value)){performIfObject(value,[index]);_.each(_.range(value.length),function(arrayIndex){if(_.isObject(value[arrayIndex])){performIfObject(value[arrayIndex],[index,arrayIndex])}})}else if(_.isObject(value)){performIfObject(value,[index])}})};this.changeUserSeatView=function(seatNumberToRotateTo){if(!_.isNumber(seatNumberToRotateTo)){var seatNumberToRotateTo=0}if(seatNumberToRotateTo>this.gameState.numSeats){throw"seatNumber too high, invalid"}var clockWiseRotationNumberBasedOnUnRotatedPosition;var temporaryArrayOfNonrotatedSeats=[];for(var i=0;i<this.gameState.numSeats;i++){temporaryArrayOfNonrotatedSeats.push({})}if(!_.isNumber(self.gameState.userSeatNumber)){clockWiseRotationNumberBasedOnUnRotatedPosition=this.gameState.numSeats-this.images.seats[0].rotatedSeatNumber}else if(seatNumberToRotateTo>=self.gameState.userSeatNumber){clockWiseRotationNumberBasedOnUnRotatedPosition=seatNumberToRotateTo-self.gameState.userSeatNumber}else{clockWiseRotationNumberBasedOnUnRotatedPosition=this.gameState.numSeats+seatNumberToRotateTo-self.gameState.userSeatNumber}if(clockWiseRotationNumberBasedOnUnRotatedPosition===this.images.seats[0].rotatedSeatNumber){console.log("no rotation");return"no rotation"}console.log("rotating to: "+clockWiseRotationNumberBasedOnUnRotatedPosition);var rotatedSeatNumberArray=[];var nonRotatedSeatNumberArray=[];for(var i=0;i<this.gameState.numSeats;i++){rotatedSeatNumberArray.push(self.images.seats[i].rotatedSeatNumber);nonRotatedSeatNumberArray.push(self.images.seats[i].nonRotatedSeatNumber)}console.log(rotatedSeatNumberArray);console.log(nonRotatedSeatNumberArray);for(var i=0;i<this.gameState.numSeats;i++){temporaryArrayOfNonrotatedSeats[self.images.seats[i].rotatedSeatNumber]=self.copySeatObjectItemLocationData(this.images.seats[i])}for(var i=0;i<this.gameState.numSeats;i++){this.images.seats[i].rotatedSeatNumber=(i+clockWiseRotationNumberBasedOnUnRotatedPosition)%this.gameState.numSeats;self.setSeatObjectLocationsInSeatObjectAEqualToOnesInSeatObjectB(this.images.seats[i],temporaryArrayOfNonrotatedSeats[(i+clockWiseRotationNumberBasedOnUnRotatedPosition)%this.gameState.numSeats])}this.updateStages([self.itemChanged(this.images.seats[0].seat)],{forceUpdate:true})};this.setNumberOfSeats=function(numSeats){var disableSeat=function(seatNum,seatNumberVariableName){if(!_.isString(seatNumberVariableName)){var seatArrayIndex=seatNum}else{var seatArrayIndex=self.getSeatImageIndex(seatNum,seatNumberVariableName)}self.images.seats[seatArrayIndex].rotatedSeatNumber=false;self.images.seats[seatArrayIndex].nonRotatedSeatNumber=false;self.images.seats.push(self.images.seats.splice(seatArrayIndex,1)[0])};var centerBottomAndTopSeats=function(){var totalLength=self.images.seats[0].seat.size.x*3+(self.images.seats[0].seat.position.x-self.images.seats[1].seat.position.x-self.images.seats[1].seat.size.x)*2;var absoluteDistanceX=(totalLength-self.images.seats[0].seat.size.x*2)/6;self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[1],addAbsoluteDistanceX);self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[4],addAbsoluteDistanceX);absoluteDistanceX=absoluteDistanceX*-1;self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[6],addAbsoluteDistanceX);self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[9],addAbsoluteDistanceX);function addAbsoluteDistanceX(value,indexes){if(value instanceof self.images.Item){value.position.x=value.position.x+absoluteDistanceX;if(value.image){value.image.x=value.image.x+absoluteDistanceX}if(value.text){value.text.x=value.text.x+absoluteDistanceX}}}};var centerSeat2And8=function(){var sideYDistance=(self.images.seats[2].seat.position.y-self.images.seats[3].seat.position.y)/2;self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[2],performIfObject);self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[8],performIfObject);function performIfObject(value,indexes){if(value instanceof self.images.Item){self.setImageItemPositionAndTextBasedOnImageChange(value,0,-sideYDistance,{movementType:"relative",permanent:true})}}};if(this.images.seats[0].rotatedSeatNumber!==this.images.seats[0].nonRotatedSeatNumber){self.changeUserSeatView()}if(this.imageData.numberOfPlayersSet!==true){this.imageData.originalSeatLocations=[];for(var seatNum=0;seatNum<this.images.seats.length;seatNum++){this.imageData.originalSeatLocations.push(this.copySeatObjectItemLocationData(this.images.seats[seatNum]))}}else{console.log("changing numseats for (atleast), the second time");for(var originalSeatNumber=0;originalSeatNumber<this.images.seats.length;originalSeatNumber++){this.images.seats.push(this.images.seats.splice(this.getSeatImageIndex(originalSeatNumber,"originalSeatNumber"),1))}for(var seatNum=0;seatNum<this.images.seats.length;seatNum++){this.setSeatObjectLocationsInSeatObjectAEqualToOnesInSeatObjectB(this.images.seats[seatNum],this.imageData.originalSeatLocations[seatNum])}}this.gameState.numSeats=numSeats;if(numSeats==9){disableSeat(5)}else if(numSeats==8){centerBottomAndTopSeats();disableSeat(5);disableSeat(0)}else if(numSeats==7){disableSeat(9);disableSeat(5);disableSeat(1)}else if(numSeats==6){centerSeat2And8();disableSeat(7);disableSeat(5);disableSeat(3);disableSeat(0)}else if(numSeats==5){centerSeat2And8();disableSeat(9);disableSeat(7);disableSeat(6);disableSeat(3);disableSeat(1)}else if(numSeats==4){centerSeat2And8();disableSeat(9);disableSeat(7);disableSeat(6);disableSeat(4);disableSeat(3);disableSeat(1)}else if(numSeats==3){disableSeat(9);disableSeat(8);disableSeat(6);disableSeat(5);disableSeat(4);disableSeat(2);disableSeat(1)}else if(numSeats==2){centerSeat2And8();disableSeat(9);disableSeat(7);disableSeat(6);disableSeat(5);disableSeat(4);disableSeat(3);disableSeat(1);disableSeat(0)}for(var i=0;i<this.gameState.numSeats;i++){this.images.seats[i].nonRotatedSeatNumber=i;this.images.seats[i].rotatedSeatNumber=i}this.imageData.numberOfPlayersSet=true};this.displayShownCard=function(cardText,parentOfImageObject,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.images.cardAsBitmap(parentOfImageObject,cardText));stagesToUpdate.push(this.displayChildren(parentOfImageObject,options));options.update=update;if(update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayHoleCards=function(hand,seatNumber,options){self.gameState.seats[seatNumber].inHand=true;if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].shownCards[0],options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].shownCards[1],options));stagesToUpdate.push(this.displayShownCard(hand[0],this.images.seats[seatNumber].shownCards[0],options));stagesToUpdate.push(this.displayShownCard(hand[1],this.images.seats[seatNumber].shownCards[1],options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].hiddenCards[0],options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].hiddenCards[1],options));options.update=update;if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideHoleCards=function(seatNumber,options){var itemsToHide=[];itemsToHide.push(this.images.seats[seatNumber].hiddenCards);itemsToHide.push(this.images.seats[seatNumber].shownCards);itemsToHide=_.flatten(itemsToHide);return this.hideChildren(itemsToHide,options)};this.itemChanged=function(item){if(this.isItemAddedToStage(item)){this.arrayOfParentsOfStageAndOfContainerArray[item.position.z.stage].upToDate=false;return item.position.z.stage}};this.updatePotSize=function(potSize,options){var stagesToUpdate=[];var newTotalPotSize=false;if(!options){var options={}}var update=options.update;options.update=false;var displayChipStackSize=options.displayChipStackSize;options.displayChipStackSize=true;if(!potSize||_.isArray(potSize)&&_.isEmpty(_.compact(potSize))){console.log("we are hiding all pots in teh updatePotSize function");for(var i=0;i<this.images.pots.length;i++){this.images.pots[i].potSize.text.text=0;stagesToUpdate.push(this.itemChanged(this.images.pots[i].potSize));stagesToUpdate.push(this.hideChildren(this.images.pots[i].potSize,options));stagesToUpdate.push(this.hideChildren(this.images.pots[i].chips,options));stagesToUpdate.push(this.hideChildren(this.images.totalPotSize,options))}}else if(_.isNumber(options.potNumber)){console.log("updating pot size based on one specific pot number");if(_.isArray(potSize)){var specificPotSize=potSize[options.potNumber]}else{var specificPotSize=potSize}if(parseFloat(specificPotSize)!=parseFloat(this.images.pots[potNumber].potSize.text.text)||self.isItemAddedToStage(this.images.pots[potNumber].potSize)!==true){stagesToUpdate.push(this.displayChipStack(parseFloat(specificPotSize),this.images.pots[options.potNumber],options))}else{console.log("pot "+options.potNumber+"not redrawn because same value")}}else if(_.isNumber(potSize)){newTotalPotSize=potSize}else if(_.isArray(potSize)&&potSize.length>0){var aggregatedPotSize=0;for(var i=0;i<potSize.length;i++){aggregatedPotSize=aggregatedPotSize+parseFloat(potSize[i]);if(parseFloat(potSize[i])!=parseFloat(this.images.pots[i].potSize.text.text)||self.isItemAddedToStage(this.images.pots[i].potSize)!==true){console.log("updating pot size "+i+"with value "+potSize[i]);stagesToUpdate.push(this.displayChipStack(parseFloat(potSize[i]),self.images.pots[i],options))}else{console.log("pot "+i+"not redrawn because same value")}stagesToUpdate.push(this.displayChildren(this.images.pots[i].potSize,options))}newTotalPotSize=aggregatedPotSize}if(_.isNumber(newTotalPotSize)){var newTotalPotSizeText="Total: "+newTotalPotSize;if(newTotalPotSizeText!=this.images.totalPotSize.text.text){this.images.totalPotSize.text.text=newTotalPotSizeText;stagesToUpdate.push(this.itemChanged(this.images.totalPotSize))}stagesToUpdate.push(this.displayChildren(this.images.totalPotSize,options))}options.update=update;options.displayChipStackSize=displayChipStackSize;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.playerSits=function(seatNumber,playerName,chips,options){this.gameState.seats[seatNumber].displayMessageType="seat";this.images.seats[seatNumber].playerName.text.text=playerName;if(_.isNumber(chips)&&chips>0){this.images.seats[seatNumber].status.text.text=chips}else if(chips==0){this.images.seats[seatNumber].status.text.text="adding chips"}var stagesToUpdate=this.displayCorrectSeatMessage(seatNumber,options);return stagesToUpdate};this.hideBet=function(seatNumber,options){var stagesToUpdate=[];stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].bet,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].chips,options));while(this.images.seats[seatNumber].chips.length>0){this.images.seats[seatNumber].chips.pop()}return stagesToUpdate};this.addChildToContainer=function(child,containerIndex,options){if(options){if(_.isNumber(options.stageNumber)){var stageNumber=options.stageNumber}}else{var stageNumber=child.parentOfImageObject.position.z.stage}this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[containerIndex].addChild(child)};this.displayChipStack=function(chipAmount,parentOfChipArray,originalOptions){var totalChipAmount=chipAmount;chipAmount=parseFloat(chipAmount);if(!_.isNumber(chipAmount)||_.isNaN(chipAmount)){console.log("displayChipStack called with invalid chipAmount");return}if(!_.isObject(originalOptions)){var options={}}else{var options=_.clone(originalOptions)}var update=options.update;options.update=false;var stagesToUpdate=[];var defaultOptions={};defaultOptions.chipArrayName="chips";console.log("displaychipStack called, parentOfChipArray is:");console.log(parentOfChipArray);if(parentOfChipArray.firstChip instanceof this.images.Item){defaultOptions.initialX=parentOfChipArray.firstChip.position.x;defaultOptions.initialY=parentOfChipArray.firstChip.position.y}if(parentOfChipArray.secondColumnChip instanceof this.images.Item&&parentOfChipArray.firstChip instanceof this.images.Item){defaultOptions.distanceBetweenColumns=parentOfChipArray.secondColumnChip.position.x-parentOfChipArray.firstChip.position.x
}else{defaultOptions.distanceBetweenColumns=this.images.pots[0].secondColumnChip.position.x-this.images.pots[0].firstChip.position.x}if(parentOfChipArray.potSize instanceof this.images.Item){defaultOptions.chipStackSizeItem=parentOfChipArray.potSize}else if(parentOfChipArray.bet instanceof this.images.Item){defaultOptions.chipStackSizeItem=parentOfChipArray.bet}_.defaults(options,defaultOptions);console.log("options =");console.log(options);var initialX=options.initialX;var initialY=options.initialY;var distanceBetweenColumns=options.distanceBetweenColumns;var chipArray=parentOfChipArray[options.chipArrayName];if(!_.isArray(parentOfChipArray[options.chipArrayName])){parentOfChipArray[options.chipArrayName]=[]}else{var oldArray=[];while(parentOfChipArray[options.chipArrayName].length>0){oldArray.push(parentOfChipArray[options.chipArrayName].pop())}}var x=initialX;var y=initialY;var chipIncrementY=this.images.pots[0].secondChip.position.y-this.images.pots[0].firstChip.position.y;var totalChips=0;var columnCounter=1;while(chipAmount>=1){if(chipAmount>=1e4){stagesToUpdate.push(this.displayChip("10k",x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1e4}else if(chipAmount>=5e3){stagesToUpdate.push(this.displayChip("5k",x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-5e3}else if(chipAmount>=1e3){stagesToUpdate.push(this.displayChip("1k",x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1e3}else if(chipAmount>=500){stagesToUpdate.push(this.displayChip(500,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-500}else if(chipAmount>=100){stagesToUpdate.push(this.displayChip(100,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-100}else if(chipAmount>=50){stagesToUpdate.push(this.displayChip(50,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-50}else if(chipAmount>=25){stagesToUpdate.push(this.displayChip(25,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-25}else if(chipAmount>=10){stagesToUpdate.push(this.displayChip(10,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1}else if(chipAmount>=5){stagesToUpdate.push(this.displayChip(5,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-5}else if(chipAmount>=1){stagesToUpdate.push(this.displayChip(1,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1}totalChips++;if(totalChips%this.imageData.maxChipsPerColumn==0){x=x+distanceBetweenColumns;y=initialY;columnCounter++;if(columnCounter>=this.imageData.maxChipColumns){chipAmount=0}}}if(options.displayChipStackSize!==false&&_.isArray(chipArray)&&chipArray.length>0&&options.chipStackSizeItem instanceof this.images.Item&&_.isObject(options.chipStackSizeItem.text)){var sizeItem=options.chipStackSizeItem;sizeItem.text.text=totalChipAmount;var measuredSizeWidth=sizeItem.text.getMeasuredWidth();var measuredSizeHeight=sizeItem.text.getMeasuredHeight();var chipDiameter=self.images.pots[0].firstChip.size.x;var chipStackMaxWidth=Math.abs(options.distanceBetweenColumns*(self.imageData.maxChipColumns-1))+chipDiameter;var chipStackMaxHeight=(self.imageData.maxChipsPerColumn-1)*(self.images.pots[0].secondChip.position.x-self.images.pots[0].firstChip.position.x)+chipDiameter;var maxLeftX;var maxRightX;var actualLeftX;var actualRightX;var maxTopY=options.initialY+chipDiameter-chipStackMaxHeight;var maxBottomY=options.initialY+chipDiameter;if(distanceBetweenColumns>0){var chipDirection="right"}else{var chipDirection="left"}var actualTopY=options.initialY;for(var i=0;i<chipArray.length;i++){if(chipArray[i].position.y<actualTopY){actualTopY=chipArray[i].position.y}}if(chipDirection==="right"){maxLeftX=options.initialX;maxRightX=maxLeftX+chipStackMaxWidth;actualLeftX=maxLeftX;actualRightX=chipArray[chipArray.length-1].position.x+chipArray[chipArray.length-1].size.x}else{maxRightX=options.initialX+chipDiameter;maxLeftX=maxRightX-chipStackMaxWidth;actualRightX=maxRightX;actualLeftX=chipArray[chipArray.length-1].position.x}if(sizeItem.position.x>=maxRightX){var sizeLatitudePositioning="right"}else if(sizeItem.position.x+sizeItem.size.x<=maxLeftX){console.log("maxLEfftX = "+maxLeftX);var sizeLatitudePositioning="left"}if(sizeItem.position.y>=maxBottomY){var sizeLongitudePositioning="bottom"}else if(sizeItem.position.y+measuredSizeHeight<=actualTopY){var sizeLongitudePositioning="top"}if(sizeLatitudePositioning==="right"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,actualRightX,sizeItem.position.y,options))}else if(sizeLatitudePositioning==="left"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,actualLeftX-measuredSizeWidth,sizeItem.position.y,options))}else{if(chipDirection==="right"){var sizePositionToItemPositionRatio=(sizeItem.position.x-actualLeftX)/chipStackMaxWidth;var sizeItemX=sizePositionToItemPositionRatio*(actualRightX-actualLeftX)+actualLeftX}else{console.log("adjusting betSize text based on chipDirection left");var sizePositionToItemPositionRatio=(actualRightX-sizeItem.position.x-sizeItem.size.x)/chipStackMaxWidth;var sizeItemX=actualRightX-sizePositionToItemPositionRatio*(actualRightX-actualLeftX)-measuredSizeWidth;console.log("ratio = "+sizePositionToItemPositionRatio)}if(sizeLongitudePositioning==="bottom"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,sizeItemX,maxBottomY,options))}else if(sizeLongitudePositioning==="top"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,sizeItemX,actualTopY-measuredSizeHeight,options))}else{stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,sizeItemX,sizeItem.position.y,options))}}stagesToUpdate.push(self.displayChildren(sizeItem,options));console.log("adjusted size item based on "+sizeLatitudePositioning+" "+sizeLongitudePositioning)}if(update!==false&&options.hidden!==true){if(_.isArray(parentOfChipArray[options.chipArrayName])&&parentOfChipArray[options.chipArrayName].length>0&&parentOfChipArray[options.chipArrayName][0]instanceof this.images.Item){this.hideChildren(oldArray,options);this.updateStages(stagesToUpdate)}options.update=update}else if(options.hidden===true){options.update=update;return oldArray}else if(update===false){stagesToUpdate.push(this.hideChildren(oldArray,options));options.update=update;return stagesToUpdate}};this.displayChip=function(chipValue,x,y,parentOfChipArray,options){var diameter=this.images.pots[0].firstChip.size.x;if(chipValue==1e3){chipColor="#CC6600";chipValue="1k"}else if(chipValue==500){chipColor="black"}else if(chipValue==100){chipColor="yellow"}else if(chipValue==50){chipColor="red"}else if(chipValue==25){chipColor="green"}else if(chipValue==10){chipColor="orange"}else if(chipValue==5){chipColor="#F52887"}else{chipColor="blue"}if(chipColor=="orange"){var chipImageSource=self.permanentPreferences.sourceObjects.value.chips["10"]}else if(chipColor=="red"){var chipImageSource=self.permanentPreferences.sourceObjects.value.chips.red}else if(chipColor=="black"){var chipImageSource=self.permanentPreferences.sourceObjects.value.chips.black}else{var chipImageSource=self.permanentPreferences.sourceObjects.value.chips.black}parentOfChipArray[options.chipArrayName].push(new this.images.Item(x,y,diameter,diameter,this.gameState.zPositionData.chips));this.images.itemAsBitmap(parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1],chipImageSource);parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].text=new createjs.Text(chipValue,"7px "+self.permanentPreferences.defaultFontType.value,"white");parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].text.x=parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].position.x+parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].size.x/2;parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].text.y=parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].position.y+4.5;parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].text.baseline="top";parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].text.textAlign="center";parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].text.maxWidth=parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].size.x*.8;for(var i=0;i<parentOfChipArray[options.chipArrayName].length-1;i++){if(i==0||(i+1)%this.imageData.maxChipsPerColumn!=0){this.hideText(parentOfChipArray[options.chipArrayName][i],{update:false});parentOfChipArray[options.chipArrayName][i].text=null}}if(options&&options.hidden===true){}else{return this.displayChildren(parentOfChipArray[options.chipArrayName],options)}};this.animateImage=function(animationInfo){if(!animationInfo||!animationInfo.item){return}var defaults={};defaults.movementType="absolute";defaults.maxDepth=1;_.defaults(animationInfo,defaults);var stagesToUpdate=[];var outOfDateItems=[];var endedItems=[];var numAnimations=0;var allTweens=[];animationInfo.animatedItems=[];if(animationInfo.maxDepth>0&&(_.isArray(animationInfo.item)||animationInfo.item instanceof this.images.Item===false&&_.isObject(animationInfo.item))){var items=animationInfo.item;var movementType=animationInfo.movementType;animationInfo.movementType="relative";animationInfo.maxDepth=animationInfo.maxDepth-1;var animationAsyncParallelArray=[];_.each(items,function(value,index,list){animationInfo.item=value;if(animationInfo.item instanceof self.images.Item&&(animationInfo.item.image||animationInfo.item.text)){var animationID=numAnimations;var info=_.clone(animationInfo);animationAsyncParallelArray.push(animateOneItem(info,animationID))}});animationInfo.maxDepth=animationInfo.maxDepth+1;animationInfo.movementType=movementType}else{animateOneItem(animationInfo,0)}for(var i=0;i<allTweens.length;i++){allTweens[i].setPaused(false)}function animateOneItem(animationInfo,animationID){numAnimations++;animationInfo.animatedItems[animationID]=animationInfo.item;var defaults={};if(animationInfo.item.image){defaults=_.defaults(defaults,getDefaultPositionsBasedOnDisplayObject(animationInfo.item.image,animationInfo))}else if(animationInfo.item.text){defaults=_.defaults(defaults,getDefaultPositionsBasedOnDisplayObject(animationInfo.item.text,animationInfo))}defaults.numTicks=10;defaults.time=300;defaults.update=false;defaults.onEnd=function(animationInfo,animationInstance){};defaults.onStart=function(animationInfo){self.displayChildren(animationInfo.item)};defaults.onTick=function(animationInfo,animationInstance){};animationInfo=_.defaults(animationInfo,defaults);var fractionDistancePerTick=1/animationInfo.numTicks;var lastTick=animationInfo.numTicks-1;var interval=animationInfo.time/animationInfo.numTicks;if(animationInfo.movementType==="relative"){var totalDistanceX=animationInfo.finalX;var totalDistanceY=animationInfo.finalY}else{var totalDistanceX=animationInfo.finalX-animationInfo.initialX;var totalDistanceY=animationInfo.finalY-animationInfo.initialY}var distancePerTickX=totalDistanceX*fractionDistancePerTick;var distancePerTickY=totalDistanceY*fractionDistancePerTick;if(_.isNumber(self.setImageItemPositionAndTextBasedOnImageChange(animationInfo.item,animationInfo.initialX,animationInfo.initialY,animationInfo))){outOfDateItems[animationID]=animationInfo.item}endedItems[animationID]=false;if(_.isFunction(animationInfo.onStart)){animationInfo.onStart(animationInfo)}var imageUpToDate=true;var textUpToDate=true;var imageEnded=false;var textEnded=false;if(animationInfo.item.image){var imageTween=createjs.Tween.get(animationInfo.item.image,{override:true,paused:true});imageTween.to({x:animationInfo.item.image.x+totalDistanceX,y:animationInfo.item.image.y+totalDistanceY},animationInfo.time).addEventListener("change",imageChanged);imageTween.call(endImage,[animationInfo,imageTween,textTween],this)}if(animationInfo.item.text){var textTween=createjs.Tween.get(animationInfo.item.text,{override:true,paused:true});textTween.to({x:animationInfo.item.text.x+totalDistanceX,y:animationInfo.item.text.y+totalDistanceY},animationInfo.time).addEventListener("change",textChanged);textTween.call(endText,[animationInfo,imageTween,textTween],this)}if(imageTween){allTweens.push(imageTween)}if(textTween){allTweens.push(textTween)}function imageChanged(tweenInstance){imageUpToDate=false;onChange()}function textChanged(tweenInstance){textUpToDate=false;onChange()}function onChange(event){if(animationInfo.item.image&&imageUpToDate===true||animationInfo.item.text&&textUpToDate===true){return}if(checkIfAllTasksCompletedResetsArrayIfItIs(outOfDateItems)){for(var i=0;i<animationInfo.animatedItems.length;i++){self.itemChanged(animationInfo.animatedItems[i])}if(_.isFunction(animationInfo.onTick)){animationInfo.onTick(animationInfo,imageTween,textTween)}textUpToDate=true;imageUpToDate=true}}function endImage(animationInfo,imageTween,textTween){imageEnded=true;onEnd(animationInfo,imageTween,textTween)}function endText(animationInfo,imageTween,textTween){textEnded=true;onEnd(animationInfo,imageTween,textTween)}function onEnd(animationInfo,imageTween,textTween){if(animationInfo.item.image&&imageEnded===false||animationInfo.item.text&&textEnded===false){return}if(checkIfAllTasksCompletedResetsArrayIfItIs(endedItems)){for(var i=0;i<animationInfo.animatedItems.length;i++){self.itemChanged(animationInfo.animatedItems[i])}animationInfo.onEnd(animationInfo,imageTween,textTween)}}function checkIfAllTasksCompletedResetsArrayIfItIs(array){array[animationID]=animationInfo.item;for(var i=0;i<array.length;i++){if(array[i]===false&&endedItems[i]===false){return false}}for(var i=0;i<array.length;i++){array[i]===false}return true}}function getDefaultPositionsBasedOnDisplayObject(imageOrText,animationInfo){if(!_.isObject(imageOrText)){return{}}var defaultPositions={};var currentPosition=getDisplayObjectPosition(imageOrText);if(animationInfo.movementType==="relative"){defaultPositions.initialX=0;defaultPositions.initialY=0}else{defaultPositions.initialX=currentPosition.x;defaultPositions.initialY=currentPosition.y}var finalXAbsolute=animationInfo.item.position.x;var finalYAbsolute=animationInfo.item.position.y;defaultPositions.finalX=finalXAbsolute;defaultPositions.finalY=finalYAbsolute;if(animationInfo.movementType==="relative"){if(_.isNumber(animationInfo.initialX)&&!_.isNan(animationInfo.initialX)){defaultPositions.finalX=finalXAbsolute-animationInfo.initialX}if(_.isNumber(animationInfo.initialY)&&!_.isNan(animationInfo.initialY)){defaultPositions.finalY=finalYAbsolute-animationInfo.initialY}}return defaultPositions}};this.getTextWidthAndFontSize=function(parentOfTextObject,fontSize){if(parentOfTextObject instanceof this.images.Item){if(!fontSize){var pIndex=parentOfTextObject.text.font.indexOf("p");var PIndex=parentOfTextObject.text.font.indexOf("P");if(pIndex>=PIndex){var pLocation=PIndex}else if(pIndex<PIndex){var pLocation=pIndex}var fontSize=parentOfTextObject.text.font.substring(0,pLocation)}}var context=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.getContext("2d");context.font=parentOfTextObject.text.font;var textData=context.measureText(parentOfTextObject.text.text);return[textData.width,fontSize]};this.setImageItemPositionAndTextBasedOnImageChange=function(item,imageX,imageY,options){if(!options){var options={}}var update=options.update;options.update=false;var defaultOptions={};defaultOptions.movementType="absolute";defaultOptions.maxDepth=1;_.defaults(options,defaultOptions);var stagesToUpdate=[];if(options.maxDepth>0&&(_.isArray(item)||item instanceof this.images.Item===false&&_.isObject(item))){var movementType=options.movementType;options.movementType="relative";options.maxDepth=options.maxDepth-1;_.each(item,function(value,index,list){moveItem(value,imageX,imageY)});options.maxDepth=options.maxDepth+1;options.movementType=movementType}else{moveItem(item,imageX,imageY)}function moveItem(item,imageX,imageY){if(item instanceof self.images.Item){if(item.image){var previousImageLocation=getDisplayObjectPosition(item.image);if(_.isUndefined(previousImageLocation)){console.log(item)}}if(item.text){var previousTextLocation=getDisplayObjectPosition(item.text)}if(!_.isNumber(imageX)){imageX=item.position.x}else if(options.movementType==="relative"){if(item.image){imageX=previousImageLocation.x+imageX}else if(item.text){imageX=previousTextLocation.x+imageX}}if(!_.isNumber(imageY)){imageY=item.position.y}else if(options.movementType==="relative"){if(item.image){imageY=previousImageLocation.y+imageY}else if(item.text){imageY=previousTextLocation.y+imageY}}var textX=imageX;var textY=imageY;if(options.permanent===true){item.position.x=imageX;item.position.y=imageY}if(item.image){setDisplayObjectPosition(item.image,imageX,imageY);var imageDeltaX=imageX-previousImageLocation.x;var imageDeltaY=imageY-previousImageLocation.y;if(imageDeltaX!==0||imageDeltaY!==0){stagesToUpdate.push(self.itemChanged(item))}}if(item.text){if(_.isNumber(imageDeltaX)||_.isNumber(imageDeltaY)){textX=previousTextLocation.x+imageDeltaX;textY=previousTextLocation.y+imageDeltaY}setDisplayObjectPosition(item.text,textX,textY);var textDeltaX=textX-previousTextLocation.x;var textDeltaY=textY-previousTextLocation.y;if(textDeltaX!==0||textDeltaY!==0){stagesToUpdate.push(self.itemChanged(item))}}}}options.update=update;if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};var setDisplayObjectPosition=function(imageOrText,x,y){if(!_.isElement(imageOrText)){imageOrText.x=x;imageOrText.y=y}else{$(imageOrText).css("left",x);$(imageOrText).css("top",y)}};var getDisplayObjectPosition=function(imageOrText){if(!_.isElement(imageOrText)){var location={x:imageOrText.x,y:imageOrText.y}}else{var location={x:parseFloat($(imageOrText).css("left")),y:parseFloat($(imageOrText).css("top"))}}if(_.isNaN(location.x)||_.isNaN(location.y)){console.log(imageOrText);throw"nan of get displayobecjt position "}return location};this.dealCommunity=function(communityArray){var dealCardAnimationTime=300;var spreadFlopAnimationTime=200;fractionDistancePerTick=.02;var lastTick=1/fractionDistancePerTick-1;var interval=fractionDistancePerTick*dealCardAnimationTime;var initialX=this.images.startingCard.position.x;var initialY=this.images.startingCard.position.y;var stagesToUpdate=[];var animatedCard=new this.images.Item(initialX,initialY,this.images.community[0].size.x,this.images.community[0].size.y,this.gameState.zPositionData.cardAnimation);stagesToUpdate.push(this.images.cardAsBitmap(animatedCard,null));var communitySound=createjs.Sound.createInstance(this.images.sources.dealCommunity);communitySound.play();var initialAnimationInfo={};initialAnimationInfo.numTicks=lastTick+1;initialAnimationInfo.item=animatedCard;initialAnimationInfo.onTick=null;initialAnimationInfo.time=dealCardAnimationTime;initialAnimationInfo.onStart=function(info){stagesToUpdate.push(self.displayChildren(info.item));self.updateStages(stagesToUpdate);stagesToUpdate.length=0};if(communityArray.length==5){initialAnimationInfo.finalX=self.images.community[4].position.x;initialAnimationInfo.finalY=self.images.community[4].position.y;initialAnimationInfo.onEnd=function(){stagesToUpdate.push(self.displayShownCard(communityArray[4],self.images.community[4]));stagesToUpdate.push(self.hideChildren(animatedCard,{update:false}));self.updateStages(stagesToUpdate);stagesToUpdate.length=0};self.animateImage(initialAnimationInfo)}else if(communityArray.length==4){initialAnimationInfo.finalX=self.images.community[3].position.x;initialAnimationInfo.finalY=self.images.community[3].position.y;initialAnimationInfo.onEnd=function(){stagesToUpdate.push(self.displayShownCard(communityArray[3],self.images.community[3]));stagesToUpdate.push(self.hideChildren(animatedCard,{update:false}));self.updateStages(stagesToUpdate);stagesToUpdate.length=0};self.animateImage(initialAnimationInfo)}else if(communityArray.length==3){initialAnimationInfo.finalX=self.images.community[0].position.x;initialAnimationInfo.finalY=self.images.community[0].position.y;async.series([function(callback){initialAnimationInfo.onEnd=function(){callback(null,1)};self.animateImage(initialAnimationInfo)},function(callback){for(var i=0;i<=2;i++){self.images.cardAsBitmap(self.images.community[i],communityArray[i]);self.images.community[i].image.x=self.images.community[0].position.x;stagesToUpdate.push(self.displayChildren(self.images.community[i],{update:false}))}stagesToUpdate.push(self.hideChildren(animatedCard,{update:false}));self.updateStages(stagesToUpdate);var community1Animation={initialX:self.images.community[0].position.x,initialY:self.images.community[0].position.y,numTicks:lastTick+1,finalX:self.images.community[1].position.x,finalY:self.images.community[1].position.y,item:self.images.community[1],time:spreadFlopAnimationTime,onEnd:function(){}};var community2Animation=_.clone(community1Animation);community2Animation.finalX=self.images.community[2].position.x;community2Animation.finalY=self.images.community[2].position.y;community2Animation.item=self.images.community[2];self.animateImage(community1Animation);self.animateImage(community2Animation)}])}};this.queueExpirationFunction=function(expirationTrigger,actionFunction,options){if(!options){var options={}}if(_.isNumber(options.expirationPlayerNumber)){var expirationObject=this.gameState.seats[options.expirationPlayerNumber][expirationTrigger]}else{var expirationObject=this.gameState[expirationTrigger]}if(_.isArray(expirationObject.onEnd)){expirationObject.onEnd.push(actionFunction)}else if(_.isFunction(expirationObject.onEnd)){expirationObject.onEnd=[expirationObject.onEnd,actionFunction]}else{expirationObject.onEnd=[actionFunction]}};this.setPreactionData=function(expirationType,actionType,value,options){if(!options){var options={}}if(!_.isNumber(options.playerNumber)){if(!_.isNumber(this.gameState.userSeatNumber)){console.log("shouldnt be able to set preaction data but did");return}var playerNumber=this.gameState.userSeatNumber}else{var playerNumber=options.playerNumber}var gameStateSeatObject=this.gameState.seats[playerNumber];var preactionOptions=self.getPreactionOptionValues();var expirationTypesToSet=[];var otherActionTypesToSet=[];var otherActionValue=false;var serverActionsSet=[];if(value===false||value===null||_.isUndefined(value)){value=false;expirationTypesToSet.push("act","street","once","hand")}else if(expirationType==="act"){expirationTypesToSet.push("act")}else if(expirationType==="street"){expirationTypesToSet.push("act","street")}else if(expirationType==="once"){expirationTypesToSet.push("act","street","once")}else if(expirationType==="hand"){expirationTypesToSet.push("act","street","once","hand")}else{expirationTypesToSet.push(expirationType)}if(options.clientLogic===true){if(value===true||_.isNumber(value)){if(actionType==="call"){otherActionTypesToSet.push("fold","raise","bet","call_any")}else if(actionType==="call_any"){otherActionTypesToSet.push("fold","raise","bet","call")}else if(actionType==="fold"){otherActionTypesToSet.push("call","raise","bet","call_any")}else if(actionType==="raise"||actionType==="bet"){otherActionTypesToSet.push("call","fold","check","call_any")}}setValue(expirationTypesToSet,otherActionTypesToSet,otherActionValue)}setValue(expirationTypesToSet,actionType,value);console.log("setPreactionData for "+actionType+" and "+expirationType+" and value of:"+value+"completed");console.log(gameStateSeatObject[expirationType][actionType]);function setValue(expirationTypes,actionTypes,value){if(_.isString(expirationTypes)){if(_.isString(actionTypes)){if(_.indexOf(serverActionsSet,actionTypes)===-1&&options.server!==false){socket.emit("set_flag",actionTypes,value);serverActionsSet.push(actionTypes)}if(options.local!==false){gameStateSeatObject[expirationTypes][actionTypes]=value}}else if(_.isArray(actionTypes)){for(var i=0;i<actionTypes.length;i++){setValue(expirationTypes,actionTypes[i],value)}}}else if(_.isArray(expirationTypes)){for(var i=0;i<expirationTypes.length;i++){setValue(expirationTypes[i],actionTypes,value)}}}};this.getPreactionData=function(actionType,checkFunction){var seat=self.gameState.userSeatNumber;if(!_.isFunction(checkFunction)){var checkFunction=function(value){var preactionOptionData=self.getPreactionOptionValues();if(self.isItemAddedToStage(self.images.community[3])){var minimumNumberValue=self.gameState.bigBlind}else{var minimumNumberValue=self.gameState.bigBlind/2}if(!preactionOptionData||_.isEmpty(preactionOptionData)){}else{if(actionType==="call"){if(preactionOptionData.check===false){minimumNumberValue=preactionOptionData.call}}else if(actionType==="check"||actionType==="call_any"||actionType==="fold"){minimumNumberValue=NaN}}if(value===true||_.isNumber(value)&&value>=minimumNumberValue){return true}}}var streetValue=self.gameState.seats[seat].street[actionType];var onceValue=self.gameState.seats[seat].once[actionType];var handValue=self.gameState.seats[seat].hand[actionType];if(!_.isUndefined(streetValue)&&!_.isNaN(streetValue)&&checkFunction(streetValue)){var data={action:actionType,value:streetValue,expiration:"street"}}else if(!_.isUndefined(onceValue)&&!_.isNaN(onceValue)&&checkFunction(onceValue)){var data={action:actionType,value:onceValue,expiration:"once"}}else if(!_.isUndefined(handValue)&&!_.isNaN(handValue)&&checkFunction(handValue)){var data={action:actionType,value:handValue,expiration:"hand"}}else{return false}return data};this.getHighBet=function(){return Math.max.apply(Math,this.getCurrentBetSizes());if(_.isNumber(this.gameState.hand.highBet)){return this.gameState.highBet}else{return Math.max.apply(Math,this.getCurrentBetSizes())}};this.images.createPairOfCheckBoxOptionDisplayObject=function(text,onClickUnchecked,onClickChecked){var height=self.images.foldToAnyBet.size.y;var preactionItem=new self.images.Item(0,0,0,height,self.gameState.zPositionData.button);var preactionItemOn=new self.images.Item(0,0,0,height,self.gameState.zPositionData.button);self.images.itemAsBitmap(preactionItem,self.permanentPreferences.sourceObjects.value.checkBox);self.images.itemAsBitmap(preactionItemOn,self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(preactionItem,text);self.images.addCheckBoxButtonText(preactionItemOn,text);if(_.isFunction(onClickUnchecked)){preactionItem.image.onClick=function(event){onClickUnchecked(event,preactionItem,preactionItemOn);self.hideChildren(preactionItem,{update:false});self.displayChildren(preactionItemOn)}}if(_.isFunction(onClickChecked)){preactionItemOn.image.onClick=function(event){onClickChecked(event,preactionItemOn,preactionItem);self.hideChildren(preactionItemOn,{update:false});self.displayChildren(preactionItem)}}return{unchecked:preactionItem,checked:preactionItemOn}};this.createPreactionOptionItems=function(){self.images.preactions={};var callPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Call");var checkPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Check");var allInPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("All-In");var foldPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Fold");var callAnyPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Call Any Bet");self.images.preactions.callUnchecked=callPreactionItems.unchecked;self.images.preactions.callChecked=callPreactionItems.checked;self.images.preactions.checkUnchecked=checkPreactionItems.unchecked;self.images.preactions.checkChecked=checkPreactionItems.checked;self.images.preactions.allInUnchecked=allInPreactionItems.unchecked;self.images.preactions.allInChecked=allInPreactionItems.checked;self.images.preactions.foldUnchecked=foldPreactionItems.unchecked;self.images.preactions.foldChecked=foldPreactionItems.checked;self.images.preactions.callAnyUnchecked=callAnyPreactionItems.unchecked;self.images.preactions.callAnyChecked=callAnyPreactionItems.checked;self.images.preactions.callUnchecked.image.onClick=function(){self.setPreactionData("street","call",self.getPreactionOptionValues().call);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.callChecked.image.onClick=function(){self.setPreactionData("hand","call",false);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.checkUnchecked.image.onClick=function(){self.setPreactionData("hand","check",self.getPreactionOptionValues().check);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.checkChecked.image.onClick=function(){self.setPreactionData("hand","check",false,seat);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.allInUnchecked.image.onClick=function(){var allIn=self.getPreactionOptionValues().allIn;self.setPreactionData("hand","raise",allIn);self.setPreactionData("hand","bet",allIn);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.allInChecked.image.onClick=function(){self.setPreactionData("hand","raise",false);self.setPreactionData("hand","bet",false);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.foldUnchecked.image.onClick=function(){self.setPreactionData("hand","fold",self.getPreactionOptionValues().fold);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.foldChecked.image.onClick=function(){self.setPreactionData("hand","fold",false);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.callAnyUnchecked.image.onClick=function(){self.setPreactionData("hand","call",self.getPreactionOptionValues().callAny);self.updateUserOptionsBasedOnFlagsAndPreactions()};self.images.preactions.callAnyChecked.image.onClick=function(){self.setPreactionData("hand","call",false);self.updateUserOptionsBasedOnFlagsAndPreactions()}};this.getPreactionOptionValues=function(){var getGameStateSeatObject=function(){return self.gameState.seats[self.gameState.userSeatNumber]};var isHighBetNonUser=function(){return self.getCurrentBetSizes().splice(self.gamestate.userSeatNumber,1).indexOf(self.getHighBet())!==-1};var getUserStackSize=function(){return self.getCurrentStackSizes()[self.gameState.userSeatNumber]};var getUserBet=function(){return self.getCurrentBetSizes()[self.gameState.userSeatNumber]};var highBet=self.getHighBet();var userBet=getUserBet();var userStackSize=getUserStackSize();var gameStateSeatObject=getGameStateSeatObject();var allIn=false;var call=false;var call_any=false;var fold=false;var check=false;var raise=false;var bet=false;if(userStackSize===0||gameStateSeatObject.toAct!==false&&gameStateSeatObject.inHand!==true){return false}else{allIn=userStackSize+userBet;fold=true;call_any=true;if(highBet>userBet){if(highBet-userBet>=userStackSize){call=userStackSize;allIn=false}else{call=highBet-userBet}}else if(highBet===userBet){check=true}}return{check:check,allIn:allIn,fold:fold,call:call,raise:raise,bet:bet}};this.updatePreactionOptionDisplayBasedOnLocalData=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];seat=this.gameState.userSeatNumber;var currentStackSizes=this.getCurrentStackSizes();if(!_.isNumber(seat)||this.gameState.seats[seat].toAct===true||this.gameState.seats[seat].inHand!==true||currentStackSizes[seat]<=0||_.without(currentStackSizes,0).length<=1){stagesToUpdate.push(this.hideChildren(this.images.preactions),options)}else{var preactionBackgroundX=this.images.fold.position.x;var preactionBackgroundY=this.images.fold.position.y;var preactionBackgroundWidth=this.images.betSlider.betSize.position.x+this.images.betSlider.betSize.size.x-this.images.fold.position.x;var preactionBackgroundHeight=this.images.fold.size.y;
var numPreactionsDisplayed=0;var preactionButtonHeight=this.images.foldToAnyBet.size.y;var preactionButtonOffsetLeft=this.images.foldToAnyBet.position.x;var preactionButtonOffsetTop=2;var preactionButtonOffsetBottom=2;var distanceBetweenPreactionButtonsX=35;var distanceBetweenPreactionButtonsY=3;var numPreactionsPerColumn=2;var preactionsZPosition=this.images.foldToAnyBet.position.z;var itemsToDisplay=[];var preactionUncheckedItemArray=[];var getLastUncheckedItem=function(){return preactionUncheckedItemArray[preactionUncheckedItemArray.length-1]};var displayLastUncheckedItem=function(){itemsToDisplay.push(getLastUncheckedItem())};var preactionCheckedItemArray=[];var getLastCheckedItem=function(){return preactionCheckedItemArray[preactionCheckedItemArray.length-1]};var displayLastCheckedItem=function(){itemsToDisplay.push(getLastCheckedItem())};var preactionOptions=this.getPreactionOptionValues();console.log("displaying preactionOptionValues");console.log(preactionOptions);if(preactionOptions.check===true){stagesToUpdate.push(addPreactionText(this.images.preactions.checkUnchecked,this.images.preactions.checkChecked,"check"));if(this.getPreactionData("check")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}if(preactionOptions.fold===true){stagesToUpdate.push(addPreactionText(this.images.preactions.foldUnchecked,this.images.preactions.foldChecked,"fold"));if(this.getPreactionData("fold")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}if(_.isNumber(preactionOptions.call)){if(preactionOptions.call>=currentStackSizes[seat]){var callAmount="All-In"}else{var callAmount=preactionOptions.call}stagesToUpdate.push(addPreactionText(this.images.preactions.callUnchecked,this.images.preactions.callChecked,"call "+callAmount));var checkIfCallIsValid=function(value){if(_.isNumber(value)&&value===preactionOptions.call){return true}};if(this.getPreactionData("call",checkIfCallIsValid)){displayLastCheckedItem()}else{displayLastUncheckedItem()}}if(_.isNumber(preactionOptions.allIn)){stagesToUpdate.push(addPreactionText(this.images.preactions.allInUnchecked,this.images.preactions.allInChecked,"All-In"));var raiseValid=false;var betValid=false;var checkIfRaiseOrBetIsValid=function(value){if(_.isNumber(value)&&value>=preactionOptions.allIn){return true}};if(this.getPreactionData("raise",checkIfRaiseOrBetIsValid)){raiseValid=true}if(this.getPreactionData("bet",checkIfRaiseOrBetIsValid)){betValid=true}if(this.getHighBet()<=0){raiseValid=true}else{betValid=true}console.log("raise valid = "+raiseValid+" , betVAlid = "+betValid);if(raiseValid===true&&betValid===true){displayLastCheckedItem()}else{displayLastUncheckedItem()}}if(preactionOptions.call_any===true){stagesToUpdate.push(addPreactionText(this.images.preactions.callAnyUnchecked,this.images.preactions.callAnyChecked,"Call Any"));var checkIfCallAnyIsValid=function(value){if(value===true){return true}};if(this.getPreactionData("call_any",checkIfCallAnyIsValid)){displayLastCheckedItem()}else{displayLastUncheckedItem()}}stagesToUpdate.push(setLocationDataOfPreactionItems());stagesToUpdate.push(this.hideChildren(this.images.preactions,options));console.log("displaying the following items:");console.log(itemsToDisplay);stagesToUpdate.push(this.displayChildren(itemsToDisplay,options))}options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}function addPreactionText(uncheckedItem,checkedItem,text){var stagesToUpdate=[];stagesToUpdate.push(self.images.addCheckBoxButtonText(uncheckedItem,text));stagesToUpdate.push(self.images.addCheckBoxButtonText(checkedItem,text));preactionUncheckedItemArray.push(uncheckedItem);preactionCheckedItemArray.push(checkedItem);return stagesToUpdate}function setLocationDataOfPreactionItems(){setAllItemWidths();var stagesToUpdate=[];var columnNumber=0;var rowNumber=0;for(var i=0;i<preactionUncheckedItemArray.length;i++){if(i!==0&&i%numPreactionsPerColumn===0){rowNumber=0;columnNumber++}var newX=getX(columnNumber);var newY=getY(rowNumber);stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(preactionUncheckedItemArray[i],newX,newY,{permanent:true}));stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(preactionCheckedItemArray[i],newX,newY,{permanent:true}));rowNumber++}return stagesToUpdate;function setAllItemWidths(){var longestWidth=0;for(var i=0;i<preactionUncheckedItemArray.length;i++){if(i%numPreactionsPerColumn===0){longestWidth=0}if(longestWidth<preactionUncheckedItemArray[i].size.x){longestWidth=preactionUncheckedItemArray[i].size.x}else{preactionUncheckedItemArray[i].size.x=longestWidth;preactionCheckedItemArray[i].size.x=longestWidth}}}function getX(column){var totalItemWidth=0;for(var i=0;i<column;i++){var totalItemWidth=totalItemWidth+preactionUncheckedItemArray[i*numPreactionsPerColumn].size.x}var x=column*distanceBetweenPreactionButtonsX+preactionButtonOffsetLeft+preactionBackgroundX+totalItemWidth;return x}function getY(row){var y=row*preactionUncheckedItemArray[0].size.y+row*distanceBetweenPreactionButtonsY+preactionButtonOffsetTop+preactionBackgroundY;return y}}};this.clearExpirationData=function(expirationType,playerNumber,options){var tableExpirationObject=self.gameState;clearExpirationObject(tableExpirationObject);if(!_.isNumber(playerNumber)){if(_.isNumber(this.gameState.userSeatNumber)){var playerNumber=this.gameState.userSeatNumber}else{throw"no player number"}}if(_.isNumber(playerNumber)){var playerSeatObject=self.gameState.seats[playerNumber];clearExpirationObject(playerSeatObject)}function clearExpirationObject(gameStateObject){if(!_.isObject(gameStateObject[expirationType])){return}var onEnd=gameStateObject[expirationType].onEnd;gameStateObject[expirationType]={};if(_.isArray(onEnd)){for(var index=0;index<onEnd.length;index++){onEnd[index]()}}else if(_.isFunction(onEnd)){onEnd()}}};this.dealHoleCards=function(smallBlindSeatNumber,playerArray,holeCardArray){var initialX=this.images.startingCard.position.x;var initialY=this.images.startingCard.position.y;var animationTime=340;var fractionDistancePerTick=.05;var lastTick=1/fractionDistancePerTick-1;var interval=fractionDistancePerTick*animationTime;var animatedCards0=[];var animatedCards1=[];var asyncArray=[];var callBackNumber=1;_.each(_.range(playerArray.length*2),function(cardsDealt){var playerArrayNumber=cardsDealt%playerArray.length;var dealHoleCardSound=createjs.Sound.createInstance(self.images.sources.dealHoleCardSound);if(cardsDealt==playerArrayNumber){animatedCards0[cardsDealt]=new self.images.Item(initialX,initialY,self.images.community[0].size.x,self.images.community[0].size.y,self.gameState.zPositionData.cardAnimation);self.images.cardAsBitmap(animatedCards0[cardsDealt],null);asyncArray.push(function(callback){var dealCard0AnimationInfo={time:animationTime,ticks:lastTick+1,item:animatedCards0[cardsDealt],finalX:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[0].position.x,finalY:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[0].position.y,onEnd:function(){callback(null,callBackNumber)},onTick:null};dealHoleCardSound.play();self.animateImage(dealCard0AnimationInfo)})}else if(cardsDealt>playerArrayNumber){animatedCards1[cardsDealt]=new self.images.Item(initialX,initialY,self.images.community[0].size.x,self.images.community[0].size.y,self.gameState.zPositionData.cardAnimation);self.images.cardAsBitmap(animatedCards1[cardsDealt],null);asyncArray.push(function(callback){var dealCard1AnimationInfo={time:animationTime,ticks:lastTick+1,item:animatedCards1[cardsDealt],finalX:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[1].position.x,finalY:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[1].position.y,onEnd:function(){callback(null,callBackNumber)},onTick:null};dealHoleCardSound.play();self.animateImage(dealCard1AnimationInfo)})}callBackNumber++;asyncArray.push(function(callback){if(_.isNumber(self.gameState.userSeatNumber)&&playerArray[playerArrayNumber]==self.gameState.userSeatNumber&&holeCardArray){if(cardsDealt==playerArrayNumber){self.hideChildren(animatedCards0[cardsDealt]);self.displayShownCard(holeCardArray[0],self.images.seats[playerArray[playerArrayNumber]].shownCards[0])}else if(cardsDealt>playerArrayNumber){self.hideChildren(animatedCards1[cardsDealt]);self.displayShownCard(holeCardArray[1],self.images.seats[playerArray[playerArrayNumber]].shownCards[1])}}else{if(cardsDealt==playerArrayNumber){self.hideChildren(animatedCards0[cardsDealt]);self.displayChildren(self.images.seats[playerArray[playerArrayNumber]].hiddenCards[0])}else if(cardsDealt>playerArrayNumber){self.hideChildren(animatedCards1[cardsDealt]);self.displayChildren(self.images.seats[playerArray[playerArrayNumber]].hiddenCards[1])}}callback(null,callBackNumber)})});async.series(asyncArray)};this.playerStands=function(seatNumber){this.gameState.seats[seatNumber].displayMessageType="openSeat";if(seatNumber===this.gameState.userSeatNumber){this.hideSeatedOptions();this.gameState.userSeatNumber=null}for(var i=0;i<this.gameState.numSeats;i++){this.displayCorrectSeatMessage(i)}};this.adjustHoleCardImageSourceRectangle=function(holeCards,options){if(!options){var options={}}var stagesToUpdate=[];var cardArray;var userIndiviualSeatNumbers=false;if(_.isArray(holeCards)){cardArray=holeCards}else if(_.isNumber(holeCards)){cardArray=_.flatten(this.images.seats[holeCards].hiddenCards,this.images.seats[holeCards].shownCards)}else if(holeCards instanceof this.images.Item){cardArray=[holeCards]}else{throw"adjusthole cards source rectangle given insufficient parameter"}for(var i=0;i<cardArray.length;i++){if(_.isNumber(options.seatNumber)){var seatNum=options.seatNumber}else{var seatNum=this.images.seats[cardArray[i].seatObjectAncestor.nonRotatedSeatNumber]}var distanceFromCardTopToSeatBottom=this.images.seats[seatNum].seat.position.y+this.images.seats[seatNum].seat.size.y-cardArray[i].image.y;if(cardArray[i].size.y>distanceFromCardTopToSeatBottom){cardArray[i].image.sourceRect=createRectangle(cardArray[i],cardArray[i+1],distanceFromCardTopToSeatBottom);stagesToUpdate.push(this.itemChanged(cardArray[i]))}if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}}function createRectangle(currentCard,nextCard,height){var currentX=currentCard.image.x;if(nextCard instanceof self.images.Item){var width=nextCard.image.x-currentX}else{var width=currentCard.size.x}var rectangle=new createjs.Rectangle(0,0,width,height);return rectangle}};this.hideSeatedOptions=function(){this.hideChildren(this.images.rebuy);this.hideChildren(this.images.sitIn)};this.adjustBetDisplay=function(betSize){var minX=self.images.betSlider.horizontal.position.x;var maxX=self.images.betSlider.horizontal.position.x+self.images.betSlider.horizontal.size.x-self.images.betSlider.vertical.size.x;var betSizePercent=(betSize-self.gameState.minBet)/(self.gameState.maxBet-self.gameState.minBet);var newX=(maxX-minX)*betSizePercent+minX;if(newX>=maxX){newX=maxX;self.images.bet.text.text="Bet All-In";self.images.raise.text.text="Raise All-In"}else{if(newX<minX){newX=minX}if(self.arrayOfParentsOfStageAndOfContainerArray[self.images.bet.position.z.stage].stage.contains(self.images.bet.text)){self.images.bet.text.text="Bet "+betSize}else if(self.getParentOfStageObject(self.images.raise).stage.contains(self.images.raise.text)){self.images.raise.text.text="Raise to "+betSize}}self.images.betSlider.vertical.image.x=newX;self.images.bet.messages=["act","bet",betSize];self.images.raise.messages=["act","raise",betSize];self.updateBetSize(betSize);this.updateStages(self.images.betSlider.vertical.position.z.stage)};this.displayAllCommunity=function(communityArray,options){var stagesToUpdate=[];for(var i=0;i<communityArray.length;i=i+1){if(_.isString(communityArray[i])&&communityArray[i].length>=2){stagesToUpdate.push(this.displayShownCard(communityArray[i],this.images.community[i],options))}}return stagesToUpdate};this.getParentOfStageObject=function(item){if(item instanceof this.images.Item){var parentOfStage=this.arrayOfParentsOfStageAndOfContainerArray[item.position.z.stage];return parentOfStage}};this.updateBetSize=function(betSize){$("#betSize").val(betSize);self.gameState.betSize=betSize};this.displayImage=function(parentOfImageObject,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(optionsWithCondom.stageNumber)){optionsWithCondom.stageNumber=parentOfImageObject.position.z.stage}if(optionsWithCondom.container){var container=optionsWithCondom.container}else{var container=parentOfImageObject.position.z.container}if(parentOfImageObject.image){if(_.isElement(parentOfImageObject.image)){$(parentOfImageObject.image).css("display","inline")}else if(this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].containers[container].contains(parentOfImageObject.image)!==true){this.addChildToContainer(parentOfImageObject.image,container,optionsWithCondom);this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate=false;var changedWithoutUpdate=optionsWithCondom.stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(options.stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.displayText=function(parentOfTextObject,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(options.stageNumber)){optionsWithCondom.stageNumber=parentOfTextObject.position.z.stage}if(options.container){var container=optionsWithCondom.container}else{var container=parentOfTextObject.position.z.container}if(parentOfTextObject.text){if(_.isString(parentOfTextObject.text.innerHTML)){$(parentOfTextObject.text).css("display","inline")}else if(this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].containers[container+1].contains(parentOfTextObject.text)!==true){this.addChildToContainer(parentOfTextObject.text,container+1,optionsWithCondom);this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate=false;var changedWithoutUpdate=optionsWithCondom.stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(optionsWithCondom.stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.displayChildren=function(parentOrGrandparent,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdateArray=[];if(parentOrGrandparent instanceof this.images.Item){stagesToUpdateArray.push(this.displayImage(parentOrGrandparent,options));stagesToUpdateArray.push(this.displayText(parentOrGrandparent,options))}else if(_.isArray(parentOrGrandparent)){for(var i=0;i<parentOrGrandparent.length;i++){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.displayImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.displayText(parentOrGrandparent[i],options))}}}else if(_.isObject(parentOrGrandparent)){for(var i in parentOrGrandparent){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.displayImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.displayText(parentOrGrandparent[i],options))}}}if(update!==false){options.update=update;this.updateStages(stagesToUpdateArray,options)}else{return stagesToUpdateArray}};this.displayHiddenCards=function(seatNumber,options){var stagesToUpdate=[];self.gameState.seats[seatNumber].inHand=true;stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].hiddenCards[0],options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].hiddenCards[1],options));return stagesToUpdate};this.hideText=function(parentOfTextObject,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(optionsWithCondom.stageNumber)){var stageNumber=parentOfTextObject.position.z.stage}else{var stageNumber=optionsWithCondom.stageNumber}if(_.isNumber(optionsWithCondom.container)){var container=optionsWithCondom.container}else{var container=parentOfTextObject.position.z.container}if(parentOfTextObject.text){if(_.isString(parentOfTextObject.text.innerHTML)){$(parentOfTextObject.text).css("display","none")}else if(this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container+1].contains(parentOfTextObject.text)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container+1].removeChild(parentOfTextObject.text);this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate=false;var changedWithoutUpdate=stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.hideImage=function(parentOfImageObject,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(optionsWithCondom.stageNumber)){var stageNumber=parentOfImageObject.position.z.stage}else{var stageNumber=optionsWithCondom.stageNumber}if(_.isNumber(optionsWithCondom.container)){var container=optionsWithCondom.container}else{var container=parentOfImageObject.position.z.container}if(parentOfImageObject.image){if(_.isString(parentOfImageObject.image.innerHTML)){$(parentOfImageObject.image).css("display","none")}else if(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(parentOfImageObject.image)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].removeChild(parentOfImageObject.image);this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate=false;var changedWithoutUpdate=stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.playerSitsOut=function(seatNumber,options){var stagesToUpdate=[];self.gameState.seats[seatNumber].sitting_out=true;if(this.images.seats[seatNumber].status.text.text!=="Sitting Out"){this.images.seats[seatNumber].status.text.text="Sitting Out";stagesToUpdate.push(this.itemChanged(this.images.seats[seatNumber].status));if(options&&options.update===false){return stagesToUpdate}else this.updateStages(stagesToUpdate)}};this.hideChildren=function(parentOrGrandparent,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdateArray=[];if(parentOrGrandparent instanceof this.images.Item){stagesToUpdateArray.push(this.hideImage(parentOrGrandparent,options));stagesToUpdateArray.push(this.hideText(parentOrGrandparent,options))}else if(_.isArray(parentOrGrandparent)){for(var i=0;i<parentOrGrandparent.length;i++){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.hideImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.hideText(parentOrGrandparent[i],options))}}}else if(_.isObject(parentOrGrandparent)){for(var i in parentOrGrandparent){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.hideImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.hideText(parentOrGrandparent[i],options))}}}if(update!==false){options.update=update;this.updateStages(stagesToUpdateArray,options)}else{return stagesToUpdateArray}};this.hideAllActionButtons=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdateArray=[];stagesToUpdateArray.push(this.hideChildren(this.images.fold,options));stagesToUpdateArray.push(this.hideChildren(this.images.call,options));stagesToUpdateArray.push(this.hideChildren(this.images.check,options));stagesToUpdateArray.push(this.hideChildren(this.images.raise,options));stagesToUpdateArray.push(this.hideChildren(this.images.bet,options));stagesToUpdateArray.push(this.hideChildren(this.images.betSlider,options));stagesToUpdateArray=_.flatten(stagesToUpdateArray);if(update!==false){this.updateStages(stagesToUpdateArray)}else{return stagesToUpdateArray}$("#betSize").css("display","none")};this.roundEnds=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];if(_.isArray(this.gameState.holeCards)){this.gameState.holeCards.length=0}else{this.gameState.holeCards=null}stagesToUpdate.push(this.hideChildren(this.images.community[i]));for(var i=0;i<this.images.seats.length;i++){this.hideChildren(this.images.seats[i].hiddenCards,{update:false});this.hideChildren(this.images.seats[i].shownCards,{update:false});this.images.seats[i].shownCards[0].image=null;this.images.seats[i].shownCards[1].image=null;this.gameState.seats[i].inHand=false}stagesToUpdate.push(this.images.seats[0].hiddenCards[0].position.z.stage);stagesToUpdate.push(this.images.seats[0].shownCards[0].position.z.stage);stagesToUpdate.push(self.hideAllBets(options));stagesToUpdate.push(self.hideChildren(self.images.totalPotSize,{update:false}));stagesToUpdate.push(self.updatePotSize());$(this.arrayOfParentsOfStageAndOfContainerArray[this.images.betSlider.vertical.position.z.stage].stage.canvas,"#betSize").unbind("mousewheel");$("#betSizeDiv").unbind("mousewheel");options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.winners=function(players){var potArrayLength=0;for(var i=0;i<players.length;i++){if(players[i].chips_won.length>potArrayLength){potArrayLength=players[i].chips_won.length}}var pots=[];for(var i=0;i<potArrayLength;i++){pots.push("placeholder")}var chipAnimationTime=700;var timeBetweenAnimations=1500;var timeAtEnd=700;var ticks=33;var chipStacks=[];for(var i=0;i<players.length;i++){chipStacks.push([])}var callbackNumber=0;var potWinners=[];var temporaryStacks=[];var potIntoChipAnimationArray=[];var callbacks=[];var finalArray=[];var chipsInFrontOfPlayer=[];for(var i=0;i<self.images.seats.length;i++){chipsInFrontOfPlayer.push(0)}for(var i=0;i<pots.length;i++){potWinners.push([]);potIntoChipAnimationArray.push([]);for(var n=0;n<players.length;n++){var winnings=players[n].chips_won[i];if(winnings>0){temporaryStacks.push([]);potWinners[i].push({seat:players[n].seat,amountWon:winnings,temporaryStackNumber:temporaryStacks.length-1})}}}var chipMoveSound=createjs.Sound.createInstance(this.images.sources.moveChipsSound);console.log("current pot sizes = ");console.log(this.getCurrentPotSizes());if(this.getCurrentPotSizes()[0]===0){var betSizes=this.getCurrentBetSizes();var preflopWinner=players[0].seat;var preflopWinAmount=0;var masterSeriesArray=[];var asyncLoserToWinnerParallelAnimationArray=[];var asyncLoserToWinnerParallelAnimationArrayCallBackNumber=0;var betSizesToHide=[];_.each(betSizes,function(value,seatNumber,list){preflopWinAmount=preflopWinAmount+betSizes[seatNumber];if(betSizes[seatNumber]>0&&seatNumber!==preflopWinner){console.log("animating from "+seatNumber+" to "+preflopWinner);var loserToWinnerStack=getAnimatePlayersStackToWinnersStackFunction(seatNumber,preflopWinner);var callbackNumber=asyncLoserToWinnerParallelAnimationArrayCallBackNumber;asyncLoserToWinnerParallelAnimationArray.push(function(callback){loserToWinnerStack(function(){callback(null,callbackNumber)})});asyncLoserToWinnerParallelAnimationArrayCallBackNumber++;betSizesToHide.push(self.images.seats[seatNumber].bet)}});asyncLoserToWinnerParallelAnimationArrayPlaySoundAndHideBetSizeTextCallbackNumber=asyncLoserToWinnerParallelAnimationArrayCallBackNumber;asyncLoserToWinnerParallelAnimationArray.push(function(callback){chipMoveSound.play();self.hideChildren(betSizesToHide,{update:false});callback(null,asyncLoserToWinnerParallelAnimationArrayPlaySoundAndHideBetSizeTextCallbackNumber)});asyncLoserToWinnerParallelAnimationArrayCallBackNumber++;var asyncLoserToWinnerParallelAnimationArrayFinishedFunction=function(err,results){if(err){console.log("preflop winners message has error");console.log(err)}else{if(results.length!==asyncLoserToWinnerParallelAnimationArrayCallBackNumber){console.log("preflop winners message results array incorrect");console.log(results)}else{for(var i=0;i<results.length;i++){if(results[i]!==i){console.log("result value incorrect");console.log(results);throw"error"}}var stagesToUpdate=[];stagesToUpdate.push(self.hideAllBets());stagesToUpdate.push(self.playerPutsChipsInPot(preflopWinner,preflopWinAmount,players[0].chips,{update:false}));self.updateStages(stagesToUpdate)}}};async.parallel(asyncLoserToWinnerParallelAnimationArray,asyncLoserToWinnerParallelAnimationArrayFinishedFunction);return}_.each(_.range(potWinners.length),function(potNumber){var callID=0;if(!_.isEmpty(potWinners[potNumber])){_.each(_.range(potWinners[potNumber].length),function(inversePotNumber){var i=potWinners[potNumber].length-1-inversePotNumber;var animationDistanceX=self.images.seats[potWinners[potNumber][i].seat].firstChip.position.x-self.images.pots[potNumber].firstChip.position.x;var animationDistanceY=self.images.seats[potWinners[potNumber][i].seat].firstChip.position.y-self.images.pots[potNumber].firstChip.position.y;var columnDistance=self.images.seats[potWinners[potNumber][i].seat].secondColumnChip.position.x-self.images.seats[potWinners[potNumber][i].seat].firstChip.position.x;var splitPotIntoChipWinningsDisplayChipstackInfo={initialX:self.images.pots[potNumber].firstChip.position.x,initialY:self.images.pots[potNumber].firstChip.position.y,hidden:true};self.displayChipStack(potWinners[potNumber][i].amountWon,temporaryStacks[potWinners[potNumber][i].temporaryStackNumber],splitPotIntoChipWinningsDisplayChipstackInfo);var tempNumber=callID;potIntoChipAnimationArray[potNumber].push(function(callback){self.displayChildren(temporaryStacks[potWinners[potNumber][i].temporaryStackNumber].chips);callback(null,tempNumber)});callID++;var chipIntoPotTempCallbackNumber=callID;var potIntoChipAnimationFunction=getAnimateChipStackFunction(temporaryStacks[potWinners[potNumber][i].temporaryStackNumber].chips,animationDistanceX,animationDistanceY);potIntoChipAnimationArray[potNumber].push(function(callback){potIntoChipAnimationFunction(function(){callback(null,chipIntoPotTempCallbackNumber)})});callID++;var chipMoveSoundCallBacknumber=callbackNumber;potIntoChipAnimationArray[potNumber].push(function(callback){chipMoveSound.play();callback(null,chipMoveSoundCallBacknumber)});callbackNumber++});callbackNumber++}});var errorNumber=0;_.each(_.range(potIntoChipAnimationArray.length),function(inversePotNumber){var potNumber=potIntoChipAnimationArray.length-1-inversePotNumber;var tempNumber=errorNumber;if(!_.isEmpty(potIntoChipAnimationArray[potNumber])){finalArray.push(function(next){self.hideChildren(self.images.pots[potNumber].chips);self.hideChildren(self.images.pots[potNumber].potSize);async.parallel(potIntoChipAnimationArray[potNumber],function(err,results){next(null,tempNumber)})});errorNumber++;var tempASDF=errorNumber;finalArray.push(function(next){var stagesWeWantToUpdateAfter=[];_.each(_.range(potWinners[potNumber].length),function(i){var seatNumber=potWinners[potNumber][i].seat;chipsInFrontOfPlayer[seatNumber]=potWinners[potNumber][i].amountWon+chipsInFrontOfPlayer[seatNumber];var maxStackSize=false;for(var z=0;z<players.length;z++){if(players[z].seat===seatNumber){maxStackSize=players[z].chips}}var currentStackSize=self.getCurrentStackSizes()[seatNumber];var newStackSize=currentStackSize+potWinners[potNumber][i].amountWon;if(newStackSize>maxStackSize){newStackSize=maxStackSize}stagesWeWantToUpdateAfter.push(self.playerPutsChipsInPot(seatNumber,chipsInFrontOfPlayer[seatNumber],newStackSize,{update:false}));stagesWeWantToUpdateAfter.push(self.displayChildren(self.images.seats[seatNumber].bet,{update:false}));if(self.arrayOfParentsOfStageAndOfContainerArray[self.images.seats[seatNumber].chips[0].position.z.stage].stage.contains(self.images.seats[seatNumber].chips[0].image)){}stagesWeWantToUpdateAfter.push(self.hideChildren(temporaryStacks[potWinners[potNumber][i].temporaryStackNumber].chips,{update:false}))});self.updateStages(stagesWeWantToUpdateAfter);console.log("start waiting after pot number "+potNumber);var wait=setTimeout(function(){next(null,tempASDF)},timeBetweenAnimations)});errorNumber++}});var finalChipUpdateCallbackNumbr=errorNumber;finalArray.push(function(next){for(var i=0;i<players.length;i++){self.playerPutsChipsInPot(players[i].seat,chipsInFrontOfPlayer[players[i].seat],players[i].chips);if(i==players.length-1){next(null,finalChipUpdateCallbackNumbr)}}errorNumber++});async.series(finalArray,function(err,results){});function getAnimateChipStackFunction(chipArray,distanceX,distanceY){var loserToWinnerStackAnimationInfo={item:chipArray,finalX:distanceX,finalY:distanceY,numTicks:ticks,onTick:null,time:chipAnimationTime};var animationFunction=function(onEnd){loserToWinnerStackAnimationInfo.onEnd=onEnd;self.animateImage(loserToWinnerStackAnimationInfo)};return animationFunction}function getAnimatePlayersStackToWinnersStackFunction(loser,winner){var animationDistanceX=self.images.seats[winner].firstChip.position.x-self.images.seats[loser].firstChip.position.x;var animationDistanceY=self.images.seats[winner].firstChip.position.y-self.images.seats[loser].firstChip.position.y;var animationFunction=getAnimateChipStackFunction(self.images.seats[loser].chips,animationDistanceX,animationDistanceY);return animationFunction}};this.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText=function(){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("assinging isAtBottom is true because i dontk now how to do it on mcustomscrollbar");var isAtBottom=true}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();var isAtBottom=scroll[0].getContentSize().h-scroll[0].getScrollTop()<=parseFloat(self.jQueryObjects.tableChatFullParagraph.outerHeight(true))+1}return isAtBottom};this.displayBubbleChat=function(chatInfo){self.images.seats[chatInfo.seat].chat.text.text="";chatInfo.message=chatInfo.message.replace(/^\s+|\s+$/g,"");if(/\S/.test(chatInfo.message)){createjs.Tween.removeTweens(self.images.seats[chatInfo.seat].chat.image);var messageToAdd;originalImageAlpha=self.imageData.chatBoxAlpha;var numLines=1;var textShortened=false;var finished=false;var currentLine=0;var needElipses=false;var largestTextWidth=0;var wasTrimmed=false;var numAddedChars=0;var chatFont=self.images.seats[chatInfo.seat].chat.text.font;var ifSymbolRegex=/^[\.,-\/#!$%\^&\*;:{}=\-_`~()]+$/;while(finished==false){wasTrimmed=false;messageToAdd=chatInfo.message.substring(self.images.seats[chatInfo.seat].chat.text.text.length-numAddedChars,chatInfo.message.length);var keepTrimming=true;while(keepTrimming===true&&self.getStringWidth(messageToAdd,chatFont)>self.images.seats[chatInfo.seat].chat.text.lineWidth){var lastRemovedChar=messageToAdd.charAt(messageToAdd.length-1);messageToAdd=messageToAdd.substring(0,messageToAdd.length-1);if(self.getStringWidth(messageToAdd,chatFont)<=self.images.seats[chatInfo.seat].chat.text.lineWidth){var keepTrimming=false;if(lastRemovedChar===" "){messageToAdd=messageToAdd+lastRemovedChar}if(messageToAdd.charAt(messageToAdd.length-1)===" "){wasTrimmed=true}else if(messageToAdd.charAt(messageToAdd.length-2)===" "){messageToAdd=messageToAdd.substring(0,messageToAdd.length-1);wasTrimmed=true}else if(ifSymbolRegex.test(lastRemovedChar)||ifSymbolRegex.test(messageToAdd.charAt(messageToAdd.length-1))){messageToAdd=messageToAdd+" ";numAddedChars=numAddedChars+1;wasTrimmed=true}else{messageToAdd=messageToAdd.substring(0,messageToAdd.length-1);wasTrimmed=true;
if(ifSymbolRegex.test(messageToAdd.charAt(messageToAdd.length-1))){messageToAdd=messageToAdd+" ";numAddedChars=numAddedChars+1}else{messageToAdd=messageToAdd+"- ";numAddedChars=numAddedChars+2}}}}self.images.seats[chatInfo.seat].chat.text.text=self.images.seats[chatInfo.seat].chat.text.text+messageToAdd;if(wasTrimmed==true){if(numLines<self.permanentPreferences.playerChatMaxLines.value){numLines++;currentLine++}else{finished=true;if(self.images.seats[chatInfo.seat].chat.text.text.length-numAddedChars==chatInfo.message.length){}else{needElipses=true}}}else{finished=true}}if(needElipses==true){self.images.seats[chatInfo.seat].chat.text.text=self.images.seats[chatInfo.seat].chat.text.text.substring(0,self.images.seats[chatInfo.seat].chat.text.text.length-4);self.images.seats[chatInfo.seat].chat.text.text=self.images.seats[chatInfo.seat].chat.text.text+"..."}var imageToTextWidthRatio=self.images.seats[chatInfo.seat].chat.size.x/self.images.seats[chatInfo.seat].chat.text.lineWidth;if(numLines>1){largestTextWidth=self.images.seats[chatInfo.seat].chat.text.lineWidth}else{largestTextWidth=self.getStringWidth(self.images.seats[chatInfo.seat].chat.text.text,chatFont)}var chatBoxWidth=imageToTextWidthRatio*largestTextWidth+1;console.log("drawing chat widh Width of "+chatBoxWidth);self.images.seats[chatInfo.seat].chat.image.drawChat(chatBoxWidth,numLines);self.images.seats[chatInfo.seat].chat.text.alpha=1;self.images.seats[chatInfo.seat].chat.text.y=self.images.seats[chatInfo.seat].chat.position.y-(numLines-1)*self.images.seats[chatInfo.seat].chat.text.getMeasuredLineHeight();self.displayChildren(self.images.seats[chatInfo.seat].chat);var imageTween=createjs.Tween.get(self.images.seats[chatInfo.seat].chat.image,{loop:false,override:true,paused:true});imageTween.to({alpha:originalImageAlpha}).to({alpha:0},1e4).call(self.hideImage,[self.images.seats[chatInfo.seat].chat],self).to({alpha:originalImageAlpha});var textTween=createjs.Tween.get(self.images.seats[chatInfo.seat].chat.text,{loop:false,override:true,paused:true});textTween.to({alpha:1}).to({alpha:0},1e4).call(self.hideText,[self.images.seats[chatInfo.seat].chat],self).to({alpha:1});imageTween.setPaused(false);textTween.setPaused(false)}};this.appendTableChatFullMessageText=function(textString,options){var isAtBottom=this.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText();self.jQueryObjects.tableChatFullParagraph.append("<br>"+textString);if(isAtBottom==true&&self.gameState.tableChatFull.mouseDown!=true&&options&&options.moveTable!==false){self.moveTableChatFullMessageText()}else if(options&&options.moveTable==true){self.moveTableChatFullMessageText()}};this.updateTableChatFullMessageTextFromCurrentOrAdditionalData=function(chatInfo,options){var isDisplayingDealerMessages=this.gameState.tableChatFull.currentlyDisplayingDealerMessages;var isDisplayingPlayerMessages=this.gameState.tableChatFull.currentlyDisplayingPlayerMessages;var isDisplayingObserverMessages=this.gameState.tableChatFull.currentlyDisplayingObserverMessages;var shouldDisplayDealerMessages;var shouldDisplayPlayerMessages;var shouldDisplayObserverMessages;if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessagesOn.value===false){shouldDisplayDealerMessages=true}else{shouldDisplayDealerMessages=false}if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessagesOn.value===false){shouldDisplayPlayerMessages=true}else{shouldDisplayPlayerMessages=false}if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessagesOn.value===false){shouldDisplayObserverMessages=true}else{shouldDisplayObserverMessages=false}var needToUpdate=isDisplayingDealerMessages!==shouldDisplayDealerMessages||isDisplayingPlayerMessages!==shouldDisplayPlayerMessages||isDisplayingObserverMessages!==shouldDisplayObserverMessages;var scrollDownAtEnd=this.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText();if(needToUpdate===true||options&&options.update===true){self.gameState.tableChatFull.fullTextString="";var displayCurrentLog;for(var i=0;i<self.gameState.tableChatFull.log.length;i++){if(self.gameState.tableChatFull.log[i][0]==="dealer"){displayCurrentLog=shouldDisplayDealerMessages}else if(self.gameState.tableChatFull.log[i][0]==="observer"){displayCurrentLog=shouldDisplayObserverMessages}else{displayCurrentLog=shouldDisplayPlayerMessages}if(displayCurrentLog===true){if(self.gameState.tableChatFull.fullTextString.length>0){self.gameState.tableChatFull.fullTextString=self.gameState.tableChatFull.fullTextString+"<br>"}self.gameState.tableChatFull.fullTextString=self.gameState.tableChatFull.fullTextString+self.gameState.tableChatFull.log[i][1]}}self.jQueryObjects.tableChatFullParagraph.html(self.gameState.tableChatFull.fullTextString);this.gameState.tableChatFull.currentlyDisplayingDealerMessages=shouldDisplayDealerMessages;this.gameState.tableChatFull.currentlyDisplayingPlayerMessages=shouldDisplayPlayerMessages;this.gameState.tableChatFull.currentlyDisplayingObserverMessages=shouldDisplayObserverMessages}if(chatInfo&&chatInfo.chatSourceType&&chatInfo.message){this.gameState.tableChatFull.log.push([chatInfo.chatSourceType,chatInfo.message]);if(chatInfo.timeStampString){this.gameState.tableChatFull.log[this.gameState.tableChatFull.log.length-1].push(chatInfo.timeStampString)}this.appendTableChatFullMessageText(chatInfo.message,{moveTable:false})}if(scrollDownAtEnd===true){this.moveTableChatFullMessageText({resize:true})}else{this.moveTableChatFullMessageText({magnitude:0,resize:true})}};this.displayInHandOptions=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.displayChildren(this.images.foldToAnyBet,options));stagesToUpdate.push(this.displayChildren(this.images.sitOutNextHand,options));stagesToUpdate.push(this.displayChildren(this.images.sitOutNextBlind,options));options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.hideSeatedOptions=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];this.images.standUp.image.onClick=null;this.images.getChips.image.onClick=null;stagesToUpdate.push(this.displayChildren(this.images.standUpDisabledShape,options));stagesToUpdate.push(this.displayChildren(this.images.getChipsDisabledShape,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextHandOn,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextHand,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(this.hideChildren(self.images.foldToAnyBet,options));stagesToUpdate.push(this.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));stagesToUpdate.push(self.hideChildren(self.images.sitIn,options));stagesToUpdate.push(this.hideAllActionButtons(options));options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.displayBetSlider=function(minBet,maxBet,minIncrement){this.gameState.minBet=minBet;this.gameState.maxBet=maxBet;this.gameState.minIncrement=minIncrement;this.images.betSlider.vertical.image.x=this.images.betSlider.vertical.position.x;this.updateBetSize(minBet);this.displayChildren(this.images.betSlider);$(this.getParentOfStageObject(this.images.betSlider.vertical).stage.canvas).bind("mousewheel",function(event,delta,deltaX,deltaY){self.events.wheelScroll(deltaY)})};this.displayCorrectSeatMessage=function(seatNumber,options){if(!_.isNumber(this.images.seats[seatNumber].nonRotatedSeatNumber)){console.log("correct seat message not displaying of seat # "+seatNumber);return}if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];switch(this.gameState.seats[seatNumber].displayMessageType){case"seat":stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].status,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));break;case"countdown":stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));if(self.gameState.seats[seatNumber].toAct===true){stagesToUpdate.push(this.displayText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options))}else{stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options))}stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].status,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));break;case"action":stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.displayText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].status,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));break;case"winner":stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].status,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));break;case"openSeat":if(_.isNumber(this.gameState.userSeatNumber)){stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].disabledSeat,options))}else if(this.gameState.userSeatNumber==false||_.isNull(this.gameState.userSeatNumber)||_.isUndefined(this.gameState.userSeatNumber)){stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].openSeat,options))}stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].status,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));break;default:if(_.isNumber(this.gameState.userSeatNumber)){stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].disabledSeat,options))}else{stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].openSeat,options))}stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].status,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));break}options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.playerActs=function(seatNumber,actionText,fadeTimeInSeconds){if(seatNumber===self.gameState.userSeatNumber){this.hideAllActionButtons(this.gameState.userSeatNumber)}this.gameState.seats[seatNumber].displayMessageType="action";self.images.seats[seatNumber].action.text.text=actionText;var interval=100;var alpha;if(fadeTimeInSeconds&&typeof fadeTimeInSeconds=="number"){alpha=fadeTimeInSeconds}else{alpha=2}var playerAction=setInterval(function(){if(self.gameState.seats[seatNumber].displayMessageType!="action"||alpha<=0){if(self.gameState.seats[seatNumber].displayMessageType==="action"){self.gameState.seats[seatNumber].displayMessageType="seat"}clearInterval(playerAction)}else if(alpha>1){self.images.seats[seatNumber].action.text.alpha=1;self.images.seats[seatNumber].action.text.text=actionText;self.updateStages(self.images.seats[seatNumber].action.position.z.stage)}else{self.images.seats[seatNumber].action.text.alpha=alpha;self.images.seats[seatNumber].action.text.text=actionText;self.updateStages(self.images.seats[seatNumber].action.position.z.stage)}alpha=alpha-interval/1e3;self.displayCorrectSeatMessage(seatNumber)},interval)};this.playerWins=function(seatNumber,chipsWon,fadeTimeInSeconds){this.gameState.seats[seatNumber].displayMessageType==="winner";self.images.seats[seatNumber].winner.text.text="";var interval=100;var alpha;if(_.isNumber(fadeTimeInSeconds)){alpha=fadeTimeInSeconds}else{alpha=2.5}var declareWinner=setInterval(function(){var stagesToUpdate=[];if(self.gameState.seats[seatNumber].displayMessageType!="winner"||alpha<=0){if(self.gameState.seats[seatNumber].displayMessageType==="winner"){self.gameState.seats[seatNumber].displayMessageType="seat"}clearInterval(declareWinner)}else if(alpha>1){self.images.seats[seatNumber].winner.text.alpha=1;self.images.seats[seatNumber].winner.text.text="Wins "+chipsWon;stagesToUpdate.push(self.images.seats[seatNumber].winner.position.z.stage)}else{self.images.seats[seatNumber].winner.text.alpha=alpha;self.images.seats[seatNumber].winner.text.text="Wins "+chipsWon;stagesToUpdate.push(self.images.seats[seatNumber].winner.position.z.stage)}alpha=alpha-interval/1e3;stagesToUpdate.push(self.displayCorrectSeatMessage(seatNumber,{update:false}));self.updateStages(stagesToUpdate)},interval)};this.playerToAct=function(seatNumber,timeoutInMS){self.gameState.seats[seatNumber].timeToActInMS=timeoutInMS;self.gameState.seats[seatNumber].toAct=true;self.gameState.seats[seatNumber].displayMessageType="countdown";var hexToRGB=function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null};var extractRGB=function(color){if(color.charAt(0)==("r"||"R")){var colorsArray=[];colorsArray=color.replace(/[^\d,]/g,"").split(",");red=parseInt(colorsArray[0]);green=parseInt(colorsArray[1]);blue=parseInt(colorsArray[2])}else if(color.charAt(0)=="#"){var colorsObject=hexToRGB(color);red=parseInt(colorsObject.r);green=parseInt(colorsObject.g);blue=parseInt(colorsObject.b)}return[red,green,blue]};var rgbArrayToString=function(rgbArray){colorString="rgb("+rgbArray[0]+","+rgbArray[1]+","+rgbArray[2]+")";return colorString};var originalBorderColor=self.images.seats[0].seat.image.borderColor;var originalMiddleDividerColor=self.images.seats[0].seat.image.middleDividerColor;var toActTimeLeftBorderColor="#FFFF00";var toActBorderColor=originalBorderColor;var toActMiddleDividerColor="#FFFFFF";var timeToChangeColors=3e3;var ticksPerColorChange=20;var interval=timeToChangeColors/ticksPerColorChange;var lastTick=ticksPerColorChange-1;var tick=0;var originalFillColor=self.images.seats[seatNumber].seat.image.fillColor;var targetFillColorsArray=[[255,0,0],[0,0,0]];var lastCompletedFillColorCounter=-1;var countdown=setInterval(function(){var stagesToUpdate=[];var currentFillColor=self.images.seats[seatNumber].seat.image.fillColor;var red;var green;var blue;var previousTargetRed;var previousTargetGreen;var previousTargetBlue;var targetRed;var targetGreen;var targetBlue;var redIncreasePerTick;var greenIncreasePerTick;var blueIncreasePerTick;var nextRed;var nextGreen;var nextBlue;var currentColors=extractRGB(currentFillColor);red=currentColors[0];green=currentColors[1];blue=currentColors[2];if(lastCompletedFillColorCounter==-1){var lastColors=extractRGB(originalFillColor);previousTargetRed=lastColors[0];previousTargetGreen=lastColors[1];previousTargetBlue=lastColors[2]}else{var previousArrayNumber=lastCompletedFillColorCounter%targetFillColorsArray.length;var lastColorString=rgbArrayToString(targetFillColorsArray[previousArrayNumber]);var lastColors=extractRGB(lastColorString);previousTargetRed=lastColors[0];previousTargetGreen=lastColors[1];previousTargetBlue=lastColors[2]}var targetArrayNumber=(lastCompletedFillColorCounter+1)%targetFillColorsArray.length;var targetColorString=rgbArrayToString(targetFillColorsArray[targetArrayNumber]);var targetColors=extractRGB(targetColorString);targetRed=targetColors[0];targetGreen=targetColors[1];targetBlue=targetColors[2];redIncreasePerTick=(targetRed-previousTargetRed)/ticksPerColorChange;greenIncreasePerTick=(targetGreen-previousTargetGreen)/ticksPerColorChange;blueIncreasePerTick=(targetBlue-previousTargetBlue)/ticksPerColorChange;nextRed=parseInt(red+redIncreasePerTick);nextGreen=parseInt(green+greenIncreasePerTick);nextBlue=parseInt(blue+blueIncreasePerTick);var nextCounter=lastCompletedFillColorCounter+1;if(redIncreasePerTick<0){if(nextRed<=targetRed){lastCompletedFillColorCounter=nextCounter}}if(redIncreasePerTick>0){if(nextRed>=targetRed){lastCompletedFillColorCounter=nextCounter}}if(greenIncreasePerTick<0){if(nextGreen<=targetGreen){lastCompletedFillColorCounter=nextCounter}}if(greenIncreasePerTick>0){if(nextGreen>=targetGreen){lastCompletedFillColorCounter=nextCounter}}if(blueIncreasePerTick<0){if(nextBlue<=targetBlue){lastCompletedFillColorCounter=nextCounter}}if(blueIncreasePerTick>0){if(nextBlue>=targetBlue){lastCompletedFillColorCounter=nextCounter}}if(nextRed>255){nextRed=255}if(nextGreen>255){nextGreen=255}if(nextBlue>255){nextBlue=255}if(nextRed<0){nextRed=0}if(nextGreen<0){nextGreen=0}if(nextBlue<0){nextBlue=0}newFillColor=rgbArrayToString([nextRed,nextGreen,nextBlue]);if(self.gameState.seats[seatNumber].toAct===false){clearInterval(countdown);stagesToUpdate.push(self.images.drawSeat(self.images.seats[seatNumber].seat,originalBorderColor,originalFillColor,originalMiddleDividerColor));if(self.gameState.seats[seatNumber].displayMessageType=="countdown"){self.gameState.seats[seatNumber].displayMessageType="seat"}}else{stagesToUpdate.push(self.images.drawSeat(self.images.seats[seatNumber].seat,toActBorderColor,newFillColor,toActMiddleDividerColor,{borderFillRatio:self.gameState.seats[seatNumber].timeToActInMS/timeoutInMS,newFillColor:toActTimeLeftBorderColor}));var countDownText="Time: "+Math.ceil(self.gameState.seats[seatNumber].timeToActInMS/1e3);if(self.gameState.seats[seatNumber].timeToActInMS>=0){if(self.images.seats[seatNumber].countdown.text.text!==countDownText){self.images.seats[seatNumber].countdown.text.text=countDownText;var countDownTextStage=self.images.seats[seatNumber].countdown.position.z.stage;var countdownTextContainer=self.images.seats[seatNumber].countdown.position.z.container;stagesToUpdate.push(self.itemChanged(self.images.seats[seatNumber].countdown))}}}stagesToUpdate.push(self.displayCorrectSeatMessage(seatNumber,{update:false}));self.updateStages(stagesToUpdate);self.gameState.seats[seatNumber].timeToActInMS=self.gameState.seats[seatNumber].timeToActInMS-interval},interval)};this.updateTableChatFullDisplay=function(displayOrHideChildrenOptions){if(!displayOrHideChildrenOptions){var displayOrHideChildrenOptions={}}var update=displayOrHideChildrenOptions.update;displayOrHideChildrenOptions.update=false;var stagesToUpdate=[];_.each(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem,function(value,index,list){if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem[index].value===false){stagesToUpdate.push(self.hideChildren(self.images.tableChatFull[index],displayOrHideChildrenOptions))}else{stagesToUpdate.push(self.displayChildren(self.images.tableChatFull[index],displayOrHideChildrenOptions))}});this.updateTableChatFullMessageTextFromCurrentOrAdditionalData();displayOrHideChildrenOptions.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayTableChatFull=function(hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.displayChildren(this.images.hideTableChatFull,hideOrDisplayChildrenOptions));stagesToUpdate.push(this.hideChildren(this.images.showTableChatFull,hideOrDisplayChildrenOptions));stagesToUpdate.push(this.displayChildren(this.images.tableChatFull,hideOrDisplayChildrenOptions));stagesToUpdate.push(this.updateTableChatFullDisplay(hideOrDisplayChildrenOptions));var tableChatFullCanvas=self.arrayOfParentsOfStageAndOfContainerArray[this.images.tableChatFull.htmlStageElement.position.z.stage].stage.canvas;$(tableChatFullCanvas).css("display","inline");self.jQueryObjects.tableChatFullParagraph.css("display","inline ");var scrollInfo={magnitude:self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value};self.moveTableChatFullMessageText(scrollInfo);self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.updateValue(self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value);hideOrDisplayChildrenOptions.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideTableChatFull=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];console.log("calling hideTableChatFull");var positionValue;if(self.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText()===true){positionValue=true}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();positionValue=scroll[0].getScrollTop()}this.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value=positionValue;stagesToUpdate.push(this.displayChildren(this.images.showTableChatFull,options));stagesToUpdate.push(this.hideChildren(this.images.hideTableChatFull,options));stagesToUpdate.push(this.hideChildren(this.images.tableChatFull,options));var tableChatFullCanvas=self.arrayOfParentsOfStageAndOfContainerArray[this.images.tableChatFull.htmlStageElement.position.z.stage].stage.canvas;$(tableChatFullCanvas).css("display","none");self.jQueryObjects.tableChatFullParagraph.css("display","none");if(update!==false){this.updateStages(stagesToUpdate)}else{stagesToUpdate}};this.displayButton=function(parentOfImageObject,buttonText,messages){if(buttonText){if(parentOfImageObject.text&&parentOfImageObject.text.text){parentOfImageObject.text.text=buttonText}}if(messages){parentOfImageObject.messages=messages}if(parentOfImageObject.button&&parentOfImageObject.bitmapAnimation&&parentOfImageObject.button instanceof createjs.ButtonHelper){this.addChildToContainer(parentOfImageObject.bitmapAnimation,parentOfImageObject.position.z);parentOfImageObject.bitmapAnimation.gotoAndStop(0)}else if(parentOfImageObject.image){if(parentOfImageObject.image.onClick==null){parentOfImageObject.image.onClick=self.events.onButtonClick}if(parentOfImageObject.image.onPress==null){parentOfImageObject.image.onPress=self.events.buttonMouseDown}this.displayChildren(parentOfImageObject)}};this.hideCashier=function(hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];$(self.arrayOfParentsOfStageAndOfContainerArray[self.images.cashier.window.position.z.stage].stage.canvas).css("display","none");if(self.jQueryObjects.chatBoxInput.attr("readonly")==true||"readonly"){self.gameState.tableChatBox.display=false;self.enableTableChatBox()}self.jQueryObjects.cashierForm.css("display","none");self.restoreActiveStages(self.gameState.cashier.activeStages);self.gameState.cashier.display=false;$("#maxRadio").prop("checked",false);$("#autoRebuyRadio").prop("checked",false);$("#otherAmountRadio").prop("checked",false);$("#otherAmount").val("");$("#autoRebuyAmount").val("");$("#maxAmount").val("");stagesToUpdate.push(self.hideChildren(self.images.cashier,hideOrDisplayChildrenOptions));if(update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideMessageBox=function(hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];var messageBoxStageNumber=self.images.messageBox[self.gameState.messageBox.messageBoxImageContainerIndex].window.position.z.stage;if(self.gameState.messageBox.messageBoxImageContainerIndex===self.gameState.zPositionData.initialMessageBox.container){if(self.gameState.cashier.display===true){this.jQueryObjects.cashierForm.css("display","inline")}else if(self.gameState.tableChatBox.display==true){self.enableTableChatBox()}}stagesToUpdate.push(self.hideChildren(self.images.messageBox[self.gameState.messageBox.messageBoxImageContainerIndex],hideOrDisplayChildrenOptions));if(self.gameState.messageBox.messageBoxImageContainerIndex===self.gameState.zPositionData.initialMessageBox.container){self.restoreActiveStages(self.gameState.messageBox.activeStages[self.gameState.messageBox.messageBoxImageContainerIndex]);$(self.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].stage.canvas).css("display","none")}self.gameState.messageBox.messageBoxImageContainerIndex=self.gameState.messageBox.messageBoxImageContainerIndex-self.gameState.zPositionData.containersPerMessageBox;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayMessageBox=function(messageString,messageInfo,hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];var messageBoxStageNumber=this.images.messageBox[0].window.position.z.stage;var messageBoxImageContainerIndex=this.images.messageBox[0].window.position.z.container;var initialContainer=messageBoxImageContainerIndex;var incrementOfContainersPerMessageBox=this.gameState.zPositionData.containersPerMessageBox;for(var i=initialContainer;i<this.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].containers.length-incrementOfContainersPerMessageBox;i++){if(this.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].containers[i]&&this.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].containers[i].isVisible()==false){messageBoxImageContainerIndex=i;i=this.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].containers.length}}self.gameState.messageBox.messageBoxImageContainerIndex=messageBoxImageContainerIndex;self.gameState.messageBox.activeStages[messageBoxImageContainerIndex]=self.storeActiveStages();var messageBoxWindowWidth=516;var messageBoxWindowHeight=199;var closeXWidth=31;var closeXHeight=20;var closeXTopOffset=1;var closeXRightOffset=7;var outerTopHeight=31;var outerBottomHeight=8;var outerSideWidth=8;var htmlCanvas=this.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].stage.canvas;var stageWidth=htmlCanvas.width;var stageHeight=htmlCanvas.height;var messageBoxWindowX=Math.floor(stageWidth/2-messageBoxWindowWidth/2);var messageBoxWindowY=Math.floor(stageHeight/2-messageBoxWindowHeight/2);var innerMessageBoxX=messageBoxWindowX+outerSideWidth;var innerMessageBoxY=messageBoxWindowY+outerTopHeight;var innerMessageBoxWidth=messageBoxWindowWidth-2*outerSideWidth;var innerMessageBoxHeight=messageBoxWindowHeight-outerBottomHeight-outerTopHeight;var textHeight=30;var textLeftOffset=7;var textTopOffset=10;var textX=innerMessageBoxX+textLeftOffset;var defaultMinimumButtonWidth=50;var buttonHeight=22;var defaultRatioOfTextWidthToButtonWidth=.9;var defaultDistanceBetweenButtons=30;var buttonButtomOffset=15;var buttonY=messageBoxWindowY+messageBoxWindowHeight-outerBottomHeight-buttonButtomOffset-buttonHeight;var backgroundContainer=0;var textContainer=1;var buttonContainer=2;if(_.isNull(messageInfo)||_.isUndefined(messageInfo)){messageInfo={}}if(_.isNull(messageInfo.title)||_.isUndefined(messageInfo.title)||!(_.isString(messageInfo.title)||!_.isNumber(messageInfo.title))){messageInfo.title=""}if(_.isNull(messageInfo.titleSizeAndFont)||_.isUndefined(messageInfo.titleSizeAndFont)){messageInfo.titleSizeAndFont="18px "+self.permanentPreferences.defaultFontType.value}if(_.isNull(messageInfo.titleColor)||_.isUndefined(messageInfo.titleColor)){messageInfo.titleColor="#000000"}if(_.isNull(messageInfo.sizeAndFont)||_.isUndefined(messageInfo.sizeAndFont)){messageInfo.messageSizeAndFont="13px "+self.permanentPreferences.defaultFontType.value}if(_.isNull(messageInfo.messageColor)||_.isUndefined(messageInfo.messageColor)){messageInfo.messageColor="#000000"}if(_.isNull(messageInfo.buttonSizeAndFont)||_.isUndefined(messageInfo.buttonSizeAndFont)){messageInfo.buttonSizeAndFont="13px "+self.permanentPreferences.defaultFontType.value}if(_.isNull(messageInfo.buttonTextColor)||_.isUndefined(messageInfo.buttonTextColor)){messageInfo.buttonTextColor="#FFFFFF"}if(_.isNull(messageInfo.buttonBackgroundColor)||_.isUndefined(messageInfo.buttonBackgroundColor)){messageInfo.buttonBackgroundColor="#0000FF"}if(_.isNull(messageInfo.okayText)||_.isUndefined(messageInfo.okayText)){messageInfo.okayText="OK"}if(_.isNull(messageInfo.cancelText)||_.isUndefined(messageInfo.cancelText)){messageInfo.cancelText="Cancel"}if(!_.isNumber(messageInfo.ratioOfTextWidthToButtonWidth)){messageInfo.ratioOfTextWidthToButtonWidth=defaultRatioOfTextWidthToButtonWidth}if(!_.isNumber(messageInfo.minimumButtonWidth)){messageInfo.minimumButtonWidth=defaultMinimumButtonWidth}if(_.isNull(messageInfo.sameSizeButtons)||_.isUndefined(messageInfo.sameSizeButtons)){messageInfo.sameSizeButtons=true}if(!_.isNumber(messageInfo.okayWidth)){messageInfo.okayWidth=this.getStringWidth(messageInfo.okayText,messageInfo.buttonSizeAndFont)/messageInfo.ratioOfTextWidthToButtonWidth
}if(messageInfo.okayWidth<messageInfo.minimumButtonWidth){messageInfo.okayWidth=messageInfo.minimumButtonWidth}if(!_.isNumber(messageInfo.cancelWidth)){messageInfo.cancelWidth=this.getStringWidth(messageInfo.cancelText,messageInfo.buttonSizeAndFont)/messageInfo.ratioOfTextWidthToButtonWidth}if(messageInfo.cancelWidth<messageInfo.minimumButtonWidth){messageInfo.cancelWidth=messageInfo.minimumButtonWidth}if(messageInfo.sameSizeButtons===true){if(messageInfo.cancelWidth<messageInfo.okayWidth){messageInfo.cancelWidth=messageInfo.okayWidth}else{messageInfo.okayWidth=messageInfo.cancelWidth}}if(!_.isNumber(messageInfo.distanceBetweenButtons)){messageInfo.distanceBetweenButtons=defaultDistanceBetweenButtons}if(messageInfo.cancel!==true){var okayX=stageWidth/2-messageInfo.okayWidth/2}else{var okayX=stageWidth/2-messageInfo.distanceBetweenButtons/2-messageInfo.okayWidth;var cancelX=stageWidth/2+messageInfo.distanceBetweenButtons/2}self.images.messageBox[messageBoxImageContainerIndex].window.position.x=messageBoxWindowX;self.images.messageBox[messageBoxImageContainerIndex].window.position.y=messageBoxWindowY;self.images.messageBox[messageBoxImageContainerIndex].window.size.x=messageBoxWindowWidth;self.images.messageBox[messageBoxImageContainerIndex].window.size.y=messageBoxWindowHeight;self.positionItemImage(self.images.messageBox[messageBoxImageContainerIndex].window,{update:false});self.images.messageBox[messageBoxImageContainerIndex].window.image.addEventListener("mousedown",function(e){var options={animationTarget:self.images.messageBox[messageBoxImageContainerIndex]};self.events.mouseDownClickAndDrag(e,options)});var closeX=messageBoxWindowX+messageBoxWindowWidth-closeXRightOffset-closeXWidth;var closeY=messageBoxWindowY+closeXTopOffset;self.images.messageBox[messageBoxImageContainerIndex].closeWindow.position.x=closeX;self.images.messageBox[messageBoxImageContainerIndex].closeWindow.position.y=closeY;self.images.messageBox[messageBoxImageContainerIndex].closeWindow.size.x=closeXWidth;self.images.messageBox[messageBoxImageContainerIndex].closeWindow.size.y=closeXHeight;self.positionItemImage(self.images.messageBox[messageBoxImageContainerIndex].closeWindow,{update:false});if(messageInfo.closeWindowMessages){self.images.messageBox[messageBoxImageContainerIndex].closeWindow.messages=messageInfo.closeWindowMessages}if(messageInfo.closeWindowEvent){if(_.isString(messageInfo.closeWindowEvent)){self.images.messageBox[messageBoxImageContainerIndex].closeWindow.image.onClick=eval(messageInfo.closeWindowEvent)}else{self.images.messageBox[messageBoxImageContainerIndex].closeWindow.image.onClick=messageInfo.closeWindowEvent}}else{self.images.messageBox[messageBoxImageContainerIndex].closeWindow.image.onClick=function(event){self.events.onButtonClick(event);self.hideMessageBox()}}self.images.messageBox[messageBoxImageContainerIndex].windowTitle=new self.images.Item(messageBoxWindowX,messageBoxWindowY,messageBoxWindowWidth,outerTopHeight,{stage:messageBoxStageNumber,container:messageBoxImageContainerIndex+textContainer});self.images.addItemText(self.images.messageBox[messageBoxImageContainerIndex].windowTitle,messageInfo.title,messageInfo.titleSizeAndFont,messageInfo.titleColor);self.images.messageBox[messageBoxImageContainerIndex].message=new self.images.Item(textX,innerMessageBoxY+textTopOffset,innerMessageBoxWidth-textLeftOffset*2,textHeight,{stage:messageBoxStageNumber,container:messageBoxImageContainerIndex+textContainer});self.images.addItemText(self.images.messageBox[messageBoxImageContainerIndex].message,messageString,messageInfo.messageSizeAndFont,messageInfo.messageColor);self.images.messageBox[messageBoxImageContainerIndex].message.text.lineWidth=self.images.messageBox[messageBoxImageContainerIndex].message.size.x*.9;self.images.messageBox[messageBoxImageContainerIndex].message.text.maxWidth=null;self.images.messageBox[messageBoxImageContainerIndex].okay=new self.images.Item(okayX,buttonY,messageInfo.okayWidth,buttonHeight,{stage:messageBoxStageNumber,container:messageBoxImageContainerIndex+buttonContainer});self.images.itemAsRectangle(self.images.messageBox[messageBoxImageContainerIndex].okay,messageInfo.buttonBackgroundColor);self.images.addItemText(self.images.messageBox[messageBoxImageContainerIndex].okay,messageInfo.okayText,messageInfo.buttonSizeAndFont,messageInfo.buttonTextColor);if(messageInfo.okayMessages){self.images.messageBox[messageBoxImageContainerIndex].okay.messages=messageInfo.okayMessages}if(messageInfo.okayEvent){if(_.isString(messageInfo.okayEvent)){self.images.messageBox[messageBoxImageContainerIndex].okay.image.onClick=eval(messageInfo.okayEvent)}else{self.images.messageBox[messageBoxImageContainerIndex].okay.image.onClick=messageInfo.okayEvent}}else{self.images.messageBox[messageBoxImageContainerIndex].okay.image.onClick=function(event){self.events.onButtonClick(event);self.hideMessageBox()}}if(messageInfo.cancel&&messageInfo.cancel==true){self.images.messageBox[messageBoxImageContainerIndex].cancel=new self.images.Item(cancelX,buttonY,messageInfo.cancelWidth,buttonHeight,{stage:messageBoxStageNumber,container:messageBoxImageContainerIndex+buttonContainer});self.images.itemAsRectangle(self.images.messageBox[messageBoxImageContainerIndex].cancel,messageInfo.buttonBackgroundColor);self.images.addItemText(self.images.messageBox[messageBoxImageContainerIndex].cancel,messageInfo.cancelText,messageInfo.buttonSizeAndFont,messageInfo.buttonTextColor);if(messageInfo.cancelMessages){self.images.messageBox[messageBoxImageContainerIndex].cancel.messages=messageInfo.cancelMessages}if(messageInfo.cancelEvent){if(_.isString(messageInfo.cancelEvent)){self.images.messageBox[messageBoxImageContainerIndex].cancel.image.onClick=eval(messageInfo.cancelEvent)}else{self.images.messageBox[messageBoxImageContainerIndex].cancel.image.onClick=messageInfo.cancelEvent}}else{self.images.messageBox[messageBoxImageContainerIndex].cancel.image.onClick=function(event){self.events.onButtonClick(event);self.hideMessageBox()}}}else{self.images.messageBox[messageBoxImageContainerIndex].cancel=null}for(var i=0;i<messageBoxImageContainerIndex;i++){self.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].containers[i].mouseEnabled=false}stagesToUpdate.push(self.displayChildren(self.images.messageBox[messageBoxImageContainerIndex],hideOrDisplayChildrenOptions));$(this.arrayOfParentsOfStageAndOfContainerArray[messageBoxStageNumber].stage.canvas).css("display","inline");if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayCashier=function(info,hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];var cashierImageContainerIndex=this.images.cashier.window.position.z.container;if($("#tableChatBox").attr("readonly")==true){}else{this.gameState.tableChatBox.display=true;this.disableTableChatBox()}if(_.isUndefined(info.currency_per_chip)||_.isNull(info.currency_per_chip)){info.currency_per_chip=1}if(_.isUndefined(info.currency)||_.isNull(info.currency)){info.currency="Chips"}this.gameState.cashier.currency=info.currency;this.gameState.cashier.min=info.min*info.currency_per_chip;this.gameState.cashier.max=info.max*info.currency_per_chip;this.gameState.cashier.balance=info.balance_in_currency;this.gameState.cashier.table_name=info.table_name;this.gameState.cashier.small_blind=info.small_blind*info.currency_per_chip;this.gameState.cashier.big_blind=info.big_blind*info.currency_per_chip;this.gameState.cashier.table_min=info.table_min*info.currency_per_chip;this.images.cashier.blinds.text.text=info.currency_per_chip*info.small_blind+"/"+info.currency_per_chip*info.big_blind;this.images.cashier.tableNameValue.text.text=info.table_name;this.images.cashier.tableMinValue.text.text=info.currency_per_chip*info.table_min;this.images.cashier.tableMaxValue.text.text=info.currency_per_chip*info.table_max;this.images.cashier.playerMinValue.text.text=info.currency_per_chip*info.min;this.images.cashier.accountBalanceValue.text.text=this.gameState.cashier.balance;this.images.cashier.currency.text.text=info.currency+":";$("#maxRadio").prop("checked",false);$("#autoRebuyRadio").prop("checked",false);$("#otherAmountRadio").prop("checked",false);$("#otherAmount").val("");$("#autoRebuyAmount").val("");$("#maxAmount").val(this.gameState.cashier.max);$("#maxAmount").attr("readonly",true);$("#otherAmountRadio").prop("checked",true);$("#otherAmount").val(self.gameState.cashier.min);var htmlcashier=document.getElementById("cashier");htmlcashier.style.display="inline";document.getElementById("cashierDiv").style.display="inline";self.gameState.cashier.activeStages=this.storeActiveStages();var cashierStageNumber=this.images.cashier.window.position.z.stage;for(var i=0;i<cashierStageNumber;i++){this.arrayOfParentsOfStageAndOfContainerArray[i].mouseEnabled=false}console.log(this.images.cashier);stagesToUpdate.push(this.displayChildren(this.images.cashier,hideOrDisplayChildrenOptions));$(this.arrayOfParentsOfStageAndOfContainerArray[this.images.cashier.window.position.z.stage].stage.canvas).css("display","inline");if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.storeActiveStages=function(){var activeStages=[];for(var i=0;i<this.arrayOfParentsOfStageAndOfContainerArray.length;i++){if(this.arrayOfParentsOfStageAndOfContainerArray[i].stage.mouseEnabled==true){activeStages.push(i)}}return activeStages};this.restoreActiveStages=function(activeStageArray){for(var i=0;i<this.arrayOfParentsOfStageAndOfContainerArray.length;i++){this.arrayOfParentsOfStageAndOfContainerArray[i].stage.mouseEnabled=false}for(var i=0;i<activeStageArray.length;i++){this.arrayOfParentsOfStageAndOfContainerArray[activeStageArray[i]].stage.mouseEnabled=true}};this.isPreference=function(preference){if(_.isObject(preference)&&(!_.isUndefined(preference.value)||_.isFunction(preference.updateValue))){return true}else{return false}};this.isItemAddedToStage=function(item){var result=false;if(!item){}else if(item.image){if(_.isElement(item.image)){result=false;if($(item.image).css("display")!=="none"){return true}}else if(this.arrayOfParentsOfStageAndOfContainerArray[item.position.z.stage].containers[item.position.z.container].contains(item.image)){result=true}}else if(item.text){if(_.isElement(item.text)){result=false;if($(item.text).css("display")!=="none"){}}else if(this.arrayOfParentsOfStageAndOfContainerArray[item.position.z.stage].containers[item.position.z.container+1].contains(item.text)){result=true}else{"item.text is not added to stage and is not an element"}}return result};this.getCurrentStackSizes=function(){var stackSizes=[];for(var i=0;i<this.gameState.numSeats;i++){var size=parseInt(this.images.seats[i].status.text.text);if(_.isNaN(size)){size=0}else if(_.isNumber(size)){if(size<0){size=0}}else{size=0}stackSizes.push(size)}return stackSizes};this.getCurrentPotSizes=function(){var potSizes=[];var numPots=1;for(var i=0;i<this.gameState.numSeats-1;i++){var potSizeItem=this.images.pots[i].potSize;var potSize=parseFloat(potSizeItem.text.text);if(_.isNaN(potSize)||!_.isNumber(potSize)){potSize=0}if(i===0||potSize>0&&this.isItemAddedToStage(potSizeItem)){potSizes.push(potSize)}else{i=999}}console.log("get current potsizes called = ");console.log(potSizes);return potSizes};this.getCurrentBetSizes=function(){var betSizes=[];for(var i=0;i<this.gameState.numSeats;i++){var betSizeItem=this.images.seats[i].bet;if(this.isItemAddedToStage(betSizeItem)){betSizes.push(parseFloat(betSizeItem.text.text))}else if(this.isItemAddedToStage(this.images.seats[i].hiddenCards[0])||this.isItemAddedToStage(this.images.seats[i].shownCards[0])){betSizes.push(0)}else{betSizes.push(false)}}return betSizes};this.newStreetEnds=function(potSizes){var animationTime=350;var ticks=30;var chipMoveSound=createjs.Sound.createInstance(this.images.sources.moveChipsSound);$(this.arrayOfParentsOfStageAndOfContainerArray[this.images.betSlider.vertical.position.z.stage].stage.canvas).unbind("mousewheel");$("#betSizeDiv").unbind("mousewheel");var masterSeriesArray=[];var masterCallbackNumber=0;var asyncParallelChipIntoPotFunctionArray=[];var chipIntoPotCallbackNumber=0;var updateDisplay=[];var stagesToUpdate=[];var allTemporaryItems=[];var asyncParallelFinishedMasterSeriesCallbackNumber=masterCallbackNumber;masterSeriesArray.push(function(masterCallback){async.parallel(asyncParallelChipIntoPotFunctionArray,function(err,results){if(results.length===chipIntoPotCallbackNumber){console.log("parallel chips to pot animations finished successfully");masterCallback(null,asyncParallelFinishedMasterSeriesCallbackNumber)}else{console.log("parallel chips to pot animations resulted in errors");console.log(err)}})});masterCallbackNumber++;var cleanupCallbackNumber=masterCallbackNumber;masterSeriesArray.push(function(masterCallback){cleanup();masterCallback(null,cleanupCallbackNumber)});masterCallbackNumber++;var currentPots=this.getCurrentPotSizes();if(currentPots.length>potSizes.length){throw"current potsizes exceed street_ends message potSize length"}var currentBets=this.getCurrentBetSizes();var currentBetsSortedWithoutSeats=_.without(currentBets,null,undefined,false,true,0).sort(function(x,y){return x-y});var uniqueBets=_.uniq(currentBetsSortedWithoutSeats,true);var deltaPotSizes=[];for(var i=0;i<potSizes.length;i++){if(_.isNumber(currentPots[i])){deltaPotSizes[i]=potSizes[i]-currentPots[i]}else{deltaPotSizes[i]=potSizes[i]}}var numPotsToFeed=_.compact(deltaPotSizes).length;var numUniqueBets=_.compact(uniqueBets).length;var firstPotToFeed=potSizes.length-numPotsToFeed;if(_.compact(deltaPotSizes).length!==numUniqueBets){console.log("potSizes = ");console.log(potSizes);console.log("current pots = ");console.log(currentPots);console.log("unique bets = ");console.log(uniqueBets);console.log("deltaPotSizes = ");console.log(deltaPotSizes);console.log("numUniqueBets not the same as number of pot sizes changed")}var splitChipstacksData=[];for(var i=uniqueBets.length-1;i>=0;i--){if(i===0){var chipStackContribution=uniqueBets[i]}else{var chipStackContribution=uniqueBets[i]-uniqueBets[i-1]}if(i<numUniqueBets-numPotsToFeed){var potNum=potSizes.length-numPotsToFeed}else{var potNum=potSizes.length-numPotsToFeed+i-numUniqueBets+numPotsToFeed}for(var seat=0;seat<currentBets.length;seat++){if(_.isNumber(currentBets[seat])&&currentBets[seat]>=chipStackContribution){splitChipstacksData.push({seatNumber:seat,numChips:chipStackContribution,potNumber:potNum})}}}var temporaryChipstacksToPotNumberIndexIsPotNumber=[];for(var i=0;i<potSizes.length;i++){temporaryChipstacksToPotNumberIndexIsPotNumber.push([])}_.each(_.range(splitChipstacksData.length),function(i){var potNumber=splitChipstacksData[i].potNumber;temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber].push({chips:[]});var splitChipStackInfo={initialX:self.images.seats[splitChipstacksData[i].seatNumber].firstChip.position.x,initialY:self.images.seats[splitChipstacksData[i].seatNumber].firstChip.position.y,hidden:true,update:false};stagesToUpdate.push(self.displayChipStack(parseFloat(splitChipstacksData[i].numChips),temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber].length-1],splitChipStackInfo))});stagesToUpdate.push(this.hideAllBets({update:false}));console.log("displaying array of array of chip parents");console.log(temporaryChipstacksToPotNumberIndexIsPotNumber);for(var i=0;i<temporaryChipstacksToPotNumberIndexIsPotNumber.length;i++){for(var n=0;n<temporaryChipstacksToPotNumberIndexIsPotNumber[i].length;n++){stagesToUpdate.push(self.displayChildren(temporaryChipstacksToPotNumberIndexIsPotNumber[i][n].chips,{update:false}))}}_.each(_.range(temporaryChipstacksToPotNumberIndexIsPotNumber.length),function(potNumber){_.each(_.range(temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber].length),function(stackNumber){var chipArray=temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips;if(_.isArray(chipArray)&&chipArray.length>0){var deltaX=self.images.pots[potNumber].firstChip.position.x-temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips[0].image.x;var deltaY=self.images.pots[potNumber].firstChip.position.y-temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips[0].image.y;_.each(_.range(temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips.length),function(n){var item=temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips[n];allTemporaryItems.push(item);var tempCallBackNumber0=chipIntoPotCallbackNumber;asyncParallelChipIntoPotFunctionArray.push(function(callback){var animationData={time:animationTime,numTicks:ticks,item:item,finalX:deltaX+item.image.x,finalY:deltaY+item.image.y,onEnd:function(animationInfo,tweenInstance){self.hideChildren(animationInfo.item,{update:false});callback(null,tempCallBackNumber0)},onStart:function(){}};self.animateImage(animationData)});chipIntoPotCallbackNumber++})}})});var tempCallBackNumber1=chipIntoPotCallbackNumber;asyncParallelChipIntoPotFunctionArray.push(function(callback){if(numPotsToFeed>0){chipMoveSound.play()}self.updateStages(stagesToUpdate);stagesToUpdate.length=0;callback(null,tempCallBackNumber1)});chipIntoPotCallbackNumber++;function cleanup(){console.log("street ends cleanup function called");self.updatePotSize(potSizes);stagesToUpdate.push(self.hideChildren(allTemporaryItems,{update:false}));self.updateStages(stagesToUpdate)}self.updateStages(stagesToUpdate);stagesToUpdate.length=0;async.series(masterSeriesArray)};this.streetEnds=function(potSizes){$(this.arrayOfParentsOfStageAndOfContainerArray[this.images.betSlider.vertical.position.z.stage].stage.canvas).unbind("mousewheel");var animationTime=200;var ticks=6;var chipIntoPotAnimationArray=[];var callBackNumber=0;var chipMoveSound=createjs.Sound.createInstance(this.images.sources.moveChipsSound);_.each(_.range(self.images.seats.length),function(seatNumber){if(self.images.seats[seatNumber].chips.length>0){console.log("playernumber:"+seatNumber+"size:"+self.images.seats[seatNumber].chips.length)}if(self.images.pots[seatNumber]&&self.images.pots[seatNumber].chips&&self.images.pots[seatNumber].chips.length>0){console.log("potnumber:"+seatNumber+"size:"+self.images.pots[seatNumber].chips.length)}if(self.images.seats[seatNumber].chips&&_.isArray(self.images.seats[seatNumber].chips)&&self.images.seats[seatNumber].chips.length>=1&&self.images.seats[seatNumber].chips[0].image&&self.arrayOfParentsOfStageAndOfContainerArray[self.images.seats[seatNumber].chips[0].position.z.stage].stage.contains(self.images.seats[seatNumber].chips[0].image)){console.log("preparing animation");var animationDistanceX=self.images.pots[0].firstChip.position.x-self.images.seats[seatNumber].firstChip.position.x;var animationDistanceY=self.images.pots[0].firstChip.position.y-self.images.seats[seatNumber].firstChip.position.y;_.each(_.range(self.images.seats[seatNumber].chips.length),function(n){chipIntoPotAnimationArray.push(function(callback){self.hideText(self.images.seats[seatNumber].bet,{update:false});var animationInfo={};animationInfo.item=self.images.seats[seatNumber].chips[n];animationInfo.finalX=self.images.seats[seatNumber].chips[n].position.x+animationDistanceX;animationInfo.finalY=self.images.seats[seatNumber].chips[n].position.y+animationDistanceY;animationInfo.numTicks=ticks;animationInfo.time=animationTime;animationInfo.onEnd=function(){console.log("completed animation of player"+seatNumber+" chipstack and chip number "+n);callback(null,callBackNumber)};self.animateImage(animationInfo)});callBackNumber++})}});async.series([function(next){if(chipIntoPotAnimationArray.length>0){chipMoveSound.play()}async.parallel(chipIntoPotAnimationArray,function(err,results){console.log(results);if(results.length=callBackNumber){console.log("parallel all chips from players moving into pot completed");next(null,1)}else{console.log("error of chipintopot parellel animation is equal to");console.log(err)}})},function(next){self.hideAllBets({update:false});self.updatePotSize(potSizes);if(potSizes.length>1){chipMoveSound.play()}next(null,2)}])};this.updateUserOptionsBasedOnFlagsAndPreactions=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(self.updatePreactionOptionDisplayBasedOnLocalData(options));if(!_.isNumber(self.gameState.userSeatNumber)){stagesToUpdate.push(this.hideSeatedOptions(options));return"display updated based on non seated player"}else{this.images.getChips.image.onClick=self.events.onButtonClick;this.images.standUp.image.onClick=this.events.userStands;stagesToUpdate.push(this.hideChildren(this.images.getChipsDisabledShape,options));stagesToUpdate.push(this.hideChildren(this.images.standUpDisabledShape,options));var user=self.gameState.seats[self.gameState.userSeatNumber];var flags=self.gameState.seats[self.gameState.userSeatNumber].flags;var preactionsAct=self.gameState.seats[self.gameState.userSeatNumber].act;var preactionStreet=self.gameState.seats[self.gameState.userSeatNumber].street;var preactionOnce=self.gameState.seats[self.gameState.userSeatNumber].once;var preactionHand=self.gameState.seats[self.gameState.userSeatNumber].hand;var preactionOptionData=self.getPreactionOptionValues();if(user.sitting_out==true){stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBet,options));stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(this.playerSitsOut(self.gameState.userSeatNumber,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextHand,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextHandOn,options));if(user.notEnoughChips==true){stagesToUpdate.push(self.hideChildren(self.images.sitIn,options));stagesToUpdate.push(self.displayChildren(self.images.rebuy,options))}else{stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));stagesToUpdate.push(self.displayChildren(self.images.sitIn,options))}}else{stagesToUpdate.push(self.hideChildren(self.images.sitIn,options));stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));console.log("checking for flags.pending_sit_out == "+flags.pending_sit_out);if(flags.pending_sit_out==true){stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextHand,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextHandOn,options))}else{stagesToUpdate.push(self.hideChildren(self.images.sitOutNextHandOn,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextHand,options));if(flags.post_blind==false){stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextBlindOn,options))}else{stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextBlind,options))}}if(this.gameState.seats[self.gameState.userSeatNumber].inHand===true){if(this.getPreactionData("fold")){if(preactionOptionData&&preactionOptionData.check===false||this.getPreactionData("check")){stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBet,options));stagesToUpdate.push(self.displayChildren(self.images.foldToAnyBetOn,options))}}else{stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(self.displayChildren(self.images.foldToAnyBet,options))}}}}options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.getPermanentPreferences=function(){$.getJSON("/preferences/1",function(response){console.log("get permanent preferences called, response is: ");console.log(response);if(_.isObject(response)){self.updatePreference(self.permanentPreferences,response.permanentPreferences)}});$};this.saveSessionPreferences=function(){console.log("user seat preference view is:");console.log(self.sessionPreferences.changeUserSeatViewTo.value);socket.emit("set_flag","sessionPreferences",this.sessionPreferences);console.log(this.sessionPreferences)};this.savePermanentPreferences=function(){socket.emit("set_preference","permanentpreferences",this.permanentPreferences)};this.initializeServerPreferenceObjects=function(currentPreferenceObject,createObjectFunction,options){console.log("initializeserver peference called");return null;if(!options){var options={}}if(!_.isNumber(options.maxDepth)){options.maxDepth=3}if(!_.isString(options.currentObjectString)){options.currentObjectString=""}if(options.maxDepth>=0){_.each(currentPreferenceObject,function(element,index,list){console.log(index);if(_.isObject(currentPreferenceObject[index])){if(_.isUndefined(currentPreferenceObject[index].value)&&_.isUndefined(currentPreferenceObject[index].updateValue)){if(options.currentObjectString.length===0){console.log("0 length objectstring triggered");console.log("objectstring: "+options.currentObjectString+" index: "+index);createObjectFunction(index,options);self.initializeServerPreferenceObjects(currentPreferenceObject[index],createObjectFunction,{currentObjectString:index,maxDepth:options.maxDepth-1})}else{console.log("non 0 length objectstring triggered");console.log("objectstring: "+options.currentObjectString+" index: "+index);createObjectFunction(options.currentObjectString+"."+index,options);self.initializeServerPreferenceObjects(currentPreferenceObject[index],createObjectFunction,{currentObjectString:options.currentObjectString+"."+index,maxDepth:options.maxDepth-1})}}}})}};this.updatePreference=function(currentPreferenceObject,newPreferenceObject,options){if(!options){var options={}}if(!_.isNumber(options.maxDepth)){options.maxDepth=4}if(options.maxDepth>=0){_.each(newPreferenceObject,function(element,index,list){if(!_.isUndefined(newPreferenceObject[index])){if(!_.isObject(currentPreferenceObject[index])){currentPreferenceObject[index]={}}if(self.isPreference(newPreferenceObject[index])){var newValue=newPreferenceObject[index].value}else if(!_.isObject(newPreferenceObject[index])){var newValue=newPreferenceObject[index]}else if(_.isObject(newPreferenceObject[index])){var depth=options.maxDepth;options.maxDepth=options.maxDepth-1;self.updatePreference(currentPreferenceObject[index],newPreferenceObject[index],options);options.maxDepth=depth}if(!_.isUndefined(newValue)&&newValue!==currentPreferenceObject[index].value||options.updateEqualValues===true){if(_.isFunction(currentPreferenceObject[index].updateValue)){currentPreferenceObject[index].updateValue(newValue,options)}else if(!_.isUndefined(newPreferenceObject[index].value)){currentPreferenceObject[index].value=newValue}}}})}};this.updateLocalGameDataBasedOnServerPlayerObject=function(player){if(player.is_you==true){self.gameState.userSeatNumber=player.seat}if(_.isObject(player.flags)){var flags=player.flags;self.gameState.seats[player.seat].flags.pending_sit_out=flags.pending_sit_out;self.gameState.seats[player.seat].flags.post_blind=flags.post_blind;var setPreactionDataOptions={server:false};if(!_.isUndefined(flags.check)){this.setPreactionData("hand","bet",flags.check,setPreactionDataOptions)}if(!_.isUndefined(flags.call)){this.setPreactionData("hand","bet",flags.call,setPreactionDataOptions)}if(!_.isUndefined(flags.fold)){this.setPreactionData("hand","bet",flags.fold,setPreactionDataOptions)}if(!_.isUndefined(flags.raise)){this.setPreactionData("hand","bet",flags.raise,setPreactionDataOptions)}if(!_.isUndefined(flags.bet)){this.setPreactionData("hand","bet",flags.bet,setPreactionDataOptions)}}self.gameState.seats[player.seat].sitting_out=player.sitting_out;self.gameState.seats[player.seat].chips=player.chips;self.gameState.seats[player.seat].username=player.username;if(_.isNumber(player.chips)&&player.chips>0){self.gameState.seats[player.seat].notEnoughChips=false}else{self.gameState.seats[player.seat].notEnoughChips=true}};this.updateStages=function(stageNumberLeaveBlankForAll,options){var getStageFamilyArray=function(stageNumber,options){var stageFamilyArray=[];var canvasID=self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.canvas.id;for(var i=0;i<self.arrayOfParentsOfStageAndOfContainerArray.length;i++){if(self.arrayOfParentsOfStageAndOfContainerArray[i].stage.canvas.id===canvasID){stageFamilyArray.push(i)}}return stageFamilyArray};var setStagesUpToDateValueFromArrayFalseByDefault=function(stages,options){if(!options){var options={}}if(options.upToDate!==true&&options.uptoDate!==false){options.upToDate=false}if(_.isNumber(stages)){self.arrayOfParentsOfStageAndOfContainerArray[stages].upToDate=options.upToDate}if(_.isArray(stages)){for(var i=0;i<stages.length;i++){self.arrayOfParentsOfStageAndOfContainerArray[stages[i]].upToDate=options.upToDate}}};var updateStagesFromArray=function(stageArray,options){if(!options){var options={}}if(stageArray.length==0){return}var sortfunction=function(x,y){return x-y};stageArray.sort(sortfunction);var canvasesCleared=[];var stagesUpdated=[];var currentCanvasID=null;for(var i=0;i<stageArray.length;i++){if(self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.canvas.id!==currentCanvasID&&options.clear!==false){currentCanvasID=self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.canvas.id;canvasesCleared.push(currentCanvasID);self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.clear();self.performance.numCanvasClears++;setStagesUpToDateValueFromArrayFalseByDefault(getStageFamilyArray(stageArray[i]))}if(self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].upToDate!==true||options.forceUpdate===true){stagesUpdated.push(stageArray[i]);self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.update();self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].upToDate=true}}if(canvasesCleared.length+stagesUpdated.length>0){var logString="canvases cleared: "+canvasesCleared.toString()+", total cleared: "+self.performance.numCanvasClears+", stages updated: "+stagesUpdated.toString()}};if(!options){var options={}}if(_.isNumber(stageNumberLeaveBlankForAll)){if(this.arrayOfParentsOfStageAndOfContainerArray[stageNumberLeaveBlankForAll].upToDate!==true||options.forceUpdate===true){var stagesToUpdate=getStageFamilyArray(stageNumberLeaveBlankForAll);updateStagesFromArray(stagesToUpdate)}}else if(_.isArray(stageNumberLeaveBlankForAll)){if(stageNumberLeaveBlankForAll.length===0){return"updatestages passed 0 length array as parameter"}var wantToUpdate=[];stageNumberLeaveBlankForAll=_.flatten(stageNumberLeaveBlankForAll);stageNumberLeaveBlankForAll=_.without(stageNumberLeaveBlankForAll,null,undefined,false,true,{});stageNumberLeaveBlankForAll=_.uniq(stageNumberLeaveBlankForAll);for(var i=0;i<stageNumberLeaveBlankForAll.length;i++){if(_.isObject(self.arrayOfParentsOfStageAndOfContainerArray[stageNumberLeaveBlankForAll[i]])){if(self.arrayOfParentsOfStageAndOfContainerArray[stageNumberLeaveBlankForAll[i]].upToDate!==true||options.forceUpdate===true){wantToUpdate.push(getStageFamilyArray(stageNumberLeaveBlankForAll[i]))}}}wantToUpdate=_.flatten(wantToUpdate);wantToUpdate=_.uniq(wantToUpdate);updateStagesFromArray(wantToUpdate)}else{var allStages=[];for(var i=0;i<this.arrayOfParentsOfStageAndOfContainerArray.length;i++){allStages.push(i)}this.updateStages(allStages,options)}};this.animateDealerButton=function(seatNumber,time){console.log("animatedealerbuton called");if(!_.isNumber(seatNumber)||_.isNaN(seatNumber)){console.log("dealer button first chip item");console.log(self.images.pots[0].firstChip);var finalX=self.images.pots[0].firstChip.position.x;
var finalY=self.images.pots[0].firstChip.position.y}else{console.log("setanumber "+seatNumber+" dealer button item");console.log(self.images.seats[seatNumber].dealerButton);var finalX=self.images.seats[seatNumber].dealerButton.position.x;var finalY=self.images.seats[seatNumber].dealerButton.position.y}var animationInfo={item:self.images.dealerButton,finalX:finalX,finalY:finalY,time:time};self.animateImage(animationInfo)};this.displayInitialTableState=function(table_state){var showTable=false;var tickerInterval=5;var ticksPerAnimation=1;var numTicks=0;createjs.Ticker.addEventListener("tick",tick);createjs.Ticker.setInterval(tickerInterval);createjs.Ticker.setPaused(false);var seatsLoaded=[];self.images.imageLoading.title.text.text=self.images.imageLoading.title.text.text+".";this.updateStages(this.images.imageLoading.title.position.z.stage);function tick(event){if(numTicks%ticksPerAnimation==0){self.images.imageLoading.title.text.text=self.images.imageLoading.title.text.text+"."}var updateLoadedSeats=function(){for(var i=0;i<table_state.max_players;i++){if(seatsLoaded[i]!=true){var stageNumber=self.images.seats[i].seat.position.z.stage;var container=self.images.seats[i].seat.position.z.container;if(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(self.images.seats[i].seat.image)||self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(self.images.seats[i].disabledSeat.image)||self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(self.images.seats[i].openSeat.image))seatsLoaded[i]=true}}};var checkSeatsLoaded=function(){for(var i=0;i<table_state.max_players;i++){if(seatsLoaded[i]!=true){return false}}return true};updateLoadedSeats();if(showTable===true){createjs.Ticker.removeEventListener("tick",tick);var parentOfLoadingStage=self.arrayOfParentsOfStageAndOfContainerArray[self.gameState.zPositionData.loadingBackground.stage];parentOfLoadingStage.stage.removeAllChildren();self.updateStages(self.gameState.zPositionData.loadingBackground.stage);console.log("loading canvas now");$(parentOfLoadingStage.stage.canvas).css("display","none");self.activateTicker(50)}console.log("increasing tick");numTicks++}this.displayChildren(this.images.getChips);this.displayChildren(this.images.table);this.displayChildren(this.images.showTableChatFull);this.displayChildren(this.images.standUp);this.displayChildren(this.images.exitTable);this.images.currencyDisplay.text.text="1 chip is equal to "+table_state.currency_per_chip+" "+table_state.currency;if(table_state.currency_per_chip==1&&table_state.currency.charAt(table_state.currency.length-1)=="s"||"S"){this.images.currencyDisplay.text.text=this.images.currencyDisplay.text.text.substring(0,this.images.currencyDisplay.text.text.length-1)}this.displayChildren(this.images.currencyDisplay);this.setNumberOfSeats(table_state.max_players);this.displayAllCommunity(table_state.community);for(var i=0;i<table_state.seats.length;i++){if(table_state.seats[i].is_you==true){this.gameState.userSeatNumber=table_state.seats[i].seat;if(table_state.seats[i].flags&&_.isObject(table_state.seats[i].flags.sessionPreferences)){var sessionPreferences=table_state.seats[i].flags.sessionPreferences;this.updatePreference(this.sessionPreferences,sessionPreferences)}if(_.isObject(table_state.seats[i].userPreferences)){var permanentPreferences=table_state.seats[i].userPreferences;this.updatePreference(this.permanentPreferences,permanentPreferences)}i=9999;this.initializeServerPreferenceObjects(this.sessionPreferences,function(serverString,options){self.saveSessionPreferences(serverString,{})})}}for(var i=0;i<table_state.seats.length;i++){self.playerSits(table_state.seats[i].seat,table_state.seats[i].username,table_state.seats[i].chips);self.updateLocalGameDataBasedOnServerPlayerObject(table_state.seats[i]);if(table_state.seats[i].is_you==true){self.events.rotateSeatsIfNeededAndConfirm();console.log("calling display seated options")}else{if(table_state.seats[i].sitting_out==true){self.playerSitsOut(table_state.seats[i].seat)}}}if(!_.isNumber(this.gameState.userSeatNumber)){this.displayChildren(this.images.getChipsDisabledShape)}for(var i=0;i<table_state.players.length;i=i+1){if(!table_state.players[i].hand||table_state.players[i].hand.length==0){this.displayHiddenCards(table_state.players[i].seat)}else if(table_state.players[i].hand){this.displayHoleCards(table_state.players[i].hand,table_state.players[i].seat)}}var potSizes=[];for(var i=0;i<table_state.pots.length;i++){potSizes[i]=table_state.pots[i].value}if(_.isArray(potSizes)&&potSizes.length>0){this.updatePotSize(potSizes)}for(var i=0;i<table_state.players.length;i=i+1){this.playerPutsChipsInPot(table_state.players[i].seat,table_state.players[i].current_bet,table_state.players[i].chips);this.displayChipStack(table_state.players[i].current_bet,self.images.seats[table_state.players[i].seat])}for(var i=0;i<table_state.max_players;i++){this.displayCorrectSeatMessage(i)}self.gameState.bigBlind=table_state.big_blind;self.gameState.minIncrement=table_state.min_increment;self.gameState.cashier.currency=table_state.currency;self.gameState.cashier.currency_per_chip=table_state.currency_per_chip;this.updateUserOptionsBasedOnFlagsAndPreactions();for(var i=0;i<table_state.messages.length;i++){this.gameState.tableChatFull.log.push(["dealer",table_state.messages[i]]);this.updateTableChatFullMessageTextFromCurrentOrAdditionalData(null,{update:true})}if(table_state.stage_name==="waiting"){var dealerPosition=null}else{var dealerPosition=table_state.dealer}self.animateDealerButton(dealerPosition,24);showTable=true};this.receiveTableState=function(){console.log("receiveTableState called");socket.once("table_state",function(table_state){console.log("one time table_state message received");self.displayInitialTableState(table_state);self.activateSockets()});socket.emit("get_table_state")};this.activateSockets=function(){socket.on("street_ends",function(potSizes){for(var i=0;i<self.images.seats.length;i++){if(self.gameState.seats[i].displayMessageType=="action"||"seat"||"openSeat"||"disabledSeat"){}else{self.gameState.seats[i].displayMessageType="seat"}self.clearExpirationData("street",i)}self.newStreetEnds(potSizes)});socket.on("error",function(errorString,messageInfo){if(messageInfo){}else{var messageInfo={};messageInfo.okay=true}self.displayMessageBox(errorString,messageInfo)});socket.on("player_gets_refund",function(player,betSize,totalPotSize){var stackSize=player.chips;var betSize=betSize;var seatNumber=player.seat;var stagesToUpdate=[];stagesToUpdate.push(self.playerPutsChipsInPot(seatNumber,betSize,stackSize));stagesToUpdate.push(self.updatePotSize(totalPotSize));self.updateStages(stagesToUpdate)});socket.on("community_dealt",function(community){self.dealCommunity(community)});socket.on("dealer_chip",function(seatNumber){self.animateDealerButton(seatNumber,350)});socket.on("hands_dealt",function(players,tableInfo){self.displayChildren(self.images.dealerButton);var playerArray=[];for(var i=0;i<players.length;i++){playerArray.push(players[i].seat)}if(self.gameState.holeCards){self.dealHoleCards(tableInfo.small_blind_seat,playerArray,self.gameState.holeCards);self.displayInHandOptions()}else{self.dealHoleCards(tableInfo.small_blind_seat,playerArray)}});socket.on("pending_sit_out",function(value){if(!_.isNumber(self.gameState.userSeatNumber)){return}self.gameState.seats[self.gameState.userSeatNumber].flags["pending_sit_out"]=value;self.updateUserOptionsBasedOnFlagsAndPreactions()});socket.on("flag_set",function(flag,value){switch(flag){case"pending_sit_out":self.gameState.seats[self.gameState.userSeatNumber].flags.pending_sit_out=value;default:if(flag.indexOf("sessionPreferences")!==-1){self.updatePreference(self.sessionPreferences,value)}else{self.gameState.seats[self.gameState.userSeatNumber].flags[flag]=value;self.setPreactionData("hand",flag,value,{server:false})}}self.updateUserOptionsBasedOnFlagsAndPreactions()});socket.on("hole_cards_dealt",function(hand){self.gameState.holeCards=hand});socket.on("player_acts",function(player,action,pot){var seatNum=player.seat;self.clearExpirationData("act",seatNum);self.playerActs(seatNum,action.toUpperCase(),1.2);if(pot&&action!=="check"){self.updatePotSize(pot)}switch(action.toLowerCase()){case"fold":self.createHoleCardCopyIfNeeded(seatNum);var foldSound=createjs.Sound.createInstance(self.images.sources.foldSound);foldSound.play();self.hideHoleCards(seatNum);self.gameState.seats[seatNum].inHand=false;if(player.seat==self.gameState.userSeatNumber){self.hideChildren(self.images.foldToAnyBet);self.hideChildren(self.images.foldToAnyBetOn)}break;case"check":var checkSound=createjs.Sound.createInstance(self.images.sources.checkSound);checkSound.play();self.gameState.seats[seatNum].inHand=true;break;case"bet":var betSound=createjs.Sound.createInstance(self.images.sources.betSound);betSound.play();self.playerPutsChipsInPot(seatNum,player.current_bet,player.chips);self.gameState.seats[seatNum].inHand=true;break;case"call":var betSound=createjs.Sound.createInstance(self.images.sources.betSound);betSound.play();self.playerPutsChipsInPot(seatNum,player.current_bet,player.chips);self.gameState.seats[seatNum].inHand=true;break;case"raise":var betSound=createjs.Sound.createInstance(self.images.sources.betSound);betSound.play();self.playerPutsChipsInPot(seatNum,player.current_bet,player.chips);self.gameState.seats[seatNum].inHand=true;break;case"post_blind":var betSound=createjs.Sound.createInstance(self.images.sources.betSound);betSound.play();self.playerPutsChipsInPot(seatNum,player.current_bet,player.chips);self.gameState.seats[seatNum].inHand=true;break}self.gameState.seats[seatNum].toAct=false;if(seatNum===self.gameState.userSeatNumber){self.gameState.seats[self.gameState.userSeatNumber].once={};$(self.arrayOfParentsOfStageAndOfContainerArray[self.images.betSlider.vertical.position.z.stage].stage.canvas).unbind("mousewheel")}self.updateUserOptionsBasedOnFlagsAndPreactions()});socket.on("act_prompt",function(actions,timeout){console.log("act prompt received");console.log(actions);self.playerToAct(self.gameState.userSeatNumber,timeout);self.updateUserOptionsBasedOnFlagsAndPreactions();for(var i=0;i<actions.length;i++){if(actions[i].fold!==undefined){if(self.getPreactionData("fold")){socket.emit("act","fold")}}else if(actions[i].check!==undefined){if(self.getPreactionData("check")){socket.emit("act","check")}}else if(actions[i].call){var checkIfCallIsValid=function(value){if(_.isNumber(value)&&value===actions[i].call){return true}};if(self.getPreactionData("call",checkIfCallIsValid)){socket.emit("act","call",actions[i].call);return}}else if(actions[i].raise){var checkIfRaiseIsValid=function(value){if(_.isNumber(value)&&value>=actions[i].raise[0]){return true}};var raisePreactionData=self.getPreactionData("raise",checkIfRaiseIsValid);if(raisePreactionData){socket.emit("act","raise",raisePreactionData.value);return}}else if(actions[i].bet){var checkIfRaiseIsValid=function(value){if(_.isNumber(value)&&value>=actions[i].bet[0]){return true}};var betPreactionData=self.getPreactionData("bet",checkIfRaiseIsValid);if(betPreactionData){socket.emit("act","bet",betPreactionData.value);return}}}for(var i=0;i<actions.length;i++){if(actions[i].fold!==undefined){self.displayButton(self.images.fold,false,["act","fold"])}else if(actions[i].check!==undefined){self.displayButton(self.images.check,false,["act","check"])}else if(actions[i].call){self.images.call.text.text="Call "+actions[i].call;self.displayButton(self.images.call,false,["act","call",actions[i].call])}else if(actions[i].raise){self.displayButton(self.images.raise,"raise to "+actions[i].raise[0],["act","raise",actions[i].raise[0]]);var onClick=self.images.raise.onClick;self.images.raise.onClick=function(event){self.setPreactionData("hand","fold",false);self.setPreactionData("hand","check",false);onClick(event)};self.displayBetSlider(actions[i].raise[0],actions[i].raise[1],1)}else if(actions[i].bet){self.displayButton(self.images.bet,"bet "+actions[i].bet[0],["act","bet",actions[i].bet[0]]);var onClick=self.images.raise.onClick;self.images.bet.onClick=function(event){self.setPreactionData("hand","fold",false);self.setPreactionData("hand","check",false);onClick(event)};self.displayBetSlider(actions[i].bet[0],actions[i].bet[1],1)}}});socket.on("hands_shown",function(players){for(var i=0;i<players.length;i++){self.hideHoleCards(players[i].seat);self.displayHoleCards(players[i].hand,players[i].seat)}});socket.on("update_time_to_act",function(seatNumber,time){self.gameState.seats[seatNumber].timeToActInMS=time});socket.on("hands_shown",function(players){for(var i=0;i<players.length;i++){self.hideHoleCards(players[i].seat);self.displayHoleCards(players[i].hand,players[i].seat)}});socket.on("game_event",function(messageString,timeStampString){var chatObjectForInternalFunctionUse={};chatObjectForInternalFunctionUse.chatSourceType="dealer";chatObjectForInternalFunctionUse.message=messageString;chatObjectForInternalFunctionUse.timeStampString=timeStampString;self.updateTableChatFullMessageTextFromCurrentOrAdditionalData(chatObjectForInternalFunctionUse)});socket.on("player_to_act",function(player,timeout){var timeToCountDown=3e3;if(player.seat!=self.gameState.userSeatNumber){self.playerToAct(player.seat,timeout)}});socket.on("notification",function(notificationString){if(notificationString=="You will sit out as soon as the hand is over."){return null}else if(notificationString.indexOf("chips as soon as the hand is over")!==-1){self.hideCashier()}var chatInfo={};chatInfo.seat=self.gameState.userSeatNumber;chatInfo.message=notificationString;self.displayBubbleChat(chatInfo)});socket.on("user_chats",function(chatInfo){chatInfo.message=chatInfo.message.replace(/^\s+|\s+$/g,"");if(/\S/.test(chatInfo.message)){if(_.isNull(chatInfo.seat)||_.isUndefined(chatInfo.seat)){console.log("observer chatted");var chatObjectForInternalFunctionUse={};chatObjectForInternalFunctionUse.chatSourceType="observer";chatObjectForInternalFunctionUse.message=chatInfo.sender+" (obs) says: "+chatInfo.message;self.updateTableChatFullMessageTextFromCurrentOrAdditionalData(chatObjectForInternalFunctionUse)}else{console.log("seated player chatted");var chatObjectForInternalFunctionUse={};chatObjectForInternalFunctionUse.chatSourceType="player";chatObjectForInternalFunctionUse.message=chatInfo.sender+" says: "+chatInfo.message;self.updateTableChatFullMessageTextFromCurrentOrAdditionalData(chatObjectForInternalFunctionUse);self.displayBubbleChat(chatInfo)}}});socket.on("player_sits_in",function(player){var stagesToUpdate=[];self.gameState.seats[player.seat].flags.pending_sit_out=false;self.gameState.seats[player.seat].sitting_out=false;self.images.seats[player.seat].status.text.text=player.chips;stagesToUpdate.push(self.itemChanged(self.images.seats[player.seat].status));if(player.seat==self.gameState.userSeatNumber){self.updateLocalGameDataBasedOnServerPlayerObject(player)}stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}));self.updateStages(stagesToUpdate)});socket.on("player_sits_out",function(player){var stagesToUpdate=[];stagesToUpdate.push(self.playerSitsOut(player.seat));if(player.seat==self.gameState.userSeatNumber){stagesToUpdate.push(self.updateLocalGameDataBasedOnServerPlayerObject(player,{update:false}));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}))}self.updateStages(self.images.seats[player.seat].status.position.z.stage)});socket.on("player_sits",function(player,is_you){if(is_you==true){self.gameState.userSeatNumber=player.seat;self.events.rotateSeatsIfNeededAndConfirm();socket.emit("get_add_chips_info");self.updateUserOptionsBasedOnFlagsAndPreactions();for(var i=0;i<self.gameState.numSeats;i++){self.displayCorrectSeatMessage(i)}}self.playerSits(player.seat,player.username,player.chips)});socket.on("player_stands",function(player,seatNumber,is_you){if(is_you){self.gameState.userSeatNumber=false;self.hideSeatedOptions();self.changeUserSeatView()}self.playerStands(seatNumber)});socket.on("add_chips_info",function(info){self.displayCashier(info)});socket.on("player_sets_flag",function(player){});socket.on("player_adds_chips",function(player,is_you){var options={};options.update=false;var stagesToUpdate=[];if(is_you==true){player.seat=self.gameState.userSeatNumber}if(player.sitting_out==true){stagesToUpdate.push(self.playerSitsOut(player.seat,options))}else if(player.chips>0){if(self.images.seats[player.seat].status.text.text+""!==player.chips+""){self.images.seats[player.seat].status.text.text=player.chips;stagesToUpdate.push(self.images.seats[player.seat].status.position.z.stage)}}if(is_you){stagesToUpdate.push(self.hideCashier(options));if(player.chips>0){stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));if(player.sitting_out==true){stagesToUpdate.push(self.displayChildren(self.images.sitIn,options))}}}self.updateStages(stagesToUpdate)});socket.on("winners",function(players){for(var i=0;i<self.gameState.seats.length;i++){self.gameState.seats[i].inHand=false;self.gameState.seats[i].toAct=false}self.updateUserOptionsBasedOnFlagsAndPreactions();self.winners(players)});socket.on("reset_table",function(players){var options={};options.update=false;var stagesToUpdate=[];stagesToUpdate.push(self.roundEnds());for(var i=0;i<self.images.seats.length;i++){self.clearExpirationData("act",i);self.clearExpirationData("street",i);self.clearExpirationData("once",i);self.clearExpirationData("hand",i);stagesToUpdate.push(self.hideChildren(self.images.seats[i].hiddenCards,options));stagesToUpdate.push(self.hideChildren(self.images.seats[i].shownCards,options))}stagesToUpdate.push(self.hideChildren(self.images.community,options));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions(options));self.updateStages(stagesToUpdate)})}}jQuery(document).ready(function(){});jQuery(window).load(function(){console.log("window load function claled");holdemCanvas=new Table;holdemCanvas.updatePreference(holdemCanvas.permanentPreferences,holdemCanvas.getPermanentPreferences());holdemCanvas.updatePreference(holdemCanvas.permanentPreferences,holdemCanvas.permanentPreferences,{updateEqualValues:true});holdemCanvas.initializeParent();console.log(document)});