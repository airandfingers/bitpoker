function Table(){var self=this;self.isIframe=function(){if(_.isArray($("#server_values").data("current_table_names"))){return false}else{return true}};self.getPlayZoneLandingPage=function(){if(self.isIframe()){var page=parent}else{var page=window}return page};self.getTableName=function(){return $("#server_values").data("table_name")};self.getIframe=function(){return $(playZoneLandingPage.document).find("#iframe_"+self.getTableName())[0]};var playZoneLandingPage=self.getPlayZoneLandingPage();if(!_.isObject(playZoneLandingPage.sourceObjects)){playZoneLandingPage.sourceObjects={}}this.events={};this.css={noFat:"noFat",unselectable:"unselectable",noTranslate:"notranslate",canvas:"pokerCanvasClass",inline:"inline",messageBoxButton:"messageBoxButton",bootstrapButton:"btn"};this.imageData={maxChipsPerColumn:5,distanceBetweenChipColumns:4,chatBoxAlpha:.75,maxChipColumns:3,numberOfPlayersSet:false,defaultDisplayCSS:"inline"};this.sessionPreferences={displaySize:{value:"desktop",updateValue:function(newValue){this.value=newValue;if(self.sessionPreferences.displaySize=="mobile"){if(!_.isObject(self.permanentPreferences.sourceObjects.value.mobileCards)){self.permanentPreferences.sourceObjects.value.mobileCards={}}self.images.sources.cardImageFolder=self.images.sources.mobileCardFolder;self.permanentPreferences.sourceObjects.value.cardObjectParent=self.permanentPreferences.sourceObjects.value.mobileCards}else{if(!_.isObject(self.permanentPreferences.sourceObjects.value.desktopCards)){self.permanentPreferences.sourceObjects.value.desktopCards={}}self.images.sources.cardImageFolder=self.images.sources.desktopCardFolder;self.permanentPreferences.sourceObjects.value.cardObjectParent=self.permanentPreferences.sourceObjects.value.desktopCards}}},changeUserSeatViewTo:{value:false,updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){self.changeUserSeatView(this.value)}}},tableChatFull:{tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels:{value:true,updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){var movementObject={};movementObject.magnitude=newValue;self.moveTableChatFullMessageText(movementObject)}}},defaultItemsToHideFalseHidesItem:{hideDealerMessages:{value:true,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(null,options)}}},hideDealerMessagesOn:{value:false,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hidePlayerMessages:{value:true,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hidePlayerMessagesOn:{value:false,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hideObserverMessages:{value:true,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},hideObserverMessagesOn:{value:false,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},popOut:{value:true,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}},popOutOn:{value:false,updateValue:function(newValue,options){if(!options){var options={}}var update=options.update;if((newValue===false||this.value===false)&&newValue!==this.value){options.update=true}this.value=newValue;if(self.gameState.itemsCreated===true){self.updateTableChatFullDisplay(options)}}}}}};this.permanentPreferences={confirmSeatRotation:{value:true},defaultFontType:{value:"arial"},sourceObjects:{value:playZoneLandingPage.sourceObjects,updateValue:function(newValue){var newerValue=newValue;if(!_.isObject(newValue)){console.log("permanent preferences creating new playZoneLandingPage.sourceObjects = {}");if(!_.isObject(playZoneLandingPage.sourceObjects)){playZoneLandingPage.sourceObjects={}}var newerValue=playZoneLandingPage.sourceObjects}this.value=newerValue}},bigBlindsPerHorizontalSliderTick:{value:.5},bigBlindsPerMouseScroll:{value:.5},timePerHorizontalSliderTick:{value:500},animate:{value:true},playerChatMaxLines:{value:3},chatTextColor:{value:"#FFFFFF",updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){var stagesToUpdate=[];for(var i=0;i<self.images.seats.length;i++){stagesToUpdate.push(self.easelJSDisplayObjectChanged(self.images.seats[i].chat.text.color=this.value))}self.updateStages(stagesToUpdate)}}},tableChatFull:{chatMessageFontSize:{value:11,updateValue:function(newValue){this.value=newValue;self.jQueryObjects.tableChatFullParagraph.css("font-size",this.value)}},chatMessageFontColor:{value:"white",updateValue:function(newValue){this.value=newValue;self.jQueryObjects.tableChatFullParagraph.css("color",this.value)}},windowColor:{value:"#000000"},windowAlpha:{value:.4,updateValue:function(newValue){this.value=newValue;if(self.gameState.itemsCreated===true){self.updateStages(self.easelJSDisplayObjectChanged(self.images.tableChatFull.window.alpha=this.value))}}}}};this.performance={};this.performance.numCanvasClears=0;var zPositionData={stages:{},canvases:{},containers:{}};zPositionData.stageArray=["staticItems","animatedAndMiddleTableItems","tableChatFull","cashier","initialMessageBox","secondMessageBox","finalMessageBox","loadingScreen"];this.gameState={};this.gameState.itemsCreated=false;this.gameState.defaulttimeToActInMS=15e3;this.gameState.numSeats=10;this.gameState.tableChatFull={log:[],lastDisplayedLogIDNumber:null,currentlyDisplayingDealerMessages:null,currentlyDisplayingPlayerMessages:null,currentlyDisplayingObserverMessages:null,scrollToBasedOnHiddenPixelsAtTopOfChatMessageText:99999999,mouseDown:false,fullTextString:""};this.gameState.betSize=new Number;this.gameState.displaySize="normal";this.gameState.secondsToAct;this.gameState.userSeatNumber=false;this.gameState.act={};this.gameState.street={};this.gameState.once={};this.gameState.hand={};this.gameState.permanent={};this.gameState.seats=[];for(var i=0;i<this.gameState.numSeats;i++){this.gameState.seats[i]={};this.gameState.seats[i].act={};this.gameState.seats[i].once={};this.gameState.seats[i].street={};this.gameState.seats[i].hand={};this.gameState.seats[i].permanent={displayMessageType:"openSeat"}}this.gameState.cashier={};this.gameState.tableChatBox={};this.gameState.messageBox={};var startingContainerIndex=-2;var stageNumberData={};stageNumberData.staticItems=0;stageNumberData.holeCardsAndButtons=stageNumberData.staticItems+1;stageNumberData.animatedAndMiddleTableItems=stageNumberData.holeCardsAndButtons+1;stageNumberData.playerBubbleChat=stageNumberData.animatedAndMiddleTableItems+1;stageNumberData.chatBox=stageNumberData.playerBubbleChat+1;stageNumberData.tableChatFull=stageNumberData.chatBox+1;stageNumberData.cashier=stageNumberData.tableChatFull+1;stageNumberData.messageBox=stageNumberData.cashier+1;stageNumberData.loadingContainers=stageNumberData.messageBox+1;function StageInitializationInfo(stageName,stageNumber,containerArray,stageOptions,canvasOptions,divOptions){var zDataObject=zPositionData;var stageData=zPositionData.stages;var directContainerData=zPositionData.containers;var canvasData=zPositionData.canvases;this.name=stageName;this.stageNumber=stageNumber;this.stageOptions=stageOptions;this.canvasOptions=canvasOptions;this.divOptions=divOptions;if(!_.isArray(containerArray)){console.log(stageName)}this.numContainers=containerArray.length+1;this.containerArray=containerArray;this.containers={};var stageInfo=this;var file1ContainerName=function(name,number){if(_.isObject(directContainerData[name])){directContainerData[name]=false}else if(directContainerData[name]!==false){directContainerData[name]={container:number,stage:stageNumber}}stageInfo.containers[name]=number};_.each(_.range(startingContainerIndex,containerArray.length),function(containerNumber){var value=containerArray[containerNumber];if(_.isString(value)&&value.indexOf(" ")!==-1){value=value.split(" ")}if(_.isArray(value)){_.each(value,function(name,element,newList){file1ContainerName(name,containerNumber)})}else if(_.isString(value)){file1ContainerName(value,containerNumber)}});stageData[stageName]=this;if(stageOptions.newCanvas===true||stageNumber===0){canvasData[stageName]=this}}self.getZData=function(){return zPositionData};var getZ=function(containerNameOrNumber,stageNameOrNumber){var stageObject;var stageNumber;var containerNumber;if(_.isString(containerNameOrNumber)&&_.isObject(zPositionData.containers[containerNameOrNumber])){var z=zPositionData.containers[containerNameOrNumber];return z}else if(!_.isString(stageNameOrNumber)&&!_.isNumber(stageNameOrNumber)){var stageNameOrNumber=containerNameOrNumber;var containerNameOrNumber=0}if(_.isNumber(stageNameOrNumber)){stageNumber=stageNameOrNumber;var stageName=zPositionData.stageArray[stageNumber];stageObject=zPositionData.stages[stageName]}else if(_.isString(stageNameOrNumber)){stageObject=zPositionData.stages[stageNameOrNumber];stageNumber=stageObject.stageNumber}else{throw"incorrect parameter for stage passed on get z: "+stageNameOrNumber}if(_.isString(containerNameOrNumber)){containerNumber=stageObject.containers[containerNameOrNumber]}else if(_.isNumber(containerNameOrNumber)){containerNumber=containerNameOrNumber}else{containerNumber=0}var z={stage:stageNumber,container:containerNumber};if(!_.isNumber(stageNumber)){console.error(stageNameOrNumber);throw""}return z};var createZPositionData=function(){var stageOptionData={};var stageContainers={};var canvasOptionData={};var divOptionData={};var disabledOptions={mouseEnabled:false,enableDOMEvents:false,mouseOverFrequency:0,touchEnabled:false,newCanvas:true};stageOptionData.staticItems={mouseEnabled:true,enableDOMEvents:true,touchEnabled:true,mouseOverFrequency:30,newCanvas:true};stageContainers.staticItems=["table","buttons chat",null,"holeCards","seats","betSlider","bubbleChat",null,"community","dealerChip","chips",null,"chipAnimation",null,"contextMenu",null];stageContainers.staticItems[startingContainerIndex]="background";stageOptionData.animatedAndMiddleTableItems=_.clone(disabledOptions);stageOptionData.animatedAndMiddleTableItems.newCanvas=true;stageContainers.animatedAndMiddleTableItems=["cardAnimation"];divOptionData.animatedAndMiddleTableItems={mouseDisabled:true};stageOptionData.tableChatFull=_.clone(stageOptionData.staticItems);stageContainers.tableChatFull=["background text",null,"buttons",null];divOptionData.tableChatFull={hidden:true};stageOptionData.cashier=_.clone(stageOptionData.staticItems);stageOptionData.cashier.newCanvas=true;stageOptionData.cashier.mouseOverFrequency=30;stageContainers.cashier=["background text",null,"buttons"];divOptionData.cashier={hidden:true};stageOptionData.initialMessageBox=_.clone(stageOptionData.staticItems);stageOptionData.initialMessageBox.newCanvas=true;stageOptionData.initialMessageBox.mouseOverFrequency=0;stageContainers.initialMessageBox=["background text",null,"buttons"];divOptionData.initialMessageBox={hidden:true};stageOptionData.secondMessageBox=_.clone(stageOptionData.staticItems);stageOptionData.secondMessageBox.newCanvas=true;stageOptionData.secondMessageBox.mouseOverFrequency=0;stageOptionData.secondMessageBox.canvasHidden=true;stageContainers.secondMessageBox=["background text",null,"buttons"];divOptionData.secondMessageBox={hidden:true};stageOptionData.finalMessageBox=_.clone(stageOptionData.staticItems);stageOptionData.finalMessageBox.newCanvas=true;stageOptionData.finalMessageBox.mouseOverFrequency=0;stageOptionData.finalMessageBox.canvasHidden=true;stageContainers.finalMessageBox=["background text",null,"buttons"];divOptionData.finalMessageBox={hidden:true};stageOptionData.loadingScreen=_.clone(disabledOptions);stageOptionData.loadingScreen.newCanvas=true;stageContainers.loadingScreen=["background text",null,"animation"];var stageOrder=zPositionData.stageArray;_.each(stageOrder,function(stageName,stageNumber,list){var initializeStage=new StageInitializationInfo(stageName,stageNumber,stageContainers[stageName],stageOptionData[stageName],canvasOptionData[stageName],divOptionData[stageName])})};this.jQueryObjects={};this.jQueryObjects.pokerTableDiv=$("#pokerTableWrapper");this.jQueryObjects.canvasDiv=$("#pokerCanvasDiv");this.jQueryObjects.tableChatFullDiv=$("#tableChatFullTextDiv");this.jQueryObjects.tableChatFullParagraph=$("#tableChatFullText");this.jQueryObjects.chatBoxInput=$("#chat");this.jQueryObjects.cashierForm=$("#cashier");this.gameState.stageData=[];this.arrayOfParentsOfStageAndOfContainerArray=[];this.images={};this.images.sourceObjects={};this.images.sourceObjects.mobileCards={};this.images.sourceObjects.desktopCards={};this.images.sourceObjects.cardObjectParent={};this.images.sources={cardBackFileNameWithoutExtension:"back",cardSpriteFileNameWithoutExtension:"sprite",background:"img/background images/dark/Map1280x800.jpg",table:"img/jpoker_table.png",dealerButton:"img/dealer_button_red.png",verticalSlider:"img/raise_slider.png",horizontalSlider:"img/small_slider_bg.png",cashierBackground:"img/cashier_background.png",cashierCloseX:"img/cashier_close_window_x.jpg",cashierButton:"img/cashier.png",cashierButtonOver:"img/cashier_over.png",cashierButtonPress:"img/cashier_press.png",cashierButtonSprite:"img/cashier_button_sprite.png",getChips:"img/get_chips.png",showTableChatFull:"img/show_chat.png",hideTableChatFull:"img/hide_chat.png",standUp:"img/stand_up.png",exitTable:"img/exit_table.png",messageBoxBackground:"img/message_box.png",messageBoxCloseX:"img/message_box_close_window_x.jpg",checkBox:"img/check_box.png",checkBoxChecked:"img/check_box_clicked.png",dealHoleCardSound:"sound/deal_hole_card.wav",checkSound:"sound/check.wav",betSound:"sound/bet.wav",shuffleSound:"sound/shuffle.wav",dealCommunity:"sound/deal_community.wav",foldSound:"sound/fold.wav",toActAlertSound:"sound/80921__justinbw__buttonchime02up.wav",failClickSound:"sound/fail_click.mp3",actionButtonClickSound:"sound/action_button_click.mp3",moveChipsSound:"sound/move_chips.wav",chips:{red:"img/chips/red_chip.png",black:"img/chips/black_chip.png",10:"img/chips/10.png"},mobileCardFolder:"img/fourcolordeck/resize/",desktopCardFolder:"img/fourcolordeck/"};this.images.background={};this.images.pots=[];for(var i=0;i<9;i++){this.images.pots[i]={};this.images.pots[i].potSize={text:{}};this.images.pots[i].chips=[];this.images.pots[i].firstChip={};this.images.pots[i].secondChip={};this.images.pots[i].secondColumnChip={}}this.images.totalPotSize={};this.images.fold={text:{},messages:[]};this.images.call={text:{},messages:[]};this.images.bet={text:{},messages:[]};this.images.raise={text:{},messages:[]};this.images.bet={text:{},messages:[]};this.images.check={text:{},messages:[]};this.images.betSlider={};this.images.cashier={};this.images.messageBox=[];this.images.community=[{},{},{},{},{}];this.images.leftSideButtons=[];this.images.rightSideButtons=[];for(var i=0;i<3;i=i+1){this.images.leftSideButtons[i]={};this.images.rightSideButtons[i]={}}this.images.seats=[];for(var i=0;i<this.gameState.numSeats;i=i+1){this.images.seats[i]={};this.images.seats[i].nonRotatedSeatNumber=i;this.images.seats[i].originalSeatNumber=i;this.images.seats[i].rotatedSeatNumber=i;this.images.seats[i].seat={};this.images.seats[i].bet={};this.images.seats[i].chips=[];this.images.seats[i].firstChip={};this.images.seats[i].secondChip={};this.images.seats[i].secondColumnChip={};this.images.seats[i].messages=[];this.images.seats[i].hiddenCards=[];this.images.seats[i].shownCards=[];this.images.seats[i].dealerButton={}}this.images.Item=function(x,y,width,height,zIndexOrStageAndContainerObject,options){this.position={};this.position.x=x;this.position.y=y;this.position.z={};if(!_.isObject(zIndexOrStageAndContainerObject)){throw"z data not given for Item constructor"}if(_.isObject(zIndexOrStageAndContainerObject)){this.position.z=zIndexOrStageAndContainerObject}else if(_.isNumber(zIndexOrStageAndContainerObject)&&zIndexOrStageAndContainerObject>=0){for(var i=0;i<=zIndexOrStageAndContainerObject;i++){for(var stageNumber=0;stageNumber<self.arrayOfParentsOfStageAndOfContainerArray.length;stageNumber++){if(i+self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers.length<zIndexOrStageAndContainerObject){i=i+self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers.length}else{this.position.z.stage=stageNumber;this.position.z.container=zIndexOrStageAndContainerObject-i}}}}this.size={};this.size.x=width;this.size.y=height;if(options){if(options.messages){this.messages=options.messages}}this.getOrSetCreateJSEvents=function(whatToDo,childType,eventType,performOnEvent){if(!_.isString(childType)){this.createjsEvents={};this.createjsEvents.image={};this.createjsEvents.text={}}else if(!_.isString(eventType)){this.createjsEvents[childType]={}}else if(!_.isUndefined(performOnEvent)){if(whatToDo==="set"){if(!_.isArray(this.createjsEvents[childType][eventType])){this.createjsEvents[childType][eventType]=[performOnEvent]}else{this.createjsEvents[childType][eventType].push(performOnEvent)}}else if(whatToDo==="get"||"remove"){var result;if(_.isArray(this.createjsEvents[childType][eventType])){this.createjsEvents[childType][eventType]=_.uniq(this.createjsEvents[childType][eventType]);var eventResponses=this.createjsEvents[childType][eventType];var result=_.indexOf(eventResponses,performOnEvent);if(result==-1){result=false}if(_.isNumber(result)&&whatToDo==="remove"){eventResponses[result]=null;console.log("removed 1 function wtih off function")}}return result}}else{if(_.isArray(this.createjsEvents[childType][eventType])){this.createjsEvents[childType][eventType]=_.uniq(this.createjsEvents[childType][eventType])}if(whatToDo==="set"){if(_.isArray(this.createjsEvents[childType][eventType])){this.createjsEvents[childType][eventType].length=0}}else if(whatToDo==="get"){return this.createjsEvents[childType][eventType]}else if(whatToDo==="function"){var item=this;return function(e){var eventResponses=item.createjsEvents[childType][eventType];if(_.isArray(eventResponses)){_.each(eventResponses,function(value,element){if(_.isFunction(value)){value(e)}})}}}}};this.getOrSetCreateJSEvents();this.drawRoundedRectangle=function(fillColor){this.image.graphics.beginFill(fillColor).drawRoundRect(0,0,this.size.x,this.size.y,this.size.y*.1)}};this.images.Item.prototype.removeChild=function(imageOrText,options){var stagesToUpdate=[];if(!options){var options={}}var item=this;var removeChild=function(textOrImageString){if(!item[textOrImageString]){return}console.log("removechild removing object of type = "+textOrImageString);if(_.isElement(item[textOrImageString])){$(item[textOrImageString]).remove();console.log("child of type = "+textOrImageString+" removed");var child=item[textOrImageString];item[textOrImageString]=null}else if(item[textOrImageString]instanceof createjs.DisplayObject){if(textOrImageString==="text"){stagesToUpdate.push(self.hideText(item,{update:false}))}else if(textOrImageString==="image"){console.log("REMOVING EASELJS CHILD IMAGE");stagesToUpdate.push(self.hideImage(item,{update:false}))}else{throw"incorrect parameter passed to eliminate "+textOrImage}}item[textOrImageString]=null};if(imageOrText==="text"||imageOrText==="image"){removeChild(imageOrText)}else{removeChild("text");removeChild("image")}if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.images.Item.prototype.addBootstrapButton=function(buttonText,bootstrapButtonOptions){if(!bootstrapButtonOptions){var bootstrapButtonOptions={}}var options=_.clone(bootstrapButtonOptions);if(_.isObject(options.css)){options.css=_.clone(options.css)}else{options.css={}}if(_.isObject(options.attr)){options.attr=_.clone(options.attr)}else{options.attr={}}if(!options.class){options.class=""}options.update=false;var defaultOptions={disableContextMenu:true};options=_.defaults(options,defaultOptions);var defaultAttr={"data-loading-text":buttonText,type:"button"};options.attr=_.defaults(options.attr,defaultAttr);var defaultCSS={"text-align":"center"};var newButton=$("<button>").addClass(self.css.unselectable+" "+self.css.bootstrapButton);newButton.html(buttonText);this.addElement(newButton[0],"image",options)};this.images.Item.prototype.updateChildLocationAndSize=function(options){if(!options){var options={}}var positionOptions=_.clone(options);var defaultOptions={size:true};positionOptions=_.defaults(positionOptions,defaultOptions);var asdf=self.positionItemImage(this,positionOptions);return asdf};this.images.Item.prototype.updateImageLocationAndSize=function(options){if(!options){var options={}}var positionOptions=_.clone(options);var defaultOptions={size:true};positionOptions=_.defaults(positionOptions,defaultOptions);var asdf=this.positionChild("image",positionOptions);return asdf};var isImage=function(src){if(_.isObject(src)&&src.src){return true}else{return false}};this.images.Item.prototype.addBitmap=function(source,options){var stagesToUpdate=[];var addItemBitmap=function(item,source,options){if(!options){var options={}}else{var options=_.clone(options)}if(options.size!==false){options.size=true}var update=options.update;options.update=false;if(!_.isFunction(options.callback)){options.callback=options.onload}options.onload=function(img){console.log("bitmap loaded through string image onload called");return stagesToUpdate.push(restOfFunction(img))};var restOfFunction=function(source){if(options.html!=true){var bitmap=new createjs.Bitmap(source);if(options.sourceRect instanceof createjs.Rectangle){bitmap.sourceRect=options.sourceRect}else if(options.sourceRect){throw"source rectangle not appropriate Rectangel instance for addBitmap"}stagesToUpdate.push(item.adoptChild(bitmap,"image",options));stagesToUpdate.push(item.positionChild("image",options))}else{var bitmap=$("<img />");bitmap.addClass(self.css.noFat);if(!_.isObject(options.attr)){options.attr={}}if(!_.isObject(options.css)){options.css={}}if(!_.isString(options.class)){options.class=""}options.class=options.class;options.attr.src=source.src;item.addElement(bitmap[0],"image",options)}stagesToUpdate.push(self.easelJSDisplayObjectChanged(item));options.update=update;if(_.isFunction(options.callback)){stagesToUpdate.push(options.callback(source))}if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};if(_.isString(source)){options.update=undefined;var tempImage=self.saveImageToParent(source,options)}else if(isImage(source)){var tempImage=source;if(tempImage.complete){restOfFunction(tempImage)}else{console.log("addbitmap passed image object that has not finished loading as parameter");console.log(source);var imageLoad=imagesLoaded(tempImage);options.update=undefined;imageLoad.on("done",function(instance){restOfFunction(tempImage)})}}if(!isImage(tempImage)){console.log("itemAsBitmap passed non source paramater");console.log(source instanceof playZoneLandingPage.window.Image);console.log(source);throw""}return stagesToUpdate};return addItemBitmap(this,source,options)};this.images.cardAsBitmap=function(item,card,options){if(!options){var options={}}var stagesToUpdate=[];if(self.sessionPreferences.displaySize.value!=="mobile"){var sourceParent=self.permanentPreferences.sourceObjects.value.cardObjectParent}else{var sourceParent=self.permanentPreferences.sourceObjects.value.cardObjectParent}if(_.isObject(card)){var source=card}else if(!_.isString(card)||card===""){var card="back"}if(_.isString(card)){var animationData=sourceParent.spriteSheet.getAnimation(card);var frame=sourceParent.spriteSheet.getFrame(animationData.frames[0]);var source=frame.image;options.sourceRect=frame.rect}stagesToUpdate.push(item.addBitmap(source,options));if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.images.itemAsRectangle=function(item,fillColor){var rect=new createjs.Shape;item.adoptChild(rect,"image");self.positionItemImage(item,{update:false});item.drawRoundedRectangle(fillColor);item.fillColor=fillColor};this.images.drawSeat=function(parent,borderColor,fillColor,middleDividerColor,seatOptions){if(!seatOptions){var options={}}else{var options=_.clone(seatOptions)}if(parent.image instanceof createjs.Shape!=true){var asdfShape=new createjs.Shape;parent.adoptChild(asdfShape,"image")}else{parent.image.graphics.clear()}if(_.isNumber(options.outerStrokeWidth)){var outerStrokeWidth=options.outerStrokeWidth}else{var outerStrokeWidth=2}if(_.isNumber(options.middleDividerStrokeWidth)){var middleDividerStrokeWidth=options.middleDividerStrokeWidth}else{var middleDividerStrokeWidth=1}var x=outerStrokeWidth/2;var y=outerStrokeWidth/2;var width=parent.size.x-outerStrokeWidth;var height=parent.size.y-outerStrokeWidth;parent.image.alpha=1;parent.image.snapToPixel=true;parent.image.graphics.setStrokeStyle(outerStrokeWidth,"round").beginStroke(borderColor).beginFill(fillColor).drawRect(x,y,width,height);if(options&&options.borderFillRatio&&_.isNumber(options.borderFillRatio)&&options.borderFillRatio>0){if(options&&options.newFillColor){var newFillColor=options.newFillColor}else{newFillColor="#FFFF00"}parent.image.graphics.setStrokeStyle(outerStrokeWidth,"square").beginStroke(newFillColor);var totalDistance=width*2+height*2;var distanceToFill=options.borderFillRatio*totalDistance;parent.image.graphics.moveTo(x,y);if(distanceToFill>=height){parent.image.graphics.lineTo(x,y+height);distanceToFill=distanceToFill-height}else if(distanceToFill>0){parent.image.graphics.lineTo(x,y+distanceToFill);distanceToFill=0}if(distanceToFill>=width){parent.image.graphics.lineTo(x+width,y+height);distanceToFill=distanceToFill-width}else if(distanceToFill>0){parent.image.graphics.lineTo(x+distanceToFill,y+height);distanceToFill=0}if(distanceToFill>=height){parent.image.graphics.lineTo(x+width,y);distanceToFill=distanceToFill-height}else if(distanceToFill>0){parent.image.graphics.lineTo(x+width,y+height-distanceToFill);distanceToFill=0}if(distanceToFill>=width){parent.image.graphics.lineTo(x,y);distanceToFill=distanceToFill-width}else if(distanceToFill>0){parent.image.graphics.lineTo(x+width-distanceToFill,y);distanceToFill=0}}parent.image.graphics.setStrokeStyle(middleDividerStrokeWidth).beginStroke(middleDividerColor);parent.image.borderColor=borderColor;parent.image.fillColor=fillColor;parent.image.middleDividerColor=middleDividerColor;parent.image.outerStrokeWidth=outerStrokeWidth;parent.image.middleDividerStrokeWidth=middleDividerStrokeWidth;self.positionItemImage(parent,{update:false});parent.image.setBounds(0,0,parent.size.x,parent.size.y);return self.easelJSDisplayObjectChanged(parent)};this.images.Item.prototype.addText=function(text,sizeAndFont,color,options){var addItemText=function(item,text,sizeAndFont,color,textOptions){if(!textOptions){var options={}}else{var options=_.clone(textOptions)}if(options.html!==true){if(item.text instanceof createjs.Text!==true){item.text=new createjs.Text("","","")}item.text.text=text;item.text.color=color;item.text.font=sizeAndFont;if(options.textAlign==="left"){item.text.x=item.position.x;item.text.textAlign=options.textAlign}else{item.text.x=item.position.x+item.size.x/2;item.text.textAlign="center"}if(options.centerTextY!==false){var textHeight=item.text.getMeasuredHeight();var textY=item.position.y+(item.size.y-textHeight)/2}else{textY=item.position.y+1}if(textY<item.position.y){textY=item.position.y}item.text.y=textY;item.text.baseline="top";item.text.maxWidth=item.size.x;item.textColor=color;assignObjectPropertiesAsPropertiesOfDisplayObject(item.text,options);return self.easelJSDisplayObjectChanged(item)}else{if(!_.isObject(options.css)){options.css={}}else{options.css=_.clone(options.css)}if(_.isUndefined(options.size)){options.size=true}if(_.isUndefined(options.position)){options.position=true}var x=item.position.x;var y=item.position.y;var width=item.size.x;var height=item.size.y;if(!_.isNumber(options.numLines)){options.numLines=1}var lineHeight=height/options.numLines+"px";var cssDefaults={"line-height":lineHeight,width:item.size.x,height:item.size.y,font:sizeAndFont,color:color,"text-align":"center","pointer-events":"none",display:"none","font-weight":400};options.css=_.defaults(options.css,cssDefaults);if(_.isString(options.textAlign)){options.css["text-align"]=options.textAlign}var newText=$("<p>").addClass(self.css.unselectable+" "+self.css.noFat);newText.html(text);item.addElement(newText[0],"text",options)}};return addItemText(this,text,sizeAndFont,color,options)};this.events.buttonMouseDown=function(event){if(event.target instanceof createjs.Shape){event.target.graphics.clear();event.target.graphics.beginFill("red").drawRoundRect(0,0,event.target.parentItem.size.x,event.target.parentItem.size.y,event.target.parentItem.size.y*.15);event.target.parentItem.text.y=event.target.parentItem.text.y+2;self.updateStages(event.target.parentItem.position.z.stage);event.onMouseUp=function(event){event.target.graphics.clear();event.target.graphics.beginFill(event.target.parentItem.fillColor).drawRoundRect(0,0,event.target.parentItem.size.x,event.target.parentItem.size.y,event.target.parentItem.size.y*.15);event.target.parentItem.text.y=event.target.parentItem.text.y-2;self.updateStages(event.target.parentItem.position.z.stage)}}};this.events.onEaselJSChildClick=function(e){console.log(e);var item=e.target.parentItem;if(item instanceof self.images.Item!=true){return}if(e.target.id===item.image.id){var childType="image"}else if(e.target.id===item.text.id){var childType="text"}if(!_.isString(childType)){console.log(e);throw""}if(e.nativeEvent.button!=2){console.log(item.getOrSetCreateJSEvents("get",childType,"click"));var asdf=item.getOrSetCreateJSEvents("function",childType,"click");asdf(e)}else{console.log(item.getOrSetCreateJSEvents("get",childType,"contextmenu"));var asdf=item.getOrSetCreateJSEvents("function",childType,"contextmenu");console.log(asdf);asdf(e)}};this.events.onButtonClick=function(event){if(event.target.parentItem.messages){var messages=event.target.parentItem.messages;if(!_.isArray(messages[0])){console.log(messages);socket.emit.apply(socket,messages)}else{for(var i=0;i<messages.length;i++){console.log([messages[i]]);socket.emit.apply(socket,messages[i])}}}};this.events.foldToAnyBetClick=function(event){self.setPreactionData("hand",["check","fold"],true,{server:true})};this.events.foldToAnyBetOnClick=function(event){self.setPreactionData("hand",["check","fold"],false,{server:true})};this.events.cashierTextFieldFocused=function(event){$(event.target).one("mouseup",function(e){e.preventDefault()}).select()};this.events.cashier=function(event){var validate;var keycode;var updateValue;var selectTextBox;if(event.type==="keydown"||event.type==="keyup"){var keycode=event.keyCode?event.keyCode:event.which}if(!_.isObject(event.originalEvent)||!_.isElement(event.originalEvent.target)||event.target.id===event.originalEvent){var originalEvent=event
}else{var originalEvent=event.originalEvent}var jQueryTarget=$(originalEvent.target);var jQueryParentDiv=jQueryTarget.parent();var jQueryTextBox=jQueryParentDiv.children("input[type='text']");parentDivID=jQueryParentDiv.attr("id");if(event.type==="keydown"&&keycode===27){self.hideCashier();jQueryTarget.one("keyup",function(e){return false});return false}else if(event.type==="mousedown"){var focusTextBox=true;if(parentDivID!=="autoRebuyDiv"){jQueryParentDiv.children("input[type='radio']").prop("checked",true)}}else if(event.type==="focus"||event.type==="mousedown"){selectTextBox=true}else if(event.type==="focusout"){validate=true;updateValue=true}else if(event.type==="keyup"&&keycode===13){validate=true;updateValue=true}else if(event.type==="input"){validate=true;updateValue=false}else if(event.type==="keydown"&&keycode===13){var preventDefault=function(e){return false};jQueryTarget.on("keydown.preventDefault",preventDefault);jQueryTarget.one("keyup",function(e){jQueryTarget.off("keydown.preventDefault",preventDefault)});var shouldSubmit=validateCashierDisplayBasedOnUserInput(false);if(shouldSubmit===true){if(parentDivID==="maxDiv"||parentDivID==="otherAmountDiv"){$(self.images.cashier.addChips.image).trigger("click")}else{$(self.images.cashier.enableAutoRebuy.image).trigger("click")}}}if(validate){if(validateCashierDisplayBasedOnUserInput(updateValue)!==true&&updateValue===true){selectTextBox=true}}if(selectTextBox){if(event.type==="mousedown"){var preventEventType="mouseup"}else if(event.type==="keydown"){var preventEventType="keyup"}else{preventEventType="mouseup"}console.log("preventing one of type: "+preventEventType);if(_.isString(preventEventType)){jQueryTextBox.one(preventEventType,function(e){return false})}jQueryTextBox.select()}if(focusTextBox){jQueryTextBox.trigger("focus")}};var validateCashierDisplayBasedOnUserInput=function(updateValue){var acceptableValues=true;var maxTextBox=$(self.images.cashier.maxAmount.image);var otherAmountTextBox=$(self.images.cashier.otherAmount.image);var autoRebuyTextBox=$(self.images.cashier.autoRebuyAmount.image);var cashierData=self.gameState.cashier;console.log(cashierData);var otherAmountValue=parseInt(otherAmountTextBox.val());if(_.isNaN(otherAmountValue)||otherAmountValue<cashierData.min){acceptableValues=false;$(self.images.cashier.addChips.image).button("loading");if(updateValue===true){otherAmountTextBox.val(cashierData.min)}}else{$(self.images.cashier.addChips.image).button("reset")}var autoRebuyValue=parseInt(autoRebuyTextBox.val());if(_.isNaN(autoRebuyValue)||autoRebuyValue<cashierData.table_min){acceptableValues=false;$(self.images.cashier.enableAutoRebuy.image).button("loading");if(updateValue===true){autoRebuyTextBox.val(cashierData.table_min)}}else{$(self.images.cashier.enableAutoRebuy.image).button("reset")}return acceptableValues};this.events.cashierInputChanged=function(event){};this.events.cashierInputSelected=function(event){var min;var allRadios=$(event.target.parentElement.parentElement).find("input[type='radio']");var parentID=false;if(event.target.parentElement.id=="otherAmountDiv"){min=self.gameState.cashier.min;parentID=event.target.parentElement.id}else if(event.target.parentElement.id=="autoRebuyDiv"){min=self.gameState.cashier.table_min;parentID=event.target.parentElement.id}else if(event.target.parentElement.id=="maxDiv"){min=self.gameState.cashier.max;parentID=event.target.parentElement.id}if(parentID){var radioInClickedDiv=$("#"+parentID).find("input[type='radio']");if(radioInClickedDiv&&radioInClickedDiv.prop("checked")===false){allRadios.prop("checked",false);radioInClickedDiv.prop("checked",true)}var textField=$(event.target.parentElement).find("input[type='text']");var alreadySelected=false;if(typeof parseFloat(textField.val())=="number"&&parseFloat(textField.val())>=min){}else{textField.val(min)}if($(event.target).is("input[type='text']")){}else if(alreadySelected!=true){textField.select()}textField.focus()}};this.events.onCashierTextFieldFocus=function(event){$(event.target).one("mouseup",function(event){event.preventDefault()}).select()};this.events.onAddChipsClick=function(event){var info={};info.okay=true;info.html=true;info.style="qtip-youtube";if($("#maxRadio").is(":checked")){socket.emit("add_chips",self.gameState.cashier.max,self.initial_table_state.currency)}else if($("#otherAmountRadio").is(":checked")){var amount=$("#otherAmount").val();if(isNaN(amount)){var message="amount must be a number";messageBoxAPI.display(message,info)}else{socket.emit("add_chips",Number(amount),self.initial_table_state.currency)}}else if($("#autoRebuyRadio").is(":checked")){var amount=$("#autoRebuy").val();if(isNaN(otherAmount)){var message="Amount must be a number";messageBoxAPI.display(message,info)}else{socket.emit("auto_rebuy",Number(amount),self.initial_table_state.currency)}}else if(!$("input[name='addChipsRadio']:checked").val()){var info={};info.okay=true;var message="Please select either: max, other amount, or auto-rebuy";messageBoxAPI.display(message,info)}};this.events.onStagePress=function(event){$(":text").blur()};this.events.mouseDownClickAndDrag=function(event,options){if(!options){var options={}}var defaultOptions={};defaultOptions.permanent=false;defaultOptions.movementType="relative";if(event.target.parentItem instanceof self.images.Item){defaultOptions.animationTarget=event.target.parentItem}_.defaults(options,defaultOptions);var initialX=event.stageX;var initialY=event.stageY;event.onMouseMove=function(e){var moveX=e.stageX-initialX;var moveY=e.stageY-initialY;initialX=initialX+moveX;initialY=initialY+moveY;self.setImageItemPositionAndTextBasedOnImageChange(options.animationTarget,moveX,moveY,options)}};this.events.seatMouseEvent=function(event,options){if(!options){var options={}}var defaults={};if(_.isObject(event.target.parentItem)&&_.isObject(event.target.parentItem.seatObjectAncestor)){defaults.seatObject=event.target.parentItem.seatObjectAncestor;defaults.seatNum=defaults.seatObject.nonRotatedSeatNumber;defaults.animationTime=600}options=_.defaults(options,defaults);if(!_.isNumber(options.seatNum)){console.log("error");console.log(event);console.log(options);console.log(defaults)}var animationTime=options.animationTime;var seatObject=options.seatObject;var seatNum=options.seatNum;var getHoleCardAnimationArray=function(){return self.gameState.seats[seatNum].hand.holeCardsPopupAnimation};var animationBottomY=seatObject.seat.position.y;var animationTopY=seatObject.hiddenCards[0].position.y;var animationDistanceY=animationTopY-animationBottomY;if(animationDistanceY<0){animationDistanceY=animationDistanceY*-1}var animationSpeed=animationDistanceY/animationTime;var seatBottomY=seatObject.seat.position.y+seatObject.seat.size.y;var displayedAnimationArray=false;var getAnimationDirection=function(){return self.gameState.seats[seatNum].hand.holeCardAnimationDirection};var setAnimationDirection=function(direction){self.gameState.seats[seatNum].hand.holeCardAnimationDirection=direction};var killCheckingFunction=function(){if(self.gameState.seats[seatNum].checkingForFoldedHoleCardAnimation){clearInterval(self.gameState.seats[seatNum].checkingForFoldedHoleCardAnimation)}};var getPreviousCheckingFunctionEvent=function(){return self.gameState.seats[seatNum].hand.checkingForFoldedHoleCardAnimationEvent};var storeEvent=function(){event.options=options;self.gameState.seats[seatNum].hand.checkingForFoldedHoleCardAnimationEvent=event};var setCorrectEventAndOptions=function(){var useCurrentEvent=false;var previousEvent=getPreviousCheckingFunctionEvent();if(!_.isObject(previousEvent)){return false}var isSeatMouseEvent=event.target.id===seatObject.seat.image.id;var isPreviousEventSeatMouseEvent=previousEvent.target.id===previousEvent.options.seatObject.seat.image.id;var areBothEventsSameTarget=event.target.id===previousEvent.target.id;var areBothEventsRelatedToTheSameSeat=seatNum===previousEvent.options.seatNum;if(areBothEventsSameTarget===true||event.type===previousEvent.type||areBothEventsRelatedToTheSameSeat===false||event.type!=="mouseover"&&event.type!=="mouseout"||previousEvent.type!=="mouseover"&&previousEvent.type!=="mouseout"||isPreviousEventSeatMouseEvent===true&&isSeatMouseEvent===true){useCurrentEvent=true}else if(event.type==="mouseover"){useCurrentEvent=true}else{useCurrentEvent=false}if(useCurrentEvent===false){event=previousEvent;options=previousEvent.options}};setCorrectEventAndOptions();storeEvent();killCheckingFunction();if(event.type==="mouseover"){animateUp();keepChecking()}else if(event.type==="mouseout"){animateDown()}event.onMouseMove=function(event){console.log("onmousemove called");animateUp()};event.onMouseOut=function(event){console.log("mouseout")};function keepChecking(){killCheckingFunction();var interval=100;var isSeatMouseEvent=event.target.id===seatObject.seat.image.id;self.gameState.seats[seatNum].checkingForFoldedHoleCardAnimation=setInterval(function(){console.log("animation direction is: "+getAnimationDirection());if(getAnimationDirection()===("bottom"||"up"||"down")){killCheckingFunction()}else{console.log("checking to see if we should animate");if(shouldAnimate()===true){if(isSeatMouseEvent===true){console.log("shouldanimate = true, eventtype is: "+event.type+" isseatmouseevent = "+isSeatMouseEvent);killCheckingFunction();self.events.seatMouseEvent(event,options)}}else{console.log("shouldAnimate = false, ending hole card popup animations");console.log("eventtype is: "+event.type+" isseatmouseevent = "+isSeatMouseEvent);endAnimations();if(event.type!=="mouseover"||isSeatMouseEvent!==true){killCheckingFunction()}}}},interval)}function animateUp(){var animationInfoArray=[];if(getAnimationDirection()==="top"){return false}if(getAnimationDirection()==="up"){return false}var holeCardAnimationArray=getHoleCardAnimationArray();if(!_.isArray(holeCardAnimationArray)){console.log("animateup stopped cuz no cards");return false}console.log("animating up "+getAnimationDirection());setAnimationDirection("up");_.each(_.range(holeCardAnimationArray.length),function(cardNumber){animationInfoArray[cardNumber]={item:holeCardAnimationArray[cardNumber],finalY:animationTopY,onTick:onAnimationTick,animationTime:(holeCardAnimationArray[cardNumber].image.y-animationBottomY)/animationSpeed,onEnd:function(){keepChecking();setAnimationDirection("top")},onStart:function(animationInfo){displayedAnimationArray=holeCardAnimationArray;cropCardImages();self.displayChildren(animationInfo.item)}}});_.each(_.range(holeCardAnimationArray.length),function(cardNumber){self.animateImage(animationInfoArray[cardNumber])})}function animateDown(){var animationInfoArray=[];if(getAnimationDirection()!=="top"&&getAnimationDirection()!=="up"){return false}var holeCardAnimationArray=getHoleCardAnimationArray();if(!_.isArray(holeCardAnimationArray)){return false}setAnimationDirection("down");console.log("animating down");_.each(_.range(holeCardAnimationArray.length),function(cardNumber){animationInfoArray[cardNumber]={item:holeCardAnimationArray[cardNumber],finalY:animationBottomY,onTick:onAnimationTick,animationTime:(animationTopY-holeCardAnimationArray[cardNumber].image.y)/animationSpeed,onEnd:function(animationInfo,imageTween,textTween){setAnimationDirection("bottom");self.hideChildren(animationInfo.item)},onStart:function(){displayedAnimationArray=holeCardAnimationArray;cropCardImages()}}});_.each(_.range(holeCardAnimationArray.length),function(cardNumber){self.animateImage(animationInfoArray[cardNumber])})}function endAnimations(){self.hideChildren(displayedAnimationArray);setAnimationDirection(false)}function shouldAnimate(){if(self.getPreactionData("inHand",{seat:options.seatNum})===true){return false}if(seatObject.rotatedSeatNumber===self.gameState.userSeatNumber){if(!(_.isArray(self.gameState.holeCards)&&self.gameState.holeCards.length>0)){return false}}else if(!_.isObject(seatObject.shownCards[0].image)||seatObject.shownCards[0].isDisplayed()||!_.isObject(seatObject.shownCards[1].image)||seatObject.shownCards[1].isDisplayed()||!_.isObject(seatObject.hiddenCards[0].image)||seatObject.hiddenCards[0].isDisplayed()||!_.isObject(seatObject.hiddenCards[1].image)||seatObject.hiddenCards[1].isDisplayed()){return false}var animationArray=getHoleCardAnimationArray();if(!_.isArray(animationArray)||animationArray.length===0){return false}return true}function onAnimationTick(animationInfo,imageTween,textTween){if(shouldAnimate()===false){if(_.isFunction(imageTween.removeTweens)){imageTween.removeTweens(imageTween.target)}if(_.isFunction(textTween.removeTweens)){textTween.removeTweens(textTween.target)}endAnimations()}else{cropCardImages()}}function cropCardImages(){self.adjustHoleCardImageSourceRectangle(getHoleCardAnimationArray(),{seatNumber:seatNum})}};this.events.showTableChatFullOnClick=function(){self.displayTableChatFull();$("#chatForm").blur();self.jQueryObjects.tableChatFullParagraph.blur()};this.events.hideTableChatFullOnClick=function(){console.log("hide clicked");self.hideTableChatFull()};this.moveTableChatFullMessageText=function(movementObject,options){var velocityTo0InMiliseconds=1e3;if(!movementObject){var movementObject={}}var defaults={};defaults.relativeUnit="pixels";defaults.relativity="top";if(!_.isNumber(movementObject.magnitude)){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("using mcustomsrollbar function to scroll to bottom, then update");self.jQueryObjects.tableChatFullDiv.mCustomScrollbar("scrollTo","bottom");movementObject.resize=true}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();if(!_.isObject(scroll[0])){console.log(scroll)}if(scroll[0].getContentSize().h!=self.jQueryObjects.tableChatFullDiv.height()){self.jQueryObjects.tableChatFullDiv.scrollTop(scroll[0].getContentSize().h*1.5);movementObject.resize=true}}}else{if(movementObject.positionUnit=="pixels"){}if(_.isNumber(movementObject.magnitude)){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();scroll[0].scrollTop(movementObject.magnitude);movementObject.resize=true}}}if(movementObject.resize===true){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("calling update function of mcustomscrollbar");self.jQueryObjects.tableChatFullDiv.mCustomScrollbar("update")}else{var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();scroll[0].resize()}}};this.events.tableChatFullChatMessageTextMouseDown=function(e){self.gameState.tableChatFull.mouseDown=true;console.log("tablechatfull text clicked");var initialRawX=e.rawX;var initialRawY=e.rawY};this.events.popOutClicked=function(){console.log("popOutClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.popOut.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.popOutOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.popOutOnClicked=function(){console.log("popOutClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.popOut.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.popOutOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideDealerMessagesClicked=function(){self.getPermanentPreferences();console.log("hideDealerMessagesClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessages.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessagesOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideDealerMessagesOnClicked=function(){console.log("hideDealerMessagesOnClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessages.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessagesOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hidePlayerMessagesClicked=function(){console.log("hidePlayerMessagesClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessages.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessagesOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hidePlayerMessagesOnClicked=function(){console.log("hidePlayerMessagesOnClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessages.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessagesOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideObserverMessagesClicked=function(){console.log("hideObserverMessagesClicked");self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessages.value=false;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessagesOn.value=true;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.hideObserverMessagesOnClicked=function(){self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessages.value=true;self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessagesOn.value=false;self.saveSessionPreferences();self.updateTableChatFullDisplay()};this.events.rotateSeatsIfNeededAndConfirm=function(){if(!_.isNumber(self.gameState.userSeatNumber)){console.error("rotateSeatsIfNeededAndConfirm called without valid userseatnumber"+self.gameState.userSeatNumber)}if(self.permanentPreferences.alwaysRotate===true){}var preferenceSeat=self.sessionPreferences.changeUserSeatViewTo.value;if(_.isNumber(preferenceSeat)&&(preferenceSeat===0||preferenceSeat===self.gameState.userSeatNumber)){console.log("rotating without confirming due to current preference:");console.log(self.sessionPreferences.changeUserSeatViewTo);self.changeUserSeatView(preferenceSeat)}else if(self.gameState.userSeatNumber!==0){self.changeUserSeatView();if(self.permanentPreferences.confirmSeatRotation.value===true){var messageInfo={};messageInfo.style="qtip-youtube";messageInfo.html=true;messageInfo.modal=false;messageInfo.title="Perspective Changed";messageInfo.okayText="OK, this is fine";messageInfo.cancelText="Change view";messageInfo.cancel=true;messageInfo.checkBox=true;messageInfo.okayEvent=function(e){console.log("ok event called of confirmseatrotation");var checked=messageBoxAPI.getStatus(e.target.parentItem.position.z.stage).checkBox;if(checked==="checked"){self.permanentPreferences.confirmSeatRotation.value=false}else if(checked==="unchecked"){self.permanentPreferences.confirmSeatRotation.value=true}console.log(checked);self.sessionPreferences.changeUserSeatViewTo.value=self.images.seats[self.gameState.userSeatNumber].rotatedSeatNumber;console.log("setting seat view preference to "+self.sessionPreferences.changeUserSeatViewTo.value);self.saveSessionPreferences();messageBoxAPI.hide()};messageInfo.cancelEvent=function(){if(self.images.seats[self.gameState.userSeatNumber].rotatedSeatNumber!==self.gameState.userSeatNumber){self.changeUserSeatView(self.gameState.userSeatNumber)}else{self.changeUserSeatView()}};var messageString="You now appear at the bottom middle.  Click "+messageInfo.cancelText+' to change your view back.  At the table, right click a seat ---> click "Show Me Here" to change your view.';messageBoxAPI.display(messageString,messageInfo)}}};this.events.userStands=function(){self.setPreactionData("hand","check",true,{server:true});self.setPreactionData("hand","fold",true,{server:true});socket.emit("stand")};this.events.exitTableClick=function(event){if(!_.isNumber(self.gameState.userSeatNumber)||self.gameState.itemsCreated!=true){self.events.exit();return}console.log("exittable clicked");if(_.isObject(event)){console.log(event)}var messageInfo={};messageInfo.title="Leave Table?";messageInfo.cancel=true;messageInfo.html=true;messageInfo.modal=true;messageInfo.style="qtip-youtube";messageInfo.okayEvent=function(){self.events.userStands();self.events.exit()};messageBoxAPI.display("Are you sure you want to leave?",messageInfo)};this.events.viewLobbyClick=function(event){var lobbyName="Lobby";window.open("/lobby",lobbyName,"width=800,height=770 ,left=200,top=200,location=0,toolbar=no,menubar=no,titlebar=no,directories=no,scrollbars=yes")};this.events.exit=function(event){messageBoxAPI.hide();if(_.isObject(playZoneLandingPage.iframes)){console.log("Close iframe");playZoneLandingPage.iframes.closeIframe(self.getTableName())}else{console.log("Close window instead");var win=window.open("","_self");win.close()}};this.events.onDisabledOrNonUserSeatClick=function(e){console.log(e);if(!_.isNumber(self.gameState.userSeatNumber)){return}if(e.nativeEvent.button!==2){return}var item=e.target.parentItem;if(!_.isObject(item)){return}var seatObject=item.seatObjectAncestor;var rotatedSeatNumber=seatObject.rotatedSeatNumber;var nonRotatedSeatNumber=seatObject.nonRotatedSeatNumber;if(self.gameState.userSeatNumber===seatObject.nonRotatedSeatNumber){return}var stageParent=self.getParentOfStageObject(item);var rotate=function(){self.sessionPreferences.changeUserSeatViewTo.updateValue(rotatedSeatNumber);self.saveSessionPreferences()};var x=e.stageX+1;var y=e.stageY+1;var contextmenuOptions={delegate:stageParent.div,menu:[{title:"Show Me Here",action:rotate}],position:{my:"left+"+x+" top+"+y,of:stageParent.div,at:"left top",within:stageParent.div,collision:"flipfit"},create:function(event,ui){console.log("contextmenu created");console.log(event)},beforeOpen:function(event,ui){console.log("original beforeOpen called, repositioning showmehere menu");console.log(event);console.log(ui);ui.menu.appendTo(stageParent.div);var css={"z-index":getZ("contextMenu","staticItems").container,"font-size":"11px","font-family":self.permanentPreferences.defaultFontType.value,padding:"0 0 0 0"};ui.menu.css(css);console.log(getDisplayObjectPositionAndSizeData(ui.menu[0],{size:true,position:true,maxSize:true}));$(stageParent.div).off("contextmenubeforeOpen");$(stageParent.div).on("contextmenubeforeOpen",function(event,ui){console.log("context menu called from regular right click, hiding and not showing it ...SUCCESS");$(stageParent.div).contextmenu("destroy");return false})},open:function(event,ui){console.log("contextmenu opened");console.log(getDisplayObjectPositionAndSizeData(ui.menu[0],{size:true,position:true,maxSize:true}))},close:function(event,ui){$(document).contextmenu("destroy")},show:false,hide:false};try{$(document).contextmenu("destroy")}catch(err){}$(document).contextmenu(contextmenuOptions);console.log("calling contextmenu open");$(document).contextmenu("open",$(stageParent.div));console.log($(document).contextmenu("getMenu"))};this.events.onBackgroundContextMenu=function(e){console.log(e);try{var background=e.target.parentItem;var stageParent=self.getParentOfStageObject(background)}catch(err){return}var x=e.stageX+1;var y=e.stageY+1;var menu=[];var addDarkOption=function(fileName){menu.push({title:menu.length,cmd:"img/background images/dark/"+fileName})};addDarkOption("Map1280x800.jpg");addDarkOption("abstract_black_gradient_desktop_1920x1200_hd-wallpaper-1012937.jpg");addDarkOption("1280x1024_backround-best-black-and-green-wall-papers-go-wallpaper.jpg");addDarkOption("51b736384045f25357.jpg");addDarkOption("Beautiful-Black-Background.jpg");addDarkOption("black_background_fabric-wallpaper-1440x960.jpg");addDarkOption("Black-Background-Leather-600x800.jpg");addDarkOption("Black-background-set-wood-on-chanconsultants.jpg");addDarkOption("Black-Desktop-Background-texture world map.jpg");addDarkOption("grey-gray-black-gradient-30641.jpg");addDarkOption("wallpapers-room-com-black-background-set-fabric-by-iamfreeman.jpg");addDarkOption("jpoker_bg_brown.png");addDarkOption("gray_bg.jpg");var addGreenOption=function(fileName){menu.push({title:menu.length,cmd:"img/background images/green/"+fileName})};addGreenOption("1280x1024_Lime-green-windows-vista-1600x1200-wallpapers-download-desktop.jpg");addGreenOption("digital_abstract_background-wide.jpg");addGreenOption("green_black_frosted.jpg");addGreenOption("green-abstract-background.jpg");addGreenOption("Technical-green-and-black-abstract-background-tron tech style1024x640.jpg");menu.push({title:"random",cmd:"random"});var getRandomSrc=function(){var randomMenuIndex=Math.floor(Math.random()*menu.length-1);return menu[randomMenuIndex].cmd};var contextmenuOptions={delegate:stageParent.div,menu:menu,select:function(event,ui){if(ui.cmd==="random"){ui.cmd=getRandomSrc()}self.setBackground(ui.cmd)},position:{my:"left+"+x+" top+"+y,of:stageParent.div,at:"left top",within:stageParent.div,collision:"flipfit"},create:function(event,ui){console.log("contextmenu created");console.log(event)},beforeOpen:function(event,ui){console.log("original beforeOpen called, repositioning showmehere menu");console.log(event);console.log(ui);ui.menu.appendTo(stageParent.div);var css={"z-index":getZ("contextMenu","staticItems").container,"font-size":"11px","font-family":self.permanentPreferences.defaultFontType.value,padding:"0 0 0 0"};ui.menu.css(css);console.log(getDisplayObjectPositionAndSizeData(ui.menu[0],{size:true,position:true,maxSize:true}));$(stageParent.div).off("contextmenubeforeOpen");$(stageParent.div).on("contextmenubeforeOpen",function(event,ui){console.log("context menu called from regular right click, hiding and not showing it ...SUCCESS");$(stageParent.div).contextmenu("destroy");return false})},open:function(event,ui){console.log("contextmenu opened");console.log(getDisplayObjectPositionAndSizeData(ui.menu[0],{size:true,position:true,maxSize:true}))},close:function(event,ui){$(document).contextmenu("destroy")},show:false,hide:false};try{$(document).contextmenu("destroy")}catch(err){}$(document).contextmenu(contextmenuOptions);console.log("calling contextmenu open");$(document).contextmenu("open",$(stageParent.div));console.log($(document).contextmenu("getMenu"))};this.events.wheelScroll=function(numScrolls){if(!_.isNumber(numScrolls)){return"scroll failed"}var change=numScrolls*self.permanentPreferences.bigBlindsPerMouseScroll.value*self.initial_table_state.big_blind;var betValue=parseFloat($("#betSize").val());var isBetValueValid=!_.isNaN(betValue)&&_.isNumber(betValue);if(isBetValueValid==true){var newBet=change+betValue}else{var newBet=change+self.gameState.betSize}newBet=self.returnRoundedDownBetSize(newBet);self.adjustBetDisplayToInputOfUser(newBet)};this.events.betSliderHorizontalMouseDown=function(event){var adjustBetSize=function(){var unroundedBetAmount=$(self.images.betSlider.slider.image).slider("value");var roundedBet=Math.round(unroundedBetAmount/self.initial_table_state.min_increment)*self.initial_table_state.min_increment;self.adjustBetDisplayToInputOfUser(roundedBet)};var moveSliderOnClick=function(event){}};this.events.betSliderChanged=function(event,ui){self.adjustBetDisplayToInputOfUser(ui.value,{slider:false})};this.events.possibleRaiseOrBetAttemptFromBetSize=function(toggleRaiseAndBetEvents){console.log("possibleRaiseOrBetAttemptFromBetSize called val = "+$("#betSize").val());var newBetSize=parseFloat($("#betSize").val());var isNumber=!isNaN(newBetSize)&&_.isNumber(newBetSize);var roundedBetSize;if(isNumber==false){roundedBetSize=self.returnRoundedDownBetSize(self.gameState.betSize)}else{roundedBetSize=self.returnRoundedDownBetSize(newBetSize)}if(roundedBetSize>self.gameState.maxBet){roundedBetSize=self.gameState.maxBet}else if(roundedBetSize<self.gameState.minBet){roundedBetSize=self.gameState.minBet}if(roundedBetSize!=newBetSize){self.adjustBetDisplayToInputOfUser(roundedBetSize)}trueOrFalseToggleRaiseAndBet(toggleRaiseAndBetEvents)};var trueOrFalseToggleRaiseAndBet=function(toggleBoolean){if(toggleBoolean===true){console.log("trueOrFalseToggleRaiseAndBet called ");enableRaiseAndBetEvents()}else if(toggleBoolean===false){console.log("trueOrFalseToggleRaiseAndBet called");disableOneRaiseOrBetAttempt()}var failSound=createjs.Sound.createInstance(self.images.sources.failClickSound);var playFailSound=function(){failSound.play()};function disableOneRaiseOrBetAttempt(e){disableNonStaticBetAndRaiseEvents();console.log("disableOneRaiseOrBetAttempt called");$(self.images.raise.image).add(self.images.bet.image).one("mousedown.disableOneRaiseOrBetClick",disableOneRaiseOrBetClick);$(self.images.raise.image).add(self.images.bet.image).on("click.preventOneClick",function(e){return false});$(self.images.raise.image).add(self.images.bet.image).on("mouseup.restoreClick",function(e){createjs.Tween.get(this,{override:true}).wait(0).call(enableRaiseAndBetEvents);return false});$(self.images.betSlider.betSize.image).on("keydown.correctRaiseAndBetAmountOnBetSizeEnter",correctRaiseAndBetAmountOnBetSizeEnter);$(self.images.betSlider.betSize.image).on("focusout",self.events.possibleRaiseOrBetAttemptFromBetSize)}function enableRaiseAndBetEvents(){disableNonStaticBetAndRaiseEvents();console.log("enableRaiseAndBetEvents called");$(self.images.betSlider.betSize.image).one("keydown.raiseOrBetOnBetSizeEnterPress",raiseOrBetOnBetSizeEnterPress)}function disableNonStaticBetAndRaiseEvents(){$(self.images.betSlider.betSize.image).off(".raiseOrBetOnBetSizeEnterPress  .correctRaiseAndBetAmountOnBetSizeEnter .enableRaiseAndBetEventsOnBetSizeEnter focusout");$(self.images.raise.image).add(self.images.bet.image).off("mousedown.disableOneRaiseOrBetClick click.preventOneClick mouseup.restoreClick")}function correctRaiseAndBetAmountOnBetSizeEnter(e){var keycode=event.keyCode?event.keyCode:event.which;if(keycode===13){playFailSound();$(self.images.betSlider.betSize.image).one("keyup.enableRaiseAndBetEventsOnBetSizeEnter",enableRaiseAndBetEventsOnBetSizeEnter);$(self.images.betSlider.betSize.image).off(".correctRaiseAndBetAmountOnBetSizeEnter");self.events.possibleRaiseOrBetAttemptFromBetSize(e);return false}}function enableRaiseAndBetEventsOnBetSizeEnter(e){console.log("keyup event called");console.log(e);var keycode=event.keyCode?event.keyCode:event.which;if(keycode!==13){return}console.log("enabling bet/raise, event type = "+event.type);self.events.possibleRaiseOrBetAttemptFromBetSize(true)}function raiseOrBetOnBetSizeEnterPress(e){var keycode=event.keyCode?event.keyCode:event.which;if(keycode!==13){return}console.log("raiseOrBetOnBetSizeEnterPress called due to enter key pressed, event type = "+event.type);if(self.images.raise.isDisplayed()){$(self.images.raise.image).trigger("click")}else if(self.images.bet.isDisplayed()){$(self.images.bet.image).trigger("click")}}function disableOneRaiseOrBetClick(e){console.log("disableOneRaiseOrBetClick called");e.preventDefault();playFailSound();self.events.possibleRaiseOrBetAttemptFromBetSize(e)}function disableEnterOnce(e){var keycode=event.keyCode?event.keyCode:event.which;console.log("keydown pressed on betSize, but we are going to disable its effect once");if(keycode!==13){return}e.preventDefault();$(self.images.betSlider.betSize.image).one("keyup.restoreEnter",function(e){enableRaiseAndBetEvents()})}};this.events.betSizeChanged=function(event){console.log("betsize changed called, val = "+$("#betSize").val());var newBetSize=parseFloat($("#betSize").val());var hasValue=/\S/.test($("#betSize").val());var isNumber=!isNaN(newBetSize)&&_.isNumber(newBetSize);var isChanged=newBetSize!=self.gameState.betSize;if(hasValue&&isNumber&&isChanged){self.adjustBetDisplayToInputOfUser(newBetSize)}var roundedDownBetSize=self.returnRoundedDownBetSize(newBetSize);if(roundedDownBetSize!=newBetSize||roundedDownBetSize==false){trueOrFalseToggleRaiseAndBet(false)}else if(roundedDownBetSize!=false&&roundedDownBetSize==newBetSize){trueOrFalseToggleRaiseAndBet(true)
}};this.initialize=function(){this.initializeStagesAndCanvasCallThisFirst();if(parent.imagesLoaded===true||parent.imagesLoading===true){return}var imageSourceArray=[];var soundSourceArray=[];var flashSoundSourceArray=[];var resourceID=0;var loadedFiles=0;var errorFiles=0;var errorSrcArray=[];var isImageSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".PNG"){return true}else if(sourceEnding==".JPG"){return true}else{return false}};var isSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".MP3"){return true}else if(sourceEnding==".WAV"){return true}else{return false}};var isFlashSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".SWF"){return true}else{return false}};for(var i in this.images.sources){if(_.isString(this.images.sources[i])){if(isImageSource(this.images.sources[i])){imageSourceArray.push({src:this.images.sources[i],id:resourceID,name:i,sourceObjectParent:this.images.sourceObjects});resourceID++}else if(isFlashSoundSource(this.images.sources[i])){flashSoundSourceArray.push({src:this.images.sources[i],id:resourceID,name:i});resourceID++}else if(isSoundSource(this.images.sources[i])){soundSourceArray.push({src:this.images.sources[i],id:resourceID,name:i});resourceID++}}else if(_.isObject(this.images.sources[i])){this.images.sourceObjects[i]={};for(var n in this.images.sources[i]){if(_.isString(this.images.sources[i][n])){imageSourceArray.push({src:this.images.sources[i][n],id:resourceID,name:n,sourceObjectParent:this.images.sourceObjects[i]});resourceID++}}}}this.images.sourceObjects.desktopCards={};this.images.sourceObjects.mobileCards={};var desktopCards=this.images.sourceObjects.desktopCards;var mobileCards=this.images.sourceObjects.mobileCards;imageSourceArray.push({src:this.images.sources.desktopCardFolder+this.images.sources.cardBackFileNameWithoutExtension+".png",id:resourceID,name:"cardBack",sourceObjectParent:desktopCards});imageSourceArray.push({src:this.images.sources.mobileCardFolder+this.images.sources.cardBackFileNameWithoutExtension+".png",id:resourceID,name:"cardBack",sourceObjectParent:mobileCards});for(var i=2;i<=14;i++){var cardRank;if(i==10){cardRank="t"}else if(i==11){cardRank="j"}else if(i==12){cardRank="q"}else if(i==13){cardRank="k"}else if(i==14){cardRank="a"}else{cardRank=i}imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"c.png",id:resourceID,name:cardRank+"c",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"d.png",id:resourceID,name:cardRank+"d",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"h.png",id:resourceID,name:cardRank+"h",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.desktopCardFolder+cardRank+"s.png",id:resourceID,name:cardRank+"s",sourceObjectParent:desktopCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"c.png",id:resourceID,name:cardRank+"c",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"d.png",id:resourceID,name:cardRank+"d",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"h.png",id:resourceID,name:cardRank+"h",sourceObjectParent:mobileCards});resourceID++;imageSourceArray.push({src:this.images.sources.mobileCardFolder+cardRank+"s.png",id:resourceID,name:cardRank+"s",sourceObjectParent:mobileCards});resourceID++}console.log(imageSourceArray);var introScreen={};var canvasWidth=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.width;var canvasHeight=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.height;var titleSizeAndFont="20px "+self.permanentPreferences.defaultFontType.value;var titleHeight=35;var titleAndPreloadBarDistanceY=50;var titleText="Loading resources...";var titleColor="#000000";var statusSizeAndFont="15px "+self.permanentPreferences.defaultFontType.value;var statusHeight=20;var statusColor="#000000";var preloadBarY=canvasHeight/2;var preloadBarWidth=canvasWidth*.65;var preloadBarHeight=30;var preloadBarBorderColor="rgb(0,0,255)";var preloadBarProgressColor="#000000";var preloadBarUnfinishedColor="rgb(150,150,150)";var introScreenBackgroundColor="blue";introScreen.background=new this.images.Item(0,0,canvasWidth,canvasHeight,getZ("background","loadingScreen"));introScreen.background.image=new createjs.Shape;introScreen.background.image.graphics.beginFill(introScreenBackgroundColor).drawRect(introScreen.background.position.x,introScreen.background.position.y,introScreen.background.size.x,introScreen.background.size.y);introScreen.preloadBar=new this.images.Item(canvasWidth/2-preloadBarWidth/2,preloadBarY,preloadBarWidth,preloadBarHeight,getZ("animation","loadingScreen"));introScreen.title=new this.images.Item(0,preloadBarY-titleAndPreloadBarDistanceY-titleHeight,canvasWidth,titleHeight,getZ("animation","loadingScreen"));introScreen.status=new this.images.Item(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y-statusHeight,canvasWidth-introScreen.preloadBar.x,statusHeight,getZ("animation","loadingScreen"));introScreen.preloadBar.image=new createjs.Shape;introScreen.preloadBar.drawBar=function(progressRatio){var progressX=introScreen.preloadBar.size.x*progressRatio+introScreen.preloadBar.position.x;var unfinishedX;if(progressX>=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x){progressX=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x;unfinishedX=false}else if(progressX<=introScreen.preloadBar.position.x){progressX=false;unfinishedX=introScreen.preloadBar.position.x}else{unfinishedX=progressX}introScreen.preloadBar.image.graphics.clear().beginStroke(preloadBarBorderColor).beginFill(null).setStrokeStyle(1).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,introScreen.preloadBar.size.x,introScreen.preloadBar.size.y);if(progressX!=false){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarProgressColor).beginStroke(null).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,progressX-introScreen.preloadBar.position.x,introScreen.preloadBar.size.y)}if(unfinishedX!=false&&unfinishedX<introScreen.preloadBar.position.x+introScreen.preloadBar.size.x){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarUnfinishedColor).beginStroke(null).drawRect(unfinishedX,introScreen.preloadBar.position.y,introScreen.preloadBar.position.x+introScreen.preloadBar.size.x-unfinishedX,introScreen.preloadBar.size.y)}var stage=introScreen.preloadBar.position.z.stage;var container=introScreen.preloadBar.position.z.container;if(self.arrayOfParentsOfStageAndOfContainerArray[stage].containers[container].contains(introScreen.preloadBar.image)){self.arrayOfParentsOfStageAndOfContainerArray[stage].upToDate=false}return stage};introScreen.title.addText(titleText,titleSizeAndFont,titleColor);introScreen.status.text=new createjs.Text("",statusSizeAndFont,statusColor);introScreen.status.text.x=introScreen.status.position.x;introScreen.status.text.y=introScreen.status.position.y+1;introScreen.status.text.baseline="top";introScreen.status.text.textAlign="left";introScreen.status.textColor=titleColor;this.images.imageLoading={};var titleHeight=30;var titleSizeAndFont="30px "+self.permanentPreferences.defaultFontType.value;var titleColor="blue";var titleText="Displaying Images ...";var titleX=canvasWidth*.25;var titleY=canvasHeight*.75;this.images.imageLoading.title=new this.images.Item(titleX,titleY,canvasWidth-titleX,titleHeight,getZ("animation","loadingScreen"));this.images.imageLoading.title.text=new createjs.Text(titleText,titleSizeAndFont,titleColor);this.images.imageLoading.title.text.x=this.images.imageLoading.title.position.x;this.images.imageLoading.title.text.y=this.images.imageLoading.title.position.y+1;this.images.imageLoading.title.text.baseline="top";this.images.imageLoading.title.text.textAlign="left";this.images.imageLoading.title.text.textColor=titleColor;var displayPreloadScreen=function(){self.displayChildren(introScreen,{update:false})};var totalSources=imageSourceArray.length+soundSourceArray.length+flashSoundSourceArray.length;function handleLoad(src,id,onComplete){loadedFiles++;introScreen.status.text.text=src+" loaded";introScreen.preloadBar.drawBar(loadedFiles/totalSources);console.log(src+" loaded file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}self.updateStages(introScreen.status.position.z.stage);if(onComplete){onComplete()}}function handleLoadError(src,id,onComplete){loadedFiles++;errorFiles++;errorSrcArray.push(src);introScreen.status.text.text=src+" loaded";console.log(src+" error loading file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);introScreen.preloadBar.drawBar(loadedFiles/totalSources);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}if(loadedFiles>=totalSources){console.log("load completed with total of "+errorFiles+" image and sound errors whose sources are in the following array:");console.log(errorSrcArray)}self.updateStages(introScreen.status.position.z.stage);if(onComplete){onComplete()}}var preloadImages=function(imageArray,onComplete){var loadedImages=0;var increaseCounter=function(){loadedImages++;console.log("loaded "+loadedImages+" images out of a total of "+imageArray.length+" images")};_.each(_.range(imageArray.length),function(i){imageArray[i].sourceObjectParent[imageArray[i].name]=new Image;var newImageObject=imageArray[i].sourceObjectParent[imageArray[i].name];if(typeof imageArray[i]=="string"){newImageObject.src=imageArray[i]}else if(typeof imageArray[i]=="object"){newImageObject.src=imageArray[i].src}newImageObject.onload=function(){handleLoad(newImageObject.src,imageArray[i].id,increaseCounter)};newImageObject.onerror=function(){handleLoadError(newImageObject.src,imageArray[i].id,increaseCounter)}});var checkIfCompleted=setInterval(function(){if(loadedImages>=imageArray.length){onComplete();clearInterval(checkIfCompleted)}},25)};var preloadSounds=function(flashArray,soundArray){createjs.FlashPlugin.BASE_PATH="js/vendor/";createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]);createjs.Sound.addEventListener("fileload",function(event){handleLoad(event.src,event.id)});createjs.Sound.addEventListener("error",function(event){handleLoadError(event.src,event.id)});createjs.Sound.registerManifest(soundArray);for(var i=0;i<flashArray.length;i++){console.log(flashArray[i].src);var temp=createjs.Sound.createInstance(flashArray[i].src);console.log(temp);handleLoad(flashArray[i].src,flashArray[i].id)}};displayPreloadScreen();preloadImages(imageSourceArray,function(){self.displayChildren(self.images.imageLoading.title,{update:false});self.createAllItems()});preloadSounds(flashSoundSourceArray,soundSourceArray)};self.saveImageToParent=function(imageName,options){if(!options){var options={}}else{var options=_.clone(options)}var defaults={parent:self.permanentPreferences.sourceObjects.value};options=_.defaults(options,defaults);console.log("saveimagetoparent name: "+imageName+", src: "+options.src);console.log(options.parent[imageName]);if(_.isObject(options.parent[imageName])){console.log("saved an image load by fetching from already created image");if(!isImage(options.parent[imageName])){throw"tried to fetch an object that is not an image"}var image=options.parent[imageName]}else{options.parent[imageName]=new Image;var image=options.parent[imageName]}var imageLoad=imagesLoaded(image);if(_.isFunction(options.onload)){imageLoad.on("done",function(imageLoaded){options.onload(imageLoaded.elements[0])})}if(_.isFunction(options.onerror)){imageLoad.on("fail",function(imageLoaded){options.onerror(imageLoaded.elements[0])})}if(!_.isString(options.src)&&!_.isObject(options.src)){if(_.isString(self.images.sources[imageName])||_.isObject(self.images.sources[imageName])){options.src=self.images.sources[imageName]}else{options.src=imageName}}if(_.isString(options.src)&&options.src.indexOf("img")!=0){options.src="img/"+options.src}image.src=options.src;return image};this.loadImageSources=function(backgroundLoad){if(self.isIframe()){var preferencesRetreived=false;console.log("loadImageSources called from inside iframe");self.getInitialPermanentPreferences(function(){preferencesRetreived=true})}if(backgroundLoad!==true){this.initializeStagesAndCanvasCallThisFirst()}var totalSources=0;var imageSourceArray=[];var soundSourceArray=[];var flashSoundSourceArray=[];var resourceID=0;var loadedFiles=0;var errorFiles=0;var errorSrcArray=[];var isImageSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".PNG"){return true}else if(sourceEnding==".JPG"){return true}else{return false}};var isSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".MP3"){return true}else if(sourceEnding==".WAV"){return true}else{return false}};var isFlashSoundSource=function(source){var sourceEnding=source.substr(source.length-4).toUpperCase();if(sourceEnding==".SWF"){return true}else{return false}};var desktopCards;var mobileCards;var createPreloadArray=function(){for(var i in self.images.sources){if(_.isString(self.images.sources[i])){if(isImageSource(self.images.sources[i])){imageSourceArray.push({src:self.images.sources[i],id:resourceID,name:i,sourceObjectParent:self.permanentPreferences.sourceObjects.value});resourceID++}else if(isFlashSoundSource(self.images.sources[i])){flashSoundSourceArray.push({src:self.images.sources[i],id:resourceID,name:i});resourceID++}else if(isSoundSource(self.images.sources[i])){soundSourceArray.push({src:self.images.sources[i],id:resourceID,name:i});resourceID++}}else if(_.isObject(self.images.sources[i])){self.permanentPreferences.sourceObjects.value[i]={};for(var n in self.images.sources[i]){if(_.isString(self.images.sources[i][n])){imageSourceArray.push({src:self.images.sources[i][n],id:resourceID,name:n,sourceObjectParent:self.permanentPreferences.sourceObjects.value[i]});resourceID++}}}}self.permanentPreferences.sourceObjects.value.desktopCards={};self.permanentPreferences.sourceObjects.value.mobileCards={};var desktopCards=self.permanentPreferences.sourceObjects.value.desktopCards;var mobileCards=self.permanentPreferences.sourceObjects.value.mobileCards;imageSourceArray.push({src:self.images.sources.desktopCardFolder+self.images.sources.cardSpriteFileNameWithoutExtension+".png",id:resourceID,name:self.images.sources.cardSpriteFileNameWithoutExtension,sourceObjectParent:desktopCards});totalSources=imageSourceArray.length+soundSourceArray.length+flashSoundSourceArray.length};if(backgroundLoad!==true){var introScreen={};var canvasWidth=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.width;var canvasHeight=this.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.height;var titleSizeAndFont="20px "+self.permanentPreferences.defaultFontType.value;var titleHeight=35;var titleAndPreloadBarDistanceY=50;var titleText="Loading resources...";var titleColor="#000000";var statusSizeAndFont="15px "+self.permanentPreferences.defaultFontType.value;var statusHeight=20;var statusColor="#000000";var preloadBarY=canvasHeight/2;var preloadBarWidth=canvasWidth*.65;var preloadBarHeight=30;var preloadBarBorderColor="rgb(0,0,255)";var preloadBarProgressColor="#000000";var preloadBarUnfinishedColor="rgb(150,150,150)";var introScreenBackgroundColor="blue";var animationZ=getZ("animation","loadingScreen");var backgroundZ=getZ("background","loadingScreen");introScreen.background=new this.images.Item(0,0,canvasWidth,canvasHeight,backgroundZ);introScreen.background.image=new createjs.Shape;introScreen.background.image.graphics.beginFill(introScreenBackgroundColor).drawRect(introScreen.background.position.x,introScreen.background.position.y,introScreen.background.size.x,introScreen.background.size.y);introScreen.preloadBar=new this.images.Item(canvasWidth/2-preloadBarWidth/2,preloadBarY,preloadBarWidth,preloadBarHeight,animationZ);introScreen.title=new this.images.Item(0,preloadBarY-titleAndPreloadBarDistanceY-titleHeight,canvasWidth,titleHeight,animationZ);introScreen.status=new this.images.Item(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y-statusHeight,canvasWidth-introScreen.preloadBar.x,statusHeight,animationZ);introScreen.preloadBar.image=new createjs.Shape;introScreen.preloadBar.drawBar=function(progressRatio){if(!_.isNumber(progressRatio)||_.isNaN(progressRatio)){var progressRatio=0}var progressX=introScreen.preloadBar.size.x*progressRatio+introScreen.preloadBar.position.x;var unfinishedX;if(progressX>=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x){progressX=introScreen.preloadBar.size.x+introScreen.preloadBar.position.x;unfinishedX=false}else if(progressX<=introScreen.preloadBar.position.x){progressX=false;unfinishedX=introScreen.preloadBar.position.x}else{unfinishedX=progressX}introScreen.preloadBar.image.graphics.clear().beginStroke(preloadBarBorderColor).beginFill(null).setStrokeStyle(1).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,introScreen.preloadBar.size.x,introScreen.preloadBar.size.y);if(progressX!=false){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarProgressColor).beginStroke(null).drawRect(introScreen.preloadBar.position.x,introScreen.preloadBar.position.y,progressX-introScreen.preloadBar.position.x,introScreen.preloadBar.size.y)}if(unfinishedX!=false&&unfinishedX<introScreen.preloadBar.position.x+introScreen.preloadBar.size.x){introScreen.preloadBar.image.graphics.setStrokeStyle(0).beginFill(preloadBarUnfinishedColor).beginStroke(null).drawRect(unfinishedX,introScreen.preloadBar.position.y,introScreen.preloadBar.position.x+introScreen.preloadBar.size.x-unfinishedX,introScreen.preloadBar.size.y)}return self.easelJSDisplayObjectChanged(introScreen.preloadBar)};introScreen.title.addText(titleText,titleSizeAndFont,titleColor);introScreen.status.text=new createjs.Text("",statusSizeAndFont,statusColor);introScreen.status.text.x=introScreen.status.position.x;introScreen.status.text.y=introScreen.status.position.y+1;introScreen.status.text.baseline="top";introScreen.status.text.textAlign="left";introScreen.status.textColor=titleColor;this.images.imageLoading={};var titleHeight=30;var titleSizeAndFont="30px "+self.permanentPreferences.defaultFontType.value;var titleColor="blue";var titleText="Displaying Images ...";var titleX=canvasWidth*.25;var titleY=canvasHeight*.75;this.images.imageLoading.title=new this.images.Item(titleX,titleY,canvasWidth-titleX,titleHeight,animationZ);this.images.imageLoading.title.text=new createjs.Text(titleText,titleSizeAndFont,titleColor);this.images.imageLoading.title.text.x=this.images.imageLoading.title.position.x;this.images.imageLoading.title.text.y=this.images.imageLoading.title.position.y+1;this.images.imageLoading.title.text.baseline="top";this.images.imageLoading.title.text.textAlign="left";this.images.imageLoading.title.text.color=titleColor;var displayPreloadScreen=function(){self.displayChildren(introScreen,{update:false})}}function handleLoad(src,id,onEnd){loadedFiles++;playZoneLandingPage.loadingScreen.status=src+" loaded";playZoneLandingPage.loadingScreen.progressRatio=loadedFiles/totalSources;console.log(src+" loaded file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);console.log(playZoneLandingPage.loadingScreen.progressRatio);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}if(onEnd){onEnd()}}function handleLoadError(src,id,onEnd){loadedFiles++;errorFiles++;errorSrcArray.push(src);playZoneLandingPage.loadingScreen.status=src+" loaded";playZoneLandingPage.loadingScreen.progressRatio=loadedFiles/totalSources;console.log(src+" error loading file id: "+id+" totalLoaded: "+loadedFiles+" of "+totalSources);console.log(playZoneLandingPage.loadingScreen.progressRatio);if(id==imageSourceArray[imageSourceArray.length-1].id){console.log("last image loaded")}else if(id==soundSourceArray[soundSourceArray.length-1].id){console.log("last non-flash sound loaded")}if(loadedFiles>=totalSources){console.log("load completed with total of "+errorFiles+" image and sound errors whose sources are in the following array:");console.log(errorSrcArray)}if(onEnd){onEnd()}}var preloadImages=function(imageArray){var loadedImages=0;var increaseCounter=function(){loadedImages++;console.log("loaded "+loadedImages+" images out of a total of "+imageArray.length+" images")};_.each(imageArray,function(elementValue,i,list){var src=imageArray[i].src;if(_.isObject(src)){var callbackSrc=src.src}else{var callbackSrc=src}var onload=function(){handleLoad(callbackSrc,imageArray[i].id,increaseCounter)};var onerror=function(){handleLoadError(callbackSrc,imageArray[i].id,increaseCounter)};self.saveImageToParent(imageArray[i].name,{src:src,onload:onload,onerror:onerror,parent:imageArray[i].sourceObjectParent})})};function onComplete(){var fullSizeCardSpriteData={images:["sprite.png"],frames:[[2080,0,40,64],[2040,0,40,64],[2e3,0,40,64],[1960,0,40,64],[1920,0,40,64],[1880,0,40,64],[1840,0,40,64],[1800,0,40,64],[1760,0,40,64],[1720,0,40,64],[1680,0,40,64],[1640,0,40,64],[1600,0,40,64],[1560,0,40,64],[1520,0,40,64],[1480,0,40,64],[1440,0,40,64],[1400,0,40,64],[1360,0,40,64],[1320,0,40,64],[1280,0,40,64],[1240,0,40,64],[1200,0,40,64],[1160,0,40,64],[1120,0,40,64],[1080,0,40,64],[1040,0,40,64],[1e3,0,40,64],[960,0,40,64],[920,0,40,64],[880,0,40,64],[840,0,40,64],[800,0,40,64],[760,0,40,64],[720,0,40,64],[680,0,40,64],[640,0,40,64],[600,0,40,64],[560,0,40,64],[520,0,40,64],[480,0,40,64],[440,0,40,64],[400,0,40,64],[360,0,40,64],[320,0,40,64],[280,0,40,64],[240,0,40,64],[200,0,40,64],[160,0,40,64],[120,0,40,64],[80,0,40,64],[40,0,40,64],[0,0,40,64]],animations:{"2c":[0],"2d":[1],"2h":[2],"2s":[3],"3c":[4],"3d":[5],"3h":[6],"3s":[7],"4c":[8],"4d":[9],"4h":[10],"4s":[11],"5c":[12],"5d":[13],"5h":[14],"5s":[15],"6c":[16],"6d":[17],"6h":[18],"6s":[19],"7c":[20],"7d":[21],"7h":[22],"7s":[23],"8c":[24],"8d":[25],"8h":[26],"8s":[27],"9c":[28],"9d":[29],"9h":[30],"9s":[31],ac:[32],ad:[33],ah:[34],as:[35],back:[36],jc:[37],jd:[38],jh:[39],js:[40],kc:[41],kd:[42],kh:[43],ks:[44],qc:[45],qd:[46],qh:[47],qs:[48],tc:[49],td:[50],th:[51],ts:[52]}};fullSizeCardSpriteData.images=[self.permanentPreferences.sourceObjects.value.desktopCards[self.images.sources.cardSpriteFileNameWithoutExtension]];self.permanentPreferences.sourceObjects.value.desktopCards.spriteSheet=new createjs.SpriteSheet(fullSizeCardSpriteData);console.log("onComplete called in initialize");console.log(parent);playZoneLandingPage.loaded=true;if(backgroundLoad!==true){self.displayChildren(self.images.imageLoading.title,{update:false});self.createAllItems()}}function checkIfCompleted(e){if(!_.isObject(playZoneLandingPage.loadingScreen)){console.log(playZoneLandingPage);throw"loadingscreen not object"}if((playZoneLandingPage.loadingScreen.progressRatio>=1||playZoneLandingPage.loaded===true)&&preferencesRetreived!==false){onComplete();createjs.Ticker.removeEventListener(e.type,checkIfCompleted)}else{introScreen.preloadBar.drawBar(playZoneLandingPage.loadingScreen.progressRatio);introScreen.status.text.text=playZoneLandingPage.loadingScreen.status;self.easelJSDisplayObjectChanged(introScreen.status);self.updateStages()}}var preloadSounds=function(flashArray,soundArray){createjs.FlashPlugin.BASE_PATH="js/vendor/";createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]);createjs.Sound.addEventListener("fileload",function(event){handleLoad(event.src,event.id)});createjs.Sound.addEventListener("error",function(event){handleLoadError(event.src,event.id)});createjs.Sound.registerManifest(soundArray);for(var i=0;i<flashArray.length;i++){console.log(flashArray[i].src);var temp=createjs.Sound.createInstance(flashArray[i].src);console.log(temp);temp.play();handleLoad(flashArray[i].src,flashArray[i].id)}};if(playZoneLandingPage.loaded===true||playZoneLandingPage.loading===true){console.log("other frame to load our images");console.log(self.permanentPreferences.sourceObjects.value);console.log(playZoneLandingPage.sourceObjects)}else{console.log("loading from this page");playZoneLandingPage.loading=true;playZoneLandingPage.loadingScreen={};playZoneLandingPage.loadingScreen.progressRatio=0;playZoneLandingPage.loadingScreen.status="";createPreloadArray();preloadSounds(flashSoundSourceArray,soundSourceArray);preloadImages(imageSourceArray)}if(backgroundLoad!==true){displayPreloadScreen();createjs.Ticker.addEventListener("tick",checkIfCompleted)}};this.images.setDefaults=function(){var canvasWidth=self.getParentOfStageObject(0).stage.canvas.width;var canvasHeight=self.getParentOfStageObject(0).stage.canvas.height;var cardWidth;var cardHeight;if(this.sources.cardImageFolder.indexOf("resize")>=0){cardWidth=36;cardHeight=44}else{cardWidth=40;cardHeight=64}var spaceBetweenHoleCards=-cardWidth/8;var shownCardY=.92;var checkBoxButtonSource=self.permanentPreferences.sourceObjects.value.checkBox;var checkBoxButtonCheckedSource=self.permanentPreferences.sourceObjects.value.checkBoxChecked;var checkBoxButtonWidth=100;var checkBoxButtonHeight=checkBoxButtonSource.height;var checkBoxButtonDistanceFromChat=8;var checkBoxButtonOffSetLeft=2;var checkBoxButtonDistanceY=3;var checkBoxButtonCheckBoxWidth=checkBoxButtonHeight;var checkBoxButtonDistanceFromBoxToText=5;var checkBoxButtonDistanceFromEdgeToInteriorHitAreaY=1;var checkBoxButtonSizeAndFont="10px "+self.permanentPreferences.defaultFontType.value;var checkBoxButtonTextColor="#FFFFFF";var actionButtonWidth=80;var actionButtonHeight=30;var actionButtonLeftX=160;var actionButtonY=419;var distanceBetweenActionButtons=19;var seatWidth=90;var seatHeight=33;var distanceBetweenSeatsX=40;var distanceBetweenSeatsY=123;var firstRowY=77;var secondRowY=153;var thirdRowY=secondRowY+seatHeight+distanceBetweenSeatsY;var fourthRowY=371;var firstColumnX=10;var fifthColumnX=canvasWidth-firstColumnX-seatWidth;var secondColumnX=canvasWidth/2-seatWidth/2-seatWidth-distanceBetweenSeatsX;var thirdColumnX=canvasWidth/2-seatWidth/2;var fourthColumnX=thirdColumnX+seatWidth+distanceBetweenSeatsX;var currencyDisplayWidth=canvasWidth;var currencyDisplayHeight=15;var currencyDisplayTopOffset=0;var currencyDisplaySizeAndFont="12px "+self.permanentPreferences.defaultFontType.value;var currencyDisplayColor="white";var communityY=220;var distanceBetweenCommunityCards=2;var dealerButtonSource=self.permanentPreferences.sourceObjects.value.dealerButton;var dealerButtonWidth=dealerButtonSource.width;var dealerButtonHeight=dealerButtonSource.height;var topRowSeatDealerButtonX=-dealerButtonWidth/3;var topRowSeatDealerButtonY=seatHeight+dealerButtonHeight*.1;var leftColumnSeatDealerButtonX=seatWidth+dealerButtonWidth*.1;var leftColumnSeatDealerButtonY=0;var bottomRowSeatDealerButtonX=seatWidth+dealerButtonWidth/3;var bottomRowSeatDealerButtonY=-dealerButtonHeight*1.1;var rightColumnSeatDealerButtonX=-dealerButtonWidth*1.1;var rightColumnSeatDealerButtonY=0;var potHeight=14;var potWidth=85;var distanceFromTotalPotSizeToPot0=1;var potSizeAndFont="14px "+self.permanentPreferences.defaultFontType.value;var potTextColor="#FFFFFF";var potDistanceToCommunity=-25;var chipSource=self.permanentPreferences.sourceObjects.value.chips["10"];var chipDiameter=chipSource.width;var distanceBetweenChipsY=3;var betTextHeight=11;var betTextWidth=20;var absoluteDistanceBetweenBetTextAndChipImages=0;var htmlTableChatBoxLeftOffset=checkBoxButtonOffSetLeft;var htmlTableChatBoxBottomOffset=8;var htmlTableChatBoxWidth=140;var htmlTableChatBorderSize=self.jQueryObjects.chatBoxInput.css("border").substring(0,self.jQueryObjects.chatBoxInput.css("border").indexOf("p"));var htmlTableChatBoxHeight=20;var htmlTableChatBoxReminderTextColor="rgb(160,0,0) ";var distanceBetweenBetSizeAndHorizontalSlider=15;var distanceBetweenBetSizeAndCanvasX=firstColumnX;var betSizeWidth=canvasWidth/9.5;var betSizeHeight=25;var verticalBetSliderWidth=6;var verticalBetSliderHeight=13;var distanceFromActionButtonToHorizontalBetSliderX=10;var horizontalBetSliderHeight=7;var chatBoxWidth=seatWidth*1.4;var initialChatBoxHeight=seatHeight/2.3;var absoluteChatDistanceFromSeatY=seatHeight/6;var chatBoxBorderColor="#FFFFFF";var chatBoxFontSize=11;var bottomChipOffsetX=chipDiameter;var bottomChipOffsetY=-cardHeight*shownCardY-chipDiameter*1.5;var leftChipOffsetX=seatWidth+chipDiameter*1.5;var leftChipOffsetY=chipDiameter/2;var topChipOffsetX=seatWidth-chipDiameter;var topChipOffsetY=seatHeight+chipDiameter*1.5;var rightChipOffsetX=-chipDiameter*1.5;var rightChipOffsetY=seatHeight-chipDiameter/2;var cashierButtonSource=self.permanentPreferences.sourceObjects.value.cashierButton;var minCashierButtonTextWidth=132;var distanceBetweenUpperButtonHitAreasY=3;var standUpSource=self.permanentPreferences.sourceObjects.value.standUp;var standUpWidth=standUpSource.width;var standUpHeight=standUpSource.height;var standUpHitAreaUpperLeftOffsetX=6;var standUpHitAreaLowerLeftOffsetX=37;var standUpHitAreaTopOffset=1;var standUpHitAreaBottomOffset=3;var standUpHitAreaRightOffset=1;var exitTableSource=self.permanentPreferences.sourceObjects.value.exitTable;var exitTableWidth=exitTableSource.width;var exitTableHeight=exitTableSource.height;var exitTableHitAreaUpperLeftOffsetX=18;var exitTableHitAreaLowerLeftOffsetX=49;var exitTableHitAreaTopOffset=1;var exitTableHitAreaBottomOffset=9;var exitTableHitAreaRightOffset=1;var getChipsSource=self.permanentPreferences.sourceObjects.value.getChips;var getChipsWidth=getChipsSource.width;var getChipsHeight=getChipsSource.height;var getChipsHitAreaLeftOffset=1;var getChipsHitAreaTopOffset=1;var getChipsHitAreaBottomOffset=10;var getChipsHitAreaUpperRightOffset=9;var getChipsHitAreaLowerRightOffset=38;var showTableChatFullSource=self.permanentPreferences.sourceObjects.value.showTableChatFull;var showTableChatFullWidth=showTableChatFullSource.width;var showTableChatFullHeight=showTableChatFullSource.height;var showTableChatFullHitAreaOffsetLeft=1;var showTableChatFullHitAreaOffsetTop=1;var showTableChatFullHitAreaOffsetBottom=7;var showTableChatFullHitAreaOffsetTopRight=5;var showTableChatFullHitAreaOffsetBottomRight=27;var seatOuterStrokeWidth=1.5;var tableY=88;var disabledButtonOverlayAlpha=.43;this.community[0]=new this.Item(canvasWidth/2-cardWidth/2-cardWidth*2-distanceBetweenCommunityCards*2,communityY,cardWidth,cardHeight,getZ("community"));this.community[1]=new this.Item(canvasWidth/2-cardWidth/2-cardWidth-distanceBetweenCommunityCards,communityY,cardWidth,cardHeight,getZ("community"));this.community[2]=new this.Item(canvasWidth/2-cardWidth/2,communityY,cardWidth,cardHeight,getZ("community"));this.community[3]=new this.Item(canvasWidth/2+cardWidth/2+distanceBetweenCommunityCards,communityY,cardWidth,cardHeight,getZ("community"));this.community[4]=new this.Item(canvasWidth/2+cardWidth/2+cardWidth+2*distanceBetweenCommunityCards,communityY,cardWidth,cardHeight,getZ("community"));this.startingCard=new this.Item(canvasWidth,canvasHeight,cardWidth,cardHeight,getZ("cardAnimation"));this.dealerButton=new this.Item(0,0,dealerButtonWidth,dealerButtonHeight,getZ("dealerChip"));this.dealerButton.addBitmap(self.permanentPreferences.sourceObjects.value.dealerButton);
var chipAndPotZ=getZ("chips");var createPotItems=function(potNumber,firstChipX,firstChipY,options){if(!options){var options={}}var distanceY=distanceBetweenChipsY;var maxPotWidth=distanceX*(self.imageData.maxChipColumns-1)+chipDiameter;var distanceX=self.imageData.distanceBetweenChipColumns+chipDiameter;if(options.columnDirection==="left"){distanceX=distanceX*-1}self.images.pots[potNumber].firstChip=new self.images.Item(firstChipX,firstChipY,chipDiameter,chipDiameter,chipAndPotZ);self.images.pots[potNumber].secondChip=new self.images.Item(firstChipX,firstChipY-distanceY,chipDiameter,chipDiameter,chipAndPotZ);self.images.pots[potNumber].secondColumnChip=new self.images.Item(firstChipX+distanceX,firstChipY,chipDiameter,chipDiameter,chipAndPotZ);if(options.columnDirection!=="left"){self.images.pots[potNumber].potSize=new self.images.Item(firstChipX,firstChipY+chipDiameter,betSizeWidth,potHeight,chipAndPotZ)}else{self.images.pots[potNumber].potSize=new self.images.Item(firstChipX+chipDiameter-betSizeWidth,firstChipY+chipDiameter,betSizeWidth,potHeight,chipAndPotZ)}self.images.pots[potNumber].potSize.addText("",potSizeAndFont,potTextColor,{textAlign:"left"});self.images.pots[potNumber].potSize.text.maxWidth=999999};var pot0X=canvasWidth/2-cardWidth/2-cardWidth;var pot0Y=communityY-potHeight-chipDiameter;createPotItems(0,pot0X,pot0Y);var totalPotWidth=(this.pots[0].secondColumnChip.position.x-this.pots[0].firstChip.position.x)*(self.imageData.maxChipColumns-1)+chipDiameter;var distanceBetweenPots=self.imageData.maxChipColumns;var distanceBetweenChipsInColumn=this.pots[0].firstChip.position.y-this.pots[0].secondChip.position.y;var chipColumnHeight=chipDiameter+(self.imageData.maxChipsPerColumn-1)*distanceBetweenChipsInColumn;var maxChipColumnHeight=(self.imageData.maxChipsPerColumn-1)*(this.pots[0].secondChip.position.x-this.pots[0].firstChip.position.x)+chipDiameter;var maxTotalPotHeight=maxChipColumnHeight+potHeight;this.totalPotSize=new this.Item(this.pots[0].firstChip.position.x,this.pots[0].firstChip.position.y+chipDiameter-chipColumnHeight-potHeight-distanceFromTotalPotSizeToPot0,potWidth,potHeight,chipAndPotZ);this.totalPotSize.addText("",potSizeAndFont,potTextColor);this.totalPotSize.text.maxWidth=null;var pot1X=pot0X+totalPotWidth+distanceBetweenPots;var pot1Y=pot0Y;createPotItems(1,pot1X,pot1Y);var pot2X=self.images.community[4].position.x+self.images.community[4].size.x+1;var pot2Y=pot1Y+potHeight;createPotItems(2,pot2X,pot2Y);var pot3X=pot2X;var pot3Y=pot2Y+maxTotalPotHeight*1.5;createPotItems(3,pot3X,pot3Y);var pot4X=pot1X;var pot4Y=self.images.community[4].position.y+self.images.community[4].size.y+maxChipColumnHeight;createPotItems(4,pot4X,pot4Y);var pot5X=pot0X;var pot5Y=pot4Y;createPotItems(5,pot5X,pot5Y);var pot6X=self.images.community[0].position.x-chipDiameter;var pot6Y=pot3Y;createPotItems(6,pot6X,pot6Y,{columnDirection:"left"});var pot7X=pot6X;var pot7Y=pot2Y;createPotItems(7,pot7X,pot7Y,{columnDirection:"left"});var pot8X=canvasWidth/2-totalPotWidth/2;var pot8Y=this.totalPotSize.position.y-maxTotalPotHeight;createPotItems(8,pot8X,pot8Y);this.htmlTableChatBox=new this.Item(htmlTableChatBoxLeftOffset,canvasHeight-htmlTableChatBoxBottomOffset-htmlTableChatBoxHeight-htmlTableChatBorderSize*2,htmlTableChatBoxWidth,htmlTableChatBoxHeight,getZ("chat","staticItems"));this.htmlTableChatBox.addElement(self.jQueryObjects.chatBoxInput[0],"image");var defaultMessage="Type here to chat";self.jQueryObjects.chatBoxInput.val(defaultMessage);self.jQueryObjects.chatBoxInput.css("color",htmlTableChatBoxReminderTextColor);self.jQueryObjects.chatBoxInput.focus(function(){if(self.jQueryObjects.chatBoxInput.val()==defaultMessage){self.jQueryObjects.chatBoxInput.val("");self.jQueryObjects.chatBoxInput.css("color",self.permanentPreferences.chatTextColor.value)}});self.jQueryObjects.chatBoxInput.focusout(function(){if(/\S/.test(self.jQueryObjects.chatBoxInput.val())){}else{self.jQueryObjects.chatBoxInput.val("Type here to chat");self.jQueryObjects.chatBoxInput.css("color",htmlTableChatBoxReminderTextColor)}});var chatBoxStageParent=self.arrayOfParentsOfStageAndOfContainerArray[self.images.htmlTableChatBox.position.z.stage];var chatBoxStageCanvasZIndex=$(chatBoxStageParent.stage.canvas).css("z-index");self.jQueryObjects.chatBoxInput.css({position:"absolute",left:this.htmlTableChatBox.position.x+"px",top:this.htmlTableChatBox.position.y+"px",width:this.htmlTableChatBox.size.x+"px",height:this.htmlTableChatBox.size.y+"px",padding:"0px",margin:"0px"});self.jQueryObjects.chatBoxInput.keypress(function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode==13){socket.emit("chat",$("#chat").val());$("#chat").val("");self.jQueryObjects.chatBoxInput.focus()}});this.foldToAnyBet=new this.Item(checkBoxButtonOffSetLeft,this.htmlTableChatBox.position.y-checkBoxButtonDistanceFromChat-3*checkBoxButtonHeight-2*checkBoxButtonDistanceY,checkBoxButtonWidth,checkBoxButtonHeight,getZ("buttons","staticItems"),{messages:[["set_flag","check",true],["set_flag","fold",true]]});this.sitOutNextHand=new this.Item(checkBoxButtonOffSetLeft,this.htmlTableChatBox.position.y-checkBoxButtonDistanceFromChat-2*checkBoxButtonHeight-checkBoxButtonDistanceY,checkBoxButtonWidth,checkBoxButtonHeight,getZ("buttons","staticItems"),{messages:["sit_out"]});this.sitOutNextBlind=new this.Item(checkBoxButtonOffSetLeft,this.htmlTableChatBox.position.y-checkBoxButtonDistanceFromChat-checkBoxButtonHeight,checkBoxButtonWidth,checkBoxButtonHeight,getZ("buttons","staticItems"),{messages:["set_flag","post_blind",false]});this.foldToAnyBetOn=new this.Item(this.foldToAnyBet.position.x,this.foldToAnyBet.position.y,this.foldToAnyBet.size.x,this.foldToAnyBet.size.y,getZ("buttons","staticItems"),{messages:[["set_flag","fold",false],["set_flag","check",false]]});this.sitOutNextHandOn=new this.Item(this.sitOutNextHand.position.x,this.sitOutNextHand.position.y,this.sitOutNextHand.size.x,this.sitOutNextHand.size.y,getZ("buttons","staticItems"),{messages:["sit_in"]});this.sitOutNextBlindOn=new this.Item(this.sitOutNextBlind.position.x,this.sitOutNextBlind.position.y,this.sitOutNextBlind.size.x,this.sitOutNextBlind.size.y,getZ("buttons","staticItems"),{messages:["set_flag","post_blind",true]});this.foldToAnyBet.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);this.sitOutNextHand.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);this.sitOutNextBlind.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);this.foldToAnyBetOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);this.sitOutNextHandOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);this.sitOutNextBlindOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.drawCheckBoxButtonHitSquareAndAdjustItemWidth=function(item){var data=item.getChildPositionAndSizeData("text",{maxSize:true});var textWidth=data.currentWidth;var totalWidth=checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText+textWidth;item.size.x=totalWidth;var textHeight=data.outerHeight;if(textHeight>checkBoxButtonHeight){var height=textHeight}else{var height=checkBoxButtonHeight}item.size.y=height;var hitSquare=new createjs.Shape;hitSquare.graphics.beginFill("#FFFFFF").beginStroke(0).drawRect(0,0,item.size.x,item.size.y);if(item.image){item.image.hitArea=hitSquare}return hitSquare};self.images.addCheckBoxButtonText=function(item,text,textOptions){if(!textOptions){var options={}}else{var options=_.clone(textOptions)}update=options.update;options.update=false;if(options.html!==false){options.html=true}var stagesToUpdate=[];if(options.html===true){options.css={"text-align":"left"};item.addText(text,checkBoxButtonSizeAndFont,checkBoxButtonTextColor,options);setDisplayObjectPositionData(item.text,{x:item.position.x+checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText,width:self.getParentOfStageObject(item).stage.canvas.width})}else{throw"";if(item.text instanceof createjs.Text!==true){var text=new createjs.Text(text,checkBoxButtonSizeAndFont,checkBoxButtonTextColor);item.adoptChild(text,"text")}else{if(item.text.text!==text||item.font!==checkBoxButtonSizeAndFont||item.color!==checkBoxButtonTextColor||item.text.x!==item.position.x+checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText||item.text.y!==item.position.y||item.text.baseline!=="top"||item.text.textAlign!=="left"){stagesToUpdate.push(self.easelJSDisplayObjectChanged(item))}item.text.text=text;item.font=checkBoxButtonSizeAndFont;item.color=checkBoxButtonTextColor}item.text.x=item.position.x+checkBoxButtonCheckBoxWidth+checkBoxButtonDistanceFromBoxToText;item.text.y=item.position.y;item.text.baseline="top";item.text.textAlign="left";item.textColor=checkBoxButtonTextColor;item.text.mouseEnabled=false;item.text.hitArea=hit;assignObjectPropertiesAsPropertiesOfDisplayObject(item.text,options)}var hit=self.images.drawCheckBoxButtonHitSquareAndAdjustItemWidth(item);item.image.hitArea=hit;options.update=update;if(update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};self.images.itemsAsCheckBoxes=function(uncheckedItem,checkedItem,text,checkBoxOptions){if(!textOptions){var options={}}else{var options=_.clone(textOptions)}options.html=true;uncheckedItem.addBitmap(checkBoxButtonSource);self.images.addCheckBoxButtonText(uncheckedItem,text,options);checkedItem.addBitmap(checkBoxButtonCheckedSource);self.images.addCheckBoxButtonText(checkedItem,text,options)};self.images.addCheckBoxButtonText(this.foldToAnyBet,"Auto check/fold");self.images.addCheckBoxButtonText(this.sitOutNextHand,"Sit out next hand");self.images.addCheckBoxButtonText(this.sitOutNextBlind,"Sit out next blind");self.images.addCheckBoxButtonText(this.foldToAnyBetOn,"Auto check/fold");self.images.addCheckBoxButtonText(this.sitOutNextHandOn,"Sit out next hand");self.images.addCheckBoxButtonText(this.sitOutNextBlindOn,"Sit out next blind");var seatZ=getZ("seats","staticItems");this.seats[0].seat=new this.Item(thirdColumnX,fourthRowY,seatWidth,seatHeight,seatZ);this.seats[1].seat=new this.Item(secondColumnX,fourthRowY,seatWidth,seatHeight,seatZ);this.seats[2].seat=new this.Item(firstColumnX,thirdRowY,seatWidth,seatHeight,seatZ);this.seats[3].seat=new this.Item(firstColumnX,secondRowY,seatWidth,seatHeight,seatZ);this.seats[4].seat=new this.Item(secondColumnX,firstRowY,seatWidth,seatHeight,seatZ);this.seats[5].seat=new this.Item(thirdColumnX,firstRowY,seatWidth,seatHeight,seatZ);this.seats[6].seat=new this.Item(fourthColumnX,firstRowY,seatWidth,seatHeight,seatZ);this.seats[7].seat=new this.Item(fifthColumnX,secondRowY,seatWidth,seatHeight,seatZ);this.seats[8].seat=new this.Item(fifthColumnX,thirdRowY,seatWidth,seatHeight,seatZ);this.seats[9].seat=new this.Item(fourthColumnX,fourthRowY,seatWidth,seatHeight,seatZ);_.each(_.range(this.seats.length),function(i){var playerSeatObject=self.images.seats[i];var x=playerSeatObject.seat.position.x;var y=playerSeatObject.seat.position.y;var width=playerSeatObject.seat.size.x;var height=playerSeatObject.seat.size.y;playerSeatObject.seat.image=new createjs.Shape;playerSeatObject.seat.image.parentItem=playerSeatObject.seat});for(var i=0;i<this.seats.length;i++){self.images.drawSeat(this.seats[i].seat,"#00008B","#000000","#7d7d7d",{outerStrokeWidth:1});this.seats[i].seat.on("mouseover",self.events.seatMouseEvent);this.seats[i].seat.on("mouseout",self.events.seatMouseEvent);this.seats[i].seat.on("contextmenu",self.events.onDisabledOrNonUserSeatClick,{cursor:false});this.seats[i].openSeat=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y,seatZ);this.seats[i].disabledSeat=new this.Item(this.seats[i].seat.position.x,this.seats[i].seat.position.y,this.seats[i].seat.size.x,this.seats[i].seat.size.y,seatZ);var seatTextX=this.seats[i].seat.position.x+seatOuterStrokeWidth;var seatTopTextY=this.seats[i].seat.position.y+seatOuterStrokeWidth;var seatTextWidth=this.seats[i].seat.size.x-seatOuterStrokeWidth*2;var seatTextHeight=(this.seats[i].seat.size.y-seatOuterStrokeWidth*2)/2;var seatBottomTextY=seatTopTextY+seatTextHeight;this.seats[i].action=new this.Item(seatTextX,seatTopTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].countdown=new this.Item(seatTextX,seatTopTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].winner=new this.Item(seatTextX,seatTopTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].playerName=new this.Item(seatTextX,seatTopTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].status=new this.Item(seatTextX,seatBottomTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].stackSize=new this.Item(seatTextX,seatBottomTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].gettingChips=new this.Item(seatTextX,seatBottomTextY,seatTextWidth,seatTextHeight,seatZ);this.seats[i].sittingOut=new this.Item(seatTextX,seatBottomTextY,seatTextWidth,seatTextHeight,seatZ);var middleOfSeat=this.seats[i].seat.position.x+this.seats[i].seat.size.x/2;var cardY=this.seats[i].seat.position.y-cardHeight*shownCardY;var card0X=middleOfSeat-cardWidth-spaceBetweenHoleCards/2;var card1X=middleOfSeat+spaceBetweenHoleCards/2;this.seats[i].hiddenCards=[];this.seats[i].hiddenCards[0]=new this.Item(card0X,cardY,cardWidth,cardHeight,getZ("holeCards"));this.seats[i].hiddenCards[1]=new this.Item(card1X,cardY,cardWidth,cardHeight,getZ("holeCards"));this.seats[i].shownCards=[];this.seats[i].shownCards[0]=new this.Item(card0X,cardY,cardWidth,cardHeight,getZ("holeCards"));this.seats[i].shownCards[1]=new this.Item(card1X,cardY,cardWidth,cardHeight,getZ("holeCards"));var openSeatFill="#000000";var openSeatMiddle=openSeatMiddle;var openSeatBorder="#FFFFFF";self.images.drawSeat(this.seats[i].openSeat,openSeatBorder,openSeatFill,openSeatMiddle,{outerStrokeWidth:seatOuterStrokeWidth});this.seats[i].openSeat.addText("Open Seat","15px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{html:true,css:{},size:true,position:true});setDisplayObjectPositionData(this.seats[i].openSeat.text,{x:seatTextX,y:seatTopTextY-1,width:seatTextWidth,height:seatTextHeight*2});var disabledBorder="#544E4F";var disabledFill="black";var disabledMiddle=disabledFill;self.images.drawSeat(this.seats[i].disabledSeat,disabledBorder,disabledFill,disabledMiddle,{outerStrokeWidth:seatOuterStrokeWidth});this.seats[i].disabledSeat.image.parentItem=this.seats[i].disabledSeat;self.images.seats[i].disabledSeat.on("contextmenu",self.events.onDisabledOrNonUserSeatClick,{cursor:false});if(self.sessionPreferences.displaySize.value!=="mobile"){}else{}this.cardAsBitmap(this.seats[i].hiddenCards[0],null);this.cardAsBitmap(this.seats[i].hiddenCards[1],null);this.seats[i].shownCards[0].addText("","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.seats[i].shownCards[1].addText("","12px "+self.permanentPreferences.defaultFontType.value,"#000000");this.seats[i].playerName.addText("","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{html:true,"class":self.css.noTranslate});this.seats[i].action.addText("","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.seats[i].countdown.addText("","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.seats[i].winner.addText("","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF");this.seats[i].status.addText("","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{html:true});this.seats[i].stackSize.addText("","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{html:true});this.seats[i].gettingChips.addText("Adding Chips","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{html:true});this.seats[i].sittingOut.addText("Sitting Out","11px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{html:true});var seatLocationMarginOfError=1.1;if(this.seats[i].seat.position.y<firstRowY+seatLocationMarginOfError&&this.seats[i].seat.position.y>firstRowY-seatLocationMarginOfError){var dealerButtonX=this.seats[i].seat.position.x+topRowSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+topRowSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,getZ("dealerChip"));this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+topChipOffsetX,this.seats[i].seat.position.y+topChipOffsetY,chipDiameter,chipDiameter,getZ("chips"));this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x-chipDiameter-self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,getZ("chips"));var distanceBetweenChipsY=this.pots[0].secondChip.position.y-this.pots[0].firstChip.position.y;var upperRightChipX=this.seats[i].firstChip.position.x;var upperRightChipY=this.seats[i].firstChip.position.y+distanceBetweenChipsY*(self.imageData.maxChipsPerColumn-1);var betX=upperRightChipX+chipDiameter+absoluteDistanceBetweenBetTextAndChipImages;var betY=upperRightChipY;this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,getZ("chips"))}else if(this.seats[i].seat.position.x<firstColumnX+seatLocationMarginOfError&&this.seats[i].seat.position.x>firstColumnX-seatLocationMarginOfError){var dealerButtonX=this.seats[i].seat.position.x+leftColumnSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+leftColumnSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,getZ("dealerChip"));this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+leftChipOffsetX,this.seats[i].seat.position.y+leftChipOffsetY,chipDiameter,chipDiameter,getZ("chips"));this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x+chipDiameter+self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,getZ("chips"));var distanceBetweenChipsY=this.pots[0].secondChip.position.y-this.pots[0].firstChip.position.y;var upperLeftChipX=this.seats[i].firstChip.position.x;var upperLeftChipY=this.seats[i].firstChip.position.y-distanceBetweenChipsY*(self.imageData.maxChipsPerColumn-1);var betX=upperLeftChipX-betTextWidth-absoluteDistanceBetweenBetTextAndChipImages;var betY=upperLeftChipY-betTextHeight-absoluteDistanceBetweenBetTextAndChipImages;this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,getZ("chips"))}else if(this.seats[i].seat.position.y<fourthRowY+seatLocationMarginOfError&&this.seats[i].seat.position.y>fourthRowY-seatLocationMarginOfError){this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+bottomChipOffsetX,this.seats[i].seat.position.y+bottomChipOffsetY,chipDiameter,chipDiameter,getZ("chips"));this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x+chipDiameter+self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,getZ("chips"));var bottomLeftChipX=this.seats[i].firstChip.position.x;var bottomLeftChipY=this.seats[i].firstChip.position.y;var betX=bottomLeftChipX-betTextWidth-absoluteDistanceBetweenBetTextAndChipImages;var betY=bottomLeftChipY;var dealerButtonX=this.seats[i].seat.position.x+bottomRowSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+bottomRowSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,getZ("dealerChip"));this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,getZ("chips"))}else if(this.seats[i].seat.position.x<fifthColumnX+seatLocationMarginOfError&&this.seats[i].seat.position.x>fifthColumnX-seatLocationMarginOfError){var dealerButtonX=this.seats[i].seat.position.x+rightColumnSeatDealerButtonX;var dealerButtonY=this.seats[i].seat.position.y+rightColumnSeatDealerButtonY;this.seats[i].dealerButton=new this.Item(dealerButtonX,dealerButtonY,dealerButtonWidth,dealerButtonHeight,getZ("dealerChip"));this.seats[i].firstChip=new this.Item(this.seats[i].seat.position.x+rightChipOffsetX,this.seats[i].seat.position.y+rightChipOffsetY,chipDiameter,chipDiameter,getZ("chips"));this.seats[i].secondColumnChip=new this.Item(this.seats[i].firstChip.position.x-chipDiameter-self.imageData.distanceBetweenChipColumns,this.seats[i].firstChip.position.y,chipDiameter,chipDiameter,getZ("chips"));var bottomRightChipX=this.seats[i].firstChip.position.x;var bottomRightChipY=this.seats[i].firstChip.position.y;var betX=bottomRightChipX-betTextWidth;var betY=bottomRightChipY+chipDiameter+absoluteDistanceBetweenBetTextAndChipImages;this.seats[i].bet=new this.Item(betX,betY,betTextWidth,betTextHeight,getZ("chips"))}var distanceBetweenChipsY=this.pots[0].secondChip.position.y-this.pots[0].firstChip.position.y;this.seats[i].secondChip=new this.Item(this.seats[i].firstChip.position.x,this.seats[i].firstChip.position.y+distanceBetweenChipsY,chipDiameter,chipDiameter,getZ("chips"));this.seats[i].bet.addText("","12px "+self.permanentPreferences.defaultFontType.value,"#FFFFFF",{textAlign:"left"});this.seats[i].bet.text.maxWidth=null;if(this.seats[i].dealerButton instanceof this.Item){this.seats[i].dealerButton.addBitmap(self.permanentPreferences.sourceObjects.value.dealerButton)}else{console.log(i+" is not a seat")}}_.each(_.range(this.seats.length),function(i){var playerSeatObject=self.images.seats[i];var chatX=playerSeatObject.seat.position.x+playerSeatObject.seat.size.x/2-chatBoxWidth/2;var chatY=playerSeatObject.seat.position.y-absoluteChatDistanceFromSeatY;playerSeatObject.chat=new self.images.Item(chatX,chatY,chatBoxWidth,initialChatBoxHeight,getZ("bubbleChat"));playerSeatObject.chat.image=new createjs.Shape;playerSeatObject.chat.image.drawChat=function(width,numLines){if(width==undefined){var width=playerSeatObject.chat.size.x}else if(width>playerSeatObject.chat.size.x){width=playerSeatObject.chat.size.x}playerSeatObject.chat.image.graphics.clear();playerSeatObject.chat.image.parentItem=playerSeatObject.chat;var x=(playerSeatObject.chat.size.x-width)/2;var y=0;playerSeatObject.chat.image.snapToPixel=true;playerSeatObject.chat.image.graphics.setStrokeStyle(1,"round").beginStroke(chatBoxBorderColor).beginFill("#000000").drawRoundRect(x,y-(numLines-1)*(chatBoxFontSize+1),width,playerSeatObject.chat.size.y+(numLines-1)*(chatBoxFontSize+1),playerSeatObject.chat.size.y*.02);self.images.seats[i].chat.image.alpha=self.imageData.chatBoxAlpha;self.positionItemImage(playerSeatObject.chat,{update:false})};playerSeatObject.chat.text=new createjs.Text("",chatBoxFontSize+"px "+self.permanentPreferences.defaultFontType.value,self.permanentPreferences.chatTextColor.value);playerSeatObject.chat.text.x=playerSeatObject.chat.position.x+playerSeatObject.chat.size.x/2;playerSeatObject.chat.text.y=playerSeatObject.chat.position.y;playerSeatObject.chat.text.baseline="top";playerSeatObject.chat.text.textAlign="center";playerSeatObject.chat.text.lineWidth=playerSeatObject.chat.size.x*.85;if(!_.isArray(playerSeatObject.bubbleChats)){playerSeatObject.bubbleChats=[]}var bubbleChatDivWidth=playerSeatObject.chat.size.x*1.1;var bubbleChatDivX=chatX+playerSeatObject.chat.size.x/2-bubbleChatDivWidth/2;var bubbleChatDivHeight=55;var bubbleChatDivY=playerSeatObject.chat.position.y+playerSeatObject.chat.size.y-bubbleChatDivHeight;if(playerSeatObject.bubbleChats[0]instanceof self.images.Item!==true){playerSeatObject.bubbleChats[0]=new self.images.Item(bubbleChatDivX,bubbleChatDivY,bubbleChatDivWidth,bubbleChatDivHeight,playerSeatObject.chat.position.z);var divID="originalSeat"+i+"BubbleChat0";$("#"+divID).remove();var seatDiv=self.arrayOfParentsOfStageAndOfContainerArray[playerSeatObject.seat.position.z.stage].div;$(seatDiv).append('<div id = "'+divID+'"></div>');playerSeatObject.bubbleChats[0].image=$("#"+divID)[0];$(playerSeatObject.bubbleChats[0].image).addClass(self.css.noFat+" "+self.css.unselectable);self.positionItemImage(playerSeatObject.bubbleChats[0]);$(playerSeatObject.bubbleChats[0].image).css({"z-index":9999,"pointer-events":"none"})}});_.each(_.range(this.seats.length),function(seatNumber){_.each(self.images.seats[seatNumber],function(value,index,element){if(_.isArray(self.images.seats[seatNumber][index])){for(var i=0;i<self.images.seats[seatNumber][index].length;i++){self.images.seats[seatNumber][index][i].seatObjectAncestor=self.images.seats[seatNumber]}}else if(_.isObject(self.images.seats[seatNumber][index])){self.images.seats[seatNumber][index].seatObjectAncestor=self.images.seats[seatNumber]}})});var maxActionButtonOffsetBottom=6;var distanceFromBottomOfSeat0ToBottomOfCanvas=canvasHeight-self.images.seats[0].seat.position.y-self.images.seats[0].seat.size.y;console.log("distance fromseat to bottom = "+distanceFromBottomOfSeat0ToBottomOfCanvas);var freeSpace=distanceFromBottomOfSeat0ToBottomOfCanvas-actionButtonHeight;console.log(freeSpace);if(freeSpace<0){var actionButtonY=canvasHeight-actionButtonHeight}else{var actionButtonY=canvasHeight-distanceFromBottomOfSeat0ToBottomOfCanvas+freeSpace/2}this.fold=new this.Item(actionButtonLeftX,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["act","fold"]});this.call=new this.Item(actionButtonLeftX+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["act","call"]});this.check=new this.Item(actionButtonLeftX+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["act","check"]});this.raise=new this.Item(this.check.position.x+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["act","raise"]});this.bet=new this.Item(this.check.position.x+actionButtonWidth+distanceBetweenActionButtons,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["act","bet"]});this.sitIn=new this.Item(actionButtonLeftX,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["sit_in"]});this.rebuy=new this.Item(actionButtonLeftX,actionButtonY,actionButtonWidth,actionButtonHeight,getZ("buttons","staticItems"),{messages:["get_add_chips_info"]});var actionButtonStageNumber=getZ("buttons","staticItems").stage;var actionButtonDiv=self.arrayOfParentsOfStageAndOfContainerArray[actionButtonStageNumber].div;var actionButtonCanvasElement=self.arrayOfParentsOfStageAndOfContainerArray[actionButtonStageNumber].stage.canvas;var actionButtonClass="actionButton";var actionButtonCSS={"font-size":"11px ",font:self.permanentPreferences.defaultFontType.value,position:"absolute","padding-top":"1px","padding-bottom":"1px","padding-left":"2px","padding-right":"2px","font-weight":500};var actionButtonOptions={"class":actionButtonClass,css:actionButtonCSS,attr:{}};actionButtonOptions.attr.id="sitIn";this.sitIn.addBootstrapButton("Sit In",actionButtonOptions);actionButtonOptions.attr.id="rebuy";this.rebuy.addBootstrapButton("Get Chips",actionButtonOptions);actionButtonOptions.attr.id="fold";this.fold.addBootstrapButton("Fold",actionButtonOptions);actionButtonOptions.attr.id="check";this.check.addBootstrapButton("Check",actionButtonOptions);actionButtonOptions.css["font-size"]="11px";actionButtonOptions.attr.id="call";this.call.addBootstrapButton("Call",actionButtonOptions);actionButtonOptions.attr.id="raise";this.raise.addBootstrapButton("Raise",actionButtonOptions);actionButtonOptions.attr.id="bet";this.bet.addBootstrapButton("Bet",actionButtonOptions);var actionButtonInnerHeight=this.call.getChildPositionAndSizeData("image",{position:false,maxSize:false,size:true}).contentHeight;$(this.call.image).add(this.raise.image).add(this.bet.image).css("line-height",actionButtonInnerHeight/2+"px");var betSizeX=canvasWidth-betSizeWidth-distanceBetweenBetSizeAndCanvasX;var betSizeY=self.images.raise.position.y+self.images.raise.size.y/2-betSizeHeight/2;this.betSlider.betSize=new this.Item(betSizeX,betSizeY,betSizeWidth,betSizeHeight,getZ("betSlider"));this.betSlider.betSize.addElement(document.getElementById("betSize"),"image",{css:{position:"absolute",padding:"0px",margin:"0px"}});self.updateBetSize("");$("#betSize").numeric({negative:false},function(){this.value=""});$("#betSize").on("change input paste focus",function(e){self.events.betSizeChanged()});$("#betSize").on("contextmenu",function(e){e.preventDefault()});$("#betSize").focus(function(){$("#betSize").one("mouseup",function(event){event.preventDefault()}).select()});var betSliderX=this.bet.position.x+this.bet.size.x+distanceBetweenActionButtons*.9;var betSliderMiddleY=actionButtonY+actionButtonHeight/2;var betSliderWidth=betSizeX-distanceBetweenActionButtons-betSliderX;var betSliderY=betSliderMiddleY-verticalBetSliderHeight/2;var sliderOptions={slide:function(e,ui){self.events.betSliderChanged(e,ui);var betSliderHandle=$(".ui-slider-handle",self.images.betSlider.slider.image);betSliderHandle.qtip("option","content.text",""+ui.value)}};var jquerySlider=$("<div>").addClass(self.css.unselectable).css({});this.betSlider.slider=new this.Item(betSliderX,betSliderY,betSliderWidth,horizontalBetSliderHeight,getZ("betSlider"));this.betSlider.slider.addElement(jquerySlider[0],"image");$(this.betSlider.slider.image).slider(sliderOptions);var betSliderHandle=$(".ui-slider-handle",jquerySlider);betSliderHandle.qtip({id:"betSlider",content:""+$(this.betSlider.slider.image).slider("option","value"),position:{my:"bottom center",at:"top center",container:betSliderHandle},show:{event:"mousedown",delay:0},hide:{event:"mouseup unfocus",delay:220},events:{show:function(e,api){api.set("content.text",""+$(self.images.betSlider.slider.image).slider("option","value"))}},style:{widget:true}});var upperButtonTextCSS={"font-size":"13px","text-shadow":"0px 2px 1px rgba(0, 0, 0, 1), 0px -2px 1px rgba(0, 0, 0, 1), 2px 0px 1px rgba(0, 0, 0, 1), -2px 0px 1px rgba(0, 0, 0, 1)"+", 5px 8px 10px rgba(0, 0, 0, 0.7), 3.5px 5.5px 6px rgba(0, 0, 0, 0.7)"+", 5px 8px 10px rgba(0, 0, 0, 0.7), 3.5px 5.5px 6px rgba(0, 0, 0, 0.7)","text-align":"left","font-weight":700,"pointer-events":"none"};var upperButtonFontType="Myriad Pro";this.standUp=new this.Item(canvasWidth-standUpWidth,0,standUpWidth,standUpHeight,getZ("buttons","staticItems"));this.standUp.addBitmap(self.permanentPreferences.sourceObjects.value.standUp);var standUpHit=new createjs.Shape;var topY=standUpHitAreaTopOffset;var bottomY=this.standUp.size.y-standUpHitAreaBottomOffset;standUpHit.graphics.beginFill("#000000").setStrokeStyle(0).moveTo(standUpHitAreaUpperLeftOffsetX,topY).lineTo(standUpHitAreaLowerLeftOffsetX,bottomY).lineTo(this.standUp.size.x-standUpHitAreaRightOffset,bottomY).lineTo(this.standUp.size.x-standUpHitAreaRightOffset,topY).lineTo(standUpHitAreaUpperLeftOffsetX,topY);this.standUp.image.hitArea=standUpHit;var standUpTextLeftOffset=73;var standUpTextTopOffset=6;var standUpTextRightOffset=21;var standUpTextBottomOffset=9;var standUpTextWidth=standUpWidth-standUpTextLeftOffset-standUpTextRightOffset;var standUpTextHeight=standUpHeight-standUpTextTopOffset-standUpTextBottomOffset;this.standUp.addText("STAND UP",upperButtonFontType,"white",{html:true,css:upperButtonTextCSS,textAlign:"left"});setDisplayObjectPositionData(this.standUp.text,{x:standUpTextLeftOffset+this.standUp.position.x,y:this.standUp.position.y+standUpTextTopOffset,height:standUpTextHeight},{update:false});this.standUpDisabledShape=new this.Item(this.standUp.position.x+standUpHitAreaUpperLeftOffsetX,this.standUp.position.y+topY,this.standUp.size.x-standUpHitAreaUpperLeftOffsetX-standUpHitAreaRightOffset,this.standUp.size.y-topY-bottomY,{container:getZ("buttons","staticItems").container+2,stage:getZ("buttons","staticItems").stage});this.standUpDisabledShape.image=standUpHit.clone(true);this.standUpDisabledShape.image.x=this.standUp.position.x;this.standUpDisabledShape.image.y=this.standUp.position.y;this.standUpDisabledShape.image.alpha=disabledButtonOverlayAlpha;
this.getChips=new this.Item(0,0,getChipsWidth,getChipsHeight,getZ("buttons","staticItems"),{messages:["get_add_chips_info"]});this.getChips.addBitmap(getChipsSource);var getChipsTextLeftOffset=37;var getChipsTextTopOffset=9;var getChipsTextRightOffset=46;var getChipsTextBottomOffset=21;var getChipsTextWidth=getChipsWidth-getChipsTextLeftOffset-getChipsTextRightOffset;var getChipsTextHeight=getChipsHeight-getChipsTextTopOffset-getChipsTextBottomOffset;this.getChips.addText("GET CHIPS",upperButtonFontType,"white",{html:true,css:upperButtonTextCSS,textAlign:"left"});setDisplayObjectPositionData(this.getChips.text,{x:getChipsTextLeftOffset+this.getChips.position.x-1,y:this.getChips.position.y+getChipsTextTopOffset,height:getChipsTextHeight},{update:false});var getChipsHitTopLeft={x:getChipsHitAreaLeftOffset,y:getChipsHitAreaTopOffset};var getChipsHitBottomLeft={x:getChipsHitTopLeft.x,y:this.getChips.size.y-getChipsHitAreaBottomOffset};var getChipsHitTopRight={x:this.getChips.size.x-getChipsHitAreaUpperRightOffset,y:getChipsHitAreaTopOffset};var getChipsHitBottomRight={x:this.getChips.size.x-getChipsHitAreaLowerRightOffset,y:getChipsHitBottomLeft.y};var getChipsHit=new createjs.Shape;getChipsHit.graphics.beginFill("#000000").beginStroke(0).moveTo(getChipsHitTopLeft.x,getChipsHitTopLeft.y).lineTo(getChipsHitBottomLeft.x,getChipsHitBottomLeft.y).lineTo(getChipsHitBottomRight.x,getChipsHitBottomRight.y).lineTo(getChipsHitTopRight.x,getChipsHitTopRight.y).closePath;this.getChips.image.hitArea=getChipsHit;this.getChipsDisabledShape=new this.Item(getChipsHitTopLeft.x,getChipsHitTopLeft.y,getChipsHitTopRight.x-getChipsHitTopLeft.x,getChipsHitBottomRight.y-getChipsHitTopLeft.y,{container:getZ("buttons","staticItems").container+2,stage:getZ("buttons","staticItems").stage});this.getChipsDisabledShape.image=getChipsHit;this.getChipsDisabledShape.image.alpha=disabledButtonOverlayAlpha;var exitTableOffsetY=distanceBetweenUpperButtonHitAreasY-exitTableHitAreaTopOffset-standUpHitAreaBottomOffset;this.exitTable=new this.Item(canvasWidth-exitTableWidth,standUpHeight,exitTableWidth,exitTableHeight,getZ("buttons","staticItems"));this.exitTable.addBitmap(self.permanentPreferences.sourceObjects.value.exitTable);var exitTableHit=new createjs.Shape;exitTableHit.graphics.beginStroke(0).beginFill("#000000").moveTo(this.exitTable.size.x-exitTableHitAreaRightOffset,exitTableHitAreaTopOffset).lineTo(this.exitTable.size.x-exitTableHitAreaRightOffset,this.exitTable.size.y-exitTableHitAreaBottomOffset).lineTo(exitTableHitAreaLowerLeftOffsetX,this.exitTable.size.y-exitTableHitAreaBottomOffset).lineTo(exitTableHitAreaUpperLeftOffsetX,exitTableHitAreaTopOffset).lineTo(this.exitTable.size.x-exitTableHitAreaRightOffset,exitTableHitAreaTopOffset);this.exitTable.image.hitArea=exitTableHit;this.exitTable.on("click",self.events.exitTableClick);var currencyDisplayX=canvasWidth/2-currencyDisplayWidth/2;this.currencyDisplay=new this.Item(currencyDisplayX,currencyDisplayTopOffset,currencyDisplayWidth,currencyDisplayHeight,getZ("buttons","staticItems"));this.currencyDisplay.addText("",currencyDisplaySizeAndFont,currencyDisplayColor);var fourColorDeckData={images:[self.permanentPreferences.sourceObjects.value.fourColorDeck],frames:{width:37,height:45}};self.images.messageBox=[];this.table=new this.Item(0,tableY,0,0,getZ("table","staticItems"));this.table.addBitmap(self.permanentPreferences.sourceObjects.value.table);var tableX=canvasWidth/2-this.table.size.x/2;self.setImageItemPositionAndTextBasedOnImageChange(this.table,tableX,null,{update:false});self.images.createCashier=function(){var cashierImageContainerIndex=getZ("background","cashier").container;var cashierStageNumber=getZ("background","cashier").stage;var cashierWindowContainer=0;var cashierWindowSource=self.permanentPreferences.sourceObjects.value.cashierBackground;var cashierWindowWidth=cashierWindowSource.width;var cashierWindowHeight=cashierWindowSource.height;var textLeftOffset=13;var textTopOffset=4;var textRightOffset=136;var textHeight=13;var distanceBetweenTextY=5;var sizeAndFont="12px "+self.permanentPreferences.defaultFontType.value;var textColor="#000000";var outerTopHeight=31;var outerBottomHeight=8;var outerSideWidth=8;var columns=2;var rows=10;var cashierWindowX=canvasWidth/2-cashierWindowWidth/2;var cashierWindowY=canvasHeight/2-cashierWindowHeight/2;var closeWindowSource=self.permanentPreferences.sourceObjects.value.cashierCloseX;var closeWindowWidth=closeWindowSource.width;var closeWindowHeight=closeWindowSource.height;var closeWindowY=cashierWindowY+1;var closeWindowX=cashierWindowX+cashierWindowWidth-closeWindowWidth-7;var innerCashierX=cashierWindowX+outerSideWidth;var innerCashierY=cashierWindowY+outerTopHeight;var innerCashierWidth=cashierWindowWidth-2*outerSideWidth-2;var innerCashierHeight=cashierWindowHeight-outerBottomHeight-outerTopHeight;var textX=innerCashierX+textLeftOffset;var textBoxOffsetLeft=135;var textBoxOffsetRight=23;var textBoxToTextHeightRatio=1.8;var distanceFromGrayBoxTopToFirstTextBox=15;var textBoxHeight=textHeight*textBoxToTextHeightRatio;var textBoxWidth=innerCashierWidth-textBoxOffsetRight-textBoxOffsetLeft;var distanceBetweenTextBoxY=textBoxToTextHeightRatio*distanceBetweenTextY;var radioOffsetLeft=19.5;var radioWidth=13;var radioHeight=radioWidth;var distanceFromRadioToText=6;var grayBoxOffsetTop=151;var htmlTextWidth=textBoxOffsetLeft-radioWidth-distanceFromRadioToText-radioOffsetLeft;var grayBoxOffsetSide=11;var grayBoxOffsetTop=150;var grayBoxOffsetBottom=49;this.cashier.closeWindow=new this.Item(closeWindowX,closeWindowY,closeWindowWidth,closeWindowHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.closeWindow.addBitmap(self.permanentPreferences.sourceObjects.value.cashierCloseX);this.cashier.closeWindow.on("click",self.hideCashier);this.cashier.window=new this.Item(cashierWindowX,cashierWindowY,cashierWindowWidth,cashierWindowHeight,{stage:cashierStageNumber,container:cashierWindowContainer});this.cashier.window.addBitmap(self.permanentPreferences.sourceObjects.value.cashierBackground);var clickAndDragHitArea=new createjs.Rectangle(this.cashier.window.position.x,this.cashier.window.y,cashierWindowWidth,outerTopHeight);this.cashier.window.image.removeAllEventListeners();this.cashier.window.on("mousedown",function(e){self.events.mouseDownClickAndDrag(e,{animationTarget:self.images.cashier})});var textColumnX=[];var textColumnWidth=[];var textRowY=[];for(var i=0;i<rows;i++){textRowY.push(cashierWindowY+outerTopHeight+textTopOffset+i*(textHeight+distanceBetweenTextY))}for(var i=0;i<columns;i++){if(i%columns==0){textColumnX.push(cashierWindowX+outerSideWidth+textLeftOffset)}else if(i%columns==1){textColumnX.push(cashierWindowX+cashierWindowWidth-outerSideWidth-textRightOffset)}}for(var i=0;i<columns;i++){if(i%columns==0){textColumnWidth.push(textColumnX[(i+1)%columns]-textColumnX[i])}else if(i%columns==1){textColumnX.push(cashierWindowX+cashierWindowWidth-outerSideWidth-textColumnX[i])}}var cashierItems={};cashierItems.currency={name:"currency",location:[0,0]};cashierItems.blinds={name:"blinds",location:[1,0]};cashierItems.tableName={name:"tableName",location:[0,1],text:"Table Name:"};cashierItems.tableNameValue={name:"tableNameValue",location:[1,1]};cashierItems.tableMin={name:"tableMin",location:[0,2],text:"Table Minimum:"};cashierItems.tableMinValue={name:"tableMinValue",location:[1,2]};cashierItems.tableMax={name:"tableMax",location:[0,3],text:"Table Maximum:"};cashierItems.tableMaxValue={name:"tableMaxValue",location:[1,3]};cashierItems.playerMin={name:"playerMin",location:[0,4],text:"Minimum Add-On:"};cashierItems.playerMinValue={name:"playerMinValue",location:[1,4]};cashierItems.accountBalance={name:"accountBalance",location:[0,5],text:"Available Balance:"};cashierItems.accountBalanceValue={name:"accountBalanceValue",location:[1,5]};cashierItems.autoRebuy={name:"autoRebuy",location:[0,6],text:"Auto-Rebuy:"};cashierItems.autoRebuyValue={name:"autoRebuyValue",location:[1,6]};var rowsUsed=7;setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(self.images.cashier.window,false);$("#cashier input[type='radio']").css({background:"rgb(233,233,233)","background-image":"img/radio_button_bg.jpg","background-repeat":"repeat","-webkit-backface-visibility":"hidden"});var radioX=innerCashierX+radioOffsetLeft;var maxTextBoxY=innerCashierY+grayBoxOffsetTop+distanceFromGrayBoxTopToFirstTextBox;var textBoxX=innerCashierX+textBoxOffsetLeft;var maxRadioY=maxTextBoxY+textBoxHeight/2-radioHeight/2;var textX=radioX+radioWidth+distanceFromRadioToText;var cashierParentOfStage=self.arrayOfParentsOfStageAndOfContainerArray[self.images.cashier.window.position.z.stage];var cashierStageCanvasZIndex=parseInt($(cashierParentOfStage.stage.canvas).css("z-index"));$(cashierParentOfStage.div).append($("#cashierDiv"));var stuffToAppend=$("#cashierDiv").find("*").addBack("#cashierDiv");$("#cashierDiv").css({"z-index":parseInt(cashierStageCanvasZIndex)+1,width:cashierParentOfStage.stage.canvas.width,height:cashierParentOfStage.stage.canvas.height,left:0,top:0});$("#cashier input[type='text']").css({width:textBoxWidth+"px",height:textBoxHeight+"px"});$("#cashier input[type='text']").numeric({negative:false},function(){this.value=""});$("#cashier input[type='text']").attr("autocomplete","off");$("#cashier input[type ='radio']").addClass(self.css.unselectable);$("#cashier p").addClass(self.css.unselectable);$("#cashier").children().children().css({font:sizeAndFont,margin:0,padding:0,display:"none"});$("#cashier p").css({"max-width":htmlTextWidth+"px",width:htmlTextWidth+"px",height:textBoxHeight+"px","white-space":"nowrap"});$("#otherAmountDiv").children().off();$("#autoRebuyDiv").children().off();$("#maxDiv").children().off();$("#cashierDiv").find("input[type = 'text']").off();$("#cashierDiv").on("mousedown keydown keyup",self.events.cashier);$("#cashierDiv").find("input[type = 'text']").on("focus focusout input paste",self.events.cashier);var cashierTextBoxNumericOptions={negative:false};this.cashier.maxRadio=new this.Item(radioX,maxRadioY,radioWidth,radioHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.maxRadio.addElement($("#maxRadio")[0],"image",{position:true});this.cashier.maxText=new this.Item(textX,maxRadioY,htmlTextWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.maxText.addElement($("#maxText")[0],"text",{position:true});this.cashier.maxAmount=new this.Item(textBoxX,maxTextBoxY,textBoxWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.maxAmount.addElement($("#maxAmount")[0],"image",{position:true});var otherTextBoxY=maxTextBoxY+textBoxHeight+distanceBetweenTextBoxY;var otherRadioY=otherTextBoxY+textBoxHeight/2-radioHeight/2;this.cashier.otherAmountRadio=new this.Item(radioX,otherRadioY,radioWidth,radioHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.otherAmountRadio.addElement($("#otherAmountRadio")[0],"image",{position:true});this.cashier.otherAmountText=new this.Item(textX,otherRadioY,htmlTextWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.otherAmountText.addElement($("#otherAmountText")[0],"text",{position:true});this.cashier.otherAmount=new this.Item(textBoxX,otherTextBoxY,textBoxWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.otherAmount.addElement($("#otherAmount")[0],"image");var autoRebuyTextBoxY=otherTextBoxY+textBoxHeight+distanceBetweenTextBoxY;var autoRebuyRadioY=autoRebuyTextBoxY+textBoxHeight/2-radioHeight/2;this.cashier.autoRebuyAmount=new this.Item(textBoxX,autoRebuyTextBoxY,textBoxWidth,textBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.autoRebuyAmount.addElement($("#autoRebuyAmount")[0],"image");for(var i in cashierItems){if(_.isArray(cashierItems[i].location)){this.cashier[cashierItems[i].name]=new this.Item(textColumnX[cashierItems[i].location[0]],textRowY[cashierItems[i].location[1]],textColumnWidth[0],textHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});if(cashierItems[i].text){var text=cashierItems[i].text}else{var text=""}this.cashier[cashierItems[i].name].text=new createjs.Text(text,sizeAndFont,textColor);this.cashier[cashierItems[i].name].text.x=this.cashier[cashierItems[i].name].position.x;this.cashier[cashierItems[i].name].text.y=this.cashier[cashierItems[i].name].position.y+1;this.cashier[cashierItems[i].name].text.baseline="top";this.cashier[cashierItems[i].name].text.textAlign="left";this.cashier[cashierItems[i].name].text.maxWidth=this.cashier[cashierItems[i].name].size.x*.9}}var grayBoxX=cashierWindowX+outerSideWidth+grayBoxOffsetSide;var grayBoxY=cashierWindowY+outerTopHeight+grayBoxOffsetTop;var grayBoxWidth=cashierWindowWidth-2*outerSideWidth-2*grayBoxOffsetSide;var grayBoxHeight=cashierWindowY+cashierWindowHeight-outerBottomHeight-grayBoxOffsetBottom-grayBoxY;this.cashier.grayBox=new this.Item(grayBoxX,grayBoxY,grayBoxWidth,grayBoxHeight,{stage:cashierStageNumber,container:cashierImageContainerIndex});this.cashier.addChipsTextBox=new this.Item(textX,this.cashier.accountBalance.position.y+25,innerCashierWidth,25,{stage:cashierStageNumber,container:cashierImageContainerIndex});var addChipsText="Add Chips";var cancelText="Cancel";var enableAutoRebuyText="Auto-Rebuy to:";var disableAutoRebuyText="Disable<br>Auto-Rebuy";var disableAutoRebuyFontSize=9;var disableAutoRebuyTextSizeAndFont=disableAutoRebuyFontSize+"px "+self.permanentPreferences.defaultFontType.value;var cashierButtonFontSize=11;var cashierButtonTextSizeAndFont=cashierButtonFontSize+"px "+self.permanentPreferences.defaultFontType.value;var cashierButtonHeight=28;var cashierButtonTextColor="white";var cashierButtonColor="blue";var cashierRatioOfTextWidthToButtonWidth=.88;var cashierButtonOptions={"class":"cashierButton",css:{font:cashierButtonTextSizeAndFont},attr:{},onClick:function(e){console.log(e)}};var enableAutoRebuyWidth=htmlTextWidth+radioWidth;this.cashier.enableAutoRebuy=new this.Item(radioX,autoRebuyRadioY+radioHeight/2-cashierButtonHeight/2,enableAutoRebuyWidth,textBoxHeight,getZ("buttons","cashier"));this.cashier.enableAutoRebuy.addBootstrapButton(enableAutoRebuyText,cashierButtonOptions);var cashierButtonSizeData=getDisplayObjectPositionAndSizeData(this.cashier.enableAutoRebuy.image,{position:false});var cashierButtonExtraWidth=cashierButtonSizeData.extraWidth;var cashierButtonExtraHeight=cashierButtonSizeData.extraHeight;$(this.cashier.enableAutoRebuy.image).button();var disableAutoRebuyOptions={"class":cashierButtonOptions.class,css:{font:disableAutoRebuyTextSizeAndFont,"line-height":(cashierButtonHeight-cashierButtonExtraHeight)/2+"px"},attr:{id:"disableAutoRebuy"}};$(this.cashier.enableAutoRebuy.image).off("click");$(this.cashier.enableAutoRebuy.image).on("click",function(e){socket.emit("set_flag","autorebuy",parseInt($(self.images.cashier.autoRebuyAmount.image).val()));e.stopPropagation()});var addChipsTextWidth=self.getStringWidth(addChipsText,cashierButtonTextSizeAndFont)/cashierRatioOfTextWidthToButtonWidth;var cancelTextWidth=self.getStringWidth(cancelText,cashierButtonTextSizeAndFont)/cashierRatioOfTextWidthToButtonWidth;var disableAutoRebuyTextWidth=self.getStringWidth("Auto-Rebuy",disableAutoRebuyTextSizeAndFont)/cashierRatioOfTextWidthToButtonWidth;if(addChipsTextWidth>=cancelTextWidth){var minCashierButtonTextWidth=addChipsTextWidth}else{var minCashierButtonTextWidth=cancelTextWidth}var innerCashierBottomY=innerCashierY+innerCashierHeight;var cashierButtonY=innerCashierBottomY-grayBoxOffsetBottom+(grayBoxOffsetBottom-cashierButtonHeight)/2;this.cashier.disableAutoRebuy=new this.Item(0,cashierButtonY,disableAutoRebuyTextWidth,cashierButtonHeight,getZ("buttons","cashier"),{messages:["set_flag","autorebuy",false]});this.cashier.disableAutoRebuy.addBootstrapButton(disableAutoRebuyText,disableAutoRebuyOptions);this.cashier.addChips=new this.Item(0,cashierButtonY,addChipsTextWidth,cashierButtonHeight,getZ("buttons","cashier"));this.cashier.addChips.addBootstrapButton(addChipsText,cashierButtonOptions);$(this.cashier.addChips.image).button();$(this.cashier.addChips.image).off("click");$(this.cashier.addChips.image).on("click",function(e){self.events.onAddChipsClick(e)});this.cashier.cancel=new this.Item(0,cashierButtonY,cancelTextWidth,cashierButtonHeight,getZ("buttons","cashier"));this.cashier.cancel.addBootstrapButton(cancelText,cashierButtonOptions);$(this.cashier.cancel.image).off("click");$(this.cashier.cancel.image).on("click",function(e){self.hideCashier()});$(this.cashier.addChips.image).on("contextmenu",function(e){return false});$(this.cashier.cancel.image).on("contextmenu",function(e){return false});$(this.cashier.disableAutoRebuy.image).on("contextmenu",function(e){return false});self.images.positionCashierButtons=function(displayDisableAutoRebuy,theseOptions){console.log("positioncashier buttons called extraWidthFat = "+cashierButtonExtraWidth);if(!theseOptions){var options={}}else{var options=_.clone(theseOptions)}options.size=true;options.update=false;var stagesToUpdate=[];var goingToDisplayDisableAutoRebuy;if(displayDisableAutoRebuy===true||displayDisableAutoRebuy===false){goingToDisplayDisableAutoRebuy=displayDisableAutoRebuy}else if($(this.cashier.disableAutoRebuy.image).css("display")==="none"){var disableAutoRebuyDisplayed=false}else{var disableAutoRebuyDisplayed=true}var cashierButtonWidth=minCashierButtonTextWidth+cashierButtonExtraWidth;var addChipsX;var cancelX;var disableRebuyWidth=disableAutoRebuyTextWidth+cashierButtonExtraWidth;var cashierWindowLocation=getDisplayObjectPositionAndSizeData(self.images.cashier.window.image,{size:false});var cashierOffsetX=cashierWindowLocation.x-self.images.cashier.window.position.x;var cashierOffsetY=cashierWindowLocation.y-self.images.cashier.window.position.y;if(goingToDisplayDisableAutoRebuy===true){if(cashierButtonWidth<disableRebuyWidth){var cashierButtonWidth=disableAutoRebuyTextWidth}var distanceBetweenCashierButtons=(innerCashierWidth-cashierButtonWidth*3)/4;var cancelX=cashierWindowX+cashierWindowWidth/2-cashierButtonWidth/2;var addChipsX=cancelX-distanceBetweenCashierButtons-cashierButtonWidth;var disableAutoRebuyX=cancelX+distanceBetweenCashierButtons+cashierButtonWidth;this.cashier.disableAutoRebuy.position.x=disableAutoRebuyX;this.cashier.disableAutoRebuy.size.x=cashierButtonWidth;stagesToUpdate.push(this.cashier.disableAutoRebuy.updateImageLocationAndSize(options));stagesToUpdate.push(self.displayChildren(this.cashier.disableAutoRebuy,options))}else{stagesToUpdate.push(self.hideChildren(this.cashier.disableAutoRebuy,options));var distanceBetweenCashierButtons=(innerCashierWidth-minCashierButtonTextWidth*2)/3;var addChipsX=cashierWindowX+cashierWindowWidth/2-distanceBetweenCashierButtons/2-cashierButtonWidth;var cancelX=cashierWindowX+cashierWindowWidth/2+distanceBetweenCashierButtons/2}this.cashier.addChips.position.x=addChipsX;this.cashier.addChips.size.x=cashierButtonWidth;stagesToUpdate.push(this.cashier.addChips.updateImageLocationAndSize(options));this.cashier.cancel.position.x=cancelX;this.cashier.cancel.size.x=cashierButtonWidth;stagesToUpdate.push(this.cashier.cancel.updateImageLocationAndSize(options));var cashierButtons=[this.cashier.addChips,this.cashier.cancel,this.cashier.disableAutoRebuy];stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(cashierButtons,cashierOffsetX,cashierOffsetY,{permanent:false,movementType:"relative"}));if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};self.images.positionCashierButtons(true,{update:false})};self.images.createCashier();var showTableChatFullOffsetY=distanceBetweenUpperButtonHitAreasY-showTableChatFullHitAreaOffsetTop-getChipsHitAreaBottomOffset;this.showTableChatFull=new this.Item(this.getChips.position.x,this.getChips.position.y+this.getChips.size.y+showTableChatFullOffsetY,showTableChatFullWidth,showTableChatFullHeight,getZ("buttons","staticItems"));this.showTableChatFull.addBitmap(showTableChatFullSource);this.showTableChatFull.on("click",self.events.showTableChatFullOnClick);var showTableChatFullTextLeftOffset=4;var showTableChatFullTextTopOffset=6;var standUpTextRightOffset=30;var showTableChatFullTextBottomOffset=14;var showTableChatFullTextHeight=showTableChatFullHeight-showTableChatFullTextTopOffset-showTableChatFullTextBottomOffset;this.showTableChatFull.addText("SHOW CHAT",upperButtonFontType,"white",{html:true,css:upperButtonTextCSS,textAlign:"left"});setDisplayObjectPositionData(this.showTableChatFull.text,{x:showTableChatFullTextLeftOffset+this.showTableChatFull.position.x,y:this.showTableChatFull.position.y+showTableChatFullTextTopOffset,height:showTableChatFullTextHeight},{update:false});this.hideTableChatFull=new this.Item(this.getChips.position.x,this.getChips.position.y+this.getChips.size.y+showTableChatFullOffsetY,showTableChatFullWidth,showTableChatFullHeight,getZ("buttons","staticItems"));this.hideTableChatFull.addBitmap(self.permanentPreferences.sourceObjects.value.hideTableChatFull);this.hideTableChatFull.on("click",self.events.hideTableChatFullOnClick);this.hideTableChatFull.addText("HIDE CHAT",upperButtonFontType,"white",{html:true,css:upperButtonTextCSS,textAlign:"left"});setDisplayObjectPositionData(this.hideTableChatFull.text,{x:showTableChatFullTextLeftOffset+this.showTableChatFull.position.x,y:this.showTableChatFull.position.y+showTableChatFullTextTopOffset,height:showTableChatFullTextHeight},{update:false});var showTableChatFullHitArea=new createjs.Shape;showTableChatFullHitArea.graphics.beginStroke(0).beginFill("#000000").moveTo(showTableChatFullHitAreaOffsetLeft,showTableChatFullHitAreaOffsetTop).lineTo(showTableChatFullHitAreaOffsetLeft,showTableChatFullHeight-showTableChatFullHitAreaOffsetBottom).lineTo(showTableChatFullWidth-showTableChatFullHitAreaOffsetBottomRight,showTableChatFullHeight-showTableChatFullHitAreaOffsetBottom).lineTo(showTableChatFullWidth-showTableChatFullHitAreaOffsetTopRight,showTableChatFullHitAreaOffsetTop).lineTo(showTableChatFullHitAreaOffsetLeft,showTableChatFullHitAreaOffsetTop);this.showTableChatFull.image.hitArea=showTableChatFullHitArea;this.hideTableChatFull.image.hitArea=showTableChatFullHitArea;var tableChatFullLeftOffset=5;var tableChatFullTopOffsetFromHideChat=4;var tableChatFullBottomOffsetFromFoldToAnyBetButton=5;var tableChatFullRightOffsetFromMiddleSeat=10;this.tableChatFull={};var tableChatFullDivX=tableChatFullLeftOffset;var tableChatFullDivY=tableChatFullTopOffsetFromHideChat+this.hideTableChatFull.position.y+this.hideTableChatFull.size.y;var tableChatFullStageWidth=this.seats[0].seat.position.x-tableChatFullDivX-tableChatFullRightOffsetFromMiddleSeat;var tableChatFullStageHeight=this.foldToAnyBet.position.y-tableChatFullBottomOffsetFromFoldToAnyBetButton-tableChatFullDivY;this.tableChatFull.htmlDivElement=new this.Item(tableChatFullDivX,tableChatFullDivY,tableChatFullStageWidth,tableChatFullStageHeight,getZ("background","tableChatFull"));this.tableChatFull.htmlCanvasElement=new this.Item(0,0,tableChatFullStageWidth,tableChatFullStageHeight,getZ("background","tableChatFull"));var tableChatFullStageParent=self.getParentOfStageObject(this.tableChatFull.htmlCanvasElement);$(tableChatFullStageParent.div).css({left:tableChatFullDivX+"px",top:tableChatFullDivY+"px",height:"auto",width:"auto","float":"left",width:this.tableChatFull.htmlCanvasElement.size.x+"px",height:this.tableChatFull.htmlCanvasElement.size.y+"px",overflow:"hidden","pointer-events":"visible"});$(tableChatFullStageParent.stage.canvas).attr({width:this.tableChatFull.htmlCanvasElement.size.x+"px",height:this.tableChatFull.htmlCanvasElement.size.y+"px"});var tableChatFullWindowBackgroundColor=self.permanentPreferences.tableChatFull.windowColor.value;var tableChatFullWindowBorderColor="#000000";var tableChatFullWindowBorderWidth=1;var tableChatFullWindowAlpha=self.permanentPreferences.tableChatFull.windowAlpha.value;var tableChatFullRoundedRectCornerSizeRatioOfHeight=.05;this.tableChatFull.window=new this.Item(0,0,tableChatFullStageWidth,tableChatFullStageHeight,getZ("background","tableChatFull"));this.tableChatFull.window.drawImage=function(){var canvas=self.getParentOfStageObject(this).stage.canvas;var width=canvas.width;var height=canvas.height;if(this.image instanceof createjs.Shape){this.image.graphics.clear()}else{this.image=new createjs.Shape}this.image.graphics.beginFill(tableChatFullWindowBackgroundColor).setStrokeStyle(tableChatFullWindowBorderWidth,"round").beginStroke(tableChatFullWindowBorderColor).drawRoundRect(this.position.x,this.position.y,width,height,tableChatFullRoundedRectCornerSizeRatioOfHeight*this.size.y);this.image.alpha=tableChatFullWindowAlpha};this.tableChatFull.window.drawImage();var hideDealerMessagesOffsetLeft=this.tableChatFull.htmlCanvasElement.size.x*.05;var hideDealerMessagesOffsetRight=hideDealerMessagesOffsetLeft;var hideDealerMessagesOffsetTop=checkBoxButtonDistanceY;this.tableChatFull.hideDealerMessages=new this.Item(hideDealerMessagesOffsetLeft,hideDealerMessagesOffsetTop,this.tableChatFull.window.size.x-checkBoxButtonOffSetLeft*2,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.hideDealerMessages.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.hideDealerMessages,"Hide dealer messages");this.tableChatFull.hideDealerMessages.on("click",self.events.hideDealerMessagesClicked);this.tableChatFull.hideDealerMessagesOn=new this.Item(hideDealerMessagesOffsetLeft,this.tableChatFull.hideDealerMessages.position.y,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.hideDealerMessagesOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.hideDealerMessagesOn,"Hide dealer messages");this.tableChatFull.hideDealerMessagesOn.on("click",self.events.hideDealerMessagesOnClicked);this.tableChatFull.hidePlayerMessages=new this.Item(hideDealerMessagesOffsetLeft,hideDealerMessagesOffsetTop*2+checkBoxButtonHeight,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.hidePlayerMessages.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.hidePlayerMessages,"Hide player messages");this.tableChatFull.hidePlayerMessages.on("click",self.events.hidePlayerMessagesClicked);this.tableChatFull.hidePlayerMessagesOn=new this.Item(hideDealerMessagesOffsetLeft,this.tableChatFull.hidePlayerMessages.position.y,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.hidePlayerMessagesOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.hidePlayerMessagesOn,"Hide player messages");this.tableChatFull.hidePlayerMessagesOn.on("click",self.events.hidePlayerMessagesOnClicked);this.tableChatFull.hideObserverMessages=new this.Item(hideDealerMessagesOffsetLeft,checkBoxButtonDistanceY*3+checkBoxButtonHeight*2,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.hideObserverMessages.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.hideObserverMessages,"Hide observer messages");this.tableChatFull.hideObserverMessages.on("click",self.events.hideObserverMessagesClicked);this.tableChatFull.hideObserverMessagesOn=new this.Item(hideDealerMessagesOffsetLeft,this.tableChatFull.hideObserverMessages.position.y,this.tableChatFull.hideDealerMessages.size.x,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.hideObserverMessagesOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.hideObserverMessagesOn,"Hide observer messages");this.tableChatFull.hideObserverMessagesOn.on("click",self.events.hideObserverMessagesOnClicked);var longestLeftSideCheckBoxAndTextItemWidth=this.tableChatFull.hideObserverMessages.size.x;if(this.tableChatFull.hidePlayerMessages.size.x>longestLeftSideCheckBoxAndTextItemWidth){longestLeftSideCheckBoxAndTextItemWidth=this.tableChatFull.hidePlayerMessages.size.x}if(this.tableChatFull.hideDealerMessages.size.x>longestLeftSideCheckBoxAndTextItemWidth){longestLeftSideCheckBoxAndTextItemWidth=this.tableChatFull.hidePlayerMessages.size.x}var rightSideCheckBoxX=this.tableChatFull.hideDealerMessages.position.x+longestLeftSideCheckBoxAndTextItemWidth+hideDealerMessagesOffsetRight;var rightSideCheckBoxY=this.tableChatFull.hideDealerMessages.position.y;this.tableChatFull.popOut=new this.Item(rightSideCheckBoxX,rightSideCheckBoxY,0,checkBoxButtonHeight,getZ("buttons","tableChatFull"));this.tableChatFull.popOut.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);self.images.addCheckBoxButtonText(this.tableChatFull.popOut,"Pop-Out");this.tableChatFull.popOut.on("click",self.events.popOutClicked);this.tableChatFull.popOutOn=new this.Item(this.tableChatFull.popOut.position.x,this.tableChatFull.popOut.position.y,this.tableChatFull.popOut.size.x,checkBoxButtonHeight,getZ("text","tableChatFull"));this.tableChatFull.popOutOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(this.tableChatFull.popOutOn,"Pop-Out");this.tableChatFull.popOutOn.on("click",self.events.popOutOnClicked);var chatTextDivTextOffsetLeft=checkBoxButtonOffSetLeft-1;var chatTextDivTextOffsetRight=checkBoxButtonOffSetLeft-1;var chatTextDivTextOffsetTopFromLastButton=3;var chatTextDivTextOffsetBottom=this.tableChatFull.window.size.y*tableChatFullRoundedRectCornerSizeRatioOfHeight;var chatTextDivX=this.tableChatFull.htmlCanvasElement.position.x+chatTextDivTextOffsetLeft;var chatTextDivY=this.tableChatFull.htmlCanvasElement.position.y+this.tableChatFull.hideObserverMessages.position.y+this.tableChatFull.hideObserverMessages.size.y+chatTextDivTextOffsetTopFromLastButton;var chatTextDivWidth=this.tableChatFull.htmlCanvasElement.size.x;var chatTextDivHeight=this.tableChatFull.htmlCanvasElement.size.y-chatTextDivTextOffsetBottom-(chatTextDivY-this.tableChatFull.htmlCanvasElement.position.y);this.tableChatFull.chatTextDiv=new this.Item(chatTextDivX,chatTextDivY,chatTextDivWidth,chatTextDivHeight,getZ("background","tableChatFull"));this.tableChatFull.chatTextDiv.addElement($("#tableChatFullTextDiv")[0],"image");var tableChatFullParentOfStage=self.arrayOfParentsOfStageAndOfContainerArray[this.tableChatFull.chatTextDiv.position.z.stage];var tableChatFullStageCanvasZIndex=$(tableChatFullParentOfStage.stage.canvas).css("z-index");$(tableChatFullParentOfStage.div).append(self.jQueryObjects.tableChatFullDiv);$(this.tableChatFull.chatTextDiv.image).css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"});var scrollBarInnerWidth=2;var scrollBarBorderWidth=1;var scrollBarTotalWidth=scrollBarInnerWidth+2*scrollBarBorderWidth;var chatMessageOffsetLeft=0;var chatMessageOffsetRight=0;var chatMessageOffsetTop=0;var chatMessageOffsetBottom=chatMessageOffsetTop;this.tableChatFull.chatMessageText=new this.Item(chatMessageOffsetLeft,chatMessageOffsetTop,chatTextDivWidth-chatMessageOffsetLeft-chatMessageOffsetRight,chatTextDivHeight-chatMessageOffsetTop-chatMessageOffsetBottom,getZ("text","tableChatFull"));var chatMessageFontSize=self.permanentPreferences.tableChatFull.chatMessageFontSize.value;var chatMessageFont="Lucida Sans";var chatMessageFontColor=self.permanentPreferences.tableChatFull.chatMessageFontColor.value;this.tableChatFull.chatMessageText.text=document.getElementById("tableChatFullTextDiv");
var messageTextScrollBarNiceScrollOptions={cursorwidth:3,cursorborderwidth:scrollBarBorderWidth+"px solid #FFF",enablescrollonselection:false,horizrailenabled:false,hwacceleration:false,bouncescroll:false,cursoropacitymax:self.permanentPreferences.tableChatFull.windowAlpha.value,autohidemode:false,touchbehavior:true,zindex:parseInt(tableChatFullStageCanvasZIndex)+1,background:"transparent"};var mCustomScrollbarOptions={theme:"light",updateOnContentResize:true,scrollButtons:{enable:true},callbacks:{onScrollStart:function(){console.log("scrolling started")}},set_height:this.tableChatFull.chatTextDiv.size.y,horizontalScroll:false};if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("creating mCustomScrollbar");self.jQueryObjects.tableChatFullDiv.mCustomScrollbar(mCustomScrollbarOptions);console.log("created");console.log(self.jQueryObjects.tableChatFullDiv)}else{$("#tableChatFullTextDiv").niceScroll(messageTextScrollBarNiceScrollOptions)}var stopWheel=function(e){console.log(e);if(e.preventDefault){e.preventDefault()}e.returnValue=false};self.jQueryObjects.tableChatFullParagraph.css({font:chatMessageFont,"font-size":chatMessageFontSize+"px",color:chatMessageFontColor,"text-overflow":"auto",top:this.tableChatFull.chatMessageText.position.y+"px",left:this.tableChatFull.chatMessageText.position.x+"px"});for(var i=0;i<this.seats.length;i++){self.displayChipStack(99999999999999,this.seats[i],{hidden:true,chipArrayName:"referenceChips"})}self.createPreactionOptionItems();console.log("all createjs images have been created")};var assignObjectPropertiesAsPropertiesOfDisplayObject=function(displayObject,properties){_.each(properties,function(value,index,list){if(index==="update"){}else if(!_.isUndefined(value)){displayObject[index]=value}})};this.createStage=function(options){var initializeStageSettings=function(options){if(!options){var options={}}if(!options.stageOptions){options.stageOptions={}}if(!_.isNumber(options.stageNumber)){var stageNumber=self.arrayOfParentsOfStageAndOfContainerArray.length-1}else{var stageNumber=options.stageNumber}var stageOptions=options.stageOptions;if(!options.canvasOptions){options.canvasOptions={}}if(!options.divOptions){options.divOptions={}}self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.autoClear=false;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.snapToPixel=false;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.snapToPixelEnabled=false;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.mouseMoveOutside=true;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.tickOnUpdate=false;if(stageOptions){if(stageOptions.touchEnabled===true){createjs.Touch.enable(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage)}if(!_.isNull(stageOptions.mouseEnabled)&&!_.isUndefined(stageOptions.mouseEnabled)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.mouseEnabled=stageOptions.mouseEnabled}if(!_.isNull(stageOptions.mouseMoveOutside)&&!_.isUndefined(stageOptions.mouseMoveOutside)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.mouseMoveOutside=stageOptions.mouseMoveOutside}if(_.isNumber(stageOptions.mouseOverFrequency)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.enableMouseOver(stageOptions.mouseOverFrequency)}if(!_.isNull(stageOptions.enableDOMEvents)&&!_.isUndefined(stageOptions.enableDOMEvents)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.enableDOMEvents(stageOptions.enableDOMEvents)}if(stageOptions.disableContextMenu=true){$(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.canvas).on("contextmenu",function(e){return false})}}if(_.isObject(options.canvasOptions.css)){$(self.getParentOfStageObject(stageNumber).canvas).css(stageOptions.canvasOptions.css)}if(options.divOptions.hidden===true){setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(stageNumber,false)}if(options.divOptions.mouseDisabled===true){$(self.getParentOfStageObject(stageNumber).div).css("pointer-events","none")}if(_.isNumber(options.numContainers)){var numContainers=options.numContainers;if(!_.isArray(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers=[]}for(var i=startingContainerIndex;i<numContainers;i++){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[i]=new createjs.Container;self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.addChild(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[i])}}};if(!options){var options={}}if(!_.isNumber(options.stageNumber)){options.stageNumber=this.arrayOfParentsOfStageAndOfContainerArray.length}if(options.stageNumber===0||this.arrayOfParentsOfStageAndOfContainerArray.length==0){var previousCanvasIDNumber=0;var newCanvasIDNumber=0}else{for(var i=options.stageNumber-1;i>=0;i--){if(!_.isEmpty(this.arrayOfParentsOfStageAndOfContainerArray[i])){var previousStageNumber=i;i=-9999}}var previousCanvasID=this.arrayOfParentsOfStageAndOfContainerArray[previousStageNumber].stage.canvas.id;var previousCanvasIDNumber=parseFloat(previousCanvasID.replace("canvas",""));if(options.stageNumber>this.arrayOfParentsOfStageAndOfContainerArray.length-1){var newCanvasIDNumber=previousCanvasIDNumber+1}else{var nextCanvasID=this.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].stage.canvas.id;var nextCanvasIDNumber=parseFloat(nextCanvasID.replace("canvas",""));var newCanvasIDNumber=(previousCanvasIDNumber+nextCanvasIDNumber)/2}}if(options.stageOptions.newCanvas===true||options.stageNumber===0){var newDivID="canvas"+newCanvasIDNumber+"Div";var newCanvasID="canvas"+newCanvasIDNumber;var canvasWidth=self.jQueryObjects.canvasDiv.outerWidth(true);var canvasHeight=self.jQueryObjects.canvasDiv.outerHeight(true);var canvasClass=self.css.canvas;var zIndexesPerDiv=10;self.jQueryObjects.canvasDiv.append("<div id = "+"'"+newDivID+"'"+" width = "+"'"+canvasWidth+"'"+" height="+"'"+canvasHeight+"'"+"></canvas>");$("#"+newDivID).append("<canvas id = "+"'"+newCanvasID+"'"+" width = "+"'"+canvasWidth+"'"+" height="+"'"+canvasHeight+"'"+"></canvas>");$("#"+newCanvasID).addClass(canvasClass+" "+self.css.unselectable+" "+self.css.noFat);$("#"+newDivID).css({"z-index":newCanvasIDNumber*zIndexesPerDiv,width:canvasWidth,height:canvasHeight}).addClass(self.css.noFat)}else{var newCanvasID="canvas"+previousCanvasIDNumber}self.arrayOfParentsOfStageAndOfContainerArray.splice(options.stageNumber,0,{});self.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].upToDate=true;self.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].div=document.getElementById(newDivID);self.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].initializationInfo=options;var canvas=document.getElementById(newCanvasID);self.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].stage=new createjs.Stage(canvas);self.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].name=options.name;self.arrayOfParentsOfStageAndOfContainerArray[options.stageNumber].stage.name=options.name;initializeStageSettings(options)};this.initializeStagesAndCanvasCallThisFirst=function(){createZPositionData();_.each(zPositionData.stages,function(value,index,list){self.createStage(value)},this)};this.setBackground=function(src,options){var canvasHeight=this.getParentOfStageObject(0).stage.canvas.height;var canvasWidth=this.getParentOfStageObject(0).stage.canvas.width;if(self.images.background instanceof self.images.Item!=true){self.images.background=new this.images.Item(0,0,canvasWidth,canvasHeight,getZ("background","staticItems"))}var background=self.images.background;if(!_.isObject(background.text)){var fullStageShape=new createjs.Shape;fullStageShape.graphics.drawRect(background.position.x,background.position.y,background.size.x,background.size.y);fullStageShape.setBounds(background.position.x,background.position.y,background.size.x,background.size.y);fullStageShape.alpha=0;fullStageShape.hitArea=new createjs.Shape;fullStageShape.hitArea.graphics.beginFill("#020202").drawRect(background.position.x,background.position.y,background.size.x,background.size.y);background.adoptChild(fullStageShape,"text",{maxSize:"parent"});self.images.background.on("contextmenu",self.events.onBackgroundContextMenu,{image:false,text:true})}if(!src){var src=self.permanentPreferences.sourceObjects.value.background}if(!options){var options={}}else{var options=_.clone(options)}options.html=true;options.size=false;options.update=true;options.maxSize="parent";options.onerror=self.setBackground;options.onload=function(img){console.log("adjusting image size of background with transformation");var scaleX=background.size.x/img.width;var scaleY=background.size.y/img.height;if(_.isNaN(scaleX)||_.isNaN(scaleY)){throw""}if(background.image instanceof createjs.DisplayObject){background.image.setTransform(0,0,scaleX,scaleY)}else if(_.isElement(background.image)){$(background.image).css({width:background.size.x+"px",height:background.size.y+"px"})}background.display(options)};background.addBitmap(src,options);return background.display(options)};this.images.setDefaultEvents=function(){for(var i=0;i<this.seats.length;i=i+1){this.seats[i].openSeat.on("click",function(event){if(_.isArray(event.target.parentItem.messages)){event.target.parentItem.messages.splice(0)}else{event.target.parentItem.messages=[]}event.target.parentItem.messages.push("sit",event.target.parentItem.seatObjectAncestor.rotatedSeatNumber);self.events.onButtonClick(event)})}};this.images.setDefaultMessages=function(){};this.createAllItems=function(){this.updatePreference(this.sessionPreferences,this.sessionPreferences,{updateEqualValues:true});this.setBackground();this.images.setDefaults();this.receiveTableState();this.images.setDefaultEvents();this.images.setDefaultMessages();this.gameState.itemsCreated=true;console.log("this.create all items finished")};this.returnRoundedDownBetSize=function(betSize){var isNumber=!_.isNaN(betSize)&&_.isNumber(betSize);var minIncrement=self.initial_table_state.min_increment;if(isNumber===false){return false}else if(betSize>=self.gameState.maxBet){return self.gameState.maxBet}else if(betSize<=self.gameState.minBet){return self.gameState.minBet}else{var roundedBetSize=Math.floor(betSize/minIncrement)*minIncrement;return roundedBetSize}};this.playerPutsChipsInPot=function(seatNumber,betSize,stackSize,options){if(!options){var options={}}var update=options.update;options.update=false;options.displayChipStackSize=true;var stagesToUpdate=[];stagesToUpdate.push(this.displayChipStack(betSize,this.images.seats[seatNumber],options));if(!_.isNull(stackSize)&&!_.isUndefined(stackSize)&&stackSize<=0){stackSize="All In"}stagesToUpdate.push(this.images.seats[seatNumber].status.updateText(stackSize,options));stagesToUpdate.push(this.images.seats[seatNumber].stackSize.updateText(stackSize,options));options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideAllBets=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];for(var i=0;i<this.images.seats.length;i=i+1){stagesToUpdate.push(this.hideBet(i,options))}options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.createHoleCardCopyIfNeeded=function(playerNumber){console.log("createholecardcopyif needed called for player: "+playerNumber+" user is number "+self.gameState.userSeatNumber);console.log(self.gameState.holeCards);var popupAlpha=.6;if(_.isArray(self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation)){self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation.length=0}else{self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation=[]}var animationArray=self.gameState.seats[playerNumber].hand.holeCardsPopupAnimation;var holeCardArray=this.images.seats[playerNumber].shownCards;var shouldCopyHoleCards=false;var holeCardSources=[];if(self.gameState.userSeatNumber===playerNumber&&_.isArray(self.gameState.holeCards)&&self.gameState.holeCards.length>0){shouldCopyHoleCards=true;holeCardSources=self.gameState.holeCards}else if(shouldCopyHoleCards===false){for(var i=0;i<holeCardArray.length;i++){if(holeCardArray[i].isDisplayed()!==true){shouldCopyHoleCards=false}else{holeCardSources[i]=holeCardArray[i].image.imageSource}}}if(shouldCopyHoleCards!==true){return false}for(var i=0;i<holeCardArray.length;i++){animationArray[i]=new this.images.Item(0,0,0,0,self.images.seats[0].hiddenCards[0].position.z);self.images.cardAsBitmap(animationArray[i],holeCardSources[i]);self.setItemLocationsInItemAEqualToOnesInItemB(animationArray[i],holeCardArray[i]);animationArray[i].image.y=this.images.seats[playerNumber].seat.position.y;animationArray[i].image.alpha=popupAlpha;var options={seatNum:playerNumber,seatObject:self.images.seats[playerNumber]};animationArray[i].on("mouseover",function(event){console.log("animatedCard moused OVER");self.events.seatMouseEvent(event,options)});animationArray[i].on("mouseout",function(event){console.log("animatedCard moused OUT");self.events.seatMouseEvent(event,options)});if(animationArray[i].text){animationArray[i].text.y=this.images.seats[playerNumber].seat.text.y-this.images.seats[playerNumber].seat.image.y+this.images.seats[playerNumber].seat.position.y;animationArray[i].text.alpha=popupAlpha}}self.hideChildren(animationArray)};this.displayTableChatBox=function(){self.jQueryObjects.chatBoxInput.css({display:"inline"})};this.activateTicker=function(FPS,onTick){if(!_.isNumber(FPS)){var FPS=15}createjs.Ticker.setFPS(FPS);createjs.Ticker.addEventListener("tick",handleTick);function handleTick(event){if(_.isFunction(onTick)){onTick()}if(!event.paused){self.updateStages()}}};this.disableTicker=function(){createjs.Ticker.setFPS(12);createjs.Ticker.removeEventListener("tick");function handleTick(event){if(onTick){onTick()}console.log(event);if(!event.paused){self.updateStages()}}};var editEventsOfItemChild=function(item,onOrOff,eventType,actionFunction,options){if(!options){var options={}}var getEventTypeFromString=function(eventTypeToParse){if(_.isString(eventTypeToParse)){var periodIndex=eventTypeToParse.indexOf(".");if(periodIndex!=-1){return eventType.substring(0,periodIndex)}}return eventTypeToParse};if(onOrOff==="off"){var removeEvent=function(childType){var child=item[childType];if(child instanceof createjs.DisplayObject){if(!_.isString(eventType)){child.removeAllEventListeners();item.getOrSetCreateJSEvents("set",childType)}else{var event=getEventTypeFromString(eventType);if(event==="contextmenu"){var createjsEvent="click"}else{var createjsEvent=event}if(_.isFunction(options.function)){var listeners=item.getOrSetCreateJSEvents("remove",childType,event,options.function);child.removeEventListener(createjsEvent,options.function)}else{item.getOrSetCreateJSEvents("set",childType,event);if(createjsEvent!=="click"&&createjsEvent!=="contextmenu"){child.removeAllEventListeners(createjsEvent)}}}}else if(_.isElement(child)){if(!_.isString(eventType)){$(child).off()}else if(_.isFunction(options.function)){$(child).off(eventType,options.function)}else{$(child).off(eventType)}}};if(this.image&&options.image!==false){removeEvent("image")}if(this.text&&options.text!==false){removeEvent("text")}}else if(onOrOff==="on"){var addEventListenerToChild=function(childType){var child=item[childType];if(child instanceof createjs.DisplayObject){var event=getEventTypeFromString(eventType);if(event==="click"||event==="contextmenu"){var createjsEvent="click";var performOnEvent=self.events.onEaselJSChildClick}else{var createjsEvent=event;var performOnEvent=actionFunction}options.function=performOnEvent;item.off(event,options);item.getOrSetCreateJSEvents("set",childType,event,actionFunction);child.addEventListener(createjsEvent,performOnEvent)}else if(_.isElement(child)){$(child).off(eventType,actionFunction);$(child).on(eventType,actionFunction)}if(getEventTypeFromString(eventType)==="click"){if(_.isUndefined(options.cursor)){options.cursor="pointer"}item.cursorHover(options)}};if(_.isObject(item.image)&&options.image!==false){addEventListenerToChild("image");if(options.text!==true){options.text=false}}if(_.isObject(item.text)&&options.text!==false){addEventListenerToChild("text")}}};this.images.Item.prototype.off=function(eventType,options){editEventsOfItemChild(this,"off",eventType,null,options)};self.images.Item.prototype.on=function(eventType,actionFunction,options){editEventsOfItemChild(this,"on",eventType,actionFunction,options)};self.images.Item.prototype.disableMouseEvents=function(options){var disableChildMouseEvent=function(child){if(child instanceof createjs.DisplayObject){child.mouseEnabled=false}else if(_.isElement(child)){$(child).css("pointer-events","none")}};if(options.text!==false){disableChildMouseEvent(this.text)}if(options.image!==false){disableChildMouseEvent(this.image)}};self.images.Item.prototype.cursorHover=function(options){if(!options){var options={}}if(options.cursor===false){return}if(options==="image"){var childType="image"}else if(options==="text"){var childType="text"}else if(options.image){var childType="image"}else if(options.text){var childType="text"}else if(_.isObject(this.image)){var childType="image"}else if(_.isObject(this.text)){var childType="text"}var child=this[childType];if(child instanceof createjs.DisplayObject){child.cursor=options.cursor}else if(_.isElement(child)){$(child).css("cursor",options.cursor)}};self.images.Item.prototype.getChildPositionAndSizeData=function(childType,options){return getDisplayObjectPositionAndSizeData(this[childType],options)};self.images.Item.prototype.positionChild=function(childType,options){if(!options){var options={}}var stagesToUpdate=[];var child=this[childType];if(_.isObject(child)){var newLocationData={};if(options.position!==false){newLocationData.x=this.position.x;newLocationData.y=this.position.y}if(options.size===true||childType==="image"&&options.size!==false){newLocationData.width=this.size.x;newLocationData.height=this.size.y}stagesToUpdate.push(setDisplayObjectPositionData(child,newLocationData,options))}if(_.isElement(child)){if(childType==="text"){var zIndex=this.position.z.container+1}else{var zIndex=this.position.z.container}$(child).css({"z-index":zIndex})}if(_.isElement(child)&&_.isNumber(newLocationData.x)&&_.isNumber(newLocationData.y)){var location=getDisplayObjectPositionAndSizeData(child,{size:false});if(location.x>this.position.x+1.1||location.x<this.position.x-1.1){console.log(location);console.log(this);throw"location not matching"}if(location.y>this.position.y+1.1||location.x<this.position.x-1.1){console.log(location);console.log(this);throw"location not matching"}}if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.positionItemImage=function(item,options){item.positionChild("image",options)};this.getStringWidth=function(string,font){var context=self.arrayOfParentsOfStageAndOfContainerArray[0].stage.canvas.getContext("2d");context.font=font;var textData=context.measureText(string);return textData.width};this.getSeatImageIndex=function(seatNum,seatNumberVariableName){if(!_.isString(seatNumberVariableName)){var seatNumberVariableName="originalSeatNumber"}for(var i=0;i<self.images.seats.length;i++){if(self.images.seats[i][seatNumberVariableName]==seatNum){return i}}};this.copyItemLocationData=function(item){var itemCopyWithOnlyLocationData={};if(item.image){itemCopyWithOnlyLocationData.image={};var itemImageLocation=getDisplayObjectPositionAndSizeData(item.image,{size:false});itemCopyWithOnlyLocationData.image.x=itemImageLocation.x;itemCopyWithOnlyLocationData.image.y=itemImageLocation.y}if(item.text){itemCopyWithOnlyLocationData.text={};var itemTextLocation=getDisplayObjectPositionAndSizeData(item.text,{size:false});itemCopyWithOnlyLocationData.text.x=itemTextLocation.x;itemCopyWithOnlyLocationData.text.y=itemTextLocation.y}if(item.size){itemCopyWithOnlyLocationData.size={};itemCopyWithOnlyLocationData.size.x=item.size.x;itemCopyWithOnlyLocationData.size.y=item.size.y}if(item.position){itemCopyWithOnlyLocationData.position={};itemCopyWithOnlyLocationData.position.x=item.position.x;itemCopyWithOnlyLocationData.position.y=item.position.y;if(item.position.z){itemCopyWithOnlyLocationData.position.z={};itemCopyWithOnlyLocationData.position.z.stage=item.position.z.stage;itemCopyWithOnlyLocationData.position.z.container=item.position.z.container}}return itemCopyWithOnlyLocationData};this.setItemLocationsInItemAEqualToOnesInItemB=function(itemA,itemB,options){if(!options){var options={}}var movementType=options.movementType;options.movementType="relative";var permanent=options.permanent;options.permanent=true;if(!_.isObject(itemA)||!_.isObject(itemB)){console.log("setItemLocationsInItemAEqualToOnesInItemB not objects");return}else if(_.isEmpty(itemB)){console.log("setItemLocationsInItemAEqualToOnesInItemB empty itemB");return}else if(itemA instanceof self.images.Item!==true){console.log("setItemLocationsInItemAEqualToOnesInItemB itemA not an Item");console.log(itemA)}var changed=false;if(_.isUndefined(itemB.position)){console.log("itemB position undefined");console.log(itemB)}if(_.isUndefined(itemA.position)){console.log("itemA position undefined");console.log(itemA)}if(!itemA.image&&!itemB.image&&itemA.text&&itemB.text&&!_.isNaN(parseInt(itemA.text.text))){}if(!itemA.image&&!itemB.image&&_.isObject(itemA.text)&&_.isObject(itemB.text)){itemA.position.x=itemB.position.x;itemA.position.y=itemB.position.y;if(_.isString(itemB.position.displayCSS)){itemA.position.displayCSS=itemB.position.displayCSS}var itemAPosition=getDisplayObjectPositionAndSizeData(itemA.text,{size:false});var itemBPosition=getDisplayObjectPositionAndSizeData(itemB.text,{size:false});var deltaX=itemBPosition.x-itemAPosition.x;var deltaY=itemBPosition.y-itemAPosition.y;options.permanent=false}else{var deltaX=itemB.position.x-itemA.position.x;var deltaY=itemB.position.y-itemA.position.y}self.setImageItemPositionAndTextBasedOnImageChange(itemA,deltaX,deltaY,options);options.permanent=permanent;options.movementType=movementType;if(options.updateStageStatus===true){if(options&&options.update===true){self.updateStages(self.easelJSDisplayObjectChanged(itemA))}else{return self.easelJSDisplayObjectChanged(itemA)}}};this.copySeatObjectItemLocationData=function(seatObject){var seatObjectCopy={};this.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(seatObject,function(value,indexes){if(indexes.length===1){if(_.isArray(value)){seatObjectCopy[indexes[0]]=[];return}else{seatObjectCopy[indexes[0]]=self.copyItemLocationData(value)}}else if(indexes.length===2){seatObjectCopy[indexes[0]][indexes[1]]=self.copyItemLocationData(value)}});return seatObjectCopy};this.setSeatObjectLocationsInSeatObjectAEqualToOnesInSeatObjectB=function(seatObjectA,seatObjectB,options){if(!options){var options={}}var movementType=options.movementType;options.movementType="relative";var permanent=options.permanent;options.permanent=true;var stagesToUpdate=[];this.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(seatObjectB,function(value,indexes){if(!_.isArray(value)&&_.isEmpty(value)){return}if(!_.isArray(value)){if(!value.position){console.log("objectB without position value whose indexes =");console.log(indexes);console.log(seatObjectB)}}if(_.isArray(value)){if(!_.isArray(seatObjectA[indexes[0]])){seatObjectA[indexes[0]]=[];console.log("created an array in seatObjectA named "+indexes[0])}}else if(indexes.length===1){if(!seatObjectA[indexes[0]].position){console.log("seatObjectA value without position =");console.log(indexes);console.log(seatObjectA)}if(indexes[0]==="bet"){"changing bet text location"}stagesToUpdate.push(self.setItemLocationsInItemAEqualToOnesInItemB(seatObjectA[indexes[0]],value,options))}else if(indexes.length===2){if(indexes[0]==="chips"){return}if(_.isUndefined(seatObjectA[indexes[0]][indexes[1]])){console.log("setseatobjectlocationA value undefined");console.log(seatObjectA);console.log(indexes);console.log(value)}else if(!seatObjectA[indexes[0]][indexes[1]].position){console.log("seatObjectA value without position =");console.log(indexes);console.log(seatObjectA)}if(indexes[0]==="referenceChips"&&_.isObject(seatObjectA["chips"][indexes[1]])){stagesToUpdate.push(self.setItemLocationsInItemAEqualToOnesInItemB(seatObjectA["chips"][indexes[1]],value,options))}stagesToUpdate.push(self.setItemLocationsInItemAEqualToOnesInItemB(seatObjectA[indexes[0]][indexes[1]],value,options))}});options.permanent=permanent;options.movementType=movementType;if(options.updateStageStatus===true){if(options&&options.update===true){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}}};this.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray=function(seatObject,performIfObject){_.each(seatObject,function(value,index,list){if(_.isArray(value)){performIfObject(value,[index]);_.each(_.range(value.length),function(arrayIndex){if(_.isObject(value[arrayIndex])&&!_.isArray(value[arrayIndex])){performIfObject(value[arrayIndex],[index,arrayIndex])}})}else if(_.isObject(value)){performIfObject(value,[index])}})};this.changeUserSeatView=function(seatNumberToRotateTo){if(!options){var options={}}if(!_.isNumber(seatNumberToRotateTo)){var seatNumberToRotateTo=0}if(seatNumberToRotateTo>this.gameState.numSeats){console.log("seatNumber too high to rotate to, invalid");return}var stagesToUpdate=[];var clockWiseRotationNumberBasedOnUnRotatedPosition;var temporaryArrayOfNonrotatedSeats=[];for(var i=0;i<this.gameState.numSeats;i++){temporaryArrayOfNonrotatedSeats.push({})}if(!_.isNumber(self.gameState.userSeatNumber)){clockWiseRotationNumberBasedOnUnRotatedPosition=0}else{clockWiseRotationNumberBasedOnUnRotatedPosition=(this.gameState.numSeats+seatNumberToRotateTo-self.gameState.userSeatNumber)%this.gameState.numSeats}if(clockWiseRotationNumberBasedOnUnRotatedPosition===(this.images.seats[0].rotatedSeatNumber+this.gameState.numSeats)%this.gameState.numSeats){console.log("no rotation, clockWiseRotationNumberBasedOnUnRotatedPosition = "+clockWiseRotationNumberBasedOnUnRotatedPosition);return"no rotation"}var rotatedSeatNumberArray=[];var nonRotatedSeatNumberArray=[];for(var i=0;i<this.gameState.numSeats;i++){rotatedSeatNumberArray.push(self.images.seats[i].rotatedSeatNumber);nonRotatedSeatNumberArray.push(self.images.seats[i].nonRotatedSeatNumber)}rotatedSeatNumberArray.length=0;nonRotatedSeatNumberArray.length=0;for(var i=0;i<this.gameState.numSeats;i++){temporaryArrayOfNonrotatedSeats[self.images.seats[i].rotatedSeatNumber]=self.copySeatObjectItemLocationData(this.images.seats[i])}var seatMessages=[];for(var i=0;i<this.gameState.numSeats;i++){this.images.seats[i].rotatedSeatNumber=(i+clockWiseRotationNumberBasedOnUnRotatedPosition)%this.gameState.numSeats;self.setSeatObjectLocationsInSeatObjectAEqualToOnesInSeatObjectB(this.images.seats[i],temporaryArrayOfNonrotatedSeats[(i+clockWiseRotationNumberBasedOnUnRotatedPosition)%this.gameState.numSeats],{updateStageStatus:false});compareSeatObjectAToSeatObjectB(this.images.seats[i],temporaryArrayOfNonrotatedSeats[(i+clockWiseRotationNumberBasedOnUnRotatedPosition)%this.gameState.numSeats]);rotatedSeatNumberArray.push(self.images.seats[i].rotatedSeatNumber);nonRotatedSeatNumberArray.push(self.images.seats[i].nonRotatedSeatNumber)}function compareSeatObjectAToSeatObjectB(seatObjectA,seatObjectB){var errorIndex=[];self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(seatObjectA,function(value,indexes){if(_.isArray(value)||_.isEmpty(value)){return}if(indexes[0]==="chips"){indexes[0]="referenceChips"}if(indexes.length===1){if(value.position.x!==seatObjectB[indexes[0]].position.x){errorIndex.push(indexes)}else if(value.position.y!==seatObjectB[indexes[0]].position.y){errorIndex.push(indexes)}}else if(indexes.length===2){if(value.position.x!==seatObjectB[indexes[0]][indexes[1]].position.x){errorIndex.push(indexes)}else if(value.position.y!==seatObjectB[indexes[0]][indexes[1]].position.y){errorIndex.push(indexes)}}});if(errorIndex.length>0){console.log("compared seat objects");console.log(seatObjectA);console.log(seatObjectB);console.log("the following are not equal");console.log(_.flatten(errorIndex))}}var seatVisible=[];for(var i=0;i<this.gameState.numSeats;i++){seatVisible.push(self.images.seats[i].seat.isDisplayed())}var currentBets=self.getCurrentBetSizes();_.each(currentBets,function(value,index,list){if(self.images.seats[index].bet.isDisplayed()){var displayBetSize=true}else{var displayBetSize=false}if(displayBetSize){stagesToUpdate.push(self.displayChipStack(value,self.images.seats[index],{displayChipStackSize:true,update:false}))}});if(_.isNumber(self.gameState.dealer)){self.animateDealerButton(self.gameState.dealer,4)}this.updateStages(null,{forceUpdate:true})};this.setNumberOfSeats=function(numSeats){var disableSeat=function(seatNum,seatNumberVariableName){if(!_.isString(seatNumberVariableName)){var seatArrayIndex=seatNum}else{var seatArrayIndex=self.getSeatImageIndex(seatNum,seatNumberVariableName)}self.images.seats[seatArrayIndex].rotatedSeatNumber=false;self.images.seats[seatArrayIndex].nonRotatedSeatNumber=false;self.images.seats.push(self.images.seats.splice(seatArrayIndex,1)[0])};var centerBottomAndTopSeats=function(){var totalLength=self.images.seats[0].seat.size.x*3+(self.images.seats[0].seat.position.x-self.images.seats[1].seat.position.x-self.images.seats[1].seat.size.x)*2;var distanceX=(totalLength-self.images.seats[0].seat.size.x*2)/6;self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[1],addAbsoluteDistanceX);self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[4],addAbsoluteDistanceX);distanceX=distanceX*-1;self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[6],addAbsoluteDistanceX);self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[9],addAbsoluteDistanceX);function addAbsoluteDistanceX(value,indexes){if(value instanceof self.images.Item){self.setImageItemPositionAndTextBasedOnImageChange(value,distanceX,0,{permanent:true,movementType:"relative"})}}};var centerSeat2And8=function(){var sideYDistance=(self.images.seats[2].seat.position.y-self.images.seats[3].seat.position.y)/2;self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[2],performIfObject);self.iterateThroughObjectAndPerformOnAllObjectsOrObjectsInArray(self.images.seats[8],performIfObject);function performIfObject(value,indexes){if(value instanceof self.images.Item){self.setImageItemPositionAndTextBasedOnImageChange(value,0,-sideYDistance,{movementType:"relative",permanent:true})}}};if(this.images.seats[0].rotatedSeatNumber!==this.images.seats[0].nonRotatedSeatNumber){self.changeUserSeatView()}if(this.imageData.numberOfPlayersSet!==true){this.imageData.originalSeatLocations=[];for(var seatNum=0;seatNum<this.images.seats.length;seatNum++){this.imageData.originalSeatLocations.push(this.copySeatObjectItemLocationData(this.images.seats[seatNum]))}}else{console.log("changing numseats for (atleast), the second time");for(var originalSeatNumber=0;originalSeatNumber<this.images.seats.length;originalSeatNumber++){this.images.seats.push(this.images.seats.splice(this.getSeatImageIndex(originalSeatNumber,"originalSeatNumber"),1))}for(var seatNum=0;seatNum<this.images.seats.length;seatNum++){this.setSeatObjectLocationsInSeatObjectAEqualToOnesInSeatObjectB(this.images.seats[seatNum],this.imageData.originalSeatLocations[seatNum])}}this.gameState.numSeats=numSeats;if(numSeats==9){disableSeat(5)}else if(numSeats==8){centerBottomAndTopSeats();disableSeat(5);disableSeat(0)}else if(numSeats==7){disableSeat(9);disableSeat(5);disableSeat(1)}else if(numSeats==6){centerSeat2And8();disableSeat(7);
disableSeat(5);disableSeat(3);disableSeat(0)}else if(numSeats==5){centerSeat2And8();disableSeat(9);disableSeat(7);disableSeat(6);disableSeat(3);disableSeat(1)}else if(numSeats==4){centerSeat2And8();disableSeat(9);disableSeat(7);disableSeat(6);disableSeat(4);disableSeat(3);disableSeat(1)}else if(numSeats==3){disableSeat(9);disableSeat(8);disableSeat(6);disableSeat(5);disableSeat(4);disableSeat(2);disableSeat(1)}else if(numSeats==2){centerSeat2And8();disableSeat(9);disableSeat(7);disableSeat(6);disableSeat(5);disableSeat(4);disableSeat(3);disableSeat(1);disableSeat(0)}for(var i=0;i<this.gameState.numSeats;i++){this.images.seats[i].nonRotatedSeatNumber=i;this.images.seats[i].rotatedSeatNumber=i}this.imageData.numberOfPlayersSet=true};var setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault=function(stageNumberOrItem,status){if(status===true){var display="inline"}else{var display="none"}var stageParent=self.getParentOfStageObject(stageNumberOrItem);var div=stageParent.div;if(!_.isObject(div)){console.log(stageNumberOrItem);throw"display status error"}$(div).css("display",display)};this.displayShownCard=function(cardText,parentItem,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.images.cardAsBitmap(parentItem,cardText));stagesToUpdate.push(this.displayChildren(parentItem,options));options.update=update;if(update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayHoleCards=function(hand,seatNumber,options){self.setPreactionData("hand","inHand",{seat:seatNumber});if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].shownCards,options));stagesToUpdate.push(this.displayShownCard(hand[0],this.images.seats[seatNumber].shownCards[0],options));stagesToUpdate.push(this.displayShownCard(hand[1],this.images.seats[seatNumber].shownCards[1],options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].hiddenCards,options));options.update=update;if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideHoleCards=function(seatNumber,options){var itemsToHide=[];itemsToHide.push(this.images.seats[seatNumber].hiddenCards);itemsToHide.push(this.images.seats[seatNumber].shownCards);itemsToHide=_.flatten(itemsToHide);return this.hideChildren(itemsToHide,options)};this.easelJSDisplayObjectChanged=function(item,options){if(!options){var options={}}if(item.isAddedToStage()){if(options.updateStageStatus!==false){this.arrayOfParentsOfStageAndOfContainerArray[item.position.z.stage].upToDate=false}return item.position.z.stage}};this.updatePotSize=function(potSize,options){var stagesToUpdate=[];var newTotalPotSize=false;if(!options){var options={}}var update=options.update;options.update=false;var displayChipStackSize=options.displayChipStackSize;options.displayChipStackSize=true;if(!potSize||_.isArray(potSize)&&_.isEmpty(_.compact(potSize))){console.log("we are hiding all pots in teh updatePotSize function");for(var i=0;i<this.images.pots.length;i++){this.images.pots[i].potSize.text.text=0;stagesToUpdate.push(this.easelJSDisplayObjectChanged(this.images.pots[i].potSize));stagesToUpdate.push(this.hideChildren(this.images.pots[i].potSize,options));stagesToUpdate.push(this.hideChildren(this.images.pots[i].chips,options));stagesToUpdate.push(this.hideChildren(this.images.totalPotSize,options))}}else if(_.isNumber(options.potNumber)){console.log("updating pot size based on one specific pot number");if(_.isArray(potSize)){var specificPotSize=potSize[options.potNumber]}else{var specificPotSize=potSize}if(parseFloat(specificPotSize)!=parseFloat(this.images.pots[potNumber].potSize.text.text)||sthis.images.pots[potNumber].potSize.isDisplayed()!==true){stagesToUpdate.push(this.displayChipStack(parseFloat(specificPotSize),this.images.pots[options.potNumber],options))}else{console.log("pot "+options.potNumber+"not redrawn because same value")}}else if(_.isNumber(potSize)){newTotalPotSize=potSize}else if(_.isArray(potSize)&&potSize.length>0){var aggregatedPotSize=0;for(var i=0;i<potSize.length;i++){aggregatedPotSize=aggregatedPotSize+parseFloat(potSize[i]);if(parseFloat(potSize[i])!=parseFloat(this.images.pots[i].potSize.text.text)||this.images.pots[i].potSize.isDisplayed()!==true){console.log("updating pot size "+i+"with value "+potSize[i]);stagesToUpdate.push(this.displayChipStack(parseFloat(potSize[i]),self.images.pots[i],options))}else{console.log("pot "+i+"not redrawn because same value")}stagesToUpdate.push(this.displayChildren(this.images.pots[i].potSize,options))}newTotalPotSize=aggregatedPotSize}if(_.isNumber(newTotalPotSize)){var newTotalPotSizeText="Total: "+newTotalPotSize;if(newTotalPotSizeText!=this.images.totalPotSize.text.text){this.images.totalPotSize.text.text=newTotalPotSizeText;stagesToUpdate.push(this.easelJSDisplayObjectChanged(this.images.totalPotSize))}stagesToUpdate.push(this.displayChildren(this.images.totalPotSize,options))}options.update=update;options.displayChipStackSize=displayChipStackSize;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.playerSits=function(seatNumber,playerName,chips,options){var stagesToUpdate=[];if(!options){var options={}}var update=options.update;options.update=false;self.setPreactionData("permanent","displayMessageType","seat",{seat:seatNumber,server:false});stagesToUpdate.push(updateItemText(this.images.seats[seatNumber].playerName,playerName));if(_.isNumber(chips)){stagesToUpdate.push(self.images.seats[seatNumber].stackSize.updateText(chips,options))}options.update=update;stagesToUpdate.push(this.displayCorrectSeatItems(seatNumber,options));if(options.update===false){return stagesToUpdate}else{self.updateStages(stagesToUpdate)}};this.hideBet=function(seatNumber,options){var stagesToUpdate=[];stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].bet,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].chips,options));while(this.images.seats[seatNumber].chips.length>0){this.images.seats[seatNumber].chips.pop()}return stagesToUpdate};this.addChildToContainer=function(child,containerIndex,options){if(options){if(_.isNumber(options.stageNumber)){var stageNumber=options.stageNumber}}else{var stageNumber=child.parentItem.position.z.stage}this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[containerIndex].addChild(child)};this.displayChipStack=function(chipAmount,parentOfChipArray,originalOptions){var totalChipAmount=chipAmount;chipAmount=parseFloat(chipAmount);if(!_.isNumber(chipAmount)||_.isNaN(chipAmount)){console.log("displayChipStack called with invalid chipAmount");return}if(!_.isObject(originalOptions)){var options={}}else{var options=_.clone(originalOptions)}var update=options.update;options.update=false;var stagesToUpdate=[];var defaultOptions={};defaultOptions.chipArrayName="chips";if(parentOfChipArray.firstChip instanceof this.images.Item){defaultOptions.initialX=parentOfChipArray.firstChip.position.x;defaultOptions.initialY=parentOfChipArray.firstChip.position.y;defaultOptions.z=parentOfChipArray.firstChip.position.z}if(parentOfChipArray.secondColumnChip instanceof this.images.Item&&parentOfChipArray.firstChip instanceof this.images.Item){defaultOptions.distanceBetweenColumns=parentOfChipArray.secondColumnChip.position.x-parentOfChipArray.firstChip.position.x;defaultOptions.z=parentOfChipArray.secondColumnChip.position.z}else{defaultOptions.distanceBetweenColumns=this.images.pots[0].secondColumnChip.position.x-this.images.pots[0].firstChip.position.x}if(parentOfChipArray.potSize instanceof this.images.Item){defaultOptions.chipStackSizeItem=parentOfChipArray.potSize;if(!defaultOptions.z){defaultOptions.z=defaultOptions.chipStackSizeItem.position.z}}else if(parentOfChipArray.bet instanceof this.images.Item){defaultOptions.chipStackSizeItem=parentOfChipArray.bet;if(!defaultOptions.z){defaultOptions.z=defaultOptions.chipStackSizeItem.position.z}}if(!_.isObject(defaultOptions.z)){defaultOptions.z=getZ("chipAnimation")}_.defaults(options,defaultOptions);var initialX=options.initialX;var initialY=options.initialY;var distanceBetweenColumns=options.distanceBetweenColumns;var chipArray=parentOfChipArray[options.chipArrayName];if(!_.isArray(parentOfChipArray[options.chipArrayName])){parentOfChipArray[options.chipArrayName]=[]}else{var oldArray=[];while(parentOfChipArray[options.chipArrayName].length>0){oldArray.push(parentOfChipArray[options.chipArrayName].pop())}}var x=initialX;var y=initialY;var chipIncrementY=this.images.pots[0].secondChip.position.y-this.images.pots[0].firstChip.position.y;var totalChips=0;var columnCounter=1;while(chipAmount>=1){if(chipAmount>=1e4){stagesToUpdate.push(this.displayChip("10k",x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1e4}else if(chipAmount>=5e3){stagesToUpdate.push(this.displayChip("5k",x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-5e3}else if(chipAmount>=1e3){stagesToUpdate.push(this.displayChip("1k",x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1e3}else if(chipAmount>=500){stagesToUpdate.push(this.displayChip(500,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-500}else if(chipAmount>=100){stagesToUpdate.push(this.displayChip(100,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-100}else if(chipAmount>=50){stagesToUpdate.push(this.displayChip(50,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-50}else if(chipAmount>=25){stagesToUpdate.push(this.displayChip(25,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-25}else if(chipAmount>=10){stagesToUpdate.push(this.displayChip(10,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1}else if(chipAmount>=5){stagesToUpdate.push(this.displayChip(5,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-5}else if(chipAmount>=1){stagesToUpdate.push(this.displayChip(1,x,y,parentOfChipArray,options));y=y+chipIncrementY;chipAmount=chipAmount-1}totalChips++;if(totalChips%this.imageData.maxChipsPerColumn==0){x=x+distanceBetweenColumns;y=initialY;columnCounter++;if(columnCounter>=this.imageData.maxChipColumns){chipAmount=0}}}if(options.displayChipStackSize!==false&&_.isArray(chipArray)&&chipArray.length>0&&options.chipStackSizeItem instanceof this.images.Item&&_.isObject(options.chipStackSizeItem.text)){var sizeItem=options.chipStackSizeItem;sizeItem.text.text=totalChipAmount;var measuredSizeWidth=sizeItem.text.getMeasuredWidth();var measuredSizeHeight=sizeItem.text.getMeasuredHeight();var chipDiameter=self.images.pots[0].firstChip.size.x;var chipStackMaxWidth=Math.abs(options.distanceBetweenColumns*(self.imageData.maxChipColumns-1))+chipDiameter;var chipStackMaxHeight=(self.imageData.maxChipsPerColumn-1)*(self.images.pots[0].secondChip.position.x-self.images.pots[0].firstChip.position.x)+chipDiameter;var maxLeftX;var maxRightX;var actualLeftX;var actualRightX;var maxTopY=options.initialY+chipDiameter-chipStackMaxHeight;var maxBottomY=options.initialY+chipDiameter;if(distanceBetweenColumns>0){var chipDirection="right"}else{var chipDirection="left"}var actualTopY=options.initialY;for(var i=0;i<chipArray.length;i++){if(chipArray[i].position.y<actualTopY){actualTopY=chipArray[i].position.y}}if(chipDirection==="right"){maxLeftX=options.initialX;maxRightX=maxLeftX+chipStackMaxWidth;actualLeftX=maxLeftX;actualRightX=chipArray[chipArray.length-1].position.x+chipArray[chipArray.length-1].size.x}else{maxRightX=options.initialX+chipDiameter;maxLeftX=maxRightX-chipStackMaxWidth;actualRightX=maxRightX;actualLeftX=chipArray[chipArray.length-1].position.x}self.setImageItemPositionAndTextBasedOnImageChange(sizeItem);if(sizeItem.position.x>=maxRightX){var sizeLatitudePositioning="right"}else if(sizeItem.position.x+sizeItem.size.x<=maxLeftX){console.log("maxLEfftX = "+maxLeftX);var sizeLatitudePositioning="left"}if(sizeItem.position.y>=maxBottomY){var sizeLongitudePositioning="bottom"}else if(sizeItem.position.y+measuredSizeHeight<=actualTopY){var sizeLongitudePositioning="top"}else if(sizeItem.position.y+sizeItem.size.y<=maxTopY){var sizeLongitudePositioning="top"}if(_.isObject(sizeItem.seatObjectAncestor)){console.log("we are adjusting the betsize text of seat: "+sizeItem.seatObjectAncestor.nonRotatedSeatNumber+", displayed in seat position: "+sizeItem.seatObjectAncestor.rotatedSeatNumber);console.log("chipDirection is: "+chipDirection);console.log("left right positioning: "+sizeLatitudePositioning);console.log("bottom top positioning: "+sizeLongitudePositioning)}if(sizeLatitudePositioning==="right"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,actualRightX,sizeItem.position.y,options))}else if(sizeLatitudePositioning==="left"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,actualLeftX-measuredSizeWidth,sizeItem.position.y,options))}else{if(chipDirection==="right"){var sizePositionToItemPositionRatio=(sizeItem.position.x-actualLeftX)/chipStackMaxWidth;var sizeItemX=sizePositionToItemPositionRatio*(actualRightX-actualLeftX)+actualLeftX}else{console.log("adjusting betSize text based on chipDirection left");var sizePositionToItemPositionRatio=(actualRightX-sizeItem.position.x-sizeItem.size.x)/chipStackMaxWidth;var sizeItemX=actualRightX-sizePositionToItemPositionRatio*(actualRightX-actualLeftX)-measuredSizeWidth}if(sizeLongitudePositioning==="bottom"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,sizeItemX,maxBottomY,options))}else if(sizeLongitudePositioning==="top"){stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,sizeItemX,actualTopY-measuredSizeHeight,options))}else{stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(sizeItem,sizeItemX,sizeItem.position.y,options))}}stagesToUpdate.push(self.displayChildren(sizeItem,options))}if(update!==false&&options.hidden!==true){if(_.isArray(parentOfChipArray[options.chipArrayName])&&parentOfChipArray[options.chipArrayName].length>0&&parentOfChipArray[options.chipArrayName][0]instanceof this.images.Item){this.hideChildren(oldArray,options);this.updateStages(stagesToUpdate)}options.update=update}else if(options.hidden===true){options.update=update;return oldArray}else if(update===false){stagesToUpdate.push(this.hideChildren(oldArray,options));options.update=update;return stagesToUpdate}};this.displayChip=function(chipValue,x,y,parentOfChipArray,options){var diameter=this.images.pots[0].firstChip.size.x;var chipArray=parentOfChipArray[options.chipArrayName];if(chipArray[0]instanceof self.images.Item){var z=chipArray[0].position.z}else if(_.isObject(options.z)){var z=options.z}else if(_.isString(options.z)){var z=getZ(options.z)}else{var z=getZ("chipAnimation")}if(chipValue==1e3){chipColor="#CC6600";chipValue="1k"}else if(chipValue==500){chipColor="black"}else if(chipValue==100){chipColor="yellow"}else if(chipValue==50){chipColor="red"}else if(chipValue==25){chipColor="green"}else if(chipValue==10){chipColor="orange"}else if(chipValue==5){chipColor="#F52887"}else{chipColor="blue"}if(chipColor=="orange"){var chipImageSource=self.permanentPreferences.sourceObjects.value.chips["10"]}else if(chipColor=="red"){var chipImageSource=self.permanentPreferences.sourceObjects.value.chips.red}else if(chipColor=="black"){var chipImageSource=self.permanentPreferences.sourceObjects.value.chips.black}else{var chipImageSource=self.permanentPreferences.sourceObjects.value.chips.black}chipArray.push(new this.images.Item(x,y,diameter,diameter,z));_.last(chipArray).addBitmap(chipImageSource);_.last(chipArray).text=new createjs.Text(chipValue,"7px "+self.permanentPreferences.defaultFontType.value,"white");_.last(chipArray).text.x=_.last(chipArray).position.x+parentOfChipArray[options.chipArrayName][parentOfChipArray[options.chipArrayName].length-1].size.x/2;_.last(chipArray).text.y=_.last(chipArray).position.y+4.5;_.last(chipArray).text.baseline="top";_.last(chipArray).text.textAlign="center";_.last(chipArray).text.maxWidth=_.last(chipArray).size.x*.8;for(var i=0;i<parentOfChipArray[options.chipArrayName].length-1;i++){if(i==0||(i+1)%self.imageData.maxChipsPerColumn!=0){this.hideText(chipArray[i],{update:false});chipArray[i].text=null}}if(options&&options.hidden===true){}else{return this.displayChildren(chipArray,options)}};this.animateImage=function(animationInfo){if(!animationInfo||!animationInfo.item){return}var defaults={};defaults.movementType="absolute";defaults.maxDepth=1;_.defaults(animationInfo,defaults);var stagesToUpdate=[];var outOfDateItems=[];var endedItems=[];var numAnimations=0;var allTweens=[];animationInfo.animatedItems=[];if(animationInfo.maxDepth>0&&(_.isArray(animationInfo.item)||animationInfo.item instanceof this.images.Item===false&&_.isObject(animationInfo.item))){var items=animationInfo.item;var movementType=animationInfo.movementType;animationInfo.movementType="relative";animationInfo.maxDepth=animationInfo.maxDepth-1;var animationAsyncParallelArray=[];_.each(items,function(value,index,list){animationInfo.item=value;if(animationInfo.item instanceof self.images.Item&&(animationInfo.item.image||animationInfo.item.text)){var animationID=numAnimations;var info=_.clone(animationInfo);animationAsyncParallelArray.push(animateOneItem(info,animationID))}});animationInfo.maxDepth=animationInfo.maxDepth+1;animationInfo.movementType=movementType}else{animateOneItem(animationInfo,0)}for(var i=0;i<allTweens.length;i++){allTweens[i].setPaused(false)}function animateOneItem(animationInfo,animationID){numAnimations++;animationInfo.animatedItems[animationID]=animationInfo.item;var defaults={};if(animationInfo.item.image){defaults=_.defaults(defaults,getDefaultPositionsBasedOnDisplayObject(animationInfo.item.image,animationInfo))}else if(animationInfo.item.text){defaults=_.defaults(defaults,getDefaultPositionsBasedOnDisplayObject(animationInfo.item.text,animationInfo))}defaults.numTicks=10;defaults.time=300;defaults.update=false;defaults.onEnd=function(animationInfo,animationInstance){};defaults.onStart=function(animationInfo){self.displayChildren(animationInfo.item)};defaults.onTick=function(animationInfo,animationInstance){};animationInfo=_.defaults(animationInfo,defaults);var fractionDistancePerTick=1/animationInfo.numTicks;var lastTick=animationInfo.numTicks-1;var interval=animationInfo.time/animationInfo.numTicks;if(animationInfo.movementType==="relative"){var totalDistanceX=animationInfo.finalX;var totalDistanceY=animationInfo.finalY}else{var totalDistanceX=animationInfo.finalX-animationInfo.initialX;var totalDistanceY=animationInfo.finalY-animationInfo.initialY}var distancePerTickX=totalDistanceX*fractionDistancePerTick;var distancePerTickY=totalDistanceY*fractionDistancePerTick;if(_.isNumber(self.setImageItemPositionAndTextBasedOnImageChange(animationInfo.item,animationInfo.initialX,animationInfo.initialY,animationInfo))){outOfDateItems[animationID]=animationInfo.item}endedItems[animationID]=false;if(_.isFunction(animationInfo.onStart)){animationInfo.onStart(animationInfo)}var imageUpToDate=true;var textUpToDate=true;var imageEnded=false;var textEnded=false;if(animationInfo.item.image){var imageTween=createjs.Tween.get(animationInfo.item.image,{override:true,paused:true});imageTween.to({x:animationInfo.item.image.x+totalDistanceX,y:animationInfo.item.image.y+totalDistanceY},animationInfo.time).addEventListener("change",imageChanged);imageTween.call(endImage,[animationInfo,imageTween,textTween],this)}if(animationInfo.item.text){var textTween=createjs.Tween.get(animationInfo.item.text,{override:true,paused:true});textTween.to({x:animationInfo.item.text.x+totalDistanceX,y:animationInfo.item.text.y+totalDistanceY},animationInfo.time).addEventListener("change",textChanged);textTween.call(endText,[animationInfo,imageTween,textTween],this)}if(imageTween){allTweens.push(imageTween)}if(textTween){allTweens.push(textTween)}function imageChanged(tweenInstance){imageUpToDate=false;onChange()}function textChanged(tweenInstance){textUpToDate=false;onChange()}function onChange(event){if(animationInfo.item.image&&imageUpToDate===true||animationInfo.item.text&&textUpToDate===true){return}if(checkIfAllTasksCompletedResetsArrayIfItIs(outOfDateItems)){for(var i=0;i<animationInfo.animatedItems.length;i++){self.easelJSDisplayObjectChanged(animationInfo.animatedItems[i])}if(_.isFunction(animationInfo.onTick)){animationInfo.onTick(animationInfo,imageTween,textTween)}textUpToDate=true;imageUpToDate=true}}function endImage(animationInfo,imageTween,textTween){imageEnded=true;onEnd(animationInfo,imageTween,textTween)}function endText(animationInfo,imageTween,textTween){textEnded=true;onEnd(animationInfo,imageTween,textTween)}function onEnd(animationInfo,imageTween,textTween){if(animationInfo.item.image&&imageEnded===false||animationInfo.item.text&&textEnded===false){return}if(checkIfAllTasksCompletedResetsArrayIfItIs(endedItems)){for(var i=0;i<animationInfo.animatedItems.length;i++){self.easelJSDisplayObjectChanged(animationInfo.animatedItems[i])}animationInfo.onEnd(animationInfo,imageTween,textTween)}}function checkIfAllTasksCompletedResetsArrayIfItIs(array){array[animationID]=animationInfo.item;for(var i=0;i<array.length;i++){if(array[i]===false&&endedItems[i]===false){return false}}for(var i=0;i<array.length;i++){array[i]===false}return true}}function getDefaultPositionsBasedOnDisplayObject(imageOrText,animationInfo){if(!_.isObject(imageOrText)){return{}}var defaultPositions={};var currentPosition=getDisplayObjectPositionAndSizeData(imageOrText,{size:false});if(animationInfo.movementType==="relative"){defaultPositions.initialX=0;defaultPositions.initialY=0}else{defaultPositions.initialX=currentPosition.x;defaultPositions.initialY=currentPosition.y}var finalXAbsolute=animationInfo.item.position.x;var finalYAbsolute=animationInfo.item.position.y;defaultPositions.finalX=finalXAbsolute;defaultPositions.finalY=finalYAbsolute;if(animationInfo.movementType==="relative"){if(_.isNumber(animationInfo.initialX)&&!_.isNan(animationInfo.initialX)){defaultPositions.finalX=finalXAbsolute-animationInfo.initialX}if(_.isNumber(animationInfo.initialY)&&!_.isNan(animationInfo.initialY)){defaultPositions.finalY=finalYAbsolute-animationInfo.initialY}}return defaultPositions}};this.setImageItemPositionAndTextBasedOnImageChange=function(item,newX,newY,options){if(!options){var options={}}var update=options.update;options.update=false;var defaultOptions={};defaultOptions.movementType="absolute";defaultOptions.maxDepth=1;_.defaults(options,defaultOptions);var stagesToUpdate=[];if(options.maxDepth>0&&(_.isArray(item)||item instanceof this.images.Item===false&&_.isObject(item))){var movementType=options.movementType;options.movementType="relative";options.maxDepth=options.maxDepth-1;_.each(item,function(value,index,list){moveItem(value,newX,newY)});options.maxDepth=options.maxDepth+1;options.movementType=movementType}else{moveItem(item,newX,newY)}function moveItem(item,newX,newY){if(item instanceof self.images.Item){var hasImage=false;var hasText=false;if(options.movementType==="relative"&&_.isObject(item.text)&&!item.image&&!_.isNaN(parseFloat(item.text.text))){}if(_.isObject(item.image)){var hasImage=true;var previousImageLocation=getDisplayObjectPositionAndSizeData(item.image,{size:false})}if(_.isObject(item.text)){var hasText=true;var previousTextLocation=getDisplayObjectPositionAndSizeData(item.text,{size:false})}if(!_.isNumber(newX)){if(hasImage){var deltaX=item.position.x-previousImageLocation.x}else if(hasText){var deltaX=item.position.x-previousTextLocation.x}else{var deltaX=0}}else{var deltaX=newX}if(!_.isNumber(newY)){if(hasImage){var deltaY=item.position.y-previousImageLocation.y}else if(hasText){var deltaY=item.position.y-previousTextLocation.y}else{var deltaY=0}}else{var deltaY=newY}if(options.movementType==="relative"){if(_.isNumber(newX)){var deltaX=newX}if(_.isNumber(newY)){var deltaY=newY}}else{if(_.isNumber(newX)){if(hasImage){var deltaX=newX-previousImageLocation.x}else if(hasText){var deltaX=newX-previousTextLocation.x}else{var deltaX=newX-item.position.x}}if(_.isNumber(newY)){if(hasImage){var deltaY=newY-previousImageLocation.y}else if(hasText){var deltaY=newY-previousTextLocation.y}else{var deltaY=newY-item.position.y}}}if(options.permanent===true){if(_.isNumber(newX)&&options.movementType!=="relative"){item.position.x=newX}else{item.position.x=item.position.x+deltaX}if(_.isNumber(newY)&&options.movementType!=="relative"){item.position.y=newY}else{item.position.y=item.position.y+deltaY}}if(deltaX===0&&deltaY===0){return}if(hasImage){var newImageX=previousImageLocation.x+deltaX;var newImageY=previousImageLocation.y+deltaY;setDisplayObjectPositionData(item.image,{x:newImageX,y:newImageY});if(options.updateStageStatus!==false){stagesToUpdate.push(self.easelJSDisplayObjectChanged(item))}}if(hasText){newTextX=previousTextLocation.x+deltaX;newTextY=previousTextLocation.y+deltaY;setDisplayObjectPositionData(item.text,{x:newTextX,y:newTextY});if(!hasImage&&options.updateStageStatus!==false){stagesToUpdate.push(self.easelJSDisplayObjectChanged(item))}}}}options.update=update;if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};var setDisplayObjectPositionData=function(imageOrText,positionData,options){if(!_.isObject(imageOrText)||!_.isObject(positionData)||_.isEmpty(positionData)){return}if(!options){var options={}}var x=positionData.x;var y=positionData.y;var newOuterWidth=positionData.width;var newOuterHeight=positionData.height;if(imageOrText instanceof createjs.DisplayObject){var changed=false;var position=false;var size=false;var maxSize=false;if(_.isNumber(x)||_.isNumber(y)){position=true}if(_.isNumber(newOuterWidth)||_.isNumber(newOuterHeight)){size=true;maxSize=true}var data=getDisplayObjectPositionAndSizeData(imageOrText,{size:size,maxSize:maxSize,position:position});if(_.isNumber(x)&&x!=data.x){imageOrText.x=x;changed=true}if(_.isNumber(y)&&y!=data.y){imageOrText.y=y;changed=true}if(_.isNumber(newOuterWidth)||_.isNumber(newOuterHeight)){var maxWidth=data.maxWidth;var maxHeight=data.maxHeight;var currentWidth=data.outerWidth;var currentHeight=data.outerHeight;var currentMask=imageOrText.mask;if(currentMask instanceof createjs.Rectangle){var maskX=currentMask.x;var maskY=currentMask.y}var restoreWidth=false;var restoreHeight=false;var newWidth;var newHeight;if(_.isNumber(newOuterWidth)){if(_.isNumber(currentHeight)){newHeight=currentHeight}else{newHeight=maxHeight}if(newOuterWidth<maxWidth){newWidth=newOuterWidth}else{newWidth=maxWidth;restoreWidth=true}}if(_.isNumber(newOuterHeight)){if(!_.isNumber(newWidth)){newWidth=currentWidth}if(!_.isNumber(newWidth)){newWidth=maxWidth}if(newOuterHeight<maxHeight){newHeight=newOuterHeight}else{newHeight=maxHeight;restoreHeight=true}}if(_.isNumber(maskX)){var x=maskX}else{var x=0}if(_.isNumber(maskY)){var y=maskY}else{var y=0}if(restoreWidth===true&&restoreHeight===true){imageOrText.mask=null}else if(!_.isNumber(newWidth)&&!_.isNumber(newHeight)){}else if(_.isNumber(newWidth)&&_.isNumber(newHeight)&&(newWidth!=currentWidth||newHeight!=currentHeight)){imageOrText.mask=new createjs.Rectangle(x,y,newWidth,newHeight)}if(newWidth!=currentWidth||newHeight!=currentHeight){changed=true}}if(changed===true&&imageOrText.parent instanceof createjs.DisplayObject){var stage=imageOrText.getStage();if(stage instanceof createjs.Stage){var canvasID=stage.canvas.id;var canvasNumber=canvasID.replace("canvas","");setStageUpdateStatus(parseInt(canvasNumber),false);return canvasNumber}}}else if(_.isElement(imageOrText)){var cssOptions={};if(_.isNumber(x)){cssOptions["left"]=x;var setPosition=true}if(_.isNumber(y)){cssOptions["top"]=y;var setPosition=true}if(setPosition){cssOptions["position"]="absolute"}if(_.isNumber(newOuterWidth)||_.isNumber(newOuterHeight)){var data=getDisplayObjectPositionAndSizeData(imageOrText,{position:false,size:true});if(_.isNumber(newOuterWidth)){cssOptions["width"]=newOuterWidth-data.extraWidth+"px"}if(_.isNumber(newOuterHeight)){cssOptions["height"]=newOuterHeight-data.extraHeight+"px";var oldLineHeight=$(imageOrText).css("line-height");if($(imageOrText).is("p")&&_.isString(oldLineHeight)&&oldLineHeight.indexOf("px")!==-1){cssOptions["line-height"]=parseInt(oldLineHeight)*((newOuterHeight-data.extraHeight)/data.contentHeight)+"px"}}}$(imageOrText).css(cssOptions);if(_.isNumber(x)){var left=parseInt($(imageOrText).css("left"));if(_.isNaN(left)||left<x-12||x>x+12){console.log("cssleft =  "+left+", assigned x = "+x);console.log(imageOrText);console.log(cssOptions);throw"getDisplayObjectPositionAndSizeData failed X"}}if(_.isNumber(y)){var top=parseInt($(imageOrText).css("top"));if(_.isNaN(top)||top<y-12||top>y+12){console.log("csstop =  "+top+", assigned y = "+y);console.log(imageOrText);console.log(cssOptions);throw"getDisplayObjectPositionAndSizeData failed Y"}}}};var getDisplayObjectPositionAndSizeData=function(imageOrText,options){if(!options){var options={}}if(imageOrText instanceof createjs.DisplayObject){var data={};if(options.position!==false){data.x=imageOrText.x;data.y=imageOrText.y}if(options.size!==false){var currentBounds;var currentSourceRect;if(imageOrText.mask){currentBounds=imageOrText.mask}if(currentBounds instanceof createjs.Rectangle){}else if(currentBounds instanceof createjs.Shape){currentBounds=currentBounds.getBounds()}if(currentBounds instanceof createjs.Rectangle!=true){currentBounds=imageOrText.getBounds()}if(currentBounds instanceof createjs.Rectangle!=true){currentBounds={width:imageOrText.parentItem.size.x,height:imageOrText.parentItem.size.y}}else{}if(imageOrText instanceof createjs.Bitmap&&imageOrText.sourceRect instanceof createjs.Rectangle){if(_.isNumber(imageOrText.sourceRect.width)&&imageOrText.sourceRect.width<currentBounds.width){currentBounds.width=imageOrText.sourceRect.width}if(_.isNumber(imageOrText.sourceRect.height)&&imageOrText.sourceRect.height<currentBounds.height){currentBounds.height=imageOrText.sourceRect.height}}data.extraWidth=0;data.paddingWidth=0;data.marginWidth=0;data.borderWidth=0;data.contentWidth=currentBounds.width;data.outerWidth=currentBounds.width;data.extraHeight=0;data.paddingHeight=0;data.borderHeight=0;data.marginHeight=0;data.contentHeight=currentBounds.height;data.outerHeight=currentBounds.height}if(options.maxSize){if(imageOrText instanceof createjs.Rectangle){maxWidth=imageOrText.width;maxHeight=imageOrText.height}else if(imageOrText instanceof createjs.Bitmap){maxWidth=imageOrText.image.width;maxHeight=imageOrText.image.height;if(imageOrText.sourceRect instanceof createjs.Rectangle){if(_.isNumber(imageOrText.sourceRect.width)&&imageOrText.sourceRect.width<maxWidth){maxWidth=imageOrText.sourceRect.width}if(_.isNumber(imageOrText.sourceRect.height)&&imageOrText.sourceRect.height<maxHeight){maxHeight=imageOrText.sourceRect.height}}}else if(imageOrText instanceof createjs.Shape){if(imageOrText.parentItem instanceof self.images.Item){maxWidth=imageOrText.parentItem.size.x;maxHeight=imageOrText.parentItem.size.y}else{maxWidth=self.getParentOfStageObject(0).stage.canvas.width;maxHeight=self.getParentOfStageObject(0).stage.canvas.height}}else if(imageOrText instanceof createjs.Text){maxWidth=self.jQueryObjects.canvasDiv.outerWidth(true);maxHeight=self.jQueryObjects.canvasDiv.outerHeight(true);if(_.isNumber(imageOrText.maxWidth)&&imageOrText.maxWidth<maxWidth){maxWidth=imageOrText.maxWidth}if(_.isNumber(imageOrText.lineWidth)&&imageOrText.lineWidth<maxWidth){maxWidth=imageOrText.lineWidth}}else{var bounds=imageOrText.getBounds();if(bounds instanceof createjs.DisplayObject!=true){console.log(imageOrText)}maxWidth=bounds.width;maxHeight=bounds.height}data.maxHeight=maxHeight;data.maxWidth=maxWidth}}else if(_.isElement(imageOrText)){var data={};
var element=imageOrText;if(options.position!==false){data.x=parseFloat($(element).css("left"));data.y=parseFloat($(element).css("top"));if(_.isNaN(data.x)||_.isNaN(data.y)){var invalidLocation=true}}var elementClass=$(element).attr("class");if(_.isString(elementClass)&&elementClass.indexOf(self.css.noFat)!==-1){data.extraWidth=0;data.extraHeight=0;var foundSize=true}if(invalidLocation||options.size!==false||!foundSize){var initialDisplay=$(element).css("display");var initialPointerEvents=$(element).css("pointer-events");if(initialDisplay==="none"){$(element).css({display:"hidden","pointer-events":"none"})}data.outerWidth=$(element).outerWidth(true);data.contentWidth=$(element).width();data.extraWidth=data.outerWidth-data.contentWidth;data.outerHeight=$(element).outerHeight(true);data.contentHeight=$(element).height();data.extraHeight=data.outerHeight-data.contentHeight;if($(element).is("p")){var dimensions=$(element).textDimensions($(element).text());data.currentWidth=dimensions.width+data.outerWidth-data.contentWidth;data.currentHeight=dimensions.height+data.outerHeight-data.contentHeight}else{data.currentWidth=data.outerWidth;data.curentHeight=data.outerHeight}if(invalidLocation){console.log("nan of get display object element position, using jquery position function");console.log($(element));console.log(data);var location=$(element).position();console.log(location);if(_.isNaN(data.x)){data.x=location.left-data.extraWidth/2}if(_.isNaN(data.y)){data.y=location.top-data.extraHeight/2}}if(initialDisplay==="none"||initialPointerEvents!=="none"){$(element).css({display:initialDisplay,"pointer-events":initialPointerEvents})}}if(_.isNaN(data.x)||_.isNaN(data.y)||_.isNaN(data.extraWidth)||_.isNaN(data.extraHeight)||!_.isNumber(data.extraWidth)||!_.isNumber(data.extraHeight)){console.log("invalidlocation = "+invalidLocation);console.log("foundsize = "+foundSize);console.log(options);console.log(data);console.log(element);throw"failed at getting position data"}if(options.maxSize){var maxWidth=$(element).css("max-width");if(_.isString(maxWidth)&&maxWidth.indexOf("px")!=-1){data.maxWidth=parseFloat(maxWidth)}else{data.maxWidth=self.jQueryObjects.canvasDiv.outerWidth(true)}var maxHeight=$(element).css("max-height");if(_.isString(maxHeight)&&maxHeight.indexOf("px")!=-1){data.maxHeight=parseFloat(maxHeight)}else{data.maxHeight=self.jQueryObjects.canvasDiv.outerHeight(true)}}}else if(_.isObject(imageOrText)){var data={x:imageOrText.x,y:imageOrText.y,extraWidth:0,paddingWidth:0,marginWidth:0,borderWidth:0,contentWidth:0,outerWidth:0,maxWidth:0,currentWidth:0,extraHeight:0,contentHeight:0,paddingHeight:0,borderHeight:0,marginHeight:0,outerHeight:0,maxHeight:0,currentHeight:0}}else{console.log("getdisplayposition failed due to parameter not a display object");return{}}if(!_.isObject(data)){console.log(imageOrText);console.log(options);throw""}return data};this.dealCommunity=function(communityArray){var dealCardAnimationTime=300;var spreadFlopAnimationTime=200;fractionDistancePerTick=.02;var lastTick=1/fractionDistancePerTick-1;var interval=fractionDistancePerTick*dealCardAnimationTime;var initialX=this.images.startingCard.position.x;var initialY=this.images.startingCard.position.y;var stagesToUpdate=[];var animatedCard=new this.images.Item(initialX,initialY,this.images.community[0].size.x,this.images.community[0].size.y,getZ("cardAnimation"));stagesToUpdate.push(this.images.cardAsBitmap(animatedCard,null));var communitySound=createjs.Sound.createInstance(this.images.sources.dealCommunity);communitySound.play();var initialAnimationInfo={};initialAnimationInfo.numTicks=lastTick+1;initialAnimationInfo.item=animatedCard;initialAnimationInfo.onTick=null;initialAnimationInfo.time=dealCardAnimationTime;initialAnimationInfo.onStart=function(info){stagesToUpdate.push(self.displayChildren(info.item));self.updateStages(stagesToUpdate);stagesToUpdate.length=0};if(communityArray.length==5){initialAnimationInfo.finalX=self.images.community[4].position.x;initialAnimationInfo.finalY=self.images.community[4].position.y;initialAnimationInfo.onEnd=function(){stagesToUpdate.push(self.displayShownCard(communityArray[4],self.images.community[4]));stagesToUpdate.push(self.hideChildren(animatedCard,{update:false}));self.updateStages(stagesToUpdate);stagesToUpdate.length=0};self.animateImage(initialAnimationInfo)}else if(communityArray.length==4){initialAnimationInfo.finalX=self.images.community[3].position.x;initialAnimationInfo.finalY=self.images.community[3].position.y;initialAnimationInfo.onEnd=function(){stagesToUpdate.push(self.displayShownCard(communityArray[3],self.images.community[3]));stagesToUpdate.push(self.hideChildren(animatedCard,{update:false}));self.updateStages(stagesToUpdate);stagesToUpdate.length=0};self.animateImage(initialAnimationInfo)}else if(communityArray.length==3){initialAnimationInfo.finalX=self.images.community[0].position.x;initialAnimationInfo.finalY=self.images.community[0].position.y;async.series([function(callback){initialAnimationInfo.onEnd=function(){callback(null,1)};self.animateImage(initialAnimationInfo)},function(callback){for(var i=0;i<=2;i++){self.images.cardAsBitmap(self.images.community[i],communityArray[i]);self.images.community[i].image.x=self.images.community[0].position.x;stagesToUpdate.push(self.displayChildren(self.images.community[i],{update:false}))}stagesToUpdate.push(self.hideChildren(animatedCard,{update:false}));self.updateStages(stagesToUpdate);var community1Animation={initialX:self.images.community[0].position.x,initialY:self.images.community[0].position.y,numTicks:lastTick+1,finalX:self.images.community[1].position.x,finalY:self.images.community[1].position.y,item:self.images.community[1],time:spreadFlopAnimationTime,onEnd:function(){}};var community2Animation=_.clone(community1Animation);community2Animation.finalX=self.images.community[2].position.x;community2Animation.finalY=self.images.community[2].position.y;community2Animation.item=self.images.community[2];self.animateImage(community1Animation);self.animateImage(community2Animation)}])}};var setFlags=function(flagsObject,callUserOptionUpdateDefaultsToTrue,optionsParameter){if(!optionsParameter){var optionsParameter={}}var options=_.clone(optionsParameter);options.update=false;if(!_.isObject(flagsObject)){console.error(flagsObject);return}_.each(flagsObject,function(value,key,list){setOneFlagOrPreference(key,value,options)});options.update=update;if(callUserOptionUpdateDefaultsToTrue!==false){return self.updateUserOptionsBasedOnFlagsAndPreactions(options)}};var setOneFlagOrPreference=function(flag,value,options){if(_.isUndefined(value)){return}var flagOptions=_.clone(options);var defaults={server:false};flagOptions=_.defaults(flagOptions,defaults);if(flag.indexOf("sessionPreferences")!==-1){self.updatePreference(self.sessionPreferences,value,flagOptions)}else{switch(flag){case"check":case"fold":case"bet":case"raise":case"all_in":case"call_any":self.setPreactionData("hand",flag,value,flagOptions);break;case"call":if(!_.isNumber(value)){self.setPreactionData("hand",flag,value,flagOptions)}else{self.setPreactionData("once",flag,value,flagOptions)}break;default:self.setPreactionData("permanent",flag,value,flagOptions);break}}};this.queueExpirationFunction=function(expirationTrigger,actionFunction,options){if(!options){var options={}}if(_.isNumber(options.seat)){var expirationObject=this.gameState.seats[options.seat][expirationTrigger]}else{var expirationObject=this.gameState[expirationTrigger]}if(_.isArray(expirationObject.onEnd)){expirationObject.onEnd.push(actionFunction)}else if(_.isFunction(expirationObject.onEnd)){expirationObject.onEnd=[expirationObject.onEnd,actionFunction]}else{expirationObject.onEnd=[actionFunction]}};this.setPreactionData=function(expirationType,actionType,value,options){if(_.isUndefined(value)){return}if(!options){var options={}}if(options.seat==="table"){var gameStateSeatObject=self.gameState}else if(!_.isNumber(options.seat)){var gameStateSeatObject=self.gameState.seats[this.gameState.userSeatNumber]}else{var gameStateSeatObject=self.gameState.seats[options.seat]}if(!_.isObject(gameStateSeatObject)){return}var expirationTypesToSet=[];var otherActionTypesToSet=[];var otherActionValue=false;if(value===false||value===null||_.isUndefined(value)){value=false;expirationTypesToSet.push("act","street","once","hand","permanent")}else if(expirationType==="act"){expirationTypesToSet.push("act")}else if(expirationType==="street"){expirationTypesToSet.push("act","street")}else if(expirationType==="once"){expirationTypesToSet.push("act","street","once")}else if(expirationType==="hand"){expirationTypesToSet.push("act","street","once","hand")}else if(expirationType==="permanent"){expirationTypesToSet.push("act","street","once","hand","permanent")}else{expirationTypesToSet.push(expirationType)}setValues(expirationTypesToSet,actionType,value);function setValues(expirationTypes,actionTypes,values){var serverActionsSet=[];var flagsObjectToSendToServer={};if(!_.isArray(actionTypes)){actionTypes=[actionTypes]}if(!_.isArray(expirationTypes)){expirationTypes=[expirationTypes]}for(var i=0;i<actionTypes.length;i++){if(_.isArray(values)){var valueOfFlag=values[i]}else{var valueOfFlag=values}for(var j=0;j<expirationTypes.length;j++){set1Value(expirationTypes[j],actionTypes[i],valueOfFlag)}}if(options.server===true){socket.emit("set_flags",flagsObjectToSendToServer)}function set1Value(expiration,action,val){if(options.server===true&&_.indexOf(serverActionsSet,actionTypes)===-1){flagsObjectToSendToServer[action]=val;serverActionsSet.push(action)}else if(options.server!==true){gameStateSeatObject[expiration][action]=val}}}};this.getPreactionData=function(actionType,options){if(!options){var options={}}if(options.seat==="table"){}else if(!_.isNumber(options.seat)||_.isNaN(options.seat)){var seat=self.gameState.userSeatNumber}else{var seat=options.seat}if(!_.isNumber(seat)){var gameStateSeatObject=self.gameState}else{var gameStateSeatObject=self.gameState.seats[seat]}if(!_.isObject(gameStateSeatObject)){return}if(!_.isFunction(options.checkFunction)){var checkFunction=function(value,flagsObject){if(actionType==="raise"||actionType==="bet"||actionType==="call"||actionType==="all_in"||actionType==="call_any"){var preactionOptionData=self.getPreactionOptionValues();var currentBetSizes=preactionOptionData.currentBetSizes;var currentStackSizes=preactionOptionData.currentStackSizes;var maxAllInSizes=preactionOptionData.maxAllInSizes;if(!_.isObject(preactionOptionData)||_.isEmpty(preactionOptionData)){return}else if(_.isNaN(preactionOptionData[actionType])||preactionOptionData[actionType]===false){return undefined}else if(!_.isNumber(preactionOptionData[actionType])&&preactionOptionData[actionType]!==true){return undefined}if(actionType==="call_any"){if(flagsObject["call"]===true){return true}else{return undefined}}else if(actionType==="call"){if(_.isNumber(value)&&_.isNumber(preactionOptionData[actionType])&&value>=preactionOptionData[actionType]){return value}if(preactionOptionData.all_in===false){if(value===true){return preactionOptionData.call}else if(flagsObject["all_in"]===true){return preactionOptionData.call}}else{if(!_.isNumber(value)){return undefined}}}else if(actionType==="all_in"){if(value===true){return true}var userAllIn=preactionOptionData[actionType];var compactedMaxSizes=_.compact(maxAllInSizes.splice(seat,1));var allInThreshhold=userAllIn;var highestNonUserStack=0;for(var i=0;i<compactedMaxSizes.length;i++){if(compactedMaxSizes[i]>highestNonUserStack){highestNonUserStack=compactedMaxSizes[i]}}if(highestNonUserStack<userAllIn){allInThreshhold=userAllIn}if(!_.isNumber(preactionOptionData[actionType])){return undefined}else if(preactionOptionData[actionType]<currentBetSizes[seat]+currentStackSizes[seat]){throw"all_in value not the same as calculated from table"}var raiseFlag=flagsObject.raise;if(!_.isNumber(raiseFlag)){return undefined}else if(raiseFlag<allInThreshhold){return undefined}var betFlag=flagsObject.bet;var highBet=self.getHighBet();if(highBet>currentBetSizes[seat]){return true}else if(highBet===currentBetSizes[seat]){if(!_.isNumber(betFlag)){return}else if(betFlag<allInThreshhold){return}else{return true}}}else if(value===true){return value}else if(_.isNumber(value)&&_.isNumber(preactionOptionData[actionType])&&value>=preactionOptionData[actionType]){return value}else{return undefined}}else if(_.isUndefined(value)){return value}else if(_.isNaN(value)){return value}else if(actionType==="autorebuy"){if(_.isNumber(value)&&value>0){return value}else{return}}else if(actionType==="toAct"){if(!_.isNumber(value)){return}else if(value>=0&&value<self.gameState.numSeats){return value}else{console.log("toAct = "+value);throw"inappropriate number on toAct flag";return}}else{return value}}}else{var checkFunction=options.checkFunction}var actValue=gameStateSeatObject.act[actionType];var streetValue=gameStateSeatObject.street[actionType];var onceValue=gameStateSeatObject.once[actionType];var handValue=gameStateSeatObject.hand[actionType];var permanentValue=gameStateSeatObject.permanent[actionType];var actProcessedValue=checkFunction(actValue,gameStateSeatObject.act);var streetProcessedValue=checkFunction(streetValue,gameStateSeatObject.street);var onceProcessedValue=checkFunction(onceValue,gameStateSeatObject.once);var handProcessedValue=checkFunction(handValue,gameStateSeatObject.hand);var permanentProcessedValue=checkFunction(permanentValue,gameStateSeatObject.permanent);var useValue=function(val){if(_.isUndefined(val)||_.isNull(val)||_.isNaN(val)){return false}else{return true}};var data=[];if(useValue(actProcessedValue)){data.push(actProcessedValue)}if(useValue(streetProcessedValue)){data.push(streetProcessedValue)}if(useValue(onceProcessedValue)){data.push(onceProcessedValue)}if(useValue(handProcessedValue)){data.push(handProcessedValue)}if(useValue(permanentProcessedValue)){data.push(permanentProcessedValue)}var numberTestArray=_.uniq(_.without(data,true,false));if(numberTestArray.length===1){var finalValue=numberTestArray[0]}else if(numberTestArray.length>1){numberTestArray=numberTestArray.sort(function(a,b){return a-b});var returnValue=_.last(numberTestArray)}else{var finalValue=data[0]}if(actionType==="toAct"&&!_.isNumber(finalValue)){}return finalValue};var Preference=function(value,options){if(!options){var options={}}this.value=value;this.updateValue=options.updateValue;if(!_.isFunction(this.updateValue)){this.updateValue=function(newValue){if(_.isUndefined(newValue)){return}this.value=newValue}}if(_.isFunction(options.get)){this.get=options.get}else{this.get=function(){return this.value}}if(_.isString(options.path)){this.path=options.path}if(_.isString(options.type)){this.type=options.type}};var PreferencesAPI=function(){var arrayFromDotString=function(dotString){if(_.isString(dotString)){var array=dotString.split(".")}else if(_.isArray(dotString)){var array=dotString}return array};var getPreferenceAncestorFromType=function(type){if(type==="permanent"){return self.permanentPreferences}else if(type==="session"||type==="temporary"){return self.sessionPreferences}};var _preferenceUtils=function(action,type,location,parameters){if(_.isString(type)){var parentObject=getPreferenceAncestorFromType(type)}else{var parentObject=type}if(!_.isObject(parentObject)){return}var locationArray=arrayFromDotString(location);if(!_.isArray(locationArray)){return}var preference=parentObject;var lastValue;_.each(locationArray,function(value,index,list){if(index===locationArray.length-1&&action==="create"||action==="new"||(action==="set"||action==="update")&&!isPreference(preference[value])){var creationOptions={path:location};if(_.isString(type)){creationOptions.type=type}if(_.isArray(parameters)){if(!_.isObject(parameters[1])){parameters[1]={}}_.each(creationOptions,function(value,index,list){parameters[1][index]=value});preference[value]=new Preference.apply(self,parameters)}else{preference[value]=new Preference(parameters,creationOptions)}lastValue=value}if(_.isObject(preference)){preference=preference[value]}});if(!isPreference(preference)){return}else if(action==="get"){return preference.get()}else if(action==="set"||action==="update"){preference.updateValue(paramaters)}};this.isPreference=function(preference){return isPreference(preference)};this.get=function(permanentOrSession,dotSeparatedStringLocation,options){var preferenceValue=_preferenceUtils("get",permanentOrSession,dotSeparatedStringLocation,null,options);return preferenceValue};this.set=function(permanentOrSession,dotSeparatedStringLocation,parameters,options){var preference=_preferenceUtils("set",permanentOrSession,dotSeparatedStringLocation,parameters,options);return preference};this.update=this.set;this.create=function(permanentOrSession,dotSeparatedStringLocation,parameters,options){var preference=_preferenceUtils("create",permanentOrSession,dotSeparatedStringLocation,parameters,options);return preference};this.new=this.create};self.preferencesAPI=new PreferencesAPI;this.getHighBet=function(){return Math.max.apply(Math,this.getCurrentBetSizes());if(_.isNumber(this.gameState.hand.highBet)){return this.gameState.highBet}else{return Math.max.apply(Math,this.getCurrentBetSizes())}};this.images.createPairOfCheckBoxOptionDisplayObject=function(text,onClickUnchecked,onClickChecked){var height=self.images.foldToAnyBet.size.y;var preactionItem=new self.images.Item(0,0,0,height,getZ("buttons","staticItems"));var preactionItemOn=new self.images.Item(0,0,0,height,getZ("buttons","staticItems"));preactionItem.addBitmap(self.permanentPreferences.sourceObjects.value.checkBox);preactionItemOn.addBitmap(self.permanentPreferences.sourceObjects.value.checkBoxChecked);self.images.addCheckBoxButtonText(preactionItem,text);self.images.addCheckBoxButtonText(preactionItemOn,text);if(_.isFunction(onClickUnchecked)){preactionItem.on("click",function(e){onClickUnchecked(event,preactionItem,preactionItemOn);self.hideChildren(preactionItem,{update:false});self.displayChildren(preactionItemOn)},{text:false})}if(_.isFunction(onClickChecked)){preactionItemOn.on("click",function(e){onClickChecked(event,preactionItemOn,preactionItem);self.hideChildren(preactionItemOn,{update:false});self.displayChildren(preactionItem)},{text:false})}return{unchecked:preactionItem,checked:preactionItemOn}};this.createPreactionOptionItems=function(){self.images.preactions={};var callPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Call");var checkPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Check");var allInPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("All-In");var foldPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Fold");var callAnyPreactionItems=self.images.createPairOfCheckBoxOptionDisplayObject("Call Any Bet");self.images.preactions.callUnchecked=callPreactionItems.unchecked;self.images.preactions.callChecked=callPreactionItems.checked;self.images.preactions.checkUnchecked=checkPreactionItems.unchecked;self.images.preactions.checkChecked=checkPreactionItems.checked;self.images.preactions.allInUnchecked=allInPreactionItems.unchecked;self.images.preactions.allInChecked=allInPreactionItems.checked;self.images.preactions.foldUnchecked=foldPreactionItems.unchecked;self.images.preactions.foldChecked=foldPreactionItems.checked;self.images.preactions.callAnyUnchecked=callAnyPreactionItems.unchecked;self.images.preactions.callAnyChecked=callAnyPreactionItems.checked;self.images.preactions.callUnchecked.image.removeAllEventListeners();self.images.preactions.callChecked.image.removeAllEventListeners();self.images.preactions.checkUnchecked.image.removeAllEventListeners();self.images.preactions.checkChecked.image.removeAllEventListeners();self.images.preactions.allInUnchecked.image.removeAllEventListeners();self.images.preactions.callUnchecked.image.removeAllEventListeners();self.images.preactions.foldUnchecked.image.removeAllEventListeners();self.images.preactions.foldChecked.image.removeAllEventListeners();self.images.preactions.callAnyUnchecked.image.removeAllEventListeners();self.images.preactions.callAnyChecked.image.removeAllEventListeners();var setPreactionDataOptions={server:true};self.images.preactions.callUnchecked.on("click",function(e){self.setPreactionData("once","call",self.getPreactionOptionValues().call,setPreactionDataOptions)});self.images.preactions.callChecked.on("click",function(e){self.setPreactionData("hand","call",false,setPreactionDataOptions)});self.images.preactions.checkUnchecked.on("click",function(e){self.setPreactionData("hand","check",self.getPreactionOptionValues().check,setPreactionDataOptions)});self.images.preactions.checkChecked.on("click",function(e){self.setPreactionData("hand","check",false,setPreactionDataOptions)});self.images.preactions.allInUnchecked.on("click",function(e){self.setPreactionData("hand","all_in",true,setPreactionDataOptions)});self.images.preactions.allInChecked.on("click",function(e){self.setPreactionData("hand","all_in",false,setPreactionDataOptions)});self.images.preactions.foldUnchecked.on("click",function(e){self.setPreactionData("hand","fold",true,setPreactionDataOptions)});self.images.preactions.foldChecked.on("click",function(e){self.setPreactionData("hand","fold",false,setPreactionDataOptions)});self.images.preactions.callAnyUnchecked.on("click",function(e){self.setPreactionData("hand","call",true,setPreactionDataOptions)});self.images.preactions.callAnyChecked.on("click",function(e){self.setPreactionData("hand","call",false,setPreactionDataOptions)})};this.getPreactionOptionValues=function(){var userSeat=self.gameState.userSeatNumber;var currentStackSizes=self.getCurrentStackSizes();var currentBetSizes=self.getCurrentBetSizes();var highBet=self.getHighBet();var gameStateSeatObject=self.gameState.seats[userSeat];var justActed=setJustActedOrPassNullToGetJustActed();var getMinBet=function(){if(self.images.community[3].isDisplayed()){var minBet=self.initial_table_state.small_blind}else{var minBet=self.initial_table_state.big_blind}if(!_.isNumber(minBet)||_.isNaN(minBet)){console.log("minbet not a number = "+minBet);console.log(self.gameState)}return minBet};var isHighBetNonUser=function(){return currentBetSizes[userSeat]===highBet};var getUserStackSize=function(){return currentStackSizes[userSeat]};var getUserBet=function(){return currentBetSizes[userSeat]};var getPlayerToAct=function(){var toAct=self.getPreactionData("toAct",{seat:"table"});if(!_.isNumber(toAct)){toAct=justActed}return playerToAct};var getMaximumAllInBetSizes=function(){if(currentStackSizes.length!==currentBetSizes.length){console.log(chipStacks);console.log(betSizes);throw"error"}var maxSizes=[];_.each(currentStackSizes,function(value,element,list){maxSizes[element]=currentStackSizes[element]+currentBetSizes[element]});return maxSizes};var highBet=self.getHighBet();var userBet=getUserBet();var userStackSize=getUserStackSize();var playerToAct=getPlayerToAct();var maxAllInSizes=getMaximumAllInBetSizes();var minBet=getMinBet();var facingAllIn=highBet>userBet&&highBet-userBet>=userStackSize;var all_in;var call;var call_any;var fold;var check;var raise;var bet;if(canPlayerActDefaultsToUser(userSeat)===false){console.log("getPreactionOptionValues fail due to player cannot act")}else if(self.getPreactionData("toAct",{seat:"table"})===userSeat){console.log("getPreactionOptionValues fail due to user is to act and so cannot display preaction values")}else if(self.getPreactionData("inHand",{seat:userSeat})!==true){console.log("getPreactionOptionValues fail due to user not in hand")}else if(!_.isNumber(minBet)){console.log("getPreactionOptionValues fail due to minbet not a number")}else if(_.compact(currentStackSizes).length===0){console.log("getPreactionOptionValues fail due to all stacksizes === 0")}else{all_in=userStackSize+userBet;fold=true;call_any=true;if(highBet>userBet){if(highBet-userBet>=userStackSize){call=userStackSize;all_in=false;call_any=false}else{call=highBet-userBet;raise=highBet-userBet+highBet;if(raise-highBet<minBet){raise=highBet+minBet}if(raise-userBet>userStackSize){raise=userStackSize+userBet}}}else if(highBet===userBet){bet=minBet;if(bet>userStackSize){bet=userStackSize}check=true}if(_.isNumber(playerToAct)&&!_.isNaN(playerToAct)){var seatNum=playerToAct;var iterations=0;var highestBetToFace=0;while(seatNum!==userSeat){if(maxAllInSizes[seatNum]>highestBetToFace){highestBetToFace=maxAllInSizes[seatNum]}iterations++;if(iterations>self.gameState.numSeats){console.log("numiterations = "+iterations);console.log("maxallinsizes = "+maxAllInSizes);throw"too many iterations on determining call_any"}seatNum++;if(seatNum>=maxAllInSizes.length){seatNum=seatNum%maxAllInSizes.length}}if(highestBetToFace>userBet&&highestBetToFace>highBet){call_any=true}}}if(_.isNaN(all_in)){console.log("all in = nan");console.log(userStackSize);console.log(userBet)}var data={check:check,all_in:all_in,fold:fold,call:call,raise:raise,bet:bet,call_any:call_any,currentStackSizes:currentStackSizes,currentBetSizes:currentBetSizes,maxAllInSizes:maxAllInSizes,userBet:userBet,highBet:highBet,userStackSize:userStackSize};return data};this.updatePreactionOptionDisplayBasedOnLocalData=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];seat=this.gameState.userSeatNumber;var currentStackSizes=this.getCurrentStackSizes();var currentBetSizes=this.getCurrentBetSizes();if(!_.isNumber(seat)||self.getPreactionData("toAct",{seat:"table"})===seat||self.getPreactionData("inHand",{seat:seat})!==true||currentStackSizes[seat]<=0||canPlayerActDefaultsToUser()===false){stagesToUpdate.push(this.hideChildren(this.images.preactions),options)}else{var preactionBackgroundX=this.images.fold.position.x;var preactionBackgroundY=this.images.fold.position.y;var preactionBackgroundWidth=this.images.betSlider.betSize.position.x+this.images.betSlider.betSize.size.x-this.images.fold.position.x;var preactionBackgroundHeight=this.images.fold.size.y;var numPreactionsDisplayed=0;var preactionButtonHeight=this.images.foldToAnyBet.size.y;var preactionButtonOffsetLeft=this.images.foldToAnyBet.position.x;var preactionButtonOffsetTop=2;var preactionButtonOffsetBottom=2;var distanceBetweenPreactionButtonsX=35;var distanceBetweenPreactionButtonsY=3;var numPreactionsPerColumn=2;var preactionsZPosition=this.images.foldToAnyBet.position.z;var itemsToDisplay=[];var preactionUncheckedItemArray=[];var getLastUncheckedItem=function(){return preactionUncheckedItemArray[preactionUncheckedItemArray.length-1]};var displayLastUncheckedItem=function(){itemsToDisplay.push(getLastUncheckedItem())};var preactionCheckedItemArray=[];var getLastCheckedItem=function(){return preactionCheckedItemArray[preactionCheckedItemArray.length-1]};var displayLastCheckedItem=function(){itemsToDisplay.push(getLastCheckedItem())};var preactionOptions=this.getPreactionOptionValues();console.log("displaying preactionOptionValues");console.log(preactionOptions);if(preactionOptions.call>=currentStackSizes[seat]){var callText="Call All-In"}else{var callText="Call "+preactionOptions.call}if(preactionOptions.check===true){stagesToUpdate.push(updatePreactionText(this.images.preactions.checkUnchecked,this.images.preactions.checkChecked,"Check"));if(this.getPreactionData("check")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}if(preactionOptions.fold===true){stagesToUpdate.push(updatePreactionText(this.images.preactions.foldUnchecked,this.images.preactions.foldChecked,"Fold"));if(this.getPreactionData("fold")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}var all_inFlag=this.getPreactionData("all_in");if(_.isNumber(preactionOptions.all_in)){stagesToUpdate.push(updatePreactionText(this.images.preactions.allInUnchecked,this.images.preactions.allInChecked,"All-In"));if(all_inFlag){displayLastCheckedItem()}else{displayLastUncheckedItem()}if(_.isNumber(preactionOptions.call)){stagesToUpdate.push(updatePreactionText(this.images.preactions.callUnchecked,this.images.preactions.callChecked,callText));var checkIfCallIsValid=function(value){if(_.isNumber(value)&&value===preactionOptions.call){return true}};if(this.getPreactionData("call")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}if(preactionOptions.call_any===true){stagesToUpdate.push(updatePreactionText(this.images.preactions.callAnyUnchecked,this.images.preactions.callAnyChecked,"Call Any"));var checkIfCallAnyIsValid=function(value){if(value===true){return true}};if(this.getPreactionData("call_any")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}}else if(preactionOptions.all_in===false){stagesToUpdate.push(updatePreactionText(this.images.preactions.callUnchecked,this.images.preactions.callChecked,callText));if(all_inFlag||this.getPreactionData("call")){displayLastCheckedItem()}else{displayLastUncheckedItem()}}stagesToUpdate.push(setLocationDataOfPreactionItems());stagesToUpdate.push(this.hideChildren(this.images.preactions,options));console.log("displaying the following items:");console.log(itemsToDisplay);stagesToUpdate.push(this.displayChildren(itemsToDisplay,options))}options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}function updatePreactionText(uncheckedItem,checkedItem,text){var stagesToUpdate=[];var updateOptions={update:false};if(!_.isObject(uncheckedItem.text)){stagesToUpdate.push(self.images.addCheckBoxButtonText(uncheckedItem,text))}else{stagesToUpdate.push(uncheckedItem.updateText(text,updateOptions));stagesToUpdate.push(self.images.drawCheckBoxButtonHitSquareAndAdjustItemWidth(uncheckedItem))}if(!_.isObject(checkedItem.text)){stagesToUpdate.push(self.images.addCheckBoxButtonText(checkedItem,text))}else{stagesToUpdate.push(checkedItem.updateText(text,updateOptions));stagesToUpdate.push(self.images.drawCheckBoxButtonHitSquareAndAdjustItemWidth(checkedItem))}preactionUncheckedItemArray.push(uncheckedItem);preactionCheckedItemArray.push(checkedItem);return stagesToUpdate}function setLocationDataOfPreactionItems(){setAllItemWidths();var stagesToUpdate=[];var columnNumber=0;var rowNumber=0;for(var i=0;i<preactionUncheckedItemArray.length;i++){if(i!==0&&i%numPreactionsPerColumn===0){rowNumber=0;columnNumber++}var newX=getX(columnNumber);var newY=getY(rowNumber);stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(preactionUncheckedItemArray[i],newX,newY,{permanent:true}));stagesToUpdate.push(self.setImageItemPositionAndTextBasedOnImageChange(preactionCheckedItemArray[i],newX,newY,{permanent:true}));rowNumber++}return stagesToUpdate;function setAllItemWidths(){var longestWidth=0;for(var i=0;i<preactionUncheckedItemArray.length;i++){if(i%numPreactionsPerColumn===0){longestWidth=0}if(longestWidth<preactionUncheckedItemArray[i].size.x){longestWidth=preactionUncheckedItemArray[i].size.x}else{preactionUncheckedItemArray[i].size.x=longestWidth;preactionCheckedItemArray[i].size.x=longestWidth}}}function getX(column){var totalItemWidth=0;for(var i=0;i<column;i++){var totalItemWidth=totalItemWidth+preactionUncheckedItemArray[i*numPreactionsPerColumn].size.x}var x=column*distanceBetweenPreactionButtonsX+preactionButtonOffsetLeft+preactionBackgroundX+totalItemWidth;return x}function getY(row){var y=row*preactionUncheckedItemArray[0].size.y+row*distanceBetweenPreactionButtonsY+preactionButtonOffsetTop+preactionBackgroundY;return y}}};this.clearExpirationData=function(expirationType,seat,options){if(!options){var options={}}if(expirationType!=="act"){this.clearExpirationData("act",seat,options);if(expirationType!=="once"){this.clearExpirationData("once",seat,options);if(expirationType!=="street"){this.clearExpirationData("street",seat,options);if(expirationType!=="hand"){console.log("clear expiration data permanent called for seat: "+seat);this.clearExpirationData("hand",seat,options)}}}}var tableExpirationObject=self.gameState;if(!_.isEmpty(tableExpirationObject)){clearExpirationObject(tableExpirationObject)
}if(!_.isNumber(seat)){if(_.isNumber(this.gameState.userSeatNumber)){var seat=this.gameState.userSeatNumber}else{throw"no player number"}}if(_.isNumber(seat)){var playerSeatObject=self.gameState.seats[seat];if(!_.isEmpty(tableExpirationObject)){clearExpirationObject(playerSeatObject)}}function clearExpirationObject(gameStateObject){if(!_.isObject(gameStateObject[expirationType])){return}var onEnd=gameStateObject[expirationType].onEnd;gameStateObject[expirationType]={};if(options.callExpirationFunctions===true){if(_.isArray(onEnd)){for(var index=0;index<onEnd.length;index++){onEnd[index]()}}else if(_.isFunction(onEnd)){onEnd()}}}};this.dealHoleCards=function(smallBlindSeatNumber,playerArray,holeCardArray){var numPlayers=playerArray.length;var totalAnimationTime=800;var animationTime=75;var initialX=this.images.startingCard.position.x;var initialY=this.images.startingCard.position.y;var fractionDistancePerTick=.1;var lastTick=1/fractionDistancePerTick-1;var interval=fractionDistancePerTick*animationTime;var animatedCards0=[];var animatedCards1=[];var asyncArray=[];var callBackNumber=1;_.each(_.range(playerArray.length*2),function(cardsDealt){var playerArrayNumber=cardsDealt%playerArray.length;var dealHoleCardSound=createjs.Sound.createInstance(self.images.sources.dealHoleCardSound);if(cardsDealt==playerArrayNumber){animatedCards0[cardsDealt]=new self.images.Item(initialX,initialY,self.images.community[0].size.x,self.images.community[0].size.y,getZ("cardAnimation"));self.images.cardAsBitmap(animatedCards0[cardsDealt],null);asyncArray.push(function(callback){var dealCard0AnimationInfo={time:animationTime,ticks:lastTick+1,item:animatedCards0[cardsDealt],finalX:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[0].position.x,finalY:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[0].position.y,onEnd:function(){callback(null,callBackNumber)},onTick:null};dealHoleCardSound.play();self.animateImage(dealCard0AnimationInfo)})}else if(cardsDealt>playerArrayNumber){animatedCards1[cardsDealt]=new self.images.Item(initialX,initialY,self.images.community[0].size.x,self.images.community[0].size.y,getZ("cardAnimation"));self.images.cardAsBitmap(animatedCards1[cardsDealt],null);asyncArray.push(function(callback){var dealCard1AnimationInfo={time:animationTime,ticks:lastTick+1,item:animatedCards1[cardsDealt],finalX:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[1].position.x,finalY:self.images.seats[playerArray[playerArrayNumber]].hiddenCards[1].position.y,onEnd:function(){callback(null,callBackNumber)},onTick:null};dealHoleCardSound.play();self.animateImage(dealCard1AnimationInfo)})}callBackNumber++;asyncArray.push(function(callback){if(_.isNumber(self.gameState.userSeatNumber)&&playerArray[playerArrayNumber]==self.gameState.userSeatNumber&&holeCardArray){if(cardsDealt==playerArrayNumber){self.hideChildren(animatedCards0[cardsDealt]);self.displayShownCard(holeCardArray[0],self.images.seats[playerArray[playerArrayNumber]].shownCards[0])}else if(cardsDealt>playerArrayNumber){self.hideChildren(animatedCards1[cardsDealt]);self.displayShownCard(holeCardArray[1],self.images.seats[playerArray[playerArrayNumber]].shownCards[1])}}else{if(cardsDealt==playerArrayNumber){self.hideChildren(animatedCards0[cardsDealt]);self.displayChildren(self.images.seats[playerArray[playerArrayNumber]].hiddenCards[0])}else if(cardsDealt>playerArrayNumber){self.hideChildren(animatedCards1[cardsDealt]);self.displayChildren(self.images.seats[playerArray[playerArrayNumber]].hiddenCards[1])}}callback(null,callBackNumber)})});async.series(asyncArray)};this.playerStands=function(seatNumber){self.setPreactionData("permanent","displayMessageType","openSeat",{server:false,seat:seatNumber});if(seatNumber===this.gameState.userSeatNumber){this.hideSeatedOptions();this.gameState.userSeatNumber=null}for(var i=0;i<this.gameState.numSeats;i++){this.displayCorrectSeatItems(i)}self.hideChildren(self.images.seats[seatNumber].bubbleChats)};this.adjustHoleCardImageSourceRectangle=function(holeCards,options){if(!options){var options={}}var stagesToUpdate=[];var cardArray;var userIndiviualSeatNumbers=false;if(_.isArray(holeCards)){cardArray=holeCards}else if(_.isNumber(holeCards)){cardArray=_.flatten(this.images.seats[holeCards].hiddenCards,this.images.seats[holeCards].shownCards)}else if(holeCards instanceof this.images.Item){cardArray=[holeCards]}else{throw"adjusthole cards source rectangle (mask) given insufficient parameter"}for(var i=0;i<cardArray.length;i++){if(_.isNumber(options.seatNumber)){var seatNum=options.seatNumber}else{var seatNum=this.images.seats[cardArray[i].seatObjectAncestor.nonRotatedSeatNumber]}var distanceFromCardTopToSeatBottom=this.images.seats[seatNum].seat.position.y+this.images.seats[seatNum].seat.size.y-cardArray[i].image.y;if(cardArray[i].size.y>distanceFromCardTopToSeatBottom){cardArray[i].image.mask=createRectangle(cardArray[i],distanceFromCardTopToSeatBottom);stagesToUpdate.push(this.easelJSDisplayObjectChanged(cardArray[i]))}if(options.update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}}function createRectangle(currentCard,height){var rectangle=new createjs.Rectangle(0,0,currentCard.size.x,height);return rectangle}};this.adjustBetDisplayToInputOfUser=function(betSize,options){if(!_.isNumber(betSize)||_.isNaN(betSize)){return false}if(!options){var adjustmentOptions={}}else{var adjustmentOptions=_.clone(options)}var sliderSize=betSize;console.log("adjustBetDisplayToInputOfUser called: "+betSize);var min=$(self.images.betSlider.slider.image).slider("option","min");var max=$(self.images.betSlider.slider.image).slider("option","max");console.log("min = "+min+", max = "+max);if(betSize>=max){sliderSize=max;self.updateActionButton("bet",{value:"All-In",hidden:true});self.updateActionButton("raise",{value:"All-In",hidden:true})}else{if(betSize<min){sliderSize=min}self.updateActionButton("bet",{value:betSize,hidden:true});self.updateActionButton("raise",{value:betSize,hidden:true})}if(adjustmentOptions.slider!==false){$(self.images.betSlider.slider.image).slider("value",sliderSize)}if(adjustmentOptions.size!==false){self.updateBetSize(betSize,adjustmentOptions)}};this.displayAllCommunity=function(communityArray,options){var stagesToUpdate=[];for(var i=0;i<communityArray.length;i=i+1){if(_.isString(communityArray[i])&&communityArray[i].length>=2){stagesToUpdate.push(this.displayShownCard(communityArray[i],this.images.community[i],options))}}return stagesToUpdate};this.getParentOfStageObject=function(item){if(item instanceof this.images.Item){var parentOfStage=this.arrayOfParentsOfStageAndOfContainerArray[item.position.z.stage];return parentOfStage}else if(_.isNumber(item)){var parentOfStage=this.arrayOfParentsOfStageAndOfContainerArray[item];return parentOfStage}};this.updateBetSize=function(betSize,options){if(!options){var options={}}if(options.size!==false){$("#betSize").val(betSize)}self.gameState.betSize=betSize};this.displayImage=function(parentItem,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(optionsWithCondom.stageNumber)){optionsWithCondom.stageNumber=parentItem.position.z.stage}if(optionsWithCondom.container){var container=optionsWithCondom.container}else{var container=parentItem.position.z.container}if(parentItem.image){if(_.isElement(parentItem.image)){var display=self.imageData.defaultDisplayCSS;if(_.isString(options.displayCSS)){display=options.displayCSS}else if(_.isString(parentItem.position.displayCSS)){display=parentItem.position.displayCSS}$(parentItem.image).css("display",display)}else if(this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].containers[container].contains(parentItem.image)!==true){this.addChildToContainer(parentItem.image,container,optionsWithCondom);this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate=false;var changedWithoutUpdate=optionsWithCondom.stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(options.stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.displayText=function(parentOfTextObject,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(options.stageNumber)){optionsWithCondom.stageNumber=parentOfTextObject.position.z.stage}if(options.container){var container=optionsWithCondom.container}else{var container=parentOfTextObject.position.z.container}if(parentOfTextObject.text){if(_.isElement(parentOfTextObject.text)){var display=self.imageData.defaultDisplayCSS;if(_.isString(options.displayCSS)){display=options.displayCSS}else if(_.isString(parentOfTextObject.position.displayCSS)){display=parentOfTextObject.position.displayCSS}$(parentOfTextObject.text).css("display",display)}else if(this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].containers[container+1].contains(parentOfTextObject.text)!==true){this.addChildToContainer(parentOfTextObject.text,container+1,optionsWithCondom);this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate=false;var changedWithoutUpdate=optionsWithCondom.stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[optionsWithCondom.stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(optionsWithCondom.stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.displayChildren=function(parentOrGrandparent,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdateArray=[];if(parentOrGrandparent instanceof this.images.Item){stagesToUpdateArray.push(this.displayImage(parentOrGrandparent,options));stagesToUpdateArray.push(this.displayText(parentOrGrandparent,options))}else if(_.isArray(parentOrGrandparent)){for(var i=0;i<parentOrGrandparent.length;i++){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.displayImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.displayText(parentOrGrandparent[i],options))}}}else if(_.isObject(parentOrGrandparent)){for(var i in parentOrGrandparent){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.displayImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.displayText(parentOrGrandparent[i],options))}}}if(update!==false){options.update=update;this.updateStages(stagesToUpdateArray,options)}else{return stagesToUpdateArray}};this.displayHiddenCards=function(seatNumber,options){var stagesToUpdate=[];self.setPreactionData("hand","inHand",true,{seat:seatNumber});stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].hiddenCards[0],options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].hiddenCards[1],options));return stagesToUpdate};this.hideText=function(parentOfTextObject,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(optionsWithCondom.stageNumber)){var stageNumber=parentOfTextObject.position.z.stage}else{var stageNumber=optionsWithCondom.stageNumber}if(_.isNumber(optionsWithCondom.container)){var container=optionsWithCondom.container}else{var container=parentOfTextObject.position.z.container}if(parentOfTextObject.text){if(_.isElement(parentOfTextObject.text)){parentOfTextObject.saveDisplayCSS();$(parentOfTextObject.text).css("display","none")}else if(this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container+1].contains(parentOfTextObject.text)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container+1].removeChild(parentOfTextObject.text);this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate=false;var changedWithoutUpdate=stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.hideImage=function(parentItem,options){if(!_.isObject(options)){var optionsWithCondom={}}else{var optionsWithCondom=_.clone(options)}if(!_.isNumber(optionsWithCondom.stageNumber)){var stageNumber=parentItem.position.z.stage}else{var stageNumber=optionsWithCondom.stageNumber}if(_.isNumber(optionsWithCondom.container)){var container=optionsWithCondom.container}else{var container=parentItem.position.z.container}if(parentItem.image){if(_.isElement(parentItem.image)){parentItem.saveDisplayCSS();$(parentItem.image).css("display","none")}else if(self.getParentOfStageObject(stageNumber).containers[container].contains(parentItem.image)){self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].removeChild(parentItem.image);this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate=false;var changedWithoutUpdate=stageNumber}}if(optionsWithCondom.update!==false&&this.arrayOfParentsOfStageAndOfContainerArray[stageNumber].upToDate!==true||optionsWithCondom.update===true){this.updateStages(stageNumber);var changedWithoutUpdate=false}return changedWithoutUpdate};this.playerSitsOut=function(seatNumber,options){var stagesToUpdate=[];if(!options){var newOptions={}}else{var newOptions=_.clone(options)}newOptions.update=false;newOptions.seat=seatNumber;self.setPreactionData("permanent","sitting_out",true,newOptions);self.setPreactionData("hand","inHand",false,newOptions);stagesToUpdate.push(self.displayCorrectSeatItems(seatNumber,newOptions));if(options&&options.update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.images.Item.prototype.hide=function(updateOptions){if(!options){var options={}}else{var options=_.clone(updateOptions)}options.update=false;var stagesToUpdate=[];if(options.text!==false){stagesToUpdate.push(self.hideText(this,options))}if(options.image!==false){stagesToUpdate.push(self.hideImage(this,options))}if(updateOptions.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.images.Item.prototype.display=function(options){if(!options){var options={}}if(options.onlyText){return self.displayText(this,options)}else if(options.onlyImage){return self.displayImage(this,options)}else{return self.displayChildren(this,options)}};this.hideChildren=function(parentOrGrandparent,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdateArray=[];if(parentOrGrandparent instanceof this.images.Item){stagesToUpdateArray.push(this.hideImage(parentOrGrandparent,options));stagesToUpdateArray.push(this.hideText(parentOrGrandparent,options))}else if(_.isArray(parentOrGrandparent)){for(var i=0;i<parentOrGrandparent.length;i++){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.hideImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.hideText(parentOrGrandparent[i],options))}}}else if(_.isObject(parentOrGrandparent)){for(var i in parentOrGrandparent){if(parentOrGrandparent[i]instanceof this.images.Item){stagesToUpdateArray.push(this.hideImage(parentOrGrandparent[i],options));stagesToUpdateArray.push(this.hideText(parentOrGrandparent[i],options))}}}if(update!==false){options.update=update;this.updateStages(stagesToUpdateArray,options)}else{return stagesToUpdateArray}};this.hideAllActionButtons=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdateArray=[];stagesToUpdateArray.push(this.hideChildren(this.images.fold,options));stagesToUpdateArray.push(this.hideChildren(this.images.call,options));stagesToUpdateArray.push(this.hideChildren(this.images.check,options));stagesToUpdateArray.push(this.hideChildren(this.images.raise,options));stagesToUpdateArray.push(this.hideChildren(this.images.bet,options));stagesToUpdateArray.push(this.hideChildren(this.images.betSlider,options));stagesToUpdateArray=_.flatten(stagesToUpdateArray);if(update!==false){this.updateStages(stagesToUpdateArray)}else{return stagesToUpdateArray}$("#betSize").css("display","none")};this.roundEnds=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];if(_.isArray(this.gameState.holeCards)){this.gameState.holeCards.length=0}else{this.gameState.holeCards=null}stagesToUpdate.push(this.hideChildren(this.images.community[i]));for(var i=0;i<this.images.seats.length;i++){this.hideChildren(this.images.seats[i].hiddenCards,{update:false});this.hideChildren(this.images.seats[i].shownCards,{update:false});self.setPreactionData("hand","inHand",false,{seat:i})}stagesToUpdate.push(this.images.seats[0].hiddenCards[0].position.z.stage);stagesToUpdate.push(this.images.seats[0].shownCards[0].position.z.stage);stagesToUpdate.push(self.hideAllBets(options));stagesToUpdate.push(self.hideChildren(self.images.totalPotSize,{update:false}));stagesToUpdate.push(self.updatePotSize(undefined,options));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions(options));options.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.winners=function(players){var potArrayLength=0;for(var i=0;i<players.length;i++){if(players[i].chips_won.length>potArrayLength){potArrayLength=players[i].chips_won.length}}var pots=[];for(var i=0;i<potArrayLength;i++){pots.push("placeholder")}var chipAnimationTime=700;var timeBetweenAnimations=1500;var timeAtEnd=700;var ticks=33;var chipStacks=[];for(var i=0;i<players.length;i++){chipStacks.push([])}var callbackNumber=0;var potWinners=[];var temporaryStacks=[];var potIntoChipAnimationArray=[];var callbacks=[];var finalArray=[];var chipsInFrontOfPlayer=[];for(var i=0;i<self.images.seats.length;i++){chipsInFrontOfPlayer.push(0)}for(var i=0;i<pots.length;i++){potWinners.push([]);potIntoChipAnimationArray.push([]);for(var n=0;n<players.length;n++){var winnings=players[n].chips_won[i];if(winnings>0){temporaryStacks.push([]);potWinners[i].push({seat:players[n].seat,amountWon:winnings,temporaryStackNumber:temporaryStacks.length-1})}}}var chipMoveSound=createjs.Sound.createInstance(this.images.sources.moveChipsSound);console.log("current pot sizes = ");console.log(this.getCurrentPotSizes());if(this.getCurrentPotSizes()[0]===0){var betSizes=this.getCurrentBetSizes();var preflopWinner=players[0].seat;var preflopWinAmount=0;var masterSeriesArray=[];var asyncLoserToWinnerParallelAnimationArray=[];var asyncLoserToWinnerParallelAnimationArrayCallBackNumber=0;var betSizesToHide=[];_.each(betSizes,function(value,seatNumber,list){preflopWinAmount=preflopWinAmount+betSizes[seatNumber];if(betSizes[seatNumber]>0&&seatNumber!==preflopWinner){console.log("animating from "+seatNumber+" to "+preflopWinner);var loserToWinnerStack=getAnimatePlayersStackToWinnersStackFunction(seatNumber,preflopWinner);var callbackNumber=asyncLoserToWinnerParallelAnimationArrayCallBackNumber;asyncLoserToWinnerParallelAnimationArray.push(function(callback){loserToWinnerStack(function(){callback(null,callbackNumber)})});asyncLoserToWinnerParallelAnimationArrayCallBackNumber++;betSizesToHide.push(self.images.seats[seatNumber].bet)}});asyncLoserToWinnerParallelAnimationArrayPlaySoundAndHideBetSizeTextCallbackNumber=asyncLoserToWinnerParallelAnimationArrayCallBackNumber;asyncLoserToWinnerParallelAnimationArray.push(function(callback){chipMoveSound.play();self.hideChildren(betSizesToHide,{update:false});callback(null,asyncLoserToWinnerParallelAnimationArrayPlaySoundAndHideBetSizeTextCallbackNumber)});asyncLoserToWinnerParallelAnimationArrayCallBackNumber++;var asyncLoserToWinnerParallelAnimationArrayFinishedFunction=function(err,results){if(err){console.log("preflop winners message has error");console.log(err)}else{if(results.length!==asyncLoserToWinnerParallelAnimationArrayCallBackNumber){console.log("preflop winners message results array incorrect");console.log(results)}else{for(var i=0;i<results.length;i++){if(results[i]!==i){console.log("result value incorrect");console.log(results);throw"error"}}var stagesToUpdate=[];stagesToUpdate.push(self.hideAllBets());stagesToUpdate.push(self.playerPutsChipsInPot(preflopWinner,preflopWinAmount,players[0].chips,{update:false}));self.updateStages(stagesToUpdate)}}};async.parallel(asyncLoserToWinnerParallelAnimationArray,asyncLoserToWinnerParallelAnimationArrayFinishedFunction);return}_.each(_.range(potWinners.length),function(potNumber){var callID=0;if(!_.isEmpty(potWinners[potNumber])){_.each(_.range(potWinners[potNumber].length),function(inversePotNumber){var i=potWinners[potNumber].length-1-inversePotNumber;var animationDistanceX=self.images.seats[potWinners[potNumber][i].seat].firstChip.position.x-self.images.pots[potNumber].firstChip.position.x;var animationDistanceY=self.images.seats[potWinners[potNumber][i].seat].firstChip.position.y-self.images.pots[potNumber].firstChip.position.y;var columnDistance=self.images.seats[potWinners[potNumber][i].seat].secondColumnChip.position.x-self.images.seats[potWinners[potNumber][i].seat].firstChip.position.x;var splitPotIntoChipWinningsDisplayChipstackInfo={initialX:self.images.pots[potNumber].firstChip.position.x,initialY:self.images.pots[potNumber].firstChip.position.y,hidden:true};self.displayChipStack(potWinners[potNumber][i].amountWon,temporaryStacks[potWinners[potNumber][i].temporaryStackNumber],splitPotIntoChipWinningsDisplayChipstackInfo);var tempNumber=callID;potIntoChipAnimationArray[potNumber].push(function(callback){self.displayChildren(temporaryStacks[potWinners[potNumber][i].temporaryStackNumber].chips);callback(null,tempNumber)});callID++;var chipIntoPotTempCallbackNumber=callID;var potIntoChipAnimationFunction=getAnimateChipStackFunction(temporaryStacks[potWinners[potNumber][i].temporaryStackNumber].chips,animationDistanceX,animationDistanceY);potIntoChipAnimationArray[potNumber].push(function(callback){potIntoChipAnimationFunction(function(){callback(null,chipIntoPotTempCallbackNumber)})});callID++;var chipMoveSoundCallBacknumber=callbackNumber;potIntoChipAnimationArray[potNumber].push(function(callback){chipMoveSound.play();callback(null,chipMoveSoundCallBacknumber)});callbackNumber++});callbackNumber++}});var errorNumber=0;_.each(_.range(potIntoChipAnimationArray.length),function(inversePotNumber){var potNumber=potIntoChipAnimationArray.length-1-inversePotNumber;var tempNumber=errorNumber;if(!_.isEmpty(potIntoChipAnimationArray[potNumber])){finalArray.push(function(next){self.hideChildren(self.images.pots[potNumber].chips);self.hideChildren(self.images.pots[potNumber].potSize);async.parallel(potIntoChipAnimationArray[potNumber],function(err,results){next(null,tempNumber)})});errorNumber++;var tempASDF=errorNumber;finalArray.push(function(next){var stagesWeWantToUpdateAfter=[];_.each(_.range(potWinners[potNumber].length),function(i){var seatNumber=potWinners[potNumber][i].seat;chipsInFrontOfPlayer[seatNumber]=potWinners[potNumber][i].amountWon+chipsInFrontOfPlayer[seatNumber];var maxStackSize=false;for(var z=0;z<players.length;z++){if(players[z].seat===seatNumber){maxStackSize=players[z].chips}}var currentStackSize=self.getCurrentStackSizes()[seatNumber];var newStackSize=currentStackSize+potWinners[potNumber][i].amountWon;if(newStackSize>maxStackSize){newStackSize=maxStackSize}stagesWeWantToUpdateAfter.push(self.playerPutsChipsInPot(seatNumber,chipsInFrontOfPlayer[seatNumber],newStackSize,{update:false}));stagesWeWantToUpdateAfter.push(self.displayChildren(self.images.seats[seatNumber].bet,{update:false}));if(self.arrayOfParentsOfStageAndOfContainerArray[self.images.seats[seatNumber].chips[0].position.z.stage].stage.contains(self.images.seats[seatNumber].chips[0].image)){}stagesWeWantToUpdateAfter.push(self.hideChildren(temporaryStacks[potWinners[potNumber][i].temporaryStackNumber].chips,{update:false}))});self.updateStages(stagesWeWantToUpdateAfter);console.log("start waiting after pot number "+potNumber);var wait=setTimeout(function(){next(null,tempASDF)},timeBetweenAnimations)});errorNumber++}});var finalChipUpdateCallbackNumbr=errorNumber;finalArray.push(function(next){for(var i=0;i<players.length;i++){self.playerPutsChipsInPot(players[i].seat,chipsInFrontOfPlayer[players[i].seat],players[i].chips);if(i==players.length-1){next(null,finalChipUpdateCallbackNumbr)}}errorNumber++});async.series(finalArray,function(err,results){});function getAnimateChipStackFunction(chipArray,distanceX,distanceY){var loserToWinnerStackAnimationInfo={item:chipArray,finalX:distanceX,finalY:distanceY,numTicks:ticks,onTick:null,time:chipAnimationTime};var animationFunction=function(onEnd){loserToWinnerStackAnimationInfo.onEnd=onEnd;self.animateImage(loserToWinnerStackAnimationInfo)};return animationFunction}function getAnimatePlayersStackToWinnersStackFunction(loser,winner){var animationDistanceX=self.images.seats[winner].firstChip.position.x-self.images.seats[loser].firstChip.position.x;var animationDistanceY=self.images.seats[winner].firstChip.position.y-self.images.seats[loser].firstChip.position.y;var animationFunction=getAnimateChipStackFunction(self.images.seats[loser].chips,animationDistanceX,animationDistanceY);return animationFunction}};this.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText=function(){if(self.permanentPreferences.tableChatFull.scrollBarType&&self.permanentPreferences.tableChatFull.scrollBarType.value=="mCustomScrollbar"){console.log("assinging isAtBottom is true because i dontk now how to do it on mcustomscrollbar");var isAtBottom=true}else{var scroll=$(self.images.tableChatFull.chatTextDiv.image).getNiceScroll();var isAtBottom=scroll[0].getContentSize().h-scroll[0].getScrollTop()<=parseFloat(self.jQueryObjects.tableChatFullParagraph.outerHeight(true))+1;var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value=scroll[0].getScrollTop()}return isAtBottom};this.displayBubbleChatPopover=function(chatInfo){var fontSize="13px";console.log("displayin bubblechat popover");console.log(chatInfo);self.images.seats[chatInfo.seat].chat.text.text="";var playerSeatObject=self.images.seats[chatInfo.seat];var seatDiv=self.arrayOfParentsOfStageAndOfContainerArray[self.images.seats[chatInfo.seat].seat.position.z.stage].div;var qtipID="seat"+chatInfo.seat;var qtipJQueryTarget=$(playerSeatObject.bubbleChats[0].image);var qtipOptions={id:qtipID,show:{ready:true,show:"manual"},hide:{fixed:true,inactive:1e4,leave:false},content:{text:chatInfo.message,attr:{}},position:{my:"bottom middle",at:"bottom middle",target:qtipJQueryTarget,adjust:{resize:true},container:$(playerSeatObject.bubbleChats[0].image),viewport:$(window),adjust:{method:"shift shift"}},style:{classes:"qtip-tipsy"},events:{show:function(event,api){console.log("show event on qtip called");var container=api.elements.tooltip;var content=api.elements.content;setCSS();api.hide();function setCSS(){var width=playerSeatObject.bubbleChats[0].size.x;var height=playerSeatObject.bubbleChats[0].size.y;console.log("calling set css");var containerWidthBullshit=container.outerWidth(true)-container.width();var containerHeightBullshit=container.outerHeight(true)-container.height();var containerWidth=width-containerWidthBullshit;var containerHeight=height-containerHeightBullshit;container.css({"max-width":containerWidth+"px","max-height":containerHeight+"px"});var contentWidthBullshit=content.outerWidth(true)-content.width();var contentHeightBullshit=content.outerHeight(true)-content.height();var contentWidth=width-contentWidthBullshit;var contentHeight=height-contentHeightBullshit;content.css({"max-width":contentWidth+"px","max-height":contentHeight+"px",overflow:"hidden","font-family":self.permanentPreferences.defaultFontType.value,"font-size":fontSize,"font-weight":300});content.addClass(self.css.unselectable)}}}};qtipJQueryTarget.qtip("hide");qtipJQueryTarget.children(".qtip").remove();qtipJQueryTarget.qtip("destroy",false);qtipJQueryTarget.qtip(qtipOptions)};this.displayBubbleChat=function(chatInfo){chatInfo.message=chatInfo.message.replace(/^\s+|\s+$/g,"");if(/\S/.test(chatInfo.message)){self.images.seats[chatInfo.seat].chat.text.text="";createjs.Tween.removeTweens(self.images.seats[chatInfo.seat].chat.image);var messageToAdd;originalImageAlpha=self.imageData.chatBoxAlpha;var numLines=1;var textShortened=false;var finished=false;var currentLine=0;var needElipses=false;var largestTextWidth=0;var wasTrimmed=false;var numAddedChars=0;var chatFont=self.images.seats[chatInfo.seat].chat.text.font;var ifSymbolRegex=/^[\.,-\/#!$%\^&\*;:{}=\-_`~()]+$/;while(finished==false){wasTrimmed=false;messageToAdd=chatInfo.message.substring(self.images.seats[chatInfo.seat].chat.text.text.length-numAddedChars,chatInfo.message.length);var keepTrimming=true;while(keepTrimming===true&&self.getStringWidth(messageToAdd,chatFont)>self.images.seats[chatInfo.seat].chat.text.lineWidth){var lastRemovedChar=messageToAdd.charAt(messageToAdd.length-1);messageToAdd=messageToAdd.substring(0,messageToAdd.length-1);if(self.getStringWidth(messageToAdd,chatFont)<=self.images.seats[chatInfo.seat].chat.text.lineWidth){var keepTrimming=false;if(lastRemovedChar===" "){messageToAdd=messageToAdd+lastRemovedChar}if(messageToAdd.charAt(messageToAdd.length-1)===" "){wasTrimmed=true}else if(messageToAdd.charAt(messageToAdd.length-2)===" "){messageToAdd=messageToAdd.substring(0,messageToAdd.length-1);wasTrimmed=true}else if(ifSymbolRegex.test(lastRemovedChar)||ifSymbolRegex.test(messageToAdd.charAt(messageToAdd.length-1))){messageToAdd=messageToAdd+" ";numAddedChars=numAddedChars+1;wasTrimmed=true}else{messageToAdd=messageToAdd.substring(0,messageToAdd.length-1);wasTrimmed=true;if(ifSymbolRegex.test(messageToAdd.charAt(messageToAdd.length-1))){messageToAdd=messageToAdd+" ";numAddedChars=numAddedChars+1}else{messageToAdd=messageToAdd+"- ";numAddedChars=numAddedChars+2}}}}self.images.seats[chatInfo.seat].chat.text.text=self.images.seats[chatInfo.seat].chat.text.text+messageToAdd;if(wasTrimmed==true){if(numLines<self.permanentPreferences.playerChatMaxLines.value){numLines++;currentLine++}else{finished=true;if(self.images.seats[chatInfo.seat].chat.text.text.length-numAddedChars==chatInfo.message.length){}else{needElipses=true}}}else{finished=true}}if(needElipses==true){self.images.seats[chatInfo.seat].chat.text.text=self.images.seats[chatInfo.seat].chat.text.text.substring(0,self.images.seats[chatInfo.seat].chat.text.text.length-4);self.images.seats[chatInfo.seat].chat.text.text=self.images.seats[chatInfo.seat].chat.text.text+"..."}var imageToTextWidthRatio=self.images.seats[chatInfo.seat].chat.size.x/self.images.seats[chatInfo.seat].chat.text.lineWidth;if(numLines>1){largestTextWidth=self.images.seats[chatInfo.seat].chat.text.lineWidth}else{largestTextWidth=self.getStringWidth(self.images.seats[chatInfo.seat].chat.text.text,chatFont)}var chatBoxWidth=imageToTextWidthRatio*largestTextWidth+1;console.log("drawing chat widh Width of "+chatBoxWidth);self.images.seats[chatInfo.seat].chat.image.drawChat(chatBoxWidth,numLines);self.images.seats[chatInfo.seat].chat.text.alpha=1;self.images.seats[chatInfo.seat].chat.text.y=self.images.seats[chatInfo.seat].chat.position.y-(numLines-1)*self.images.seats[chatInfo.seat].chat.text.getMeasuredLineHeight();self.displayChildren(self.images.seats[chatInfo.seat].chat);var imageTween=createjs.Tween.get(self.images.seats[chatInfo.seat].chat.image,{loop:false,override:true,paused:true});imageTween.to({alpha:originalImageAlpha}).wait(9500).to({alpha:0},500).call(self.hideImage,[self.images.seats[chatInfo.seat].chat],self).to({alpha:originalImageAlpha});var textTween=createjs.Tween.get(self.images.seats[chatInfo.seat].chat.text,{loop:false,override:true,paused:true});textTween.to({alpha:1}).wait(9500).to({alpha:0},500).call(self.hideText,[self.images.seats[chatInfo.seat].chat],self).to({alpha:1});
imageTween.setPaused(false);textTween.setPaused(false)}};this.appendTableChatFullMessageText=function(messageArray,options){if(!options){var options={}}var isAtBottom=this.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText();var log=self.gameState.tableChatFull.log;if(_.isNumber(messageArray)&&!_.isNaN(messageArray)&&messageArray>=0&&messageArray<=log.length-1){appendTableChatFullMessageInArrayForm(log[messageArray])}else if(!_.isArray(messageArray)){replaceTableChatFullParagraphText();for(var i=0;i<log.length;i++){appendTableChatFullMessageInArrayForm(log[i],false)}replaceTableChatFullParagraphText(self.gameState.tableChatFull.fullTextString)}else if(_.isArray(messageArray)){log.push(messageArray);appendTableChatFullMessageInArrayForm(messageArray)}else{console.log("append text passed invalid parameter")}if(options.update!==false&&options.moveTable!==true){if(isAtBottom===true&&self.gameState.tableChatFull.mouseDown!=true&&options&&options.moveTable!==false){self.moveTableChatFullMessageText()}else if(options&&options.moveTable===true){self.moveTableChatFullMessageText()}}function appendTableChatFullMessageInArrayForm(messageInArrayForm){var displayCurrentLog;if(messageInArrayForm[1]===""||!_.isString(messageInArrayForm[1])){console.error("returning due to not a real message");return}if(messageInArrayForm[0]==="dealer"){displayCurrentLog=self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessages.value}else if(messageInArrayForm[0]==="observer"){displayCurrentLog=self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessages.value}else if(messageInArrayForm[0]==="player"){displayCurrentLog=self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessages.value}else{throw"unknown message type:"+messageInArrayForm}if(displayCurrentLog!==false){var stringToAppend="";if(self.gameState.tableChatFull.fullTextString.length>0){stringToAppend=stringToAppend+"<br>"}stringToAppend=stringToAppend+messageInArrayForm[1];appendTableChatFullString(stringToAppend)}}function appendTableChatFullString(textToAppend,updateDefaultsToTrue){self.gameState.tableChatFull.fullTextString=self.gameState.tableChatFull.fullTextString+textToAppend;if(updateDefaultsToTrue!==false){self.jQueryObjects.tableChatFullParagraph.append(textToAppend)}}function replaceTableChatFullParagraphText(fullText){if(!_.isString(fullText)){var fullText=""}self.gameState.tableChatFull.fullTextString=fullText;self.jQueryObjects.tableChatFullParagraph.html(fullText)}};this.updateTableChatFullMessageTextFromCurrentOrAdditionalData=function(chatInfo,options){if(!options){var options={}}var log=self.gameState.tableChatFull.log;var isDisplayingDealerMessages=this.gameState.tableChatFull.currentlyDisplayingDealerMessages;var isDisplayingPlayerMessages=this.gameState.tableChatFull.currentlyDisplayingPlayerMessages;var isDisplayingObserverMessages=this.gameState.tableChatFull.currentlyDisplayingObserverMessages;var shouldDisplayDealerMessages;var shouldDisplayPlayerMessages;var shouldDisplayObserverMessages;if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideDealerMessagesOn.value===false){shouldDisplayDealerMessages=true}else{shouldDisplayDealerMessages=false}if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hidePlayerMessagesOn.value===false){shouldDisplayPlayerMessages=true}else{shouldDisplayPlayerMessages=false}if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.hideObserverMessagesOn.value===false){shouldDisplayObserverMessages=true}else{shouldDisplayObserverMessages=false}var needToUpdate=isDisplayingDealerMessages!==shouldDisplayDealerMessages||isDisplayingPlayerMessages!==shouldDisplayPlayerMessages||isDisplayingObserverMessages!==shouldDisplayObserverMessages;var scrollDownAtEnd=this.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText();if(chatInfo&&chatInfo.chatSourceType&&chatInfo.message){var pushed=true;log.push([chatInfo.chatSourceType,_.escape(chatInfo.message)]);if(chatInfo.timeStampString){log[log.length-1].push(chatInfo.timeStampString)}}if(needToUpdate===true||options.update===true){console.log("re appending the full tablechatfull message text due to needToUpdate =  "+needToUpdate+", options.update = "+options.update);console.log(shouldDisplayDealerMessages+", "+shouldDisplayPlayerMessages+", "+shouldDisplayObserverMessages);console.log(isDisplayingDealerMessages+", "+isDisplayingPlayerMessages+", "+isDisplayingObserverMessages);this.gameState.tableChatFull.currentlyDisplayingDealerMessages=shouldDisplayDealerMessages;this.gameState.tableChatFull.currentlyDisplayingPlayerMessages=shouldDisplayPlayerMessages;this.gameState.tableChatFull.currentlyDisplayingObserverMessages=shouldDisplayObserverMessages;this.appendTableChatFullMessageText(null)}else if(pushed===true){this.appendTableChatFullMessageText(log.length-1,{moveTable:false})}if(scrollDownAtEnd===true){this.moveTableChatFullMessageText({resize:true})}else{this.moveTableChatFullMessageText({magnitude:self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value,resize:true})}};this.displayInHandOptions=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.displayChildren(this.images.foldToAnyBet,options));stagesToUpdate.push(this.displayChildren(this.images.sitOutNextHand,options));stagesToUpdate.push(this.displayChildren(this.images.sitOutNextBlind,options));options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.hideSeatedOptions=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];this.images.standUp.image.removeAllEventListeners();this.images.getChips.image.removeAllEventListeners();stagesToUpdate.push(this.displayChildren(this.images.standUpDisabledShape,options));stagesToUpdate.push(this.displayChildren(this.images.getChipsDisabledShape,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextHandOn,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextHand,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(this.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(this.hideChildren(self.images.foldToAnyBet,options));stagesToUpdate.push(this.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));stagesToUpdate.push(self.hideChildren(self.images.sitIn,options));stagesToUpdate.push(this.hideAllActionButtons(options));options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.displayBetSlider=function(minBet,maxBet,options){if(minBet==maxBet){return}var stagesToUpdate=[];if(!options){var options={}}var update=options.update;options.update=false;trueOrFalseToggleRaiseAndBet(true);this.gameState.minBet=minBet;this.gameState.maxBet=maxBet;console.log("min: "+minBet+", max: "+maxBet);$(this.images.betSlider.slider.image).slider("option","min",minBet).slider("option","max",maxBet).slider("value",minBet).slider("option","step",self.initial_table_state.min_increment);console.log("slider value after set to min = "+$(this.images.betSlider.slider.image).slider("value"));var setMin=$(this.images.betSlider.slider.image).slider("option","min");var setMax=$(this.images.betSlider.slider.image).slider("option","max");console.log("slider setMin = "+setMin+", setMax = "+setMax);stagesToUpdate.push(this.updateBetSize(minBet,options));$(self.getParentOfStageObject(self.images.betSlider.slider).div).on("mousewheel.adjustBetSize",function(event,delta,deltaX,deltaY){self.events.wheelScroll(deltaY)});$(window).on("mousewheel.disable",function(e){return false});stagesToUpdate.push(this.displayChildren(this.images.betSlider,options));options.update=update;if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayCorrectSeatItems=function(seatNumber,options){var stagesToUpdate=[];if(!_.isNumber(seatNumber)||_.isNaN(seatNumber)){for(var i=0;i<this.gameState.numSeats;i++){stagesToUpdate.push(this.displayCorrectSeatItems(i,options))}}else{if(!options){var options={}}var update=options.update;options.update=false;if(self.getPreactionData("sitting_out",{seat:seatNumber})===true){if(self.getPreactionData("getting_chips",{seat:seatNumber})===true){stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].gettingChips,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].sittingOut,options))}else{stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].sittingOut,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].gettingChips,options))}stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].stackSize,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options))}else{switch(self.getPreactionData("displayMessageType",{seat:seatNumber})){case"seat":stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].gettingChips,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].stackSize,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].sittingOut,options));break;case"countdown":stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].sittingOut,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].gettingChips,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));if(self.getPreactionData("toAct",{seat:"table"})===seatNumber){stagesToUpdate.push(this.displayText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options))}else{stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options))}stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].stackSize,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));break;case"action":stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].sittingOut,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].gettingChips,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.displayText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].stackSize,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));break;default:stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].sittingOut,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].gettingChips,options));if(_.isNumber(this.gameState.userSeatNumber)){stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].openSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].disabledSeat,options))}else{stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].disabledSeat,options));stagesToUpdate.push(this.displayChildren(this.images.seats[seatNumber].openSeat,options))}stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].seat,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].stackSize,options));stagesToUpdate.push(this.hideChildren(this.images.seats[seatNumber].playerName,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].action,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].winner,options));stagesToUpdate.push(this.hideText(this.images.seats[seatNumber].countdown,options));break}}}options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.playerActs=function(seatNumber,actionText,displayTime){if(seatNumber===self.gameState.userSeatNumber){this.hideAllActionButtons(this.gameState.userSeatNumber)}self.setPreactionData("permanent","displayMessageType","action",{server:false,seat:seatNumber});var interval=25;if(!displayTime||typeof displayTime!="number"){var displayTime=1e3}var fadeAtEndTime=displayTime/8.5;var playerAction=setInterval(function(){var stagesToUpdate=[];var options={update:false};var displayMessageType=self.getPreactionData("displayMessageType",{seat:seatNumber});if(displayMessageType!=="action"||displayTime<=0){if(displayMessageType==="action"){self.setPreactionData("permanent","displayMessageType","seat",{seat:seatNumber,server:false})}clearInterval(playerAction)}else if(displayTime>=fadeAtEndTime){stagesToUpdate.push(self.images.seats[seatNumber].action.updateText(actionText,options));self.images.seats[seatNumber].action.text.alpha=1}else{self.images.seats[seatNumber].action.text.alpha=displayTime/fadeAtEndTime;stagesToUpdate.push(self.images.seats[seatNumber].action.updateText(actionText,options))}displayTime=displayTime-interval;stagesToUpdate.push(self.displayCorrectSeatItems(seatNumber,options));self.updateStages(stagesToUpdate)},interval)};this.playerWins=function(seatNumber,chipsWon,displayTime){self.images.seats[seatNumber].winner.updateText("");self.setPreactionData("permanent","displayMessageType","winner",{seat:seatNumber,server:false});var interval=25;if(!displayTime||typeof displayTime!="number"){var displayTime=1e3}var fadeAtEndTime=displayTime/8.5;var declareWinner=setInterval(function(){var displayMessageType=self.getPreactionData("displayMessageType",{seat:seatNumber});var stagesToUpdate=[];var options={update:false,seat:seatNumber,server:false};if(displayMessageType!="winner"||displayTime<=0){if(displayMessageType==="winner"){self.setPreactionData("permanent","displayMessageType","seat",options)}clearInterval(declareWinner)}else if(displayTime>=fadeAtEndTime){stagesToUpdate.push(self.images.seats[seatNumber].winner.updateText("Wins "+chipsWon,options));self.images.seats[seatNumber].winner.text.alpha=1}else{self.images.seats[seatNumber].winner.text.alpha=displayTime/fadeAtEndTime;stagesToUpdate.push(self.images.seats[seatNumber].winner.updateText("Wins "+chipsWon,options))}displayTime=displayTime-interval;stagesToUpdate.push(self.displayCorrectSeatItems(seatNumber,options));self.updateStages(stagesToUpdate)},interval)};this.playerToAct=function(seatNumber,timeoutInMS){self.setPreactionData("hand","timeToAct",timeoutInMS,{seat:seatNumber});self.setPreactionData("hand","toAct",seatNumber,{seat:"table"});if(seatNumber===self.gameState.userSeatNumber){self.setPreactionData("permanent","displayMessageType","countdown",{seat:seatNumber})}var hexToRGB=function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null};var extractRGB=function(color){if(color.charAt(0)==("r"||"R")){var colorsArray=[];colorsArray=color.replace(/[^\d,]/g,"").split(",");red=parseInt(colorsArray[0]);green=parseInt(colorsArray[1]);blue=parseInt(colorsArray[2])}else if(color.charAt(0)=="#"){var colorsObject=hexToRGB(color);red=parseInt(colorsObject.r);green=parseInt(colorsObject.g);blue=parseInt(colorsObject.b)}return[red,green,blue]};var rgbArrayToString=function(rgbArray){colorString="rgb("+rgbArray[0]+","+rgbArray[1]+","+rgbArray[2]+")";return colorString};var originalBorderColor=self.images.seats[0].seat.image.borderColor;var originalMiddleDividerColor=self.images.seats[0].seat.image.middleDividerColor;var toActTimeLeftBorderColor="#FFFF00";var toActBorderColor=originalBorderColor;var toActMiddleDividerColor="#FFFFFF";var timeToChangeColors=3e3;var ticksPerColorChange=40;var interval=timeToChangeColors/ticksPerColorChange;var lastTick=ticksPerColorChange-1;var tick=0;var originalFillColor=self.images.seats[seatNumber].seat.image.fillColor;var targetFillColorsArray=[[255,0,0],[0,0,0]];var lastCompletedFillColorCounter=-1;var options={server:false,seat:seatNumber,update:false};var countdown=setInterval(function(){var stagesToUpdate=[];var currentFillColor=self.images.seats[seatNumber].seat.image.fillColor;var red;var green;var blue;var previousTargetRed;var previousTargetGreen;var previousTargetBlue;var targetRed;var targetGreen;var targetBlue;var redIncreasePerTick;var greenIncreasePerTick;var blueIncreasePerTick;var nextRed;var nextGreen;var nextBlue;var currentColors=extractRGB(currentFillColor);red=currentColors[0];green=currentColors[1];blue=currentColors[2];if(lastCompletedFillColorCounter==-1){var lastColors=extractRGB(originalFillColor);previousTargetRed=lastColors[0];previousTargetGreen=lastColors[1];previousTargetBlue=lastColors[2]}else{var previousArrayNumber=lastCompletedFillColorCounter%targetFillColorsArray.length;var lastColorString=rgbArrayToString(targetFillColorsArray[previousArrayNumber]);var lastColors=extractRGB(lastColorString);previousTargetRed=lastColors[0];previousTargetGreen=lastColors[1];previousTargetBlue=lastColors[2]}var targetArrayNumber=(lastCompletedFillColorCounter+1)%targetFillColorsArray.length;var targetColorString=rgbArrayToString(targetFillColorsArray[targetArrayNumber]);var targetColors=extractRGB(targetColorString);targetRed=targetColors[0];targetGreen=targetColors[1];targetBlue=targetColors[2];redIncreasePerTick=(targetRed-previousTargetRed)/ticksPerColorChange;greenIncreasePerTick=(targetGreen-previousTargetGreen)/ticksPerColorChange;blueIncreasePerTick=(targetBlue-previousTargetBlue)/ticksPerColorChange;nextRed=parseInt(red+redIncreasePerTick);nextGreen=parseInt(green+greenIncreasePerTick);nextBlue=parseInt(blue+blueIncreasePerTick);var nextCounter=lastCompletedFillColorCounter+1;if(redIncreasePerTick<0){if(nextRed<=targetRed){lastCompletedFillColorCounter=nextCounter}}if(redIncreasePerTick>0){if(nextRed>=targetRed){lastCompletedFillColorCounter=nextCounter}}if(greenIncreasePerTick<0){if(nextGreen<=targetGreen){lastCompletedFillColorCounter=nextCounter}}if(greenIncreasePerTick>0){if(nextGreen>=targetGreen){lastCompletedFillColorCounter=nextCounter}}if(blueIncreasePerTick<0){if(nextBlue<=targetBlue){lastCompletedFillColorCounter=nextCounter}}if(blueIncreasePerTick>0){if(nextBlue>=targetBlue){lastCompletedFillColorCounter=nextCounter}}if(nextRed>255){nextRed=255}if(nextGreen>255){nextGreen=255}if(nextBlue>255){nextBlue=255}if(nextRed<0){nextRed=0}if(nextGreen<0){nextGreen=0}if(nextBlue<0){nextBlue=0}newFillColor=rgbArrayToString([nextRed,nextGreen,nextBlue]);if(self.getPreactionData("toAct",{seat:"table"})!==seatNumber){clearInterval(countdown);stagesToUpdate.push(self.images.drawSeat(self.images.seats[seatNumber].seat,originalBorderColor,originalFillColor,originalMiddleDividerColor));if(self.getPreactionData("displayMessageType",options)==="countdown"){self.setPreactionData("permanent","displayMessageType","seat",options)}}else{var remainingTimeToAct=self.getPreactionData("timeToAct",options);stagesToUpdate.push(self.images.drawSeat(self.images.seats[seatNumber].seat,toActBorderColor,newFillColor,toActMiddleDividerColor,{borderFillRatio:remainingTimeToAct/self.initial_table_state.act_timeout,newFillColor:toActTimeLeftBorderColor}));var countDownText="Time: "+Math.ceil(remainingTimeToAct/1e3);if(remainingTimeToAct>=0){stagesToUpdate.push(self.images.seats[seatNumber].countdown.updateText(countDownText,options))}else{stagesToUpdate.push(self.images.seats[seatNumber].countdown.updateText("0",options))}}self.setPreactionData("hand","timeToAct",remainingTimeToAct-interval,{seat:seatNumber});stagesToUpdate.push(self.displayCorrectSeatItems(seatNumber,options));self.updateStages(stagesToUpdate)},interval)};this.updateTableChatFullDisplay=function(displayOrHideChildrenOptions){if(!displayOrHideChildrenOptions){var displayOrHideChildrenOptions={}}var update=displayOrHideChildrenOptions.update;displayOrHideChildrenOptions.update=false;var stagesToUpdate=[];console.log("update tablechatfull display called");console.log(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem);_.each(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem,function(value,index,list){if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem[index].value===false){stagesToUpdate.push(self.hideChildren(self.images.tableChatFull[index],displayOrHideChildrenOptions))}else{stagesToUpdate.push(self.displayChildren(self.images.tableChatFull[index],displayOrHideChildrenOptions))}});this.updateTableChatFullMessageTextFromCurrentOrAdditionalData();var tableChatFullStageParent=self.getParentOfStageObject(self.images.tableChatFull.window);if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.popOut.value===false&&$(tableChatFullStageParent.div).parent().is(self.jQueryObjects.canvasDiv)==true){var newHeight=self.jQueryObjects.canvasDiv.outerHeight(true);var newDivX=0;var newDivY=0;var bgColor="rgba(0,0,0,0.5)";var prependTo=self.jQueryObjects.pokerTableDiv;var position="relative";var prependChatBoxTo=tableChatFullStageParent.div;var chatBoxWidth=self.images.tableChatFull.htmlDivElement.size.x-self.images.htmlTableChatBox.position.x*2;var chatBoxTopOffset=newHeight-self.images.htmlTableChatBox.position.y-self.images.htmlTableChatBox.size.y;var newTextHeight=self.images.htmlTableChatBox.position.y-chatBoxTopOffset-self.images.tableChatFull.chatTextDiv.position.y;console.log("moving chat outside of the table height = "+newHeight+" textheight =  "+newTextHeight);var scrollDownAtEnd=self.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText()}else if(self.sessionPreferences.tableChatFull.defaultItemsToHideFalseHidesItem.popOut.value!==false&&$(tableChatFullStageParent.div).parent().is(self.jQueryObjects.canvasDiv)!=true){console.log("moving chat inside the table");var newHeight=self.images.tableChatFull.htmlDivElement.size.y;var newDivX=self.images.tableChatFull.htmlDivElement.position.x;var newDivY=self.images.tableChatFull.htmlDivElement.position.y;var bgColor="transparent";var prependTo=self.jQueryObjects.canvasDiv;var position="absolute";var prependChatBoxTo=self.getParentOfStageObject(self.images.htmlTableChatBox).div;var chatBoxWidth=self.images.tableChatFull.htmlDivElement.size.x;var chatBoxTopOffset=0;var newTextHeight=self.images.tableChatFull.chatTextDiv.size.y;var scrollDownAtEnd=self.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText()}else{console.log("keeping chat same place as last time ")}if(prependTo){setDisplayObjectPositionData(self.images.tableChatFull.chatTextDiv.image,{height:newTextHeight},{update:false});setDisplayObjectPositionData(self.images.htmlTableChatBox.image,{width:chatBoxWidth},{update:false});$(self.images.htmlTableChatBox.image).prependTo(prependChatBoxTo);$(tableChatFullStageParent.div).css({position:position,left:newDivX,top:newDivY,height:newHeight,"background-color":bgColor});$(tableChatFullStageParent.stage.canvas).attr("height",newHeight);$(tableChatFullStageParent.div).prependTo(prependTo);self.images.tableChatFull.window.drawImage()}if(scrollDownAtEnd){self.moveTableChatFullMessageText()}else{self.moveTableChatFullMessageText({magnitude:self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels})}displayOrHideChildrenOptions.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayTableChatFull=function(hideOrDisplayChildrenOptions){console.log("display table chat full called");if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];stagesToUpdate.push(this.displayChildren(this.images.hideTableChatFull,hideOrDisplayChildrenOptions));stagesToUpdate.push(this.hideChildren(this.images.showTableChatFull,hideOrDisplayChildrenOptions));stagesToUpdate.push(this.displayChildren(this.images.tableChatFull,hideOrDisplayChildrenOptions));stagesToUpdate.push(this.updateTableChatFullDisplay(hideOrDisplayChildrenOptions));var tableChatFullCanvas=self.arrayOfParentsOfStageAndOfContainerArray[this.images.tableChatFull.htmlCanvasElement.position.z.stage].stage.canvas;setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(this.images.tableChatFull.window,true);var scrollInfo={magnitude:self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value};self.moveTableChatFullMessageText(scrollInfo);self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.updateValue(self.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value);console.log("tablechatfull object = ");console.log(this.images.tableChatFull);hideOrDisplayChildrenOptions.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideTableChatFull=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];console.log("calling hideTableChatFull");var positionValue;if(self.checkIfTableChatFullMessageTextShouldBeScrolledAfterChangingText()===true){positionValue=true}else{if(self.sessionPreferences.tableChatFull.scrollBarType!="mCustomScrollbar"){var scroll=self.jQueryObjects.tableChatFullDiv.getNiceScroll();positionValue=scroll[0].getScrollTop()}else{positionValue=0}}this.sessionPreferences.tableChatFull.tableChatFullScrollBarPositionTrueForBottomOrUpperInvisiblePixels.value=positionValue;stagesToUpdate.push(this.displayChildren(this.images.showTableChatFull,options));stagesToUpdate.push(this.hideChildren(this.images.hideTableChatFull,options));stagesToUpdate.push(this.hideChildren(this.images.tableChatFull,options));var tableChatFullCanvas=self.arrayOfParentsOfStageAndOfContainerArray[this.images.tableChatFull.htmlCanvasElement.position.z.stage].stage.canvas;setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(this.images.tableChatFull.window,false);if(update!==false){this.updateStages(stagesToUpdate)}else{stagesToUpdate}};this.images.Item.prototype.saveDisplayCSS=function(options){if(!_.isObject(options)){var options={}}if(_.isString(options.display)){var displayCSS=options.display}if(_.isElement(this.image)){if(!displayCSS){var displayCSS=$(this.image).css("display")}if(displayCSS!=="none"&&displayCSS!=="hidden"&&_.isString(displayCSS)){this.position.displayCSS=displayCSS;return}}if(_.isElement(this.text)){if(!displayCSS){var displayCSS=$(this.text).css("display")}if(displayCSS!=="none"&&displayCSS!=="hidden"&&_.isString(displayCSS)){this.position.displayCSS=displayCSS;return}}};this.images.Item.prototype.adoptChild=function(child,type,options){if(!options){var options={}}var stagesToUpdate=[];if(options.overwrite!==false){stagesToUpdate.push(this.removeChild(type))}this[type]=child;child.parentItem=this;this.getOrSetCreateJSEvents("set",type);if(this.messages&&type==="image"){this.on("click",self.events.onButtonClick,{image:true,text:false})}if(options.size===true||options.maxSize==="child"){var data=this.getChildPositionAndSizeData(type,{position:false,size:true,maxSize:false});if(this.size.x<data.outerWidth){this.size.x=data.outerWidth}if(this.size.y<data.outerHeight){this.size.y=data.outerHeight}}else if(options.maxSize==="parent"){var data=this.getChildPositionAndSizeData(type,{position:false,size:true,maxSize:false});var newSize={};if(this.size.x>data.outerWidth){newSize.x=this.size.x}if(this.size.y>data.outerHeight){newSize.y=this.size.y}setDisplayObjectPositionData(child,newSize)}if(options.update!=false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.images.Item.prototype.addElement=function(element,textOrImage,functionOptions){if(!functionOptions){var options={}}else{var options=_.clone(functionOptions)}if(_.isObject(options.css)){options.css=_.clone(options.css)}else{options.css={}}if(_.isObject(options.attr)){options.attr=_.clone(options.attr)}else{options.attr={}}if(!options.class){options.class=""}options.update=false;var parentDiv=self.getParentOfStageObject(this).div;var elementType=$(this).get(0).tagName;if(textOrImage==="text"||textOrImage==="image"){var type=textOrImage}else if(_.isObject(this.image)&&!_.isObject(this.text)){var type="text"}else if(!this.image&&_.isObject(this.text)){var type="image"}else if(elementType==="p"){var type="text"}else{var type="image"}if(type==="text"){var z=this.position.z.container+1}else{var z=this.position.z.container}if(options.overwrite!==false){this.removeChild(type);if(_.isString(options.attr.id)){var leftoverChild=$("#"+options.attr.id);if(leftoverChild.length>0){console.log("leftover child removed with id = "+options.attr.id);leftoverChild.remove()}}}else{console.log("overwrite not = false on add element type = "+type);console.log(element);console.log(options);throw""}if(_.isString(options.css.display)){options.display=options.css.display;this.saveDisplayCSS(options)}options.css.display="none";$(element).css(options.css).attr(options.attr).addClass(options.class);if($(element).is("p")&&_.isString(options.css["line-height"])&&!_.isArray(options.css)){$(element).css("line-height",options.css["line-height"])}if(options.container){$(options.container).append(element)}else if($(parentDiv).find(element).length<1){$(parentDiv).append(element)}this.adoptChild(element,type,{size:false,position:false});this.positionChild(type,options);if(options.disableContextMenu===true){$(element).on("contextmenu.disable",function(e){return false})}if(!_.isFunction(options.onClick)&&this.messages&&type==="image"){var onClick=self.events.onButtonClick}else{var onClick=options.onClick}if(_.isFunction(onClick)){$(element).on("click",function(e){onClick(e)})}};this.images.Item.prototype.getText=function(){if(this.text instanceof createjs.Text){var text=this.text.text
}else if(_.isElement(this.text)){var text=$(this.text).text()}else if(_.isElement(this.image)){var text=$(this.image).text()}return text};this.images.Item.prototype.updateText=function(text,options){return updateItemText(this,text,options)};var updateItemText=function(item,text,options){if(!options){var options={}}var stagesToUpdate=[];if(!_.isString(text+"")){console.log("updateitemtext given non text as parameter = "+text);return}if(_.isElement(item.text)){$(item.text).html(text)}else if(item.text instanceof createjs.Text){if(item.text.text+""!==text+""){item.text.text=text;stagesToUpdate.push(self.easelJSDisplayObjectChanged(item))}}else if(_.isElement(item.image)){$(item.image).html(text)}if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.updateActionButton=function(actionTypeOrItem,options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];if(_.isString(actionTypeOrItem)){var item=self.images[actionTypeOrItem];if(_.isString(options.value+"")){if(actionTypeOrItem==="fold"){var fullText="Fold";options.messages=["act","fold"]}else if(actionTypeOrItem==="check"){var fullText="Check";options.messages=["act","check"]}else if(actionTypeOrItem==="call"){var fullText="Call<br>"+options.value;options.messages=["act","call",options.value]}else if(actionTypeOrItem==="raise"){var currentStackSize=self.getCurrentStackSizes()[self.gameState.userSeatNumber];var currentBetSize=self.getCurrentBetSizes()[self.gameState.userSeatNumber];console.log("update action button called type = raise, currentBetSize = "+currentBetSize);if(parseFloat(options.value)>=currentStackSize+currentBetSize){var fullText="Raise All-In"}else if(_.isNaN(parseFloat(options.value))){var fullText="Raise All-In";options.value=currentStackSize+currentBetSize}else{var fullText="Raise to<br>"+options.value}options.messages=["act","raise",options.value]}else if(actionTypeOrItem==="bet"){var currentStackSize=self.getCurrentStackSizes()[self.gameState.userSeatNumber];if(parseFloat(options.value)>=currentStackSize){var fullText="Bet All-In"}else if(_.isNaN(parseFloat(options.value))){var fullText="Bet All-In";options.value=currentStackSize}else{var fullText="Bet<br>"+options.value}options.messages=["act","bet",options.value]}else if(actionTypeOrItem==="sitIn"){var fullText="Sit In";options.messages=["sit_in"]}else if(actionTypeOrItem==="rebuy"){var fullText="Rebuy";options.messages=["get_add_chips_info"]}stagesToUpdate.push(item.updateText(fullText,options))}else if(_.isString(options.text)){stagesToUpdate.push(updateItemText(item,options.text,options))}}else if(actionTypeOrItem instanceof self.images.Item){var item=actionTypeOrItem;if(_.isString(options.text+"")){stagesToUpdate.push(updateItemText(item,options.text,options))}else if(_.isString(options.value+"")){stagesToUpdate.push(updateItemText(item,options.value,options))}}else{return}if(_.isArray(options.messages)){item.messages=options.messages}options.update=update;if(options.hidden===true){return}stagesToUpdate.push(this.displayChildren(item));if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.hideCashier=function(hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(self.images.cashier.window,false);self.jQueryObjects.cashierForm.css("display","none");self.gameState.cashier.display=false;$("#maxRadio").prop("checked",false);$("#autoRebuyRadio").prop("checked",false);$("#otherAmountRadio").prop("checked",false);$("#otherAmount").val("");$("#autoRebuyAmount").val("");$("#maxAmount").val("");stagesToUpdate.push(self.hideChildren(self.images.cashier,hideOrDisplayChildrenOptions));if(update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};var messageBoxAPI={};messageBoxAPI.getRawCurrentStageNumber=function(){return self.gameState.messageBox.currentlyHighestDisplayedMessageBoxStageNumber};messageBoxAPI.getInitialStageNumber=function(){return getZ("background","initialMessageBox").stage};messageBoxAPI.getFinalStageNumber=function(){return getZ("background","finalMessageBox").stage};messageBoxAPI.getStageNumberIncrement=function(){return getZ("background","secondMessageBox").stage-getZ("background","initialMessageBox").stage};messageBoxAPI.setCurrent=function(val){self.gameState.messageBox.currentlyHighestDisplayedMessageBoxStageNumber=val};messageBoxAPI.getCurrent=function(){var current=this.getRawCurrentStageNumber();var min=this.getInitialStageNumber();var max=this.getFinalStageNumber();if(!_.isNumber(current)||_.isNaN(current)||current<min||current>max){return}else{return current}};messageBoxAPI.getNext=function(){var current=this.getCurrent();var min=this.getInitialStageNumber();var max=this.getFinalStageNumber();if(!_.isNumber(current)||_.isNaN(current)){return min}else if(current<min){return min}else if(current>=max){return}else{return current}};messageBoxAPI.getPrevious=function(){var current=this.getCurrent();var min=this.getInitialStageNumber();var max=this.getFinalStageNumber();if(!_.isNumber(current)||_.isNaN(current)){return}else if(current<=min){return}else if(current>max+1){return}else{return current-this.getStageNumberIncrement()}};messageBoxAPI.decrementCurrent=function(){var nextVal=this.getCurrent()-this.getStageNumberIncrement();this.setCurrent(nextVal)};messageBoxAPI.incrementCurrent=function(){var nextVal=this.getCurrent()+this.getStageNumberIncrement();this.setCurrent(nextVal)};messageBoxAPI.getItemsObject=function(stageNumber){if(_.isNumber(stageNumber)){}else if(stageNumber==="next"){var stageNumber=this.getNext()}else if(stageNumber==="previous"){var stageNumber=this.getPrevious()}else{var stageNumber=this.getCurrent()}if(!_.isNumber(stageNumber)){return}if(!_.isObject(self.images.messageBox[stageNumber])){this.deleteMessageBoxItems(stageNumber)}return self.images.messageBox[stageNumber]};messageBoxAPI.deleteMessageBoxItems=function(stageNumber){if(_.isNumber(stageNumber)){}else if(stageNumber==="next"){var stageNumber=this.getNext()}else if(stageNumber==="previous"){var stageNumber=this.getPrevious()}else{stageNumber=this.getCurrent()}if(!_.isNumber(stageNumber)){return}console.log("deleting messagebox items stagenumber = "+stageNumber);self.hideChildren(self.images.messageBox[stageNumber]);self.images.messageBox[stageNumber]={};var parentOfStage=self.getParentOfStageObject(stageNumber);$(parentOfStage.div).children().not(parentOfStage.stage.canvas).remove()};messageBoxAPI.display=function(messageString,messageInfo,hideOrDisplayChildrenOptions){return self.displayMessageBox(messageString,messageInfo,hideOrDisplayChildrenOptions)};messageBoxAPI.displayModal=function(messageString,messageInfo,hideOrDisplayChildrenOptions){};messageBoxAPI.getStatus=function(){var current=this.getCurrent();if(!_.isNumber(current)){return}var status={};var items=this.getItemsObject(current);var div=self.getParentOfStageObject(current);if(isItemDisplayed(items.checkBoxChecked)===true){status.checkBox="checked"}else if(isItemDisplayed(items.checkBoxUnchecked)===true){status.checkBox="unchecked"}else if(items.htmlCheckBox instanceof self.images.Item){var checkBox=$(items.htmlCheckBox.image);console.log("found checkBox = ");console.log(checkBox);if(checkBox.prop("checked")===true){status.checkBox="checked"}else if(checkBox.prop("checked")===false){status.checkBox="unchecked"}}return status};messageBoxAPI.hide=function(options){console.log("messagebox hide called");var current=this.getCurrent();if(!_.isNumber(current)){console.error("mesagebox hide without a valid current number: "+current);return}var itemsToHide=this.getItemsObject(current);setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(current,false);this.decrementCurrent();return self.hideChildren(itemsToHide,options)};this.displayMessageBox=function(messageString,messageInfo,hideOrDisplayChildrenOptions){console.log("displaymessagebox called");if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];var newStageNumber=messageBoxAPI.getNext();if(!_.isNumber(newStageNumber)){return}messageBoxAPI.incrementCurrent();messageBoxAPI.deleteMessageBoxItems();var messageBoxItems=messageBoxAPI.getItemsObject(newStageNumber);var div=self.getParentOfStageObject(newStageNumber).div;var messageBoxWindowSource=self.permanentPreferences.sourceObjects.value.messageBoxBackground;var messageBoxWindowWidth=messageBoxWindowSource.width;var messageBoxWindowHeight=messageBoxWindowSource.height;var closeXSource=self.permanentPreferences.sourceObjects.value.messageBoxCloseX;var closeXWidth=closeXSource.width;var closeXHeight=closeXSource.height;var closeXTopOffset=1;var closeXRightOffset=7;var outerTopHeight=31;var outerBottomHeight=8;var outerSideWidth=8;var htmlCanvas=this.arrayOfParentsOfStageAndOfContainerArray[newStageNumber].stage.canvas;var stageWidth=htmlCanvas.width;var stageHeight=htmlCanvas.height;var messageBoxWindowX=Math.floor(stageWidth/2-messageBoxWindowWidth/2);var messageBoxWindowY=Math.floor(stageHeight/2-messageBoxWindowHeight/2);var innerMessageBoxX=messageBoxWindowX+outerSideWidth;var innerMessageBoxY=messageBoxWindowY+outerTopHeight;var innerMessageBoxWidth=messageBoxWindowWidth-2*outerSideWidth;var innerMessageBoxHeight=messageBoxWindowHeight-outerBottomHeight-outerTopHeight;var textLeftOffset=7;var textTopOffset=8;var textBottomOffset=8;var textX=innerMessageBoxX+textLeftOffset;var defaultMinimumButtonWidth=50;var buttonHeight=22;var defaultRatioOfTextWidthToButtonWidth=.9;var defaultDistanceBetweenButtons=30;var buttonButtomOffset=15;var buttonY=messageBoxWindowY+messageBoxWindowHeight-outerBottomHeight-buttonButtomOffset-buttonHeight;var maxDistanceFromButtonsToCheckOption=10;var backgroundContainer=0;var textContainer=1;var buttonContainer=2;if(_.isNull(messageInfo)||_.isUndefined(messageInfo)){messageInfo={}}if(_.isNull(messageInfo.title)||_.isUndefined(messageInfo.title)||!(_.isString(messageInfo.title)||!_.isNumber(messageInfo.title))){messageInfo.title=""}if(_.isNull(messageInfo.titleSizeAndFont)||_.isUndefined(messageInfo.titleSizeAndFont)){messageInfo.titleSizeAndFont="18px "+self.permanentPreferences.defaultFontType.value}if(_.isNull(messageInfo.titleColor)||_.isUndefined(messageInfo.titleColor)){messageInfo.titleColor="#000000"}if(_.isNull(messageInfo.sizeAndFont)||_.isUndefined(messageInfo.sizeAndFont)){messageInfo.messageSizeAndFont="13px "+self.permanentPreferences.defaultFontType.value}if(_.isNull(messageInfo.messageColor)||_.isUndefined(messageInfo.messageColor)){messageInfo.messageColor="#000000"}if(_.isNull(messageInfo.buttonSizeAndFont)||_.isUndefined(messageInfo.buttonSizeAndFont)){messageInfo.buttonSizeAndFont="13px "+self.permanentPreferences.defaultFontType.value}if(_.isNull(messageInfo.buttonTextColor)||_.isUndefined(messageInfo.buttonTextColor)){messageInfo.buttonTextColor="#FFFFFF"}if(_.isNull(messageInfo.buttonBackgroundColor)||_.isUndefined(messageInfo.buttonBackgroundColor)){messageInfo.buttonBackgroundColor="#0000FF"}if(_.isNull(messageInfo.okayText)||_.isUndefined(messageInfo.okayText)){messageInfo.okayText="OK"}if(_.isNull(messageInfo.cancelText)||_.isUndefined(messageInfo.cancelText)){messageInfo.cancelText="Cancel"}if(!_.isNumber(messageInfo.ratioOfTextWidthToButtonWidth)){messageInfo.ratioOfTextWidthToButtonWidth=defaultRatioOfTextWidthToButtonWidth}if(!_.isNumber(messageInfo.minimumButtonWidth)){messageInfo.minimumButtonWidth=defaultMinimumButtonWidth}if(_.isNull(messageInfo.sameSizeButtons)||_.isUndefined(messageInfo.sameSizeButtons)){messageInfo.sameSizeButtons=true}if(!_.isNumber(messageInfo.okayWidth)){messageInfo.okayWidth=this.getStringWidth(messageInfo.okayText,messageInfo.buttonSizeAndFont)/messageInfo.ratioOfTextWidthToButtonWidth}if(messageInfo.okayWidth<messageInfo.minimumButtonWidth){messageInfo.okayWidth=messageInfo.minimumButtonWidth}if(!_.isNumber(messageInfo.cancelWidth)){messageInfo.cancelWidth=this.getStringWidth(messageInfo.cancelText,messageInfo.buttonSizeAndFont)/messageInfo.ratioOfTextWidthToButtonWidth}if(messageInfo.cancelWidth<messageInfo.minimumButtonWidth){messageInfo.cancelWidth=messageInfo.minimumButtonWidth}if(messageInfo.sameSizeButtons===true){if(messageInfo.cancelWidth<messageInfo.okayWidth){messageInfo.cancelWidth=messageInfo.okayWidth}else{messageInfo.okayWidth=messageInfo.cancelWidth}}if(!_.isNumber(messageInfo.distanceBetweenButtons)){messageInfo.distanceBetweenButtons=defaultDistanceBetweenButtons}if(messageInfo.cancel!==true){var okayX=stageWidth/2-messageInfo.okayWidth/2}else{var okayX=stageWidth/2-messageInfo.distanceBetweenButtons/2-messageInfo.okayWidth;var cancelX=stageWidth/2+messageInfo.distanceBetweenButtons/2}var defaults={};defaults.checkBox=false;defaults.checkBoxText="Dont show this message again.";defaults.checkBoxTextColor=messageInfo.messageColor;defaults.checkBoxFontSize=10;defaults.checkboxFontType=self.permanentPreferences.defaultFontType.value;defaults.modal=false;_.defaults(messageInfo,defaults);if(_.isString(messageInfo.okayEvent)){messageInfo.okayEvent=eval(messageInfo.okayEvent)}if(!_.isFunction(messageInfo.okayEvent)){messageInfo.okayEvent=function(e){self.events.onButtonClick(e);messageBoxAPI.hide()}}if(_.isString(messageInfo.cancelEvent)){messageInfo.cancelEvent=eval(messageInfo.cancelEvent)}if(!_.isFunction(messageInfo.cancelEvent)){messageInfo.cancelEvent=function(e){self.events.onButtonClick(e);messageBoxAPI.hide()}}if(_.isString(messageInfo.checkBoxUncheckedEvent)){messageInfo.checkBoxUncheckedEvent=eval(messageInfo.checkBoxUncheckedEvent)}if(_.isString(messageInfo.checkBoxCheckedEvent)){messageInfo.checkBoxCheckedEvent=eval(messageInfo.checkBoxCheckedEvent)}if(_.isString(messageInfo.closeWindowEvent)){messageInfo.closeWindowEvent=eval(messageInfo.closeWindowEvent)}if(!_.isFunction(messageInfo.closeWindowEvent)){messageInfo.closeWindowEvent=function(e){self.events.onButtonClick(e);messageBoxAPI.hide()}}var createBlankItems=function(){messageBoxItems.window=new self.images.Item(messageBoxWindowX,messageBoxWindowY,messageBoxWindowWidth,messageBoxWindowHeight,getZ("background",newStageNumber));messageBoxItems.windowTitle=new self.images.Item(messageBoxWindowX,messageBoxWindowY,messageBoxWindowWidth,outerTopHeight,getZ("text",newStageNumber));var textHeight=innerMessageBoxHeight-textTopOffset-buttonButtomOffset-buttonHeight-textBottomOffset-maxDistanceFromButtonsToCheckOption;messageBoxItems.message=new self.images.Item(textX,innerMessageBoxY+textTopOffset,innerMessageBoxWidth-textLeftOffset*2,textHeight,getZ("text",newStageNumber));var closeX=messageBoxWindowX+messageBoxWindowWidth-closeXRightOffset-closeXWidth;var closeY=messageBoxWindowY+closeXTopOffset;messageBoxItems.closeWindow=new self.images.Item(closeX,closeY,closeXWidth,closeXHeight,getZ("background",newStageNumber));if(messageInfo.closeWindowMessages){messageBoxItems.closeWindow.messages=messageInfo.closeWindowMessages}messageBoxItems.okay=new self.images.Item(okayX,buttonY,messageInfo.okayWidth,buttonHeight,getZ("buttons",newStageNumber));if(messageInfo.okayMessages){messageBoxItems.okay.messages=messageInfo.okayMessages}if(messageInfo.cancel){messageBoxItems.cancel=new self.images.Item(cancelX,buttonY,messageInfo.cancelWidth,buttonHeight,getZ("buttons",newStageNumber));if(messageInfo.cancelMessages){messageBoxItems.cancel.messages=messageInfo.cancelMessages}}if(messageInfo.checkBox){messageBoxItems.checkBoxUnchecked=new self.images.Item(0,0,0,0,getZ("buttons",newStageNumber));messageBoxItems.checkBoxChecked=new self.images.Item(0,0,0,0,getZ("buttons",newStageNumber));messageBoxItems.htmlCheckBox=new self.images.Item(0,0,0,0,getZ("buttons",newStageNumber))}};createBlankItems();if(messageInfo.html===true){console.log("displaying qtip message box");var additionalContent=[];var onRenderFunctions=[];var onShowFunctions=[];var messageCSS={"text-align":"center","pointer-events":"none"};if(!_.isString(messageInfo.style)){messageCSS["font"]=messageInfo.messageSizeAndFont;messageCSS["color"]=messageInfo.messageColor}var content=$("<p>").addClass(self.css.unselectable).css(messageCSS);content.html(messageString);$(div).append(content);messageBoxItems.message.addElement(content[0],"text",{position:false,size:false});if(messageBoxItems.okay instanceof self.images.Item||messageBoxItems.cancel instanceof self.images.Item){var bootstrapOptions={css:{font:messageInfo.buttonSizeAndFont,position:"relative"},attr:{"class":""},position:false,"class":self.css.unselectable};if(!_.isString(messageInfo.style)){bootstrapOptions.css["color"]=messageInfo.buttonTextColor;bootstrapOptions.css["background-color"]=messageInfo.buttonBackgroundColor}}if(messageInfo.checkBox){messageBoxItems.checkBoxUnchecked=null;messageBoxItems.checkBoxChecked=null;var checkBoxSize=parseInt($(messageBoxItems.message.text).css("font-size"))+1;var jqueryCheckBox=$("<input>").attr({type:"checkbox","class":self.css.unselectable}).css({width:checkBoxSize,height:checkBoxSize});jqueryCheckBox.addClass(self.css.unselectable);jqueryCheckBox.on("click",function(e){if(jqueryCheckBox.prop("checked")===true&&_.isFunction(messageInfo.checkBoxUncheckedEvent)){messageInfo.checkBoxUncheckedEvent(e)}else if(jqueryCheckBox.prop("checked")===false&&_.isFunction(messageInfo.checkBoxCheckedEvent)){messageInfo.checkBoxCheckedEvent(e)}});onShowFunctions.push(function(e,api){jqueryCheckBox.css("display","inline")});messageBoxItems.htmlCheckBox.addElement(jqueryCheckBox[0],"image",{position:false,size:false});additionalContent.push(jqueryCheckBox);var checkBoxTextCSS={"text-align":"left","font-size":messageInfo.checkBoxFontSize,"overflow-x":"hidden",position:"relative",left:checkBoxSize+"px",cursor:"pointer"};if(!_.isString(messageInfo.style)){checkBoxTextCSS.font=messageInfo.checkboxFontType;checkBoxTextCSS.color=messageInfo.checkBoxTextColor}var jqueryCheckBoxText=$("<p>").css(checkBoxTextCSS).addClass(self.css.unselectable);jqueryCheckBoxText.html(messageInfo.checkBoxText+"<br>");jqueryCheckBoxText.on("click.triggerBox",function(e){console.log(e);jqueryCheckBox.trigger("click")});messageBoxItems.htmlCheckBox.addElement(jqueryCheckBoxText[0],"text",{position:false,size:false});additionalContent.push(jqueryCheckBoxText);onShowFunctions.push(function(e,api){jqueryCheckBoxText.css("display","inline")})}if(messageBoxItems.okay instanceof self.images.Item){bootstrapOptions.css.width=messageBoxItems.okay.size.x+"px";bootstrapOptions.css.height=messageBoxItems.okay.size.y+"px";bootstrapOptions.onClick=messageInfo.okayEvent;messageBoxItems.okay.addBootstrapButton(messageInfo.okayText,bootstrapOptions);$(messageBoxItems.okay.image).attr("id",self.css.messageBoxButton);var okayPositionData=getDisplayObjectPositionAndSizeData(messageBoxItems.okay,{position:false});messageBoxItems.okay.size.x=messageBoxItems.okay.size.x+okayPositionData.extraWidth;messageBoxItems.okay.size.y=messageBoxItems.okay.size.y+okayPositionData.extraHeight;onShowFunctions.push(function(e,api){$(messageBoxItems.okay.image).css("display","inline")});additionalContent.push(messageBoxItems.okay.image)}if(messageBoxItems.cancel instanceof self.images.Item){bootstrapOptions.css.width=messageBoxItems.cancel.size.x+"px";bootstrapOptions.css.height=messageBoxItems.cancel.size.y+"px";bootstrapOptions.onClick=messageInfo.cancelEvent;messageBoxItems.cancel.addBootstrapButton(messageInfo.cancelText,bootstrapOptions);$(messageBoxItems.cancel.image).attr("id",self.css.messageBoxButton);var cancelPositionData=getDisplayObjectPositionAndSizeData(messageBoxItems.cancel,{position:false});messageBoxItems.cancel.size.x=messageBoxItems.cancel.size.x+cancelPositionData.extraWidth;messageBoxItems.cancel.size.y=messageBoxItems.cancel.size.y+cancelPositionData.extraHeight;onShowFunctions.push(function(e,api){$(messageBoxItems.cancel.image).css("display","inline")});additionalContent.push(messageBoxItems.cancel.image)}_.each(additionalContent,function(value,element,list){content=content.add(value)});var messageBoxQtipOptions={overwrite:false,content:{text:content,button:true,title:messageInfo.title},position:{my:"center",at:"center",target:$(div),container:$(div)},show:{ready:true,fixed:true,modal:{on:messageInfo.modal,blur:false}},hide:false,style:messageInfo.style,events:{render:function(event,api){console.log("render event called");api.elements.tooltip.find("*").add(api.elements.tooltip).css({"max-width":messageBoxWindowWidth*.72+"px"}).addClass(self.css.unselectable).removeAttr("title");if(_.isObject(api.elements.overlay)){api.elements.overlay.css({height:"100%",width:"100%","z-index":0,position:"absolute"})}api.elements.tooltip.css({"max-width":messageBoxWindowWidth+"px"});_.each(onRenderFunctions,function(value,element,list){value(e,api)})},hide:function(event,api){api.destroy();messageBoxAPI.hide(newStageNumber)},show:function(e,api){createjs.Tween.get(api.elements.content).wait(0).call(function(){var innerContentWidth=api.elements.content.width();console.log("innerconten width: "+innerContentWidth);console.log("distance bettn button: "+messageInfo.distanceBetweenButtons);console.log(messageBoxItems.okay.size.x);if(messageBoxItems.cancel&&messageBoxItems.cancel.image&&messageBoxItems.okay&&messageBoxItems.okay.image){messageInfo.distanceBetweenButtons;$(messageBoxItems.okay.image).css("left",innerContentWidth/2-messageInfo.distanceBetweenButtons/2-messageBoxItems.okay.size.x);$(messageBoxItems.cancel.image).css("left",innerContentWidth/2+messageInfo.distanceBetweenButtons/2-messageBoxItems.okay.size.x)}else if(messageBoxItems.okay&&messageBoxItems.okay.image){var onlyButton=messageBoxItems.okay}else if(messageBoxItems.cancel&&messageBoxItems.cancel.image){var onlyButton=messageBoxItems.cancel}if(onlyButton instanceof self.images.Item){$(onlyButton.image).css("left",innerContentWidth/2-onlyButton.size.x/2)}console.log("displaying messagebox div");setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(newStageNumber,true)});if(_.isObject(api.elements.overlay)){$(self.getParentOfStageObject(newStageNumber).div).append(api.elements.overlay)}if(_.isObject(api.elements.title)){var titleCSS={"text-align":"center",font:messageInfo.titleSizeAndFont,"pointer-events":"none"};if(!_.isString(messageInfo.style)){titleCSS.color=messageInfo.titleColor}api.elements.title.css(titleCSS)}_.each(onShowFunctions,function(value,element,list){value(e,api)});setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(newStageNumber,true)}}};$(div).qtip(messageBoxQtipOptions);console.log("modal completed")}else{messageBoxItems.window=new self.images.Item(messageBoxWindowX,messageBoxWindowY,messageBoxWindowWidth,messageBoxWindowHeight,getZ("background",newStageNumber));messageBoxItems.window.addBitmap(self.permanentPreferences.sourceObjects.value.messageBoxBackground,hideOrDisplayChildrenOptions);messageBoxItems.window.on("mousedown",function(e){var options={animationTarget:messageBoxItems};self.events.mouseDownClickAndDrag(e,options)});messageBoxItems.windowTitle=new self.images.Item(messageBoxWindowX,messageBoxWindowY,messageBoxWindowWidth,outerTopHeight,getZ("text",newStageNumber));messageBoxItems.windowTitle.addText(messageInfo.title,messageInfo.titleSizeAndFont,messageInfo.titleColor);var textHeight=innerMessageBoxHeight-textTopOffset-buttonButtomOffset-buttonHeight-textBottomOffset-maxDistanceFromButtonsToCheckOption;messageBoxItems.message=new self.images.Item(textX,innerMessageBoxY+textTopOffset,innerMessageBoxWidth-textLeftOffset*2,textHeight,getZ("text",newStageNumber));var messageTextOptions={centerTextY:false,lineWidth:messageBoxItems.message.size.x*.9,maxWidth:null};messageBoxItems.message.addText(messageString,messageInfo.messageSizeAndFont,messageInfo.messageColor,messageTextOptions);var closeX=messageBoxWindowX+messageBoxWindowWidth-closeXRightOffset-closeXWidth;var closeY=messageBoxWindowY+closeXTopOffset;messageBoxItems.closeWindow=new self.images.Item(closeX,closeY,closeXWidth,closeXHeight,getZ("background",newStageNumber));messageBoxItems.closeWindow.addBitmap(self.permanentPreferences.sourceObjects.value.messageBoxCloseX,hideOrDisplayChildrenOptions);if(messageInfo.closeWindowMessages){messageBoxItems.closeWindow.messages=messageInfo.closeWindowMessages}messageBoxItems.closeWindow.on("click",messageInfo.closeWindowEvent);messageBoxItems.okay=new self.images.Item(okayX,buttonY,messageInfo.okayWidth,buttonHeight,getZ("buttons",newStageNumber));self.images.itemAsRectangle(messageBoxItems.okay,messageInfo.buttonBackgroundColor);messageBoxItems.okay.addText(messageInfo.okayText,messageInfo.buttonSizeAndFont,messageInfo.buttonTextColor);if(messageInfo.okayMessages){messageBoxItems.okay.messages=messageInfo.okayMessages}messageBoxItems.okay.on("click",messageInfo.okayEvent);if(messageInfo.cancel){messageBoxItems.cancel=new self.images.Item(cancelX,buttonY,messageInfo.cancelWidth,buttonHeight,getZ("buttons",newStageNumber));self.images.itemAsRectangle(messageBoxItems.cancel,messageInfo.buttonBackgroundColor);messageBoxItems.cancel.addText(messageInfo.cancelText,messageInfo.buttonSizeAndFont,messageInfo.buttonTextColor);if(messageInfo.cancelMessages){messageBoxItems.cancel.messages=messageInfo.cancelMessages}messageBoxItems.cancel.on("click",messageInfo.cancelEvent)}else{messageBoxItems.cancel=null}if(messageInfo.checkBox){messageBoxItems.checkBoxUnchecked=new self.images.Item(0,0,0,0,getZ("buttons",newStageNumber));messageBoxItems.checkBoxChecked=new self.images.Item(0,0,0,0,getZ("buttons",newStageNumber));self.images.itemsAsCheckBoxes(messageBoxItems.checkBoxUnchecked,messageBoxItems.checkBoxChecked,messageInfo.checkBoxText,{color:messageInfo.checkBoxTextColor});var checkBoxWidth=messageBoxItems.checkBoxUnchecked.size.x;var checkBoxX=messageBoxWindowX+messageBoxWindowWidth/2-checkBoxWidth/2;var getCheckBoxY=function(){var messageBoxMessage=messageBoxItems.message;var messageBoxTextBottom=getDisplayObjectPositionAndSizeData(messageBoxMessage.text,{size:false}).x+messageBoxMessage.text.getMeasuredHeight();var defaultCheckBoxY=messageBoxItems.okay.position.y-maxDistanceFromButtonsToCheckOption-messageBoxItems.checkBoxUnchecked.size.y;if(defaultCheckBoxY-messageBoxTextBottom>=maxDistanceFromButtonsToCheckOption){}else if(defaultCheckBoxY-messageBoxTextBottom>=maxDistanceFromButtonsToCheckOption*-1){var distanceFromButtonsToMessageBottom=messageBoxItems.okay.position.y-messageBoxTextBottom;var distanceFromCheckBoxToMessageBottomAndButtons=(distanceFromButtonsToMessageBottom-messageBoxItems.checkBoxUnchecked.size.y)/2;var checkBoxY=messageBoxItems.okay.position.y-distanceFromCheckBoxToMessageBottomAndButtons}else if(defaultCheckBoxY-messageBoxTextBottom<maxDistanceFromButtonsToCheckOption*-1){}if(_.isNumber(checkBoxY)&&!_.isNaN(checkBoxY)){return checkBoxY}else{return defaultCheckBoxY}};var checkBoxY=getCheckBoxY();self.setImageItemPositionAndTextBasedOnImageChange(messageBoxItems.checkBoxUnchecked,checkBoxX,checkBoxY);self.setImageItemPositionAndTextBasedOnImageChange(messageBoxItems.checkBoxChecked,checkBoxX,checkBoxY);messageBoxItems.checkBoxUnchecked.on("click",function(e){if(_.isFunction(messageInfo.checkBoxUncheckedEvent)){messageInfo.checkBoxUncheckedEvent(e)}console.log("unchecked mesagebox checkbox clicked");var stagesToUpdate=[];stagesToUpdate.push(self.hideChildren(messageBoxItems.checkBoxUnchecked,{update:false}));stagesToUpdate.push(self.displayChildren(messageBoxItems.checkBoxChecked,{update:false}));self.updateStages(stagesToUpdate)});messageBoxItems.checkBoxChecked.on("click",function(e){if(_.isFunction(messageInfo.checkBoxCheckedEvent)){messageInfo.checkBoxCheckedEvent(e)}var stagesToUpdate=[self.hideChildren(messageBoxItems.checkBoxChecked,{update:false}),self.displayChildren(messageBoxItems.checkBoxUnchecked,{update:false})];self.updateStages(stagesToUpdate)})}else{messageBoxItems.checkBoxUnchecked=null;messageBoxItems.checkBoxChecked=null}stagesToUpdate.push(self.displayChildren(messageBoxItems,hideOrDisplayChildrenOptions));stagesToUpdate.push(self.hideChildren(messageBoxItems.checkBoxChecked,hideOrDisplayChildrenOptions));setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(newStageNumber,true)}messageBoxAPI.setCurrent(newStageNumber);hideOrDisplayChildrenOptions.update=update;if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.displayCashier=function(info,hideOrDisplayChildrenOptions){if(!hideOrDisplayChildrenOptions){var hideOrDisplayChildrenOptions={}}var update=hideOrDisplayChildrenOptions.update;hideOrDisplayChildrenOptions.update=false;var stagesToUpdate=[];var cashierImageContainerIndex=this.images.cashier.window.position.z.container;if(_.isUndefined(info.currency_per_chip)||_.isNull(info.currency_per_chip)){info.currency_per_chip=1}if(_.isUndefined(info.currency)||_.isNull(info.currency)){info.currency="Chips"}this.gameState.cashier.currency=info.currency;this.gameState.cashier.min=info.min*info.currency_per_chip;this.gameState.cashier.max=info.max*info.currency_per_chip;this.gameState.cashier.balance=info.balance_in_currency;this.gameState.cashier.table_name=info.table_name;this.gameState.cashier.small_blind=info.small_blind*info.currency_per_chip;this.gameState.cashier.big_blind=info.big_blind*info.currency_per_chip;this.gameState.cashier.table_min=info.table_min*info.currency_per_chip;this.images.cashier.currency.text.text="Blinds:";this.images.cashier.blinds.text.text=info.currency_per_chip*info.small_blind+"/"+info.currency_per_chip*info.big_blind+" "+info.currency;this.images.cashier.tableNameValue.text.text=info.table_name;this.images.cashier.tableMinValue.text.text=info.currency_per_chip*info.table_min;this.images.cashier.tableMaxValue.text.text=info.currency_per_chip*info.table_max;this.images.cashier.playerMinValue.text.text=info.currency_per_chip*info.min;this.images.cashier.accountBalanceValue.text.text=this.gameState.cashier.balance+" "+info.currency;if(this.gameState.cashier.balance<this.gameState.cashier.min){var accountBalanceColor="red"}else{var accountBalanceColor=this.images.cashier.accountBalanceValue.textColor}this.images.cashier.accountBalanceValue.text.color=accountBalanceColor;this.images.cashier.accountBalance.text.color=accountBalanceColor;$("#maxRadio").prop("checked",false);$("#autoRebuyRadio").prop("checked",false);$("#otherAmountRadio").prop("checked",false);$("#otherAmount").val(self.gameState.cashier.min);$("#autoRebuyAmount").val(this.gameState.cashier.table_min);$("#maxAmount").val(this.gameState.cashier.max);$("#maxAmount").attr("readonly",true);$("#otherAmountRadio").prop("checked",true);var htmlcashier=document.getElementById("cashier");htmlcashier.style.display="inline";var cashierStageNumber=this.images.cashier.window.position.z.stage;console.log(this.images.cashier);validateCashierDisplayBasedOnUserInput(true);stagesToUpdate.push(this.displayChildren(this.images.cashier,hideOrDisplayChildrenOptions));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions(hideOrDisplayChildrenOptions));setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(self.images.cashier.window,true);if(update!==false){this.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.isPreference=function(preference){if(_.isObject(preference)&&(!_.isUndefined(preference.value)||_.isFunction(preference.updateValue))){return true}else{return false}};this.images.Item.prototype.isCSSDisplayed=function(){if(_.isElement(this.image)){var displayStatus=$(this.image).css("display");if(displayStatus!=="none"&&displayStatus!=="hidden"){return true}}if(_.isElement(this.text)){var displayStatus=$(this.text).css("display");if(displayStatus!=="none"&&displayStatus!=="hidden"){return true
}}};this.images.Item.prototype.isDisplayed=function(){if(this.isCSSDisplayed()===true){return true}if(this.isAddedToStage()===true){return true}return false};var isItemDisplayed=function(item){if(item instanceof self.images.Item){return item.isDisplayed()}};this.images.Item.prototype.isAddedToStage=function(){var isItemAddedToStage=function(item){var result=false;if(item instanceof self.images.Item){if(item.image instanceof createjs.DisplayObject&&self.getParentOfStageObject(item).containers[item.position.z.container].contains(item.image)===true){result=true}if(result!==true&&item.text instanceof createjs.DisplayObject&&self.getParentOfStageObject(item).containers[item.position.z.container+1].contains(item.text)===true){result=true}}return result};return isItemAddedToStage(this)};this.getCurrentStackSizes=function(){var stackSizes=[];for(var i=0;i<this.gameState.numSeats;i++){var size=parseInt(this.images.seats[i].stackSize.getText());if(_.isNaN(size)){size=0}else if(_.isNumber(size)){if(size<0){size=0}}else{size=0}stackSizes.push(size)}return stackSizes};this.getCurrentPotSizes=function(){var potSizes=[];var numPots=1;for(var i=0;i<this.gameState.numSeats-1;i++){var potSizeItem=this.images.pots[i].potSize;var potSize=parseFloat(potSizeItem.text.text);if(_.isNaN(potSize)||!_.isNumber(potSize)){potSize=0}if(i===0||potSize>0&&potSizeItem.isAddedToStage){potSizes.push(potSize)}else{i=999}}return potSizes};this.getCurrentBetSizes=function(){var betSizes=[];for(var i=0;i<this.gameState.numSeats;i++){var betSizeItem=this.images.seats[i].bet;if(betSizeItem.isAddedToStage()){betSizes.push(parseFloat(betSizeItem.getText()))}else if(this.images.seats[i].hiddenCards[0].isAddedToStage()||this.images.seats[i].shownCards[0].isAddedToStage()){betSizes.push(0)}else{betSizes.push(false)}}return betSizes};this.streetEnds=function(potSizes){var animationTime=350;var ticks=30;var chipMoveSound=createjs.Sound.createInstance(this.images.sources.moveChipsSound);$(self.getParentOfStageObject(this.images.betSlider.slider).div).off("mousewheel.adjustBetSize");var masterSeriesArray=[];var masterCallbackNumber=0;var asyncParallelChipIntoPotFunctionArray=[];var chipIntoPotCallbackNumber=0;var updateDisplay=[];var stagesToUpdate=[];var allTemporaryItems=[];var asyncParallelFinishedMasterSeriesCallbackNumber=masterCallbackNumber;masterSeriesArray.push(function(masterCallback){async.parallel(asyncParallelChipIntoPotFunctionArray,function(err,results){if(results.length===chipIntoPotCallbackNumber){console.log("parallel chips to pot animations finished successfully");masterCallback(null,asyncParallelFinishedMasterSeriesCallbackNumber)}else{console.error("parallel chips to pot animations resulted in errors");console.error(err);throw""}})});masterCallbackNumber++;var cleanupCallbackNumber=masterCallbackNumber;masterSeriesArray.push(function(masterCallback){cleanup();masterCallback(null,cleanupCallbackNumber)});masterCallbackNumber++;var currentPots=this.getCurrentPotSizes();if(currentPots.length>potSizes.length){throw"current potsizes exceed street_ends message potSize length"}var currentBets=this.getCurrentBetSizes();var currentBetsSortedWithoutSeats=_.without(currentBets,null,undefined,false,true,0).sort(function(x,y){return x-y});var uniqueBets=_.uniq(currentBetsSortedWithoutSeats,true);var deltaPotSizes=[];for(var i=0;i<potSizes.length;i++){if(_.isNumber(currentPots[i])){deltaPotSizes[i]=potSizes[i]-currentPots[i]}else{deltaPotSizes[i]=potSizes[i]}}var numPotsToFeed=_.compact(deltaPotSizes).length;var numUniqueBets=_.compact(uniqueBets).length;var firstPotToFeed=potSizes.length-numPotsToFeed;if(_.compact(deltaPotSizes).length!==numUniqueBets){console.log("potSizes = ");console.log(potSizes);console.log("current pots = ");console.log(currentPots);console.log("unique bets = ");console.log(uniqueBets);console.log("deltaPotSizes = ");console.log(deltaPotSizes);console.log("numUniqueBets not the same as number of pot sizes changed")}var splitChipstacksData=[];for(var i=uniqueBets.length-1;i>=0;i--){if(i===0){var chipStackContribution=uniqueBets[i]}else{var chipStackContribution=uniqueBets[i]-uniqueBets[i-1]}if(i<numUniqueBets-numPotsToFeed){var potNum=potSizes.length-numPotsToFeed}else{var potNum=potSizes.length-numPotsToFeed+i-numUniqueBets+numPotsToFeed}for(var seat=0;seat<currentBets.length;seat++){if(_.isNumber(currentBets[seat])&&currentBets[seat]>=chipStackContribution){splitChipstacksData.push({seatNumber:seat,numChips:chipStackContribution,potNumber:potNum})}}}var temporaryChipstacksToPotNumberIndexIsPotNumber=[];for(var i=0;i<potSizes.length;i++){temporaryChipstacksToPotNumberIndexIsPotNumber.push([])}_.each(_.range(splitChipstacksData.length),function(i){var potNumber=splitChipstacksData[i].potNumber;temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber].push({chips:[]});var splitChipStackInfo={initialX:self.images.seats[splitChipstacksData[i].seatNumber].firstChip.position.x,initialY:self.images.seats[splitChipstacksData[i].seatNumber].firstChip.position.y,hidden:true,update:false};stagesToUpdate.push(self.displayChipStack(parseFloat(splitChipstacksData[i].numChips),temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber].length-1],splitChipStackInfo))});stagesToUpdate.push(this.hideAllBets({update:false}));console.log("displaying array of array of chip parents");console.log(temporaryChipstacksToPotNumberIndexIsPotNumber);for(var i=0;i<temporaryChipstacksToPotNumberIndexIsPotNumber.length;i++){for(var n=0;n<temporaryChipstacksToPotNumberIndexIsPotNumber[i].length;n++){stagesToUpdate.push(self.displayChildren(temporaryChipstacksToPotNumberIndexIsPotNumber[i][n].chips,{update:false}))}}_.each(_.range(temporaryChipstacksToPotNumberIndexIsPotNumber.length),function(potNumber){_.each(_.range(temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber].length),function(stackNumber){var chipArray=temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips;if(_.isArray(chipArray)&&chipArray.length>0){var deltaX=self.images.pots[potNumber].firstChip.position.x-temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips[0].image.x;var deltaY=self.images.pots[potNumber].firstChip.position.y-temporaryChipstacksToPotNumberIndexIsPotNumber[potNumber][stackNumber].chips[0].image.y;_.each(chipArray,function(chipItem,chipNumber){allTemporaryItems.push(chipItem);var tempCallBackNumber0=chipIntoPotCallbackNumber;asyncParallelChipIntoPotFunctionArray.push(function(callback){var animationData={time:animationTime,numTicks:ticks,item:chipItem,finalX:deltaX+chipItem.image.x,finalY:deltaY+chipItem.image.y,onEnd:function(animationInfo,tweenInstance){self.hideChildren(animationInfo.item,{update:false});callback(null,tempCallBackNumber0)},onStart:function(){}};self.animateImage(animationData)});chipIntoPotCallbackNumber++})}})});var tempCallBackNumber1=chipIntoPotCallbackNumber;asyncParallelChipIntoPotFunctionArray.push(function(callback){if(numPotsToFeed>0){chipMoveSound.play()}self.updateStages(stagesToUpdate);stagesToUpdate.length=0;callback(null,tempCallBackNumber1)});chipIntoPotCallbackNumber++;function cleanup(){console.log("street ends cleanup function called");self.updatePotSize(potSizes);stagesToUpdate.push(self.hideChildren(allTemporaryItems,{update:false}));self.updateStages(stagesToUpdate)}self.updateStages(stagesToUpdate);stagesToUpdate.length=0;async.series(masterSeriesArray)};var canPlayerActDefaultsToUser=function(seat){if(!_.isNumber(seat)){var seat=self.gameState.userSeatNumber}var currentStackSizes=self.getCurrentStackSizes();var currentBetSizes=self.getCurrentBetSizes();var compactedStackSizes=_.compact(currentStackSizes);if(!_.isNumber(seat)){return false}else if(currentStackSizes[self.gameState.userSeatNumber]<=0){return false}else if(compactedStackSizes.length<=0){return false}else if(compactedStackSizes.length<=1&&self.getHighBet()<=currentBetSizes[self.gameState.userSeatNumber]){return false}else{return true}};var setAutoRebuyValueText=function(value,options){if(!options){var options={}}var stagesToUpdate=[];if(!_.isNumber(value)||_.isNaN(value)||value<=0){var value="disabled"}stagesToUpdate.push(updateItemText(self.images.cashier.autoRebuyValue,value,options));if(options.update!==false){self.updateStages(stagesToUpdate)}else{return stagesToUpdate}};this.updateUserOptionsBasedOnFlagsAndPreactions=function(options){if(!options){var options={}}var update=options.update;options.update=false;var stagesToUpdate=[];var currentStackSizes=self.getCurrentStackSizes();stagesToUpdate.push(self.updatePreactionOptionDisplayBasedOnLocalData(options));if(!_.isNumber(self.gameState.userSeatNumber)){stagesToUpdate.push(this.hideSeatedOptions(options));console.log("updated options based on non seated user. if you are seated at a table you should NOT be seeing this")}else{var autoRebuyFlagValue=self.getPreactionData("autorebuy");var displayDisableAutoRebuy=false;if(_.isNumber(autoRebuyFlagValue)){var displayDisableAutoRebuy=true}stagesToUpdate.push(setAutoRebuyValueText(autoRebuyFlagValue,options));stagesToUpdate.push(self.images.positionCashierButtons(displayDisableAutoRebuy,options));this.images.getChips.on("click",self.events.onButtonClick);this.images.standUp.on("click",self.events.userStands);stagesToUpdate.push(this.hideChildren(this.images.getChipsDisabledShape,options));stagesToUpdate.push(this.hideChildren(this.images.standUpDisabledShape,options));var preactionOptionData=self.getPreactionOptionValues();if(self.getPreactionData("sitting_out")){console.log("updating user options based on sitting_out user");stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBet,options));stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(this.playerSitsOut(self.gameState.userSeatNumber,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextHand,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextHandOn,options));if(currentStackSizes[self.gameState.userSeatNumber]<=0){stagesToUpdate.push(self.hideChildren(self.images.sitIn,options));stagesToUpdate.push(self.displayChildren(self.images.rebuy,options))}else{stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));stagesToUpdate.push(self.displayChildren(self.images.sitIn,options))}}else{stagesToUpdate.push(self.hideChildren(self.images.sitIn,options));stagesToUpdate.push(self.hideChildren(self.images.rebuy,options));if(self.getPreactionData("pending_sit_out")){stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(self.hideChildren(self.images.sitOutNextHand,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextHandOn,options))}else{stagesToUpdate.push(self.hideChildren(self.images.sitOutNextHandOn,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextHand,options));if(self.getPreactionData("post_blind")===false){console.log("displaying sitoutnextblindon");stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlind,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextBlindOn,options))}else{stagesToUpdate.push(self.hideChildren(self.images.sitOutNextBlindOn,options));stagesToUpdate.push(self.displayChildren(self.images.sitOutNextBlind,options))}}if(self.getPreactionData("inHand")===true&&canPlayerActDefaultsToUser()===true){if(this.getPreactionData("fold")){if(preactionOptionData&&preactionOptionData.check===false||this.getPreactionData("check")){stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBet,options));stagesToUpdate.push(self.displayChildren(self.images.foldToAnyBetOn,options))}}else{stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(self.displayChildren(self.images.foldToAnyBet,options))}if(this.getPreactionData("toAct",{seat:"table"})!==self.gameState.userSeatNumber){$(self.getParentOfStageObject(self.images.betSlider.slider).div).off("mousewheel.adjustBetSize");$(window).off("mousewheel.disable")}}else{$(self.getParentOfStageObject(self.images.betSlider.slider).div).off("mousewheel.adjustBetSize");stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBetOn,options));stagesToUpdate.push(self.hideChildren(self.images.foldToAnyBet,options))}}}options.update=update;if(update===false){return stagesToUpdate}else{this.updateStages(stagesToUpdate)}};this.getPermanentPreferences=function(){};this.saveSessionPreferences=function(){socket.emit("set_flag","sessionPreferences",this.sessionPreferences);console.log(this.sessionPreferences)};this.savePermanentPreferences=function(){socket.emit("set_preference","permanentPreferences",self.permanentPreferences)};this.initializeServerPreferenceObjects=function(currentPreferenceObject,createObjectFunction,options){console.log("initializeserver peference called");return null;if(!options){var options={}}if(!_.isNumber(options.maxDepth)){options.maxDepth=3}if(!_.isString(options.currentObjectString)){options.currentObjectString=""}if(options.maxDepth>=0){_.each(currentPreferenceObject,function(element,index,list){console.log(index);if(_.isObject(currentPreferenceObject[index])){if(_.isUndefined(currentPreferenceObject[index].value)&&_.isUndefined(currentPreferenceObject[index].updateValue)){if(options.currentObjectString.length===0){console.log("0 length objectstring triggered");console.log("objectstring: "+options.currentObjectString+" index: "+index);createObjectFunction(index,options);self.initializeServerPreferenceObjects(currentPreferenceObject[index],createObjectFunction,{currentObjectString:index,maxDepth:options.maxDepth-1})}else{console.log("non 0 length objectstring triggered");console.log("objectstring: "+options.currentObjectString+" index: "+index);createObjectFunction(options.currentObjectString+"."+index,options);self.initializeServerPreferenceObjects(currentPreferenceObject[index],createObjectFunction,{currentObjectString:options.currentObjectString+"."+index,maxDepth:options.maxDepth-1})}}}})}};this.updatePreference=function(currentPreferenceObject,newPreferenceObject,options){if(!options){var options={}}if(!_.isNumber(options.maxDepth)){options.maxDepth=4}if(options.maxDepth>=0){_.each(newPreferenceObject,function(element,index,list){if(!_.isUndefined(newPreferenceObject[index])){if(!_.isObject(currentPreferenceObject[index])){currentPreferenceObject[index]={}}if(self.isPreference(newPreferenceObject[index])){var newValue=newPreferenceObject[index].value}else if(!_.isObject(newPreferenceObject[index])){var newValue=newPreferenceObject[index]}else if(_.isObject(newPreferenceObject[index])){var depth=options.maxDepth;options.maxDepth=options.maxDepth-1;self.updatePreference(currentPreferenceObject[index],newPreferenceObject[index],options);options.maxDepth=depth}if(!_.isUndefined(newValue)&&newValue!==currentPreferenceObject[index].value||options.updateEqualValues===true){if(_.isFunction(currentPreferenceObject[index].updateValue)){currentPreferenceObject[index].updateValue(newValue,options)}else if(!_.isUndefined(newPreferenceObject[index].value)){currentPreferenceObject[index].value=newValue}}}})}};this.updateLocalGameDataBasedOnServerPlayerObject=function(player){if(player.is_you==true){self.gameState.userSeatNumber=player.seat}var setPreactionDataOptions={server:false,seat:player.seat};if(_.isObject(player.flags)){var flags=player.flags;console.log("updateLocalGameDataBasedOnServerPlayerObject");console.log(flags);if(!_.isUndefined(flags.pending_sit_out)){self.setPreactionData("permanent","pending_sit_out",flags.pending_sit_out,setPreactionDataOptions)}if(!_.isUndefined(flags.post_blind)){self.setPreactionData("permanent","post_blind",flags.post_blind,setPreactionDataOptions)}if(!_.isUndefined(flags.sitting_out)){self.setPreactionData("permanent","sitting_out",flags.sitting_out,setPreactionDataOptions)}if(!_.isUndefined(flags.check)){this.setPreactionData("hand","check",flags.check,setPreactionDataOptions)}if(!_.isUndefined(flags.call)){this.setPreactionData("hand","call",flags.call,setPreactionDataOptions)}if(!_.isUndefined(flags.fold)){this.setPreactionData("hand","fold",flags.fold,setPreactionDataOptions)}if(!_.isUndefined(flags.raise)){this.setPreactionData("hand","raise",flags.raise,setPreactionDataOptions)}if(!_.isUndefined(flags.bet)){this.setPreactionData("hand","bet",flags.bet,setPreactionDataOptions)}}self.gameState.seats[player.seat].sitting_out=player.sitting_out;self.gameState.seats[player.seat].chips=player.chips;self.gameState.seats[player.seat].username=player.username;if(_.isNumber(player.chips)&&player.chips>0){self.gameState.seats[player.seat].notEnoughChips=false}else{self.gameState.seats[player.seat].notEnoughChips=true}};var setStageUpdateStatus=function(numberOrItem,status){self.getParentOfStageObject(numberOrItem).upToDate=status};this.updateStages=function(stageNumberLeaveBlankForAll,options){var getStageFamilyArray=function(stageNumber,options){var stageFamilyArray=[];var canvasID=self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].stage.canvas.id;for(var i=0;i<self.arrayOfParentsOfStageAndOfContainerArray.length;i++){if(self.arrayOfParentsOfStageAndOfContainerArray[i].stage.canvas.id===canvasID){stageFamilyArray.push(i)}}return stageFamilyArray};var setStagesUpToDateValueFromArrayFalseByDefault=function(stages,options){if(!options){var options={}}if(options.upToDate!==true&&options.uptoDate!==false){options.upToDate=false}if(_.isNumber(stages)){self.arrayOfParentsOfStageAndOfContainerArray[stages].upToDate=options.upToDate}if(_.isArray(stages)){for(var i=0;i<stages.length;i++){self.arrayOfParentsOfStageAndOfContainerArray[stages[i]].upToDate=options.upToDate}}};var updateStagesFromArray=function(stageArray,options){if(!options){var options={}}if(stageArray.length==0){return}var sortfunction=function(x,y){return x-y};stageArray.sort(sortfunction);var canvasesCleared=[];var stagesUpdated=[];var currentCanvasID=null;for(var i=0;i<stageArray.length;i++){if(self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.canvas.id!==currentCanvasID&&options.clear!==false){currentCanvasID=self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.canvas.id;canvasesCleared.push(currentCanvasID);self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.clear();self.performance.numCanvasClears++;setStagesUpToDateValueFromArrayFalseByDefault(getStageFamilyArray(stageArray[i]))}if(self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].upToDate!==true||options.forceUpdate===true){stagesUpdated.push(stageArray[i]);self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].stage.update();self.arrayOfParentsOfStageAndOfContainerArray[stageArray[i]].upToDate=true}}if(canvasesCleared.length+stagesUpdated.length>0){var logString="canvases cleared: "+canvasesCleared.toString()+", total cleared: "+self.performance.numCanvasClears+", stages updated: "+stagesUpdated.toString()}};if(!options){var options={}}if(_.isNumber(stageNumberLeaveBlankForAll)){if(this.arrayOfParentsOfStageAndOfContainerArray[stageNumberLeaveBlankForAll].upToDate!==true||options.forceUpdate===true){var stagesToUpdate=getStageFamilyArray(stageNumberLeaveBlankForAll);updateStagesFromArray(stagesToUpdate)}}else if(_.isArray(stageNumberLeaveBlankForAll)){if(stageNumberLeaveBlankForAll.length===0){return"updatestages passed 0 length array as parameter"}var wantToUpdate=[];stageNumberLeaveBlankForAll=_.flatten(stageNumberLeaveBlankForAll);stageNumberLeaveBlankForAll=_.without(stageNumberLeaveBlankForAll,null,undefined,false,true,{});stageNumberLeaveBlankForAll=_.uniq(stageNumberLeaveBlankForAll);for(var i=0;i<stageNumberLeaveBlankForAll.length;i++){if(_.isObject(self.arrayOfParentsOfStageAndOfContainerArray[stageNumberLeaveBlankForAll[i]])){if(self.arrayOfParentsOfStageAndOfContainerArray[stageNumberLeaveBlankForAll[i]].upToDate!==true||options.forceUpdate===true){wantToUpdate.push(getStageFamilyArray(stageNumberLeaveBlankForAll[i]))}}}wantToUpdate=_.flatten(wantToUpdate);wantToUpdate=_.uniq(wantToUpdate);updateStagesFromArray(wantToUpdate)}else{var allStages=[];for(var i=0;i<this.arrayOfParentsOfStageAndOfContainerArray.length;i++){allStages.push(i)}this.updateStages(allStages,options)}};this.animateDealerButton=function(seatNumber,time,options){if(!options){var options={}}if(!_.isNumber(seatNumber)||_.isNaN(seatNumber)){var finalX=self.images.pots[0].firstChip.position.x;var finalY=self.images.pots[0].firstChip.position.y}else{var finalX=self.images.seats[seatNumber].dealerButton.position.x;var finalY=self.images.seats[seatNumber].dealerButton.position.y}if(!time){self.setImageItemPositionAndTextBasedOnImageChange(self.images.dealerButton,finalX,finalY,options)}else{var animationInfo={item:self.images.dealerButton,finalX:finalX,finalY:finalY,time:time};self.animateImage(animationInfo)}};var setJustActedOrPassNullToGetJustActed=function(playerNumber){if(_.isNumber(playerNumber)&&!_.isNaN(playerNumber)){self.gameState.street.justActed=playerNumber;self.setPreactionData("hand","toAct",false,{seat:"table"})}else{return self.gameState.street.justActed}};this.displayInitialTableState=function(table_state){this.initial_table_state=table_state;var displayOptions={update:false,server:false};var showTable=false;var tickerInterval=5;var ticksPerAnimation=1;var numTicks=0;createjs.Ticker.addEventListener("tick",tick);createjs.Ticker.setInterval(tickerInterval);createjs.Ticker.setPaused(false);var seatsLoaded=[];self.images.imageLoading.title.text.text=self.images.imageLoading.title.text.text+".";this.updateStages(this.images.imageLoading.title.position.z.stage);function tick(event){if(numTicks%ticksPerAnimation==0){self.images.imageLoading.title.text.text=self.images.imageLoading.title.text.text+"."}var updateLoadedSeats=function(){for(var i=0;i<table_state.max_players;i++){if(seatsLoaded[i]!=true){var stageNumber=self.images.seats[i].seat.position.z.stage;var container=self.images.seats[i].seat.position.z.container;if(self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(self.images.seats[i].seat.image)||self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(self.images.seats[i].disabledSeat.image)||self.arrayOfParentsOfStageAndOfContainerArray[stageNumber].containers[container].contains(self.images.seats[i].openSeat.image))seatsLoaded[i]=true}}};var checkSeatsLoaded=function(){for(var i=0;i<table_state.max_players;i++){if(seatsLoaded[i]!=true){return false}}return true};updateLoadedSeats();if(showTable===true){createjs.Ticker.removeEventListener("tick",tick);var parentOfLoadingStage=self.arrayOfParentsOfStageAndOfContainerArray[getZ("loadingScreen").stage];parentOfLoadingStage.stage.removeAllChildren();self.updateStages(getZ("loadingScreen").stage);console.log("loading canvas now");setDisplayStatusOfCanvasDivByStageNumberOrItemTrueDisplaysHidesByDefault(getZ("loadingScreen").stage,false);self.activateTicker(50)}console.log("increasing tick");numTicks++}this.displayChildren(this.images.getChips,displayOptions);this.displayChildren(this.images.table,displayOptions);this.displayChildren(this.images.showTableChatFull,displayOptions);this.displayChildren(this.images.standUp,displayOptions);this.displayTableChatBox();this.images.currencyDisplay.text.text="1 chip is equal to "+table_state.currency_per_chip+" "+table_state.currency;if(table_state.currency_per_chip==1&&table_state.currency.charAt(table_state.currency.length-1)=="s"||"S"){this.images.currencyDisplay.text.text=this.images.currencyDisplay.text.text.substring(0,this.images.currencyDisplay.text.text.length-1)}this.displayChildren(this.images.currencyDisplay,displayOptions);this.setNumberOfSeats(table_state.max_players,displayOptions);this.displayAllCommunity(table_state.community,displayOptions);for(var i=0;i<table_state.seats.length;i++){if(table_state.seats[i].is_you===true){self.gameState.userSeatNumber=table_state.seats[i].seat}}console.log("assigned userseat number from table_state of: "+self.gameState.userSeatNumber);for(var i=0;i<table_state.seats.length;i++){self.playerSits(table_state.seats[i].seat,table_state.seats[i].username,table_state.seats[i].chips,displayOptions);setFlags(table_state.seats[i],false,{update:false,server:false,seat:table_state.seats[i].seat});if(_.isObject(table_state.seats[i].flags)){setFlags(table_state.seats[i].flags,false,{update:false,updateEqualValues:true,server:false,seat:table_state.seats[i].seat})}if(table_state.seats[i].is_you==true){console.log("calling display seated options")}else{if(table_state.seats[i].sitting_out==true){self.playerSitsOut(table_state.seats[i].seat,displayOptions)}}}if(!_.isNumber(this.gameState.userSeatNumber)){this.displayChildren(this.images.getChipsDisabledShape,displayOptions)}if(table_state.stage_name!=="waiting"&&table_state.stage_name!=="blinding"){for(var i=0;i<table_state.players.length;i=i+1){if(!table_state.players[i].hand||table_state.players[i].hand.length==0){this.displayHiddenCards(table_state.players[i].seat,displayOptions)}else if(table_state.players[i].hand){this.displayHoleCards(table_state.players[i].hand,table_state.players[i].seat,displayOptions)}}}var potSizes=[];for(var i=0;i<table_state.pots.length;i++){potSizes[i]=table_state.pots[i].value}if(_.isArray(potSizes)&&potSizes.length>0){this.updatePotSize(potSizes,displayOptions)}for(var i=0;i<table_state.players.length;i=i+1){this.playerPutsChipsInPot(table_state.players[i].seat,table_state.players[i].current_bet,table_state.players[i].chips,displayOptions);this.displayChipStack(table_state.players[i].current_bet,self.images.seats[table_state.players[i].seat],displayOptions)}for(var i=0;i<table_state.max_players;i++){this.displayCorrectSeatItems(i,displayOptions)}for(var i=0;i<table_state.messages.length;i++){this.gameState.tableChatFull.log.push(["dealer",table_state.messages[i]])}this.updateTableChatFullMessageTextFromCurrentOrAdditionalData(null,{update:false});if(table_state.stage_name==="waiting"){var dealerPosition=null}else{var dealerPosition=table_state.dealer}self.gameState.dealer=dealerPosition;self.animateDealerButton(dealerPosition,0,displayOptions);self.displayChildren(self.images.dealerButton,{update:false});this.updateUserOptionsBasedOnFlagsAndPreactions(displayOptions);showTable=true;testFunction(displayOptions);if(_.isObject(playZoneLandingPage.iframes)&&self.isIframe()){playZoneLandingPage.iframes.setIframeCloseHandler(self.getTableName(),self.events.exitTableClick)}};var testFunction=function(){console.log(" calling testfunction");for(var i=0;i<self.gameState.numSeats;i++){}};this.getInitialPermanentPreferences=function(callback){console.log("getInitialPermanentPreferences");$.getJSON("/preferences",function(data){self.updatePreference(self.permanentPreferences,data,{updateEqualValues:true});if(_.isFunction(callback)){callback()}})};this.receiveTableState=function(){socket.once("table_state",function(table_state){console.log("one time table_state message received");console.log(table_state);self.displayInitialTableState(table_state);self.activateSockets()});socket.emit("get_table_state")};this.activateSockets=function(){socket.on("street_ends",function(potSizes){for(var i=0;i<self.gameState.numSeats;i++){self.clearExpirationData("street",i)}self.streetEnds(potSizes)});socket.on("error",function(errorString,messageInfo){if(messageInfo){}else{var messageInfo={};messageInfo.okay=true;messageInfo.html=true;messageInfo.style="qtip-youtube"}messageBoxAPI.display(errorString,messageInfo)});socket.on("player_gets_refund",function(player,betSize,totalPotSize){var stackSize=player.chips;var betSize=betSize;var seatNumber=player.seat;var stagesToUpdate=[];stagesToUpdate.push(self.playerPutsChipsInPot(seatNumber,betSize,stackSize));stagesToUpdate.push(self.updatePotSize(totalPotSize));self.updateStages(stagesToUpdate)});socket.on("community_dealt",function(community){self.dealCommunity(community)});socket.on("dealer_chip",function(seatNumber){self.gameState.dealer=seatNumber;self.animateDealerButton(seatNumber,350)});socket.on("hands_dealt",function(players,tableInfo){self.displayChildren(self.images.dealerButton);var playerArray=[];for(var i=0;i<players.length;i++){playerArray.push(players[i].seat)}if(self.gameState.holeCards){self.dealHoleCards(tableInfo.small_blind_seat,playerArray,self.gameState.holeCards);self.displayInHandOptions()}else{self.dealHoleCards(tableInfo.small_blind_seat,playerArray)}});socket.on("pending_sit_out",function(value){if(!_.isNumber(self.gameState.userSeatNumber)){return}self.setPreactionData("permanent","pending_sit_out",value);self.updateUserOptionsBasedOnFlagsAndPreactions()});socket.on("flags_set",function(flags){console.log(["flags_set",flags]);setFlags(flags);self.updateUserOptionsBasedOnFlagsAndPreactions()});socket.on("flag_set",function(flagName,valueOfFlag){console.log(["flag_set",flagName,valueOfFlag]);setOneFlagOrPreference(flagName,valueOfFlag,{update:false});self.updateUserOptionsBasedOnFlagsAndPreactions()});socket.on("hole_cards_dealt",function(hand){self.gameState.holeCards=hand});socket.on("player_acts",function(player,action,pot){var seatNum=player.seat;var stagesToUpdate=[];var action=action.toUpperCase();self.clearExpirationData("act",seatNum);if(action!="SKIP"){self.playerActs(seatNum,action,1e3)}if(pot&&action!=="CHECK"){self.updatePotSize(pot)}switch(action){case"FOLD":self.createHoleCardCopyIfNeeded(seatNum);var foldSound=createjs.Sound.createInstance(self.images.sources.foldSound);foldSound.play();self.hideHoleCards(seatNum);self.setPreactionData("hand","inHand",false);if(player.seat==self.gameState.userSeatNumber){self.hideChildren(self.images.foldToAnyBet);self.hideChildren(self.images.foldToAnyBetOn)}break;case"CHECK":var checkSound=createjs.Sound.createInstance(self.images.sources.checkSound);checkSound.play();self.setPreactionData("hand","inHand",true);break;case"BET":case"CALL":case"RAISE":case"POST_BLIND":var betSound=createjs.Sound.createInstance(self.images.sources.betSound);betSound.play();self.playerPutsChipsInPot(seatNum,player.current_bet,player.chips);self.setPreactionData("hand","inHand",true);break}setJustActedOrPassNullToGetJustActed(seatNum);if(seatNum===self.gameState.userSeatNumber){self.clearExpirationData("once",player.seat);$(self.getParentOfStageObject(self.images.betSlider.slider).div).off("mousewheel.adjustBetSize")}else{self.clearExpirationData("act",seatNum)}stagesToUpdate.push(self.displayCorrectSeatItems(player.seat,{update:false}));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}))});socket.on("act_prompt",function(actions,timeout){var stagesToUpdate=[];_.each(actions,function(value,i,list){var options={update:false};if(actions[i].fold!==undefined){stagesToUpdate.push(self.updateActionButton("fold",options))}else if(actions[i].check!==undefined){stagesToUpdate.push(self.updateActionButton("check",options))}else if(actions[i].call){options.value=actions[i].call;stagesToUpdate.push(self.updateActionButton("call",options))}else if(actions[i].raise){options.value=actions[i].raise[0];stagesToUpdate.push(self.updateActionButton("raise",options));if(actions[i].raise[0]!=actions[i].raise[1]){stagesToUpdate.push(self.displayBetSlider(actions[i].raise[0],actions[i].raise[1]))}}else if(actions[i].bet){options.value=actions[i].bet[0];stagesToUpdate.push(self.updateActionButton("bet",options));stagesToUpdate.push(self.displayBetSlider(actions[i].bet[0],actions[i].bet[1]))}});var promptSound=createjs.Sound.createInstance(self.images.sources.toActAlertSound);promptSound.setVolume(.2);promptSound.play();stagesToUpdate.push(self.playerToAct(self.gameState.userSeatNumber,timeout));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}));
self.updateStages(stagesToUpdate)});socket.on("hands_shown",function(players){for(var i=0;i<players.length;i++){self.hideHoleCards(players[i].seat);self.displayHoleCards(players[i].hand,players[i].seat)}});socket.on("update_time_to_act",function(seatNumber,time){self.gameState.seats[seatNumber].timeToActInMS=time});socket.on("hands_shown",function(players){for(var i=0;i<players.length;i++){self.hideHoleCards(players[i].seat);self.displayHoleCards(players[i].hand,players[i].seat)}});socket.on("game_event",function(messageString,timeStampString){var chatObjectForInternalFunctionUse={};chatObjectForInternalFunctionUse.chatSourceType="dealer";chatObjectForInternalFunctionUse.message=_.escape(messageString);chatObjectForInternalFunctionUse.timeStampString=timeStampString;self.updateTableChatFullMessageTextFromCurrentOrAdditionalData(chatObjectForInternalFunctionUse)});socket.on("player_to_act",function(player,timeout){var timeToCountDown=3e3;if(player.seat!=self.gameState.userSeatNumber){self.playerToAct(player.seat,timeout)}});socket.on("notification",function(notificationString){if(notificationString=="You will sit out as soon as the hand is over."){return null}else if(notificationString.indexOf("chips as soon as the hand is over")!==-1){self.hideCashier()}var chatInfo={};chatInfo.seat=self.gameState.userSeatNumber;chatInfo.message=notificationString;self.displayBubbleChatPopover(chatInfo)});socket.on("user_chats",function(chatInfo){chatInfo.message=chatInfo.message.replace(/^\s+|\s+$/g,"");if(/\S/.test(chatInfo.message)){if(_.isNull(chatInfo.seat)||_.isUndefined(chatInfo.seat)){console.log("observer chatted");var chatObjectForInternalFunctionUse={};chatObjectForInternalFunctionUse.chatSourceType="observer";chatObjectForInternalFunctionUse.message=chatInfo.sender+" (obs) says: "+chatInfo.message;self.updateTableChatFullMessageTextFromCurrentOrAdditionalData(chatObjectForInternalFunctionUse)}else{console.log("seated player chatted");var chatObjectForInternalFunctionUse={};chatObjectForInternalFunctionUse.chatSourceType="player";chatObjectForInternalFunctionUse.message=chatInfo.sender+" says: "+chatInfo.message;self.updateTableChatFullMessageTextFromCurrentOrAdditionalData(chatObjectForInternalFunctionUse);self.displayBubbleChatPopover(chatInfo)}}});socket.on("player_sits_in",function(player){var stagesToUpdate=[];self.setPreactionData("permanent","sitting_out",false,{server:false,seat:player.seat});self.setPreactionData("permanent","getting_chips",false,{server:false,seat:player.seat});stagesToUpdate.push(self.images.seats[player.seat].stackSize.updateText(player.chips,{update:false}));if(player.seat==self.gameState.userSeatNumber){setFlags(player,false,{update:false,server:false,seat:player.seat})}stagesToUpdate.push(self.displayCorrectSeatItems(player.seat,{update:false}));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}));self.updateStages(stagesToUpdate)});socket.on("player_sits_out",function(player){var stagesToUpdate=[];stagesToUpdate.push(self.playerSitsOut(player.seat));stagesToUpdate.push(setFlags(player,false,{update:false,server:false,seat:player.seat}));if(player.seat==self.gameState.userSeatNumber){stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}))}self.updateStages(stagesToUpdate)});socket.on("player_sits",function(player,is_you){var stagesToUpdate=[];self.clearExpirationData("permanent",player.seat);if(is_you==true){socket.emit("get_add_chips_info");self.gameState.userSeatNumber=player.seat;self.changeUserSeatView(self.sessionPreferences.changeUserSeatViewTo.value);stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}))}stagesToUpdate.push(self.playerSits(player.seat,player.username,player.chips));for(var i=0;i<self.gameState.numSeats;i++){stagesToUpdate.push(self.displayCorrectSeatItems(i,{update:false}))}self.updateStages(stagesToUpdate)});socket.on("player_stands",function(player,seatNumber,is_you){if(is_you){self.gameState.userSeatNumber=false;self.hideSeatedOptions();self.changeUserSeatView()}self.playerStands(seatNumber)});socket.on("add_chips_info",function(info){self.displayCashier(info)});socket.on("player_sets_flag",function(player){});socket.on("player_adds_chips",function(player,is_you){var options={};options.update=false;var stagesToUpdate=[];self.setPreactionData("permanent","getting_chips",false,{seat:player.seat,server:false});if(is_you===true){player.seat=self.gameState.userSeatNumber}if(player.sitting_out===true){stagesToUpdate.push(self.playerSitsOut(player.seat,options))}if(!_.isUndefined(player.chips)){stagesToUpdate.push(self.images.seats[player.seat].stackSize.updateText(player.chips,options))}if(is_you){stagesToUpdate.push(self.hideCashier(options));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions({update:false}))}stagesToUpdate.push(self.displayCorrectSeatItems(player.seat,{update:false}));self.updateStages(stagesToUpdate)});socket.on("winners",function(players){for(var i=0;i<self.gameState.seats.length;i++){self.clearExpirationData("hand",i)}self.updateUserOptionsBasedOnFlagsAndPreactions();self.winners(players)});socket.on("reset_table",function(players){var options={update:false};var stagesToUpdate=[];stagesToUpdate.push(self.roundEnds());for(var i=0;i<self.images.seats.length;i++){stagesToUpdate.push(self.hideChildren(self.images.seats[i].hiddenCards,options));stagesToUpdate.push(self.hideChildren(self.images.seats[i].shownCards,options))}stagesToUpdate.push(self.hideChildren(self.images.community,options));stagesToUpdate.push(self.updateUserOptionsBasedOnFlagsAndPreactions(options));self.updateStages(stagesToUpdate)})}}jQuery(document).ready(function(){holdemCanvas=new Table;var landingPage=holdemCanvas.getPlayZoneLandingPage();var setIFrameToTopHandler=function(){console.log("trying to run setIFrameToTop @ ");console.log(this);landingPage.iframes.setIFrameToTop(this)};if(holdemCanvas.isIframe()){console.log("this is an iframe");holdemCanvas.loadImageSources();$(holdemCanvas.getIframe()).off("mousedown.setToTop");$(holdemCanvas.getIframe()).on("mousedown.setToTop",setIFrameToTopHandler);$(window).on("mousedown.triggerIframeSetToTop",function(e){console.log("window mousedown triggered");console.log(holdemCanvas.getIframe());$(holdemCanvas.getIframe()).trigger("mousedown.setToTop")})}else{console.log("this is not an iframe");holdemCanvas.loadImageSources(true)}});jQuery(window).load(function(){console.log("window load function claled");console.log(document)});